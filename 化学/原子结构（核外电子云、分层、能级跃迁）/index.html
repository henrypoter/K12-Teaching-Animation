<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸå­ç»“æ„ï¼šç”µå­äº‘ã€èƒ½çº§ä¸è·ƒè¿</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f1a30 0%, #1a2c42 100%);
            color: #ecf0f1;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            max-width: 900px;
        }

        h1 {
            color: #f1c40f;
            margin-bottom: 10px;
            font-size: 2.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .subtitle {
            color: #bdc3c7;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            max-width: 1200px;
            width: 100%;
            justify-content: center;
        }

        .main-canvas-container {
            flex: 1;
            min-width: 600px;
            background-color: rgba(44, 62, 80, 0.7);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }

        #atomCanvas {
            display: block;
            width: 100%;
            height: 500px;
            background-color: rgba(15, 26, 48, 0.9);
            border-radius: 10px;
        }

        .controls-panel {
            width: 320px;
            background-color: rgba(44, 62, 80, 0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .panel-section {
            border-bottom: 1px solid rgba(189, 195, 199, 0.2);
            padding-bottom: 20px;
        }

        .panel-section:last-child {
            border-bottom: none;
        }

        h2 {
            color: #3498db;
            font-size: 1.4rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        h2 i {
            font-size: 1.2rem;
        }

        .scene-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .scene-btn {
            padding: 12px 10px;
            background-color: #2c3e50;
            color: #ecf0f1;
            border: 2px solid #3498db;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
        }

        .scene-btn:hover {
            background-color: #3498db;
            transform: translateY(-2px);
        }

        .scene-btn.active {
            background-color: #1abc9c;
            border-color: #1abc9c;
            box-shadow: 0 0 15px rgba(26, 188, 156, 0.5);
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-label {
            display: block;
            margin-bottom: 8px;
            color: #bdc3c7;
            font-size: 0.95rem;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="range"] {
            flex: 1;
            height: 8px;
            -webkit-appearance: none;
            background: linear-gradient(to right, #2c3e50, #3498db);
            border-radius: 4px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background-color: #f1c40f;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(241, 196, 15, 0.8);
        }

        .slider-value {
            min-width: 40px;
            text-align: center;
            font-weight: bold;
            color: #f1c40f;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .btn {
            padding: 10px 15px;
            background-color: #34495e;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            flex: 1;
            min-width: 120px;
        }

        .btn:hover {
            background-color: #4a6b8f;
            transform: translateY(-2px);
        }

        .btn.primary {
            background-color: #3498db;
        }

        .btn.primary:hover {
            background-color: #2980b9;
        }

        .btn.warning {
            background-color: #f39c12;
        }

        .btn.warning:hover {
            background-color: #e67e22;
        }

        .btn.success {
            background-color: #2ecc71;
        }

        .btn.success:hover {
            background-color: #27ae60;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .info-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background-color: rgba(44, 62, 80, 0.85);
            border-radius: 10px;
            padding: 15px;
            border-left: 5px solid #1abc9c;
            font-size: 0.95rem;
            line-height: 1.5;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            max-height: 120px;
            overflow-y: auto;
        }

        .info-title {
            color: #f1c40f;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .footer {
            margin-top: 30px;
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9rem;
            max-width: 900px;
        }

        @media (max-width: 1000px) {
            .container {
                flex-direction: column;
                align-items: center;
            }
            
            .main-canvas-container, .controls-panel {
                width: 100%;
                min-width: unset;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>åŸå­ç»“æ„ï¼šç”µå­äº‘ã€èƒ½çº§ä¸è·ƒè¿</h1>
        <p class="subtitle">æ¢ç´¢å¾®è§‚ä¸–ç•Œçš„é‡å­ç‰¹æ€§ - ç”µå­æ¦‚ç‡åˆ†å¸ƒã€é‡å­åŒ–èƒ½çº§ä¸å…‰å­å‘å°„</p>
    </div>

    <div class="container">
        <div class="main-canvas-container">
            <canvas id="atomCanvas" width="800" height="500"></canvas>
            <div class="info-panel">
                <div class="info-title" id="infoTitle">æ¬¢è¿æ¥åˆ°åŸå­ä¸–ç•Œ</div>
                <div id="infoText">è¯·é€‰æ‹©ä¸€ä¸ªåœºæ™¯å¼€å§‹æ¢ç´¢ã€‚ç”µå­äº‘æ¨¡å‹å±•ç¤ºäº†ç”µå­åœ¨åŸå­æ ¸å‘¨å›´å‡ºç°çš„æ¦‚ç‡åˆ†å¸ƒï¼Œè€Œä¸æ˜¯å›ºå®šçš„è½¨é“ã€‚</div>
            </div>
        </div>

        <div class="controls-panel">
            <div class="panel-section">
                <h2>ğŸ“š å­¦ä¹ åœºæ™¯</h2>
                <div class="scene-buttons">
                    <button class="scene-btn active" data-scene="electronCloud">ç”µå­äº‘æ¦‚ç‡æ¨¡å‹</button>
                    <button class="scene-btn" data-scene="energyLevels">èƒ½çº§ä¸å£³å±‚</button>
                    <button class="scene-btn" data-scene="orbitals">è½¨é“å½¢çŠ¶</button>
                    <button class="scene-btn" data-scene="transitions">èƒ½çº§è·ƒè¿</button>
                </div>
            </div>

            <div class="panel-section">
                <h2>âš™ï¸ æ¨¡æ‹Ÿæ§åˆ¶</h2>
                <div class="control-group">
                    <div class="control-label">ç”µå­å‡ºç°é¢‘ç‡ï¼š<span id="speedValue" class="slider-value">ä¸­é€Ÿ</span></div>
                    <div class="slider-container">
                        <input type="range" id="speedSlider" min="1" max="10" value="5">
                    </div>
                </div>
                
                <div class="button-group">
                    <button id="playBtn" class="btn primary">â–¶ è¿è¡Œæ¨¡æ‹Ÿ</button>
                    <button id="resetBtn" class="btn">ğŸ”„ é‡ç½®</button>
                    <button id="clearBtn" class="btn">ğŸ—‘ï¸ æ¸…é™¤è½¨è¿¹</button>
                </div>
            </div>

            <div class="panel-section">
                <h2>ğŸ”¬ åŸå­å‚æ•°</h2>
                <div class="control-group">
                    <div class="control-label">é€‰æ‹©å…ƒç´ ï¼š</div>
                    <select id="elementSelect" class="btn" style="width:100%; padding:10px;">
                        <option value="H">æ°¢ (H) - 1ä¸ªç”µå­</option>
                        <option value="He">æ°¦ (He) - 2ä¸ªç”µå­</option>
                        <option value="Li">é”‚ (Li) - 3ä¸ªç”µå­</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <div class="control-label">èƒ½çº§è·ƒè¿èƒ½é‡ï¼š<span id="energyValue" class="slider-value">0.0 eV</span></div>
                    <div class="slider-container">
                        <input type="range" id="energySlider" min="0" max="15" value="0" step="0.5">
                    </div>
                </div>
                
                <div class="button-group">
                    <button id="exciteBtn" class="btn warning">âš¡ æ¿€å‘åŸå­</button>
                    <button id="autoDecayBtn" class="btn success">ğŸ”„ è‡ªåŠ¨è¡°å‡: å…³</button>
                    <button id="spectrumBtn" class="btn">ğŸŒˆ æ˜¾ç¤ºå…‰è°±</button>
                </div>
            </div>

            <div class="panel-section">
                <h2>ğŸ‘ï¸ æ˜¾ç¤ºé€‰é¡¹</h2>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" id="showPoints" checked>
                        <span>æ¦‚ç‡ç‚¹</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="showCloud" checked>
                        <span>ç”µå­äº‘è½®å»“</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="showLevels" checked>
                        <span>èƒ½çº§çº¿</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="showLabels">
                        <span>è½¨é“æ ‡ç­¾</span>
                    </label>
                </div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #f1c40f;"></div>
                        <span>åŸå­æ ¸</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #3498db;"></div>
                        <span>ç”µå­/æ¦‚ç‡ç‚¹</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: rgba(52, 152, 219, 0.2);"></div>
                        <span>ç”µå­äº‘åŒºåŸŸ</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>æ•™å­¦åŠ¨ç”» | åŸå­ç»“æ„ï¼šæ ¸å¤–ç”µå­äº‘ã€åˆ†å±‚ã€èƒ½çº§è·ƒè¿ | è®¾è®¡åŸç†ï¼šé‡å­åŠ›å­¦æ¦‚ç‡æ¨¡å‹ã€ç»å°”èƒ½çº§ã€ç”µå­è·ƒè¿</p>
    </div>

    <script>
        // è·å–Canvaså’Œä¸Šä¸‹æ–‡
        const canvas = document.getElementById('atomCanvas');
        const ctx = canvas.getContext('2d');
        
        // åŠ¨ç”»çŠ¶æ€
        let animationId = null;
        let isPlaying = true;
        let currentScene = 'electronCloud';
        let points = []; // å­˜å‚¨æ¦‚ç‡ç‚¹
        let orbitals = []; // å­˜å‚¨è½¨é“æ•°æ®
        let transitions = []; // å­˜å‚¨è·ƒè¿åŠ¨ç”»
        let photons = []; // å­˜å‚¨å…‰å­
        let autoDecay = false;
        let showSpectrum = false;
        
        // åŸå­å‚æ•°
        let atom = {
            element: 'H',
            electronCount: 1,
            nucleusRadius: 12,
            energyLevels: [
                {n: 1, radius: 80, electrons: 1, color: '#3498db'},
                {n: 2, radius: 160, electrons: 0, color: '#1abc9c'},
                {n: 3, radius: 240, electrons: 0, color: '#9b59b6'},
                {n: 4, radius: 320, electrons: 0, color: '#e74c3c'}
            ],
            excitedLevel: 1 // å½“å‰æ¿€å‘åˆ°çš„èƒ½çº§
        };
        
        // èƒ½çº§è·ƒè¿èƒ½é‡ (eV)
        const transitionEnergies = {
            '1-2': 10.2,
            '1-3': 12.1,
            '1-4': 12.75,
            '2-3': 1.89,
            '2-4': 2.55,
            '3-4': 0.66
        };
        
        // è·ƒè¿å¯¹åº”çš„é¢œè‰²
        const transitionColors = {
            '1-2': '#e74c3c', // çº¢è‰²
            '1-3': '#f39c12', // æ©™è‰²
            '1-4': '#f1c40f', // é»„è‰²
            '2-3': '#2ecc71', // ç»¿è‰²
            '2-4': '#1abc9c', // è“ç»¿è‰²
            '3-4': '#3498db'  // è“è‰²
        };
        
        // è½¨é“å½¢çŠ¶æ•°æ®
        const orbitalShapes = {
            's': {type: 's', radius: 80, color: 'rgba(52, 152, 219, 0.15)'},
            'px': {type: 'p', axis: 'x', radius: 120, color: 'rgba(26, 188, 156, 0.15)'},
            'py': {type: 'p', axis: 'y', radius: 120, color: 'rgba(26, 188, 156, 0.15)'},
            'pz': {type: 'p', axis: 'z', radius: 120, color: 'rgba(26, 188, 156, 0.15)'}
        };
        
        // åˆå§‹åŒ–
        function init() {
            // è®¾ç½®Canvaså°ºå¯¸
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            // åˆå§‹åŒ–è½¨é“
            orbitals = [];
            for (let i = 0; i < 4; i++) {
                orbitals.push({
                    x: canvas.width/2,
                    y: canvas.height/2,
                    radius: 80 + i * 80,
                    points: []
                });
            }
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            setupEventListeners();
            
            // å¼€å§‹åŠ¨ç”»å¾ªç¯
            animate();
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // åœºæ™¯æŒ‰é’®
            document.querySelectorAll('.scene-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.scene-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentScene = this.dataset.scene;
                    updateInfoPanel();
                    
                    // é‡ç½®ä¸€äº›çŠ¶æ€
                    if (currentScene === 'electronCloud') {
                        points = [];
                    }
                    if (currentScene === 'transitions') {
                        transitions = [];
                        photons = [];
                    }
                });
            });
            
            // æ’­æ”¾/æš‚åœæŒ‰é’®
            document.getElementById('playBtn').addEventListener('click', function() {
                isPlaying = !isPlaying;
                this.textContent = isPlaying ? 'â¸ æš‚åœæ¨¡æ‹Ÿ' : 'â–¶ è¿è¡Œæ¨¡æ‹Ÿ';
            });
            
            // é‡ç½®æŒ‰é’®
            document.getElementById('resetBtn').addEventListener('click', function() {
                points = [];
                transitions = [];
                photons = [];
                atom.excitedLevel = 1;
                updateAtomFromElement();
            });
            
            // æ¸…é™¤æŒ‰é’®
            document.getElementById('clearBtn').addEventListener('click', function() {
                points = [];
            });
            
            // é€Ÿåº¦æ»‘å—
            const speedSlider = document.getElementById('speedSlider');
            const speedValue = document.getElementById('speedValue');
            speedSlider.addEventListener('input', function() {
                const speeds = ['ææ…¢', 'å¾ˆæ…¢', 'æ…¢', 'è¾ƒæ…¢', 'ä¸­é€Ÿ', 'è¾ƒå¿«', 'å¿«', 'å¾ˆå¿«', 'æå¿«', 'è¶…å¿«'];
                speedValue.textContent = speeds[this.value - 1];
            });
            
            // å…ƒç´ é€‰æ‹©
            document.getElementById('elementSelect').addEventListener('change', function() {
                atom.element = this.value;
                updateAtomFromElement();
            });
            
            // èƒ½é‡æ»‘å—
            const energySlider = document.getElementById('energySlider');
            const energyValue = document.getElementById('energyValue');
            energySlider.addEventListener('input', function() {
                energyValue.textContent = this.value + ' eV';
            });
            
            // æ¿€å‘æŒ‰é’®
            document.getElementById('exciteBtn').addEventListener('click', function() {
                const energy = parseFloat(energySlider.value);
                triggerTransition(energy);
            });
            
            // è‡ªåŠ¨è¡°å‡æŒ‰é’®
            document.getElementById('autoDecayBtn').addEventListener('click', function() {
                autoDecay = !autoDecay;
                this.textContent = autoDecay ? 'ğŸ”„ è‡ªåŠ¨è¡°å‡: å¼€' : 'ğŸ”„ è‡ªåŠ¨è¡°å‡: å…³';
                this.classList.toggle('success', autoDecay);
            });
            
            // å…‰è°±æŒ‰é’®
            document.getElementById('spectrumBtn').addEventListener('click', function() {
                showSpectrum = !showSpectrum;
                this.textContent = showSpectrum ? 'ğŸŒˆ éšè—å…‰è°±' : 'ğŸŒˆ æ˜¾ç¤ºå…‰è°±';
            });
            
            // æ˜¾ç¤ºé€‰é¡¹
            document.getElementById('showPoints').addEventListener('change', updateDisplay);
            document.getElementById('showCloud').addEventListener('change', updateDisplay);
            document.getElementById('showLevels').addEventListener('change', updateDisplay);
            document.getElementById('showLabels').addEventListener('change', updateDisplay);
            
            // çª—å£å¤§å°è°ƒæ•´
            window.addEventListener('resize', function() {
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
            });
        }
        
        // æ ¹æ®é€‰æ‹©çš„å…ƒç´ æ›´æ–°åŸå­å‚æ•°
        function updateAtomFromElement() {
            switch(atom.element) {
                case 'H':
                    atom.electronCount = 1;
                    atom.energyLevels[0].electrons = 1;
                    atom.energyLevels[1].electrons = 0;
                    atom.energyLevels[2].electrons = 0;
                    atom.energyLevels[3].electrons = 0;
                    break;
                case 'He':
                    atom.electronCount = 2;
                    atom.energyLevels[0].electrons = 2;
                    atom.energyLevels[1].electrons = 0;
                    atom.energyLevels[2].electrons = 0;
                    atom.energyLevels[3].electrons = 0;
                    break;
                case 'Li':
                    atom.electronCount = 3;
                    atom.energyLevels[0].electrons = 2;
                    atom.energyLevels[1].electrons = 1;
                    atom.energyLevels[2].electrons = 0;
                    atom.energyLevels[3].electrons = 0;
                    break;
            }
            atom.excitedLevel = 1;
        }
        
        // è§¦å‘èƒ½çº§è·ƒè¿
        function triggerTransition(energy) {
            // æŸ¥æ‰¾æœ€åŒ¹é…çš„èƒ½çº§è·ƒè¿
            let closestTransition = null;
            let minDiff = Infinity;
            
            for (const [key, value] of Object.entries(transitionEnergies)) {
                const diff = Math.abs(energy - value);
                if (diff < minDiff && diff < 1.5) { // å®¹å¿åº¦1.5eV
                    minDiff = diff;
                    closestTransition = key;
                }
            }
            
            if (closestTransition) {
                const [from, to] = closestTransition.split('-').map(Number);
                
                // æ£€æŸ¥æ˜¯å¦å¯ä»¥ä»å½“å‰èƒ½çº§è·ƒè¿
                if (from === atom.excitedLevel) {
                    // æ·»åŠ è·ƒè¿åŠ¨ç”»
                    transitions.push({
                        fromLevel: from,
                        toLevel: to,
                        progress: 0,
                        color: transitionColors[closestTransition],
                        direction: 'up'
                    });
                    
                    // æ›´æ–°åŸå­æ¿€å‘æ€
                    atom.excitedLevel = to;
                    
                    // æ›´æ–°ä¿¡æ¯é¢æ¿
                    updateInfoPanel(`ç”µå­ä» n=${from} è·ƒè¿åˆ° n=${to}ï¼Œå¸æ”¶ ${transitionEnergies[closestTransition].toFixed(2)} eV èƒ½é‡`);
                    
                    // å¦‚æœè‡ªåŠ¨è¡°å‡å¼€å¯ï¼Œç¨åè§¦å‘è¡°å‡
                    if (autoDecay) {
                        setTimeout(() => {
                            triggerDecay(to, from);
                        }, 1500);
                    }
                } else {
                    updateInfoPanel(`å½“å‰ç”µå­åœ¨ n=${atom.excitedLevel}ï¼Œéœ€è¦ ${transitionEnergies[closestTransition].toFixed(2)} eV æ‰èƒ½è·ƒè¿åˆ° n=${to}`);
                }
            } else {
                updateInfoPanel(`èƒ½é‡ ${energy.toFixed(2)} eV ä¸åŒ¹é…ä»»ä½•å…è®¸çš„èƒ½çº§è·ƒè¿`);
            }
        }
        
        // è§¦å‘è¡°å‡ï¼ˆè‡ªå‘è¾å°„ï¼‰
        function triggerDecay(from, to) {
            const key = `${to}-${from}`;
            if (transitionColors[key]) {
                transitions.push({
                    fromLevel: from,
                    toLevel: to,
                    progress: 0,
                    color: transitionColors[key],
                    direction: 'down'
                });
                
                // æ·»åŠ å…‰å­
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const fromRadius = atom.energyLevels[from-1].radius;
                const angle = Math.random() * Math.PI * 2;
                
                photons.push({
                    x: centerX + Math.cos(angle) * fromRadius,
                    y: centerY + Math.sin(angle) * fromRadius,
                    color: transitionColors[key],
                    radius: 5,
                    speed: 3,
                    angle: angle,
                    life: 100
                });
                
                // æ›´æ–°åŸå­çŠ¶æ€
                atom.excitedLevel = to;
                
                updateInfoPanel(`ç”µå­ä» n=${from} è¡°å‡åˆ° n=${to}ï¼Œå‘å°„ ${transitionEnergies[key].toFixed(2)} eV å…‰å­`);
            }
        }
        
        // æ›´æ–°ä¿¡æ¯é¢æ¿
        function updateInfoPanel(customText) {
            const infoTitle = document.getElementById('infoTitle');
            const infoText = document.getElementById('infoText');
            
            const sceneInfo = {
                'electronCloud': {
                    title: 'ç”µå­äº‘æ¦‚ç‡æ¨¡å‹',
                    text: 'æ¯ä¸ªè“ç‚¹è¡¨ç¤ºç”µå­å¯èƒ½å‡ºç°çš„ä½ç½®ã€‚éšç€æ—¶é—´æ¨ç§»ï¼Œç‚¹çš„åˆ†å¸ƒå½¢æˆ"ç”µå­äº‘"ï¼Œæ˜¾ç¤ºç”µå­åœ¨åŸå­æ ¸å‘¨å›´çš„æ¦‚ç‡å¯†åº¦ã€‚'
                },
                'energyLevels': {
                    title: 'èƒ½çº§ä¸å£³å±‚',
                    text: 'ç°è‰²è™šçº¿è¡¨ç¤ºé‡å­åŒ–çš„èƒ½çº§ï¼ˆK, L, M...å±‚ï¼‰ã€‚ç”µå­åªèƒ½å­˜åœ¨äºè¿™äº›ç‰¹å®šèƒ½çº§ä¸Šï¼Œä¸èƒ½å¤„äºèƒ½çº§ä¹‹é—´ã€‚'
                },
                'orbitals': {
                    title: 'è½¨é“å½¢çŠ¶',
                    text: 'sè½¨é“å‘ˆçƒå½¢å¯¹ç§°ï¼Œpè½¨é“å‘ˆå“‘é“ƒå½¢ï¼ˆæ²¿xã€yã€zè½´ï¼‰ã€‚ä¸åŒå½¢çŠ¶çš„è½¨é“å¯¹åº”ä¸åŒçš„è§’åŠ¨é‡é‡å­æ•°ã€‚'
                },
                'transitions': {
                    title: 'èƒ½çº§è·ƒè¿',
                    text: 'ç”µå­å¸æ”¶èƒ½é‡è·ƒè¿åˆ°é«˜èƒ½çº§ï¼ˆæ¿€å‘æ€ï¼‰ï¼Œç„¶åè‡ªå‘è·ƒè¿å›ä½èƒ½çº§å¹¶å‘å°„å…‰å­ã€‚å…‰å­é¢œè‰²å–å†³äºèƒ½çº§å·®ã€‚'
                }
            };
            
            if (customText) {
                infoText.textContent = customText;
            } else {
                infoTitle.textContent = sceneInfo[currentScene].title;
                infoText.textContent = sceneInfo[currentScene].text;
            }
        }
        
        // æ›´æ–°æ˜¾ç¤ºï¼ˆå ä½å‡½æ•°ï¼‰
        function updateDisplay() {
            // æ˜¾ç¤ºé€‰é¡¹å·²åœ¨ç»˜åˆ¶å‡½æ•°ä¸­å¤„ç†
        }
        
        // ç”Ÿæˆæ¦‚ç‡ç‚¹
        function generateProbabilityPoint() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            // æ ¹æ®å½“å‰åœºæ™¯å’Œèƒ½çº§ç”Ÿæˆç‚¹
            let radius, angle;
            
            if (currentScene === 'electronCloud' || currentScene === 'energyLevels') {
                // åŸºäºå½“å‰æ¿€å‘èƒ½çº§
                const levelIndex = Math.min(atom.excitedLevel - 1, 3);
                const baseRadius = atom.energyLevels[levelIndex].radius;
                
                // é«˜æ–¯åˆ†å¸ƒï¼Œæ›´é è¿‘èƒ½çº§åŠå¾„
                radius = baseRadius * (0.7 + Math.random() * 0.6);
                angle = Math.random() * Math.PI * 2;
                
                // æ·»åŠ ä¸€äº›éšæœºæ€§
                radius += (Math.random() - 0.5) * 30;
            } else if (currentScene === 'orbitals') {
                // è½¨é“ç‰¹å®šåˆ†å¸ƒ
                const orbitalType = Math.random() > 0.5 ? 's' : 'p';
                
                if (orbitalType === 's') {
                    // sè½¨é“ï¼šçƒå½¢å¯¹ç§°
                    radius = 80 * Math.sqrt(Math.random());
                    angle = Math.random() * Math.PI * 2;
                } else {
                    // pè½¨é“ï¼šå“‘é“ƒå½¢åˆ†å¸ƒ
                    const axis = Math.floor(Math.random() * 3); // 0:x, 1:y, 2:z
                    radius = 120 * (Math.random() * 0.8 + 0.2);
                    
                    if (axis === 0) {
                        // æ²¿xè½´
                        angle = Math.random() > 0.5 ? 0 : Math.PI;
                        radius *= Math.random() > 0.5 ? 1 : -1;
                    } else if (axis === 1) {
                        // æ²¿yè½´
                        angle = Math.random() > 0.5 ? Math.PI/2 : 3*Math.PI/2;
                        radius *= Math.random() > 0.5 ? 1 : -1;
                    } else {
                        // æ²¿zè½´ï¼ˆåœ¨2Dä¸­è¡¨ç°ä¸ºç‚¹æ›´é è¿‘ä¸­å¿ƒï¼‰
                        radius = 60 * Math.sqrt(Math.random());
                        angle = Math.random() * Math.PI * 2;
                    }
                }
            }
            
            const x = centerX + Math.cos(angle) * radius;
            const y = centerY + Math.sin(angle) * radius;
            
            points.push({
                x, y,
                radius: 2,
                color: atom.energyLevels[Math.min(atom.excitedLevel-1, 3)].color,
                life: 200 + Math.random() * 100 // ç‚¹çš„å­˜æ´»æ—¶é—´
            });
            
            // é™åˆ¶ç‚¹çš„æ•°é‡
            if (points.length > 1000) {
                points.splice(0, 100);
            }
        }
        
        // ç»˜åˆ¶å‡½æ•°
        function draw() {
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            // ç»˜åˆ¶èƒ½çº§çº¿ï¼ˆå¦‚æœå¼€å¯ï¼‰
            if (document.getElementById('showLevels').checked) {
                for (let i = 0; i < atom.energyLevels.length; i++) {
                    const level = atom.energyLevels[i];
                    
                    // è™šçº¿èƒ½çº§åœ†
                    ctx.beginPath();
                    ctx.setLineDash([5, 5]);
                    ctx.arc(centerX, centerY, level.radius, 0, Math.PI * 2);
                    ctx.strokeStyle = i < atom.excitedLevel ? level.color : '#bdc3c7';
                    ctx.lineWidth = 1;
                    ctx.stroke();
                    ctx.setLineDash([]);
                    
                    // èƒ½çº§æ ‡ç­¾
                    if (document.getElementById('showLabels').checked) {
                        ctx.fillStyle = i < atom.excitedLevel ? level.color : '#bdc3c7';
                        ctx.font = 'bold 16px Arial';
                        ctx.fillText(`n=${i+1}`, centerX + level.radius + 10, centerY);
                        
                        // ç”µå­æ•°
                        ctx.font = '14px Arial';
                        ctx.fillText(`${level.electrons}eâ»`, centerX + level.radius + 10, centerY + 20);
                    }
                }
            }
            
            // ç»˜åˆ¶ç”µå­äº‘è½®å»“ï¼ˆå¦‚æœå¼€å¯ä¸”æ˜¯ç›¸å…³åœºæ™¯ï¼‰
            if (document.getElementById('showCloud').checked && 
                (currentScene === 'electronCloud' || currentScene === 'orbitals')) {
                
                // æ ¹æ®å½“å‰æ¿€å‘èƒ½çº§ç»˜åˆ¶äº‘è½®å»“
                const levelIndex = Math.min(atom.excitedLevel - 1, 3);
                const cloudRadius = atom.energyLevels[levelIndex].radius;
                
                // ç»˜åˆ¶åŠé€æ˜ç”µå­äº‘åŒºåŸŸ
                ctx.beginPath();
                ctx.arc(centerX, centerY, cloudRadius, 0, Math.PI * 2);
                const gradient = ctx.createRadialGradient(
                    centerX, centerY, cloudRadius * 0.3,
                    centerX, centerY, cloudRadius
                );
                gradient.addColorStop(0, 'rgba(52, 152, 219, 0.3)');
                gradient.addColorStop(1, 'rgba(52, 152, 219, 0.05)');
                ctx.fillStyle = gradient;
                ctx.fill();
                
                // ç»˜åˆ¶äº‘è¾¹ç•Œ
                ctx.beginPath();
                ctx.arc(centerX, centerY, cloudRadius, 0, Math.PI * 2);
                ctx.strokeStyle = 'rgba(52, 152, 219, 0.5)';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
            
            // ç»˜åˆ¶è½¨é“å½¢çŠ¶ï¼ˆå¦‚æœæ˜¯è½¨é“åœºæ™¯ï¼‰
            if (currentScene === 'orbitals') {
                // sè½¨é“
                ctx.beginPath();
                ctx.arc(centerX, centerY, 80, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(52, 152, 219, 0.15)';
                ctx.fill();
                ctx.strokeStyle = '#3498db';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // pè½¨é“ï¼ˆä¸‰ä¸ªæ–¹å‘ï¼‰
                // px
                ctx.beginPath();
                ctx.ellipse(centerX, centerY, 120, 40, 0, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(26, 188, 156, 0.15)';
                ctx.fill();
                ctx.strokeStyle = '#1abc9c';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // py
                ctx.beginPath();
                ctx.ellipse(centerX, centerY, 40, 120, 0, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(26, 188, 156, 0.15)';
                ctx.fill();
                ctx.strokeStyle = '#1abc9c';
                ctx.stroke();
                
                if (document.getElementById('showLabels').checked) {
                    ctx.fillStyle = '#3498db';
                    ctx.font = 'bold 16px Arial';
                    ctx.fillText('sè½¨é“', centerX, centerY - 100);
                    
                    ctx.fillStyle = '#1abc9c';
                    ctx.fillText('pè½¨é“', centerX + 140, centerY);
                }
            }
            
            // ç»˜åˆ¶æ¦‚ç‡ç‚¹ï¼ˆå¦‚æœå¼€å¯ï¼‰
            if (document.getElementById('showPoints').checked) {
                for (let i = 0; i < points.length; i++) {
                    const point = points[i];
                    
                    // æ›´æ–°ç‚¹å¯¿å‘½
                    point.life -= 1;
                    
                    // ç»˜åˆ¶ç‚¹
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, point.radius, 0, Math.PI * 2);
                    ctx.fillStyle = point.color;
                    ctx.globalAlpha = point.life / 300; // é€æ¸æ·¡å‡º
                    ctx.fill();
                    
                    // ç§»é™¤æ­»äº¡çš„ç‚¹
                    if (point.life <= 0) {
                        points.splice(i, 1);
                        i--;
                    }
                }
                ctx.globalAlpha = 1.0;
            }
            
            // ç»˜åˆ¶åŸå­æ ¸
            ctx.beginPath();
            ctx.arc(centerX, centerY, atom.nucleusRadius, 0, Math.PI * 2);
            const nucleusGradient = ctx.createRadialGradient(
                centerX, centerY, 0,
                centerX, centerY, atom.nucleusRadius
            );
            nucleusGradient.addColorStop(0, '#f1c40f');
            nucleusGradient.addColorStop(1, '#d35400');
            ctx.fillStyle = nucleusGradient;
            ctx.fill();
            
            // ç»˜åˆ¶è·ƒè¿åŠ¨ç”»
            for (let i = 0; i < transitions.length; i++) {
                const transition = transitions[i];
                
                const fromRadius = atom.energyLevels[transition.fromLevel-1].radius;
                const toRadius = atom.energyLevels[transition.toLevel-1].radius;
                const currentRadius = fromRadius + (toRadius - fromRadius) * transition.progress;
                
                // ç»˜åˆ¶è·ƒè¿ç®­å¤´
                ctx.beginPath();
                if (transition.direction === 'up') {
                    ctx.arc(centerX, centerY - currentRadius, 8, 0, Math.PI * 2);
                } else {
                    ctx.arc(centerX, centerY - currentRadius, 8, 0, Math.PI * 2);
                }
                ctx.fillStyle = transition.color;
                ctx.fill();
                
                // ç»˜åˆ¶ç®­å¤´æ–¹å‘
                ctx.beginPath();
                if (transition.direction === 'up') {
                    ctx.moveTo(centerX, centerY - currentRadius - 15);
                    ctx.lineTo(centerX - 10, centerY - currentRadius);
                    ctx.lineTo(centerX + 10, centerY - currentRadius);
                } else {
                    ctx.moveTo(centerX, centerY - currentRadius + 15);
                    ctx.lineTo(centerX - 10, centerY - currentRadius);
                    ctx
<!--æ£€æµ‹åˆ°ä»£ç æˆªæ–­ï¼Œè‡ªåŠ¨ç»­å†™ä¸­...-->
lineTo(centerX + 10, centerY - currentRadius);
                }
                ctx.closePath();
                ctx.fillStyle = transition.color;
                ctx.fill();
                
                // æ›´æ–°è¿›åº¦
                transition.progress += 0.02;
                
                // å¦‚æœåŠ¨ç”»å®Œæˆï¼Œç§»é™¤
                if (transition.progress >= 1) {
                    transitions.splice(i, 1);
                    i--;
                }
            }
            
            // ç»˜åˆ¶å…‰å­
            for (let i = 0; i < photons.length; i++) {
                const photon = photons[i];
                
                // æ›´æ–°ä½ç½®
                photon.x += Math.cos(photon.angle) * photon.speed;
                photon.y += Math.sin(photon.angle) * photon.speed;
                photon.life -= 1;
                
                // ç»˜åˆ¶å…‰å­
                ctx.beginPath();
                ctx.arc(photon.x, photon.y, photon.radius, 0, Math.PI * 2);
                const photonGradient = ctx.createRadialGradient(
                    photon.x, photon.y, 0,
                    photon.x, photon.y, photon.radius
                );
                photonGradient.addColorStop(0, photon.color);
                photonGradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
                ctx.fillStyle = photonGradient;
                ctx.fill();
                
                // ç»˜åˆ¶å…‰å°¾
                ctx.beginPath();
                ctx.moveTo(photon.x, photon.y);
                ctx.lineTo(
                    photon.x - Math.cos(photon.angle) * 15,
                    photon.y - Math.sin(photon.angle) * 15
                );
                ctx.strokeStyle = photon.color;
                ctx.lineWidth = 3;
                ctx.stroke();
                
                // ç§»é™¤æ­»äº¡çš„å…‰å­
                if (photon.life <= 0 || 
                    photon.x < 0 || photon.x > canvas.width || 
                    photon.y < 0 || photon.y > canvas.height) {
                    photons.splice(i, 1);
                    i--;
                }
            }
            
            // ç»˜åˆ¶å…‰è°±ï¼ˆå¦‚æœå¼€å¯ï¼‰
            if (showSpectrum && currentScene === 'transitions') {
                const spectrumWidth = 200;
                const spectrumHeight = 60;
                const spectrumX = canvas.width - spectrumWidth - 20;
                const spectrumY = 20;
                
                // å…‰è°±èƒŒæ™¯
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(spectrumX, spectrumY, spectrumWidth, spectrumHeight);
                
                // å…‰è°±æ ‡é¢˜
                ctx.fillStyle = '#f1c40f';
                ctx.font = 'bold 14px Arial';
                ctx.fillText('æ°¢åŸå­å‘å°„å…‰è°±', spectrumX + 10, spectrumY + 20);
                
                // ç»˜åˆ¶è°±çº¿
                const lines = [
                    {name: 'HÎ±', color: '#e74c3c', x: spectrumX + 30},
                    {name: 'HÎ²', color: '#f39c12', x: spectrumX + 70},
                    {name: 'HÎ³', color: '#f1c40f', x: spectrumX + 110},
                    {name: 'HÎ´', color: '#2ecc71', x: spectrumX + 150}
                ];
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i];
                    
                    // è°±çº¿
                    ctx.beginPath();
                    ctx.moveTo(line.x, spectrumY + 30);
                    ctx.lineTo(line.x, spectrumY + 50);
                    ctx.strokeStyle = line.color;
                    ctx.lineWidth = 3;
                    ctx.stroke();
                    
                    // æ ‡ç­¾
                    ctx.fillStyle = '#ecf0f1';
                    ctx.font = '12px Arial';
                    ctx.fillText(line.name, line.x - 8, spectrumY + 55);
                }
            }
            
            // ç»˜åˆ¶å½“å‰åœºæ™¯æ ‡é¢˜
            ctx.fillStyle = '#ecf0f1';
            ctx.font = 'bold 20px Arial';
            ctx.textAlign = 'left';
            
            const sceneTitles = {
                'electronCloud': 'ç”µå­äº‘æ¦‚ç‡æ¨¡å‹',
                'energyLevels': 'èƒ½çº§ä¸å£³å±‚',
                'orbitals': 'è½¨é“å½¢çŠ¶ (s, p)',
                'transitions': 'èƒ½çº§è·ƒè¿ä¸å…‰å­å‘å°„'
            };
            
            ctx.fillText(sceneTitles[currentScene] || 'åŸå­ç»“æ„', 20, 40);
            
            // ç»˜åˆ¶å½“å‰å…ƒç´ å’ŒçŠ¶æ€
            ctx.font = '16px Arial';
            ctx.fillText(`å…ƒç´ : ${atom.element} | ç”µå­æ•°: ${atom.electronCount} | å½“å‰èƒ½çº§: n=${atom.excitedLevel}`, 20, 70);
            
            // ç»˜åˆ¶ç»å…¸è½¨é“å¯¹æ¯”ï¼ˆä»…ç”µå­äº‘åœºæ™¯ï¼‰
            if (currentScene === 'electronCloud') {
                ctx.strokeStyle = 'rgba(231, 76, 60, 0.3)';
                ctx.setLineDash([5, 3]);
                ctx.beginPath();
                ctx.arc(centerX, centerY, 100, 0, Math.PI * 2);
                ctx.stroke();
                ctx.setLineDash([]);
                
                ctx.fillStyle = 'rgba(231, 76, 60, 0.7)';
                ctx.font = '14px Arial';
                ctx.fillText('ç»å…¸è½¨é“æ¨¡å‹ï¼ˆé”™è¯¯ï¼‰', centerX + 110, centerY - 10);
            }
        }
        
        // åŠ¨ç”»å¾ªç¯
        function animate() {
            draw();
            
            // å¦‚æœæ­£åœ¨æ’­æ”¾ï¼Œç”Ÿæˆæ–°çš„æ¦‚ç‡ç‚¹
            if (isPlaying) {
                const speed = parseInt(document.getElementById('speedSlider').value);
                const pointsPerFrame = Math.floor(speed / 2) + 1;
                
                for (let i = 0; i < pointsPerFrame; i++) {
                    generateProbabilityPoint();
                }
                
                // éšæœºè‡ªåŠ¨è¡°å‡ï¼ˆå¦‚æœå¼€å¯ï¼‰
                if (autoDecay && currentScene === 'transitions' && atom.excitedLevel > 1) {
                    if (Math.random() < 0.01) { // 1%æ¦‚ç‡æ¯å¸§
                        const from = atom.excitedLevel;
                        const to = Math.floor(Math.random() * (from - 1)) + 1;
                        triggerDecay(from, to);
                    }
                }
            }
            
            animationId = requestAnimationFrame(animate);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', init);
    </script>
</body>
</html>