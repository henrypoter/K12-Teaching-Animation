<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èœ¡çƒ›ç‡ƒçƒ§çš„å¾®è§‚è¿‡ç¨‹æ•™å­¦åŠ¨ç”»</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            max-width: 800px;
        }

        h1 {
            color: #ffeb3b;
            margin-bottom: 10px;
            font-size: 2.2rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            color: #94a3b8;
            font-size: 1.1rem;
            margin-bottom: 15px;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            max-width: 1000px;
            width: 100%;
        }

        .animation-area {
            position: relative;
            width: 100%;
            height: 500px;
            background-color: #1a2332;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid #2d3748;
        }

        #canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            background: rgba(30, 41, 59, 0.8);
            padding: 20px;
            border-radius: 10px;
            width: 100%;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            background: #4299e1;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            min-width: 120px;
        }

        .btn:hover {
            background: #3182ce;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(66, 153, 225, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-step {
            background: #38a169;
        }

        .btn-step:hover {
            background: #2f855a;
        }

        .btn-reset {
            background: #e53e3e;
        }

        .btn-reset:hover {
            background: #c53030;
        }

        .btn-view {
            background: #805ad5;
        }

        .btn-view:hover {
            background: #6b46c1;
        }

        .btn:disabled {
            background: #4a5568;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .info-panel {
            background: rgba(45, 55, 72, 0.9);
            border-radius: 10px;
            padding: 20px;
            width: 100%;
            border-left: 4px solid #4299e1;
        }

        .step-title {
            color: #ffeb3b;
            font-size: 1.3rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .step-desc {
            color: #cbd5e0;
            line-height: 1.6;
            font-size: 1.05rem;
        }

        .equation {
            background: rgba(26, 32, 44, 0.8);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
            font-family: 'Cambria', 'Times New Roman', serif;
            font-size: 1.2rem;
            color: #ff9800;
            border: 1px solid #4a5568;
        }

        .highlight {
            color: #68d391;
            font-weight: bold;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #4a5568;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .legend-text {
            font-size: 0.9rem;
            color: #a0aec0;
        }

        .footer {
            margin-top: 20px;
            text-align: center;
            color: #718096;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .animation-area {
                height: 400px;
            }
            
            .btn {
                min-width: 100px;
                padding: 10px 16px;
                font-size: 0.9rem;
            }
            
            h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ•¯ï¸ èœ¡çƒ›ç‡ƒçƒ§çš„å¾®è§‚è¿‡ç¨‹</h1>
        <p class="subtitle">æ¢ç´¢å›ºæ€èœ¡å¦‚ä½•è½¬åŒ–ä¸ºæ°”ä½“ï¼Œå¹¶ä¸æ°§æ°”ååº”ç”ŸæˆäºŒæ°§åŒ–ç¢³å’Œæ°´</p>
    </div>

    <div class="container">
        <div class="animation-area">
            <canvas id="canvas"></canvas>
        </div>

        <div class="controls">
            <button id="playPause" class="btn">â¸ï¸ æš‚åœ</button>
            <button id="prevStep" class="btn btn-step">â—€ ä¸Šä¸€æ­¥</button>
            <button id="nextStep" class="btn btn-step">ä¸‹ä¸€æ­¥ â–¶</button>
            <button id="reset" class="btn btn-reset">ğŸ”„ é‡ç½®</button>
            <button id="toggleView" class="btn btn-view">ğŸ”¬ å¾®è§‚è§†å›¾</button>
        </div>

        <div class="info-panel">
            <div class="step-title">
                <span id="stepIcon">ğŸ”</span>
                <span id="stepTitle">è§‚å¯Ÿå®è§‚ç°è±¡</span>
            </div>
            <p class="step-desc" id="stepDesc">è¿™æ˜¯ä¸€æ”¯æ­£åœ¨ç‡ƒçƒ§çš„èœ¡çƒ›ã€‚æ³¨æ„è§‚å¯Ÿç«ç„°ã€çƒ­é‡ä»¥åŠèœ¡çš„å‡å°‘ã€‚</p>
            <div class="equation" id="equation">
                å®è§‚ç°è±¡ï¼šå‘å…‰ã€å‘çƒ­ã€èœ¡å‡å°‘
            </div>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background-color: #333333;"></div>
                <span class="legend-text">ç¢³åŸå­ (C)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #f0f0f0;"></div>
                <span class="legend-text">æ°¢åŸå­ (H)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #e53e3e;"></div>
                <span class="legend-text">æ°§åŸå­ (O)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(90deg, #ffeb3b, #ff9800);"></div>
                <span class="legend-text">ç«ç„°ä¸çƒ­é‡</span>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>æ•™å­¦åŠ¨ç”» | åŒ–å­¦å¾®è§‚è¿‡ç¨‹å¯è§†åŒ– | è®¾è®¡ï¼šç†ŠçŒ«è€å¸ˆ</p>
    </div>

    <script>
        // è·å–Canvaså…ƒç´ å’Œä¸Šä¸‹æ–‡
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // è®¾ç½®Canvaså°ºå¯¸
        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // åŠ¨ç”»çŠ¶æ€æ§åˆ¶
        let animationId = null;
        let isPlaying = true;
        let currentStep = 0;
        let isMicroView = false;

        // æ­¥éª¤å®šä¹‰
        const steps = [
            {
                title: "è§‚å¯Ÿå®è§‚ç°è±¡",
                desc: "è¿™æ˜¯ä¸€æ”¯æ­£åœ¨ç‡ƒçƒ§çš„èœ¡çƒ›ã€‚æ³¨æ„è§‚å¯Ÿç«ç„°ã€çƒ­é‡ä»¥åŠèœ¡çš„å‡å°‘ã€‚",
                equation: "å®è§‚ç°è±¡ï¼šå‘å…‰ã€å‘çƒ­ã€èœ¡å‡å°‘",
                icon: "ğŸ”"
            },
            {
                title: "èœ¡çš„ç†”åŒ–ï¼ˆç‰©ç†å˜åŒ–ï¼‰",
                desc: "ç«ç„°çš„çƒ­é‡ä¼ é€’åˆ°èœ¡èŠ¯ï¼Œå›ºæ€èœ¡å¸æ”¶çƒ­é‡ï¼Œåˆ†å­æŒ¯åŠ¨åŠ å‰§ï¼Œä»æœ‰åºæ’åˆ—å˜ä¸ºæ— åºæµåŠ¨ï¼Œè½¬åŒ–ä¸ºæ¶²æ€èœ¡ã€‚",
                equation: "å›ºæ€èœ¡ + çƒ­é‡ â†’ æ¶²æ€èœ¡",
                icon: "ğŸ”¥"
            },
            {
                title: "èœ¡çš„æ±½åŒ–ï¼ˆç‰©ç†å˜åŒ–ï¼‰",
                desc: "æ¶²æ€èœ¡ç»§ç»­å—çƒ­ï¼Œåˆ†å­è·å¾—è¶³å¤Ÿèƒ½é‡ï¼ŒæŒ£è„±æ¶²ä½“è¡¨é¢å¼ åŠ›ï¼Œå˜æˆæ°”æ€èœ¡åˆ†å­ï¼ˆä»¥Câ‚‚â‚…Hâ‚…â‚‚ä¸ºä¾‹ï¼‰ã€‚",
                equation: "æ¶²æ€èœ¡ + æ›´å¤šçƒ­é‡ â†’ æ°”æ€èœ¡åˆ†å­",
                icon: "ğŸ’¨"
            },
            {
                title: "åˆ†å­æ··åˆä¸æ‰©æ•£",
                desc: "æ°”æ€èœ¡åˆ†å­å‘ä¸Šæ‰©æ•£ï¼Œä¸ç©ºæ°”ä¸­çš„æ°§æ°”åˆ†å­(Oâ‚‚)æ··åˆï¼Œä¸ºåŒ–å­¦ååº”åšå‡†å¤‡ã€‚",
                equation: "Câ‚‚â‚…Hâ‚…â‚‚(æ°”) + Oâ‚‚(æ°”) â†’ æ··åˆ",
                icon: "ğŸŒ€"
            },
            {
                title: "ç‡ƒçƒ§ååº”ï¼ˆåŒ–å­¦å˜åŒ–ï¼‰",
                desc: "åœ¨é«˜æ¸©ä¸‹ï¼Œèœ¡åˆ†å­ä¸æ°§æ°”åˆ†å­å‰§çƒˆç¢°æ’ï¼ŒåŒ–å­¦é”®æ–­è£‚ï¼Œç¢³ã€æ°¢ã€æ°§åŸå­é‡æ–°ç»„åˆï¼Œå½¢æˆæ–°çš„åŒ–å­¦é”®ã€‚",
                equation: "Câ‚‚â‚…Hâ‚…â‚‚ + 38Oâ‚‚ â†’ 25COâ‚‚ + 26Hâ‚‚O + èƒ½é‡",
                icon: "âš¡"
            },
            {
                title: "ç”Ÿæˆç‰©ä¸èƒ½é‡é‡Šæ”¾",
                desc: "ååº”ç”ŸæˆäºŒæ°§åŒ–ç¢³(COâ‚‚)å’Œæ°´(Hâ‚‚O)åˆ†å­ï¼Œå¹¶å‘å‘¨å›´é‡Šæ”¾å¤§é‡èƒ½é‡ï¼Œè¡¨ç°ä¸ºå…‰å’Œçƒ­ã€‚",
                equation: "ç”Ÿæˆç‰©ï¼šCOâ‚‚ â†‘ å’Œ Hâ‚‚O â†‘ | èƒ½é‡ï¼šå…‰ + çƒ­",
                icon: "âœ¨"
            }
        ];

        // åˆ†å­å’Œç²’å­å®šä¹‰
        const particles = {
            solidWax: [],
            liquidWax: [],
            gasWax: [],
            oxygen: [],
            co2: [],
            h2o: [],
            heatWaves: []
        };

        // é¢œè‰²å®šä¹‰
        const colors = {
            carbon: '#333333',
            hydrogen: '#f0f0f0',
            oxygen: '#e53e3e',
            bond: '#a0aec0',
            flameInner: '#ffeb3b',
            flameOuter: '#ff9800',
            heatWave: 'rgba(255, 152, 0, 0.3)',
            solidWax: '#d1d5db',
            liquidWax: '#e5e7eb',
            background: '#1a2332'
        };

        // åˆ†å­ç±»
        class Molecule {
            constructor(x, y, type, vx = 0, vy = 0) {
                this.x = x;
                this.y = y;
                this.type = type; // 'wax', 'oxygen', 'co2', 'h2o'
                this.vx = vx;
                this.vy = vy;
                this.size = type === 'wax' ? 8 : 6;
                this.atoms = [];
                this.bonds = [];
                this.reacted = false;
                this.reactionProgress = 0;
                
                // æ ¹æ®åˆ†å­ç±»å‹åˆå§‹åŒ–åŸå­å’Œé”®
                this.initMolecule();
            }

            initMolecule() {
                if (this.type === 'wax') {
                    // ç®€åŒ–èœ¡åˆ†å­ï¼šä¸­å¿ƒç¢³åŸå­ï¼Œå‘¨å›´æœ‰æ°¢åŸå­
                    this.atoms = [
                        {type: 'C', x: 0, y: 0, color: colors.carbon},
                        {type: 'H', x: -10, y: -8, color: colors.hydrogen},
                        {type: 'H', x: 10, y: -8, color: colors.hydrogen},
                        {type: 'H', x: -10, y: 8, color: colors.hydrogen},
                        {type: 'H', x: 10, y: 8, color: colors.hydrogen}
                    ];
                    this.bonds = [
                        {from: 0, to: 1}, {from: 0, to: 2},
                        {from: 0, to: 3}, {from: 0, to: 4}
                    ];
                } else if (this.type === 'oxygen') {
                    this.atoms = [
                        {type: 'O', x: -5, y: 0, color: colors.oxygen},
                        {type: 'O', x: 5, y: 0, color: colors.oxygen}
                    ];
                    this.bonds = [{from: 0, to: 1}];
                } else if (this.type === 'co2') {
                    this.atoms = [
                        {type: 'C', x: 0, y: 0, color: colors.carbon},
                        {type: 'O', x: -8, y: 0, color: colors.oxygen},
                        {type: 'O', x: 8, y: 0, color: colors.oxygen}
                    ];
                    this.bonds = [{from: 0, to: 1}, {from: 0, to: 2}];
                } else if (this.type === 'h2o') {
                    this.atoms = [
                        {type: 'O', x: 0, y: 0, color: colors.oxygen},
                        {type: 'H', x: -6, y: -6, color: colors.hydrogen},
                        {type: 'H', x: 6, y: -6, color: colors.hydrogen}
                    ];
                    this.bonds = [{from: 0, to: 1}, {from: 0, to: 2}];
                }
            }

            update(step) {
                // æ ¹æ®æ­¥éª¤æ›´æ–°åˆ†å­è¡Œä¸º
                if (step >= 1 && step <= 2 && this.type === 'wax') {
                    // æ­¥éª¤1-2ï¼šèœ¡åˆ†å­å—çƒ­å‘ä¸Šè¿åŠ¨
                    this.vy = -0.5 - Math.random() * 0.5;
                } else if (step >= 3 && this.type === 'wax') {
                    // æ­¥éª¤3+ï¼šæ°”æ€èœ¡åˆ†å­æ›´å‰§çƒˆè¿åŠ¨
                    this.vx += (Math.random() - 0.5) * 0.2;
                    this.vy = -1 - Math.random() * 0.5;
                }
                
                if (step >= 3 && this.type === 'oxygen') {
                    // æ°§æ°”åˆ†å­å‘ç«ç„°åŒºåŸŸæ‰©æ•£
                    const dx = canvas.width/2 - this.x;
                    const dy = canvas.height*0.7 - this.y;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    if (dist > 50) {
                        this.vx += dx * 0.0005;
                        this.vy += dy * 0.0005;
                    }
                }
                
                if (step >= 5 && (this.type === 'co2' || this.type === 'h2o')) {
                    // ç”Ÿæˆç‰©å‘ä¸Šé£˜æ•£
                    this.vy = -1.5 - Math.random();
                    this.vx += (Math.random() - 0.5) * 0.1;
                }

                // é™åˆ¶é€Ÿåº¦
                const speedLimit = this.type === 'oxygen' ? 2 : 3;
                const speed = Math.sqrt(this.vx*this.vx + this.vy*this.vy);
                if (speed > speedLimit) {
                    this.vx = (this.vx / speed) * speedLimit;
                    this.vy = (this.vy / speed) * speedLimit;
                }

                // æ›´æ–°ä½ç½®
                this.x += this.vx;
                this.y += this.vy;

                // è¾¹ç•Œå¤„ç†
                if (this.x < 0) this.x = 0;
                if (this.x > canvas.width) this.x = canvas.width;
                if (this.y < 0) this.y = 0;
                if (this.y > canvas.height) this.y = canvas.height;
            }

            draw() {
                // ç»˜åˆ¶åŒ–å­¦é”®
                ctx.strokeStyle = colors.bond;
                ctx.lineWidth = 2;
                for (const bond of this.bonds) {
                    const fromAtom = this.atoms[bond.from];
                    const toAtom = this.atoms[bond.to];
                    ctx.beginPath();
                    ctx.moveTo(this.x + fromAtom.x, this.y + fromAtom.y);
                    ctx.lineTo(this.x + toAtom.x, this.y + toAtom.y);
                    ctx.stroke();
                }

                // ç»˜åˆ¶åŸå­
                for (const atom of this.atoms) {
                    ctx.fillStyle = atom.color;
                    ctx.beginPath();
                    ctx.arc(this.x + atom.x, this.y + atom.y, 5, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // åŸå­ç±»å‹æ ‡ç­¾ï¼ˆå¾®è§‚è§†å›¾ï¼‰
                    if (isMicroView) {
                        ctx.fillStyle = 'white';
                        ctx.font = '10px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText(atom.type, this.x + atom.x, this.y + atom.y - 8);
                    }
                }
            }
        }

        // çƒ­æ³¢ç±»
        class HeatWave {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.radius = 10;
                this.maxRadius = 100;
                this.speed = 2;
                this.alpha = 0.5;
            }

            update() {
                this.radius += this.speed;
                this.alpha -= 0.01;
                return this.alpha > 0 && this.radius < this.maxRadius;
            }

            draw() {
                ctx.strokeStyle = `rgba(255, 152, 0, ${this.alpha})`;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.stroke();
            }
        }

        // åˆå§‹åŒ–ç²’å­ç³»ç»Ÿ
        function initParticles() {
            particles.solidWax = [];
            particles.liquidWax = [];
            particles.gasWax = [];
            particles.oxygen = [];
            particles.co2 = [];
            particles.h2o = [];
            particles.heatWaves = [];

            // åˆ›å»ºå›ºæ€èœ¡ç²’å­ï¼ˆåº•éƒ¨ï¼‰
            for (let i = 0; i < 30; i++) {
                particles.solidWax.push({
                    x: canvas.width/2 + (Math.random() - 0.5) * 100,
                    y: canvas.height - 50 + Math.random() * 30,
                    size: 4 + Math.random() * 3
                });
            }

            // åˆ›å»ºæ°§æ°”åˆ†å­
            for (let i = 0; i < 40; i++) {
                particles.oxygen.push(new Molecule(
                    Math.random() * canvas.width,
                    Math.random() * canvas.height * 0.3,
                    'oxygen',
                    (Math.random() - 0.5) * 0.5,
                    (Math.random() - 0.5) * 0.5
                ));
            }
        }

        // ç»˜åˆ¶å®è§‚è§†å›¾
        function drawMacroView() {
            // ç»˜åˆ¶èœ¡çƒ›
            const candleX = canvas.width / 2;
            const candleBottom = canvas.height - 50;
            
            // èœ¡çƒ›ä¸»ä½“
            ctx.fillStyle = '#f0f0f0';
            ctx.fillRect(candleX - 20, candleBottom - 150, 40, 150);
            
            // èœ¡çƒ›èŠ¯
            ctx.fillStyle = '#4a5568';
            ctx.fillRect(candleX - 2, candleBottom - 160, 4, 10);
            
            // ç«ç„°
            const gradient = ctx.createRadialGradient(
                candleX, candleBottom - 160, 5,
                candleX, candleBottom - 160, 30
            );
            gradient.addColorStop(0, colors.flameInner);
            gradient.addColorStop(1, colors.flameOuter);
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.moveTo(candleX, candleBottom - 190);
            ctx.bezierCurveTo(
                candleX + 15, candleBottom - 170,
                candleX + 10, candleBottom - 140,
                candleX, candleBottom - 130
            );
            ctx.bezierCurveTo(
                candleX - 10, candleBottom - 140,
                candleX - 15, candleBottom - 170,
                candleX, candleBottom - 190
            );
            ctx.fill();
            
            // çƒ­æµª
            if (currentStep >= 1) {
                particles.heatWaves.push(new HeatWave(candleX, candleBottom - 160));
            }
            
            // ç»˜åˆ¶çƒ­æµª
            for (let i = particles.heatWaves.length - 1; i >= 0; i--) {
                if (!particles.heatWaves[i].update()) {
                    particles.heatWaves.splice(i, 1);
                } else {
                    particles.heatWaves[i].draw();
                }
            }
            
            // ç»˜åˆ¶å›ºæ€èœ¡ç²’å­
            ctx.fillStyle = colors.solidWax;
            for (const wax of particles.solidWax) {
                ctx.beginPath();
                ctx.arc(wax.x, wax.y, wax.size, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // ç»˜åˆ¶æ¶²æ€èœ¡ï¼ˆæ­¥éª¤1-2ï¼‰
            if (currentStep >= 1) {
                ctx.fillStyle = colors.liquidWax;
                for (let i = 0; i < 15; i++) {
                    const x = candleX + (Math.random() - 0.5) * 30;
                    const y = candleBottom - 50 + Math.random() * 20;
                    ctx.beginPath();
                    ctx.arc(x, y, 3, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            // ç»˜åˆ¶æ°”æ€èœ¡åˆ†å­ï¼ˆæ­¥éª¤2+ï¼‰
            if (currentStep >= 2) {
                for (const wax of particles.gasWax) {
                    wax.update(currentStep);
                    wax.draw();
                }
            }
            
            // ç»˜åˆ¶æ°§æ°”åˆ†å­ï¼ˆæ­¥éª¤3+ï¼‰
            if (currentStep >= 3) {
                for (const oxy of particles.oxygen) {
                    oxy.update(currentStep);
                    oxy.draw();
                }
            }
            
            // ç»˜åˆ¶ç”Ÿæˆç‰©ï¼ˆæ­¥éª¤5+ï¼‰
            if (currentStep >= 5) {
                for (const co2 of particles.co2) {
                    co2.update(currentStep);
                    co2.draw();
                }
                for (const h2o of particles.h2o) {
                    h2o.update(currentStep);
                    h2o.draw();
                }
            }
            
            // æ·»åŠ æ–°çš„æ°”æ€èœ¡åˆ†å­ï¼ˆæ­¥éª¤2+ï¼‰
            if (currentStep >= 2 && Math.random() < 0.05) {
                particles.gasWax.push(new Molecule(
                    candleX + (Math.random() - 0.5) * 40,
                    candleBottom - 50,
                    'wax',
                    (Math.random() - 0.5) * 0.5,
                    -1 - Math.random()
                ));
            }
            
            // æ¨¡æ‹Ÿååº”ï¼ˆæ­¥éª¤4+ï¼‰
            if (currentStep >= 4 && particles.gasWax.length > 0 && particles.oxygen.length > 0) {
                // éšæœºé€‰æ‹©èœ¡åˆ†å­å’Œæ°§æ°”åˆ†å­è¿›è¡Œååº”
                if (Math.random() < 0.02) {
                    const waxIndex = Math.floor(Math.random() * particles.gasWax.length);
                    const oxyIndex = Math.floor(Math.random() * particles.oxygen.length);
                    
                    const wax = particles.gasWax[waxIndex];
                    const oxy = particles.oxygen[oxyIndex];
                    
                    // ç§»é™¤ååº”ç‰©
                    particles.gasWax.splice(waxIndex, 1);
                    particles.oxygen.splice(oxyIndex, 1);
                    
                    // æ·»åŠ ç”Ÿæˆç‰©
                    particles.co2.push(new Molecule(
                        wax.x, wax.y, 'co2',
                        (Math.random() - 0.5) * 1,
                        -2 - Math.random()
                    ));
                    
                    particles.h2o.push(new Molecule(
                        wax.x + 20, wax.y, 'h2o',
                        (Math.random() - 0.5) * 1,
                        -2 - Math.random()
                    ));
                }
            }
        }

        // ç»˜åˆ¶å¾®è§‚è§†å›¾
        function drawMicroView() {
            // ç»˜åˆ¶èƒŒæ™¯
            ctx.fillStyle = colors.background;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶çƒ­æºåŒºåŸŸ
            const gradient = ctx.createRadialGradient(
                canvas.width/2, canvas.height*0.7, 20,
                canvas.width/2, canvas.height*0.7, 100
            );
            gradient.addColorStop(0, 'rgba(255, 235, 59, 0.3)');
            gradient.addColorStop(1, 'rgba(255, 152, 0, 0.1)');
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(canvas.width/2, canvas.height*0.7, 100, 0, Math.PI * 2);
            ctx.fill();
            
            // ç»˜åˆ¶æ‰€æœ‰åˆ†å­
            for (const wax of particles.gasWax) {
                wax.update(currentStep);
                wax.draw();
            }
            
            for (const oxy of particles.oxygen) {
                oxy.update(currentStep);
                oxy.draw();
            }
            
            for (const co2 of particles.co2) {
                co2.update(currentStep);
                co2.draw();
            }
            
            for (const h2o of particles.h2o) {
                h2o.update(currentStep);
                h2o.draw();
            }
            
            // ç»˜åˆ¶ååº”åŠ¨ç”»ï¼ˆæ­¥éª¤4-5ï¼‰
            if (currentStep >= 4 && currentStep <= 5) {
                // åœ¨ä¸­å¿ƒåŒºåŸŸæ˜¾ç¤ºååº”ç¤ºæ„
                const centerX = canvas.width/2;
                const centerY = canvas.height*0.7;
                
                // ç»˜åˆ¶ç¢°æ’ç¤ºæ„
                ctx.strokeStyle = 'rgba(255, 235, 59, 0.5)';
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.arc(centerX, centerY, 60, 0, Math.PI * 2);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // ç»˜åˆ¶ååº”ç®­å¤´
                ctx.strokeStyle = '#68d391';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(centerX - 80, centerY);
                ctx.lineTo(centerX - 30, centerY);
                ctx.moveTo(centerX - 20, centerY);
                ctx.lineTo(centerX - 10, centerY - 5);
                ctx.lineTo(centerX - 10, centerY + 5);
                ctx.lineTo(centerX - 20, centerY);
                ctx.stroke();
                
                // ç»˜åˆ¶ååº”ç‰©å’Œç”Ÿæˆç‰©ç¤ºæ„
                if (currentStep === 4) {
                    // ååº”ç‰©
                    const waxMolecule = new Molecule(centerX - 120, centerY, 'wax');
                    waxMolecule.draw();
                    
                    const oxyMolecule = new Molecule(centerX - 150, centerY + 40, 'oxygen');
                    oxyMolecule.draw();
                    
                    ctx.fillStyle = 'white';
                    ctx.font = '14px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('+', centerX - 135, centerY + 20);
                } else if (currentStep === 5) {
                    // ç”Ÿæˆç‰©
                    const co2Molecule = new Molecule(centerX + 100, centerY - 30, 'co2');
                    co2Molecule.draw();
                    
                    const h2oMolecule = new Molecule(centerX + 100, centerY + 30, 'h2o');
                    h2oMolecule.draw();
                    
                    ctx.fillStyle = 'white';
                    ctx.font = '14px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('+', centerX + 100, centerY);
                }
            }
        }

        // æ›´æ–°ä¿¡æ¯é¢æ¿
        function updateInfoPanel() {
            const step = steps[currentStep];
            document.getElementById('stepTitle').textContent = step.title;
            document.getElementById('stepDesc').textContent = step.desc;
            document.getElementById('equation').textContent = step.equation;
            document.getElementById('stepIcon').textContent = step.icon;
            
            // é«˜äº®æ–¹ç¨‹ä¸­çš„å…³é”®éƒ¨åˆ†
            if (currentStep === 4 || currentStep === 5) {
                const eq = document.getElementById('equation');
                eq.innerHTML = step.equation
                    .replace('Câ‚‚â‚…Hâ‚…â‚‚', '<span class="highlight">Câ‚‚â‚…Hâ‚…â‚‚</span>')
                    .replace('Oâ‚‚', '<span class="highlight">Oâ‚‚</span>')
                    .replace('COâ‚‚', '<span class="highlight">COâ‚‚</span>')
                    .replace('Hâ‚‚O', '<span class="highlight">Hâ‚‚O</span>');
            }
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('prevStep').disabled = currentStep === 0;
            document.getElementById('nextStep').disabled = currentStep === steps.length - 1;
        }

        // ä¸»åŠ¨ç”»å¾ªç¯
        function animate() {
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // æ ¹æ®è§†å›¾æ¨¡å¼ç»˜åˆ¶
            if (isMicroView) {
                drawMicroView();
            } else {
                drawMacroView();
            }
            
            // ç»§ç»­åŠ¨ç”»å¾ªç¯
            if (isPlaying) {
                animationId = requestAnimationFrame(animate);
            }
        }

        // æ§åˆ¶å‡½æ•°
        function playPause() {
            isPlaying = !isPlaying;
            const btn = document.getElementById('playPause');
            btn.textContent = isPlaying ? 'â¸ï¸ æš‚åœ' : 'â–¶ï¸ æ’­æ”¾';
            
            if (isPlaying) {
                animate();
            } else {
                cancelAnimationFrame(animationId);
            }
        }

        function nextStep() {
            if (currentStep < steps.length - 1) {
                currentStep++;
                updateInfoPanel();
                
                // åœ¨ç‰¹å®šæ­¥éª¤åˆå§‹åŒ–ç²’å­
                if (currentStep === 2) {
                    // å¼€å§‹ç”Ÿæˆæ°”æ€èœ¡åˆ†å­
                    const candleX = canvas.width / 2;
                    const candleBottom = canvas.height - 50;
                    for (let i = 0; i < 10; i++) {
                        particles.gasWax.push(new Molecule(
                            candleX + (Math.random() - 0.5) * 40,
                            candleBottom - 30 + Math.random() * 20,
                            'wax',
                            (Math.random() - 0.5) * 0.5,
                            -0.5 - Math.random()
                        ));
                    }
                }
            }
        }

        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                updateInfoPanel();
            }
        }

        function resetAnimation() {
            currentStep = 0;
            isMicroView = false;
            initParticles();
            updateInfoPanel();
            
            const viewBtn = document.getElementById('toggleView');
            viewBtn.textContent = 'ğŸ”¬ å¾®è§‚è§†å›¾';
            
            if (!isPlaying) {
                playPause(); // è‡ªåŠ¨å¼€å§‹æ’­æ”¾
            }
        }

        function toggleView() {
            isMicroView = !isMicroView;
            const btn = document.getElementById('toggleView');
            btn.textContent = isMicroView ? 'ğŸ‘ï¸ å®è§‚è§†å›¾' : 'ğŸ”¬ å¾®è§‚è§†å›¾';
        }

        // äº‹ä»¶ç›‘å¬
        document.getElementById('playPause').addEventListener('click', playPause);
        document.getElementById('nextStep').addEventListener('click', nextStep);
        document.getElementById('prevStep').addEventListener('click', prevStep);
        document.getElementById('reset').addEventListener('click', resetAnimation);
        document.getElementById('toggleView').addEventListener('click', toggleView);

        // é”®ç›˜æ§åˆ¶
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case ' ':
                    playPause();
                    break;
                case 'ArrowRight':
                    nextStep();
                    break;
                case 'ArrowLeft':
                    prevStep();
                    break;
                case 'r':
                case 'R':
                    resetAnimation();
                    break;
                case 'v':
                case 'V':
                    toggleView();
                    break;
            }
        });

        // åˆå§‹åŒ–
        initParticles();
        updateInfoPanel();
        animate();

        // æ·»åŠ ä½¿ç”¨æç¤º
        setTimeout(() => {
            console.log('ğŸ® æ§åˆ¶æç¤ºï¼š');
            console.log('ç©ºæ ¼é”® - æ’­æ”¾/æš‚åœ');
            console.log('å·¦å³ç®­å¤´ - åˆ‡æ¢æ­¥éª¤');
            console.log('Ré”® - é‡ç½®åŠ¨ç”»');
            console.log('Vé”® - åˆ‡æ¢è§†å›¾');
        }, 1000);
    </script>
</body>
</html>