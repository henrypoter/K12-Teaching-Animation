<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾®è§‚ç²’å­è¿åŠ¨ä¸ååº”é€Ÿç‡ | æ´»åŒ–èƒ½æ•™å­¦åŠ¨ç”»</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f1a2f 0%, #1a2b3c 100%);
            color: #ecf0f1;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            max-width: 900px;
        }

        h1 {
            color: #4d96ff;
            margin-bottom: 8px;
            font-size: 2.2rem;
        }

        .subtitle {
            color: #aaaaaa;
            font-size: 1.1rem;
            margin-bottom: 15px;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            max-width: 1200px;
            justify-content: center;
        }

        .main-panel {
            flex: 1;
            min-width: 600px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
        }

        .canvas-container {
            position: relative;
            flex-grow: 1;
            border-radius: 8px;
            overflow: hidden;
            background-color: #0a0e17;
            border: 1px solid #2d3436;
        }

        #mainCanvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        .canvas-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            color: #ffd93d;
            pointer-events: none;
        }

        .control-panel {
            width: 320px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel-section {
            background-color: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #3498db;
        }

        .panel-section.catalyst {
            border-left-color: #2ecc71;
        }

        .panel-section.data {
            border-left-color: #ff9a3d;
        }

        h2 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #ecf0f1;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        h2 i {
            font-style: normal;
            font-size: 1.1em;
        }

        .control-group {
            margin-bottom: 18px;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        label {
            display: block;
            margin-bottom: 6px;
            color: #aaaaaa;
            font-size: 0.95rem;
        }

        .value-display {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        .value-display span:last-child {
            color: #ffd93d;
            font-weight: bold;
        }

        .slider-container {
            width: 100%;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #2d3436;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            border: 2px solid #ecf0f1;
        }

        input[type="range"]#tempSlider::-webkit-slider-thumb {
            background: #ff6b6b;
        }

        input[type="range"]#eaSlider::-webkit-slider-thumb {
            background: #ffd93d;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            background-color: #3498db;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            flex-grow: 1;
            min-width: 120px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        #resetBtn {
            background-color: #95a5a6;
        }

        #catalystBtn {
            background-color: #2ecc71;
        }

        #catalystBtn:hover {
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.4);
        }

        .toggle-group {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .toggle-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .data-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .data-item {
            background-color: rgba(0, 0, 0, 0.2);
            padding: 12px;
            border-radius: 6px;
            text-align: center;
        }

        .data-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ff9a3d;
            margin: 5px 0;
        }

        .data-label {
            font-size: 0.85rem;
            color: #aaaaaa;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }

        .footer {
            margin-top: 25px;
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9rem;
            max-width: 900px;
            line-height: 1.5;
        }

        @media (max-width: 1000px) {
            .container {
                flex-direction: column;
                align-items: center;
            }
            
            .main-panel {
                min-width: 90vw;
                height: 500px;
            }
            
            .control-panel {
                width: 90vw;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>å¾®è§‚ç²’å­è¿åŠ¨ä¸åŒ–å­¦ååº”é€Ÿç‡</h1>
        <p class="subtitle">é€šè¿‡ç²’å­ç¢°æ’æ¨¡å‹æ¢ç´¢æ´»åŒ–èƒ½ã€æ¸©åº¦ã€æµ“åº¦å’Œå‚¬åŒ–å‰‚å¯¹ååº”é€Ÿç‡çš„å½±å“</p>
    </div>

    <div class="container">
        <div class="main-panel">
            <div class="canvas-container">
                <canvas id="mainCanvas"></canvas>
                <div class="canvas-overlay">æ´»åŒ–èƒ½é˜ˆå€¼: <span id="eaValueOverlay">100</span> èƒ½é‡å•ä½</div>
            </div>
        </div>

        <div class="control-panel">
            <div class="panel-section">
                <h2><i>âš™ï¸</i> åŠ¨ç”»æ§åˆ¶</h2>
                <div class="button-group">
                    <button id="startBtn">å¼€å§‹</button>
                    <button id="pauseBtn">æš‚åœ</button>
                    <button id="resetBtn">é‡ç½®</button>
                </div>
                
                <div class="toggle-group">
                    <div class="toggle-item">
                        <input type="checkbox" id="showCurve" checked>
                        <label for="showCurve">æ˜¾ç¤ºèƒ½é‡åˆ†å¸ƒ</label>
                    </div>
                    <div class="toggle-item">
                        <input type="checkbox" id="highlightCollisions" checked>
                        <label for="highlightCollisions">é«˜äº®æœ‰æ•ˆç¢°æ’</label>
                    </div>
                </div>
            </div>

            <div class="panel-section">
                <h2><i>ğŸŒ¡ï¸</i> ååº”æ¡ä»¶</h2>
                
                <div class="control-group">
                    <div class="value-display">
                        <span>æ¸©åº¦</span>
                        <span id="tempValue">300 K</span>
                    </div>
                    <div class="slider-container">
                        <input type="range" id="tempSlider" min="100" max="500" value="300" step="10">
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="value-display">
                        <span>ç²’å­Aæµ“åº¦</span>
                        <span id="concentrationAValue">30</span>
                    </div>
                    <div class="slider-container">
                        <input type="range" id="concentrationASlider" min="5" max="60" value="30" step="1">
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="value-display">
                        <span>ç²’å­Bæµ“åº¦</span>
                        <span id="concentrationBValue">30</span>
                    </div>
                    <div class="slider-container">
                        <input type="range" id="concentrationBSlider" min="5" max="60" value="30" step="1">
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="value-display">
                        <span>æ´»åŒ–èƒ½ (Ea)</span>
                        <span id="eaValue">100</span>
                    </div>
                    <div class="slider-container">
                        <input type="range" id="eaSlider" min="20" max="200" value="100" step="5">
                    </div>
                    <div style="font-size: 0.8rem; color: #7f8c8d; margin-top: 4px;">
                        æ´»åŒ–èƒ½æ˜¯ååº”å‘ç”Ÿæ‰€éœ€çš„æœ€ä½èƒ½é‡
                    </div>
                </div>
            </div>

            <div class="panel-section catalyst">
                <h2><i>âš—ï¸</i> å‚¬åŒ–å‰‚</h2>
                <p style="color: #aaaaaa; margin-bottom: 15px; font-size: 0.95rem;">
                    å‚¬åŒ–å‰‚é€šè¿‡æä¾›æ›¿ä»£ååº”è·¯å¾„é™ä½æ´»åŒ–èƒ½ï¼Œä½†ä¸æ”¹å˜æ€»èƒ½é‡ã€‚
                </p>
                <button id="catalystBtn">æ·»åŠ å‚¬åŒ–å‰‚</button>
                <div style="margin-top: 10px; font-size: 0.9rem;">
                    <span>å½“å‰çŠ¶æ€: </span>
                    <span id="catalystStatus" style="color: #ff6b6b;">æœªä½¿ç”¨</span>
                </div>
            </div>

            <div class="panel-section data">
                <h2><i>ğŸ“Š</i> å®æ—¶æ•°æ®</h2>
                <div class="data-display">
                    <div class="data-item">
                        <div class="data-value" id="totalCollisions">0</div>
                        <div class="data-label">æ€»ç¢°æ’æ¬¡æ•°</div>
                    </div>
                    <div class="data-item">
                        <div class="data-value" id="effectiveCollisions">0</div>
                        <div class="data-label">æœ‰æ•ˆç¢°æ’æ¬¡æ•°</div>
                    </div>
                    <div class="data-item">
                        <div class="data-value" id="reactionRate">0.0</div>
                        <div class="data-label">ååº”é€Ÿç‡</div>
                    </div>
                    <div class="data-item">
                        <div class="data-value" id="efficiency">0%</div>
                        <div class="data-label">æœ‰æ•ˆç¢°æ’ç‡</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background-color: #ff6b6b;"></div>
            <span>ç²’å­ A (ååº”ç‰©)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #4d96ff;"></div>
            <span>ç²’å­ B (ååº”ç‰©)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #6bcf7f;"></div>
            <span>ç²’å­ C (äº§ç‰©)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #ffd93d;"></div>
            <span>æ´»åŒ–èƒ½é˜ˆå€¼</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #ff9a3d;"></div>
            <span>é«˜èƒ½é‡ç²’å­</span>
        </div>
    </div>

    <div class="footer">
        <p><strong>æ•™å­¦æç¤ºï¼š</strong> è§‚å¯Ÿæ¸©åº¦å¦‚ä½•å½±å“ç²’å­è¿åŠ¨é€Ÿåº¦ï¼Œæ´»åŒ–èƒ½å¦‚ä½•å†³å®šæœ‰æ•ˆç¢°æ’çš„æ¯”ä¾‹ï¼Œä»¥åŠå‚¬åŒ–å‰‚å¦‚ä½•é€šè¿‡é™ä½æ´»åŒ–èƒ½é—¨æ§›æ¥åŠ é€Ÿååº”ã€‚</p>
        <p>æœ‰æ•ˆç¢°æ’ = èƒ½é‡ â‰¥ æ´»åŒ–èƒ½ + æ­£ç¡®å–å‘çš„ç¢°æ’ | ååº”é€Ÿç‡ âˆ æœ‰æ•ˆç¢°æ’é¢‘ç‡</p>
    </div>

    <script>
        // è·å–Canvaså’Œä¸Šä¸‹æ–‡
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');

        // è®¾ç½®Canvaså°ºå¯¸
        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        }
        
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // è·å–DOMå…ƒç´ 
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const catalystBtn = document.getElementById('catalystBtn');
        const tempSlider = document.getElementById('tempSlider');
        const concentrationASlider = document.getElementById('concentrationASlider');
        const concentrationBSlider = document.getElementById('concentrationBSlider');
        const eaSlider = document.getElementById('eaSlider');
        const showCurve = document.getElementById('showCurve');
        const highlightCollisions = document.getElementById('highlightCollisions');
        
        const tempValue = document.getElementById('tempValue');
        const concentrationAValue = document.getElementById('concentrationAValue');
        const concentrationBValue = document.getElementById('concentrationBValue');
        const eaValue = document.getElementById('eaValue');
        const eaValueOverlay = document.getElementById('eaValueOverlay');
        const catalystStatus = document.getElementById('catalystStatus');
        
        const totalCollisionsEl = document.getElementById('totalCollisions');
        const effectiveCollisionsEl = document.getElementById('effectiveCollisions');
        const reactionRateEl = document.getElementById('reactionRate');
        const efficiencyEl = document.getElementById('efficiency');

        // é¢œè‰²å¸¸é‡
        const COLOR_A = '#ff6b6b';
        const COLOR_B = '#4d96ff';
        const COLOR_C = '#6bcf7f';
        const COLOR_THRESHOLD = '#ffd93d';
        const COLOR_HIGH_ENERGY = '#ff9a3d';
        const COLOR_CURVE = '#aaaaaa';
        const BG_COLOR = '#0a0e17';

        // ç²’å­ç±»
        class Particle {
            constructor(type, x, y, vx, vy, radius) {
                this.type = type; // 'A', 'B', æˆ– 'C'
                this.x = x;
                this.y = y;
                this.vx = vx;
                this.vy = vy;
                this.radius = radius;
                this.energy = Math.sqrt(vx*vx + vy*vy) * 5; // ç®€åŒ–èƒ½é‡è®¡ç®—
                this.color = type === 'A' ? COLOR_A : (type === 'B' ? COLOR_B : COLOR_C);
                this.highlight = false;
                this.highlightTimer = 0;
            }
            
            update() {
                // æ›´æ–°ä½ç½®
                this.x += this.vx;
                this.y += this.vy;
                
                // è¾¹ç•Œç¢°æ’
                if (this.x - this.radius < 0 || this.x + this.radius > canvas.width) {
                    this.vx = -this.vx;
                    this.x = Math.max(this.radius, Math.min(canvas.width - this.radius, this.x));
                }
                if (this.y - this.radius < 0 || this.y + this.radius > canvas.height) {
                    this.vy = -this.vy;
                    this.y = Math.max(this.radius, Math.min(canvas.height - this.radius, this.y));
                }
                
                // æ›´æ–°èƒ½é‡ï¼ˆåŸºäºé€Ÿåº¦ï¼‰
                this.energy = Math.sqrt(this.vx*this.vx + this.vy*this.vy) * 5;
                
                // æ›´æ–°é«˜äº®è®¡æ—¶å™¨
                if (this.highlightTimer > 0) {
                    this.highlightTimer--;
                    this.highlight = true;
                } else {
                    this.highlight = false;
                }
            }
            
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                
                // å¦‚æœç²’å­èƒ½é‡é«˜ï¼Œä½¿ç”¨é«˜äº®é¢œè‰²
                let drawColor = this.color;
                if (this.energy > activationEnergy && this.type !== 'C') {
                    // æ ¹æ®èƒ½é‡æ¯”ä¾‹æ··åˆé¢œè‰²
                    const energyRatio = Math.min(1, (this.energy - activationEnergy) / 50);
                    drawColor = mixColors(this.color, COLOR_HIGH_ENERGY, energyRatio);
                }
                
                // å¦‚æœè¢«é«˜äº®ï¼ˆæœ‰æ•ˆç¢°æ’ï¼‰
                if (this.highlight) {
                    ctx.shadowColor = '#ffffff';
                    ctx.shadowBlur = 15;
                }
                
                ctx.fillStyle = drawColor;
                ctx.fill();
                
                // é‡ç½®é˜´å½±
                ctx.shadowColor = 'transparent';
                ctx.shadowBlur = 0;
                
                // å¦‚æœæ˜¯äº§ç‰©Cï¼Œç”»ä¸€ä¸ªå°å†…åœˆè¡¨ç¤ºä¸åŒ
                if (this.type === 'C') {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius * 0.6, 0, Math.PI * 2);
                    ctx.fillStyle = '#ffffff';
                    ctx.globalAlpha = 0.3;
                    ctx.fill();
                    ctx.globalAlpha = 1.0;
                }
            }
            
            // é«˜äº®ç²’å­ï¼ˆç”¨äºæœ‰æ•ˆç¢°æ’ï¼‰
            highlightParticle() {
                this.highlightTimer = 20; // é«˜äº®æŒç»­20å¸§
            }
        }

        // é¢œè‰²æ··åˆè¾…åŠ©å‡½æ•°
        function mixColors(color1, color2, ratio) {
            const r1 = parseInt(color1.substr(1, 2), 16);
            const g1 = parseInt(color1.substr(3, 2), 16);
            const b1 = parseInt(color1.substr(5, 2), 16);
            
            const r2 = parseInt(color2.substr(1, 2), 16);
            const g2 = parseInt(color2.substr(3, 2), 16);
            const b2 = parseInt(color2.substr(5, 2), 16);
            
            const r = Math.round(r1 * (1 - ratio) + r2 * ratio);
            const g = Math.round(g1 * (1 - ratio) + g2 * ratio);
            const b = Math.round(b1 * (1 - ratio) + b2 * ratio);
            
            return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
        }

        // å…¨å±€å˜é‡
        let particles = [];
        let animationId = null;
        let isRunning = false;
        let lastTime = 0;
        
        // ååº”å‚æ•°
        let temperature = 300; // K
        let concentrationA = 30;
        let concentrationB = 30;
        let activationEnergy = 100; // æ´»åŒ–èƒ½
        let catalystActive = false;
        
        // ç»Ÿè®¡æ•°æ®
        let totalCollisions = 0;
        let effectiveCollisions = 0;
        let productsCount = 0;
        let lastProductTime = 0;
        let reactionRate = 0;

        // åˆå§‹åŒ–ç²’å­
        function initParticles() {
            particles = [];
            
            // åˆ›å»ºAç²’å­
            for (let i = 0; i < concentrationA; i++) {
                const speed = 1 + Math.random() * (temperature / 150);
                const angle = Math.random() * Math.PI * 2;
                particles.push(new Particle(
                    'A',
                    Math.random() * (canvas.width - 40) + 20,
                    Math.random() * (canvas.height - 40) + 20,
                    Math.cos(angle) * speed,
                    Math.sin(angle) * speed,
                    8
                ));
            }
            
            // åˆ›å»ºBç²’å­
            for (let i = 0; i < concentrationB; i++) {
                const speed = 1 + Math.random() * (temperature / 150);
                const angle = Math.random() * Math.PI * 2;
                particles.push(new Particle(
                    'B',
                    Math.random() * (canvas.width - 40) + 20,
                    Math.random() * (canvas.height - 40) + 20,
                    Math.cos(angle) * speed,
                    Math.sin(angle) * speed,
                    8
                ));
            }
            
            // é‡ç½®ç»Ÿè®¡æ•°æ®
            totalCollisions = 0;
            effectiveCollisions = 0;
            productsCount = 0;
            reactionRate = 0;
            updateStats();
        }

        // æ£€æµ‹å’Œå¤„ç†ç¢°æ’
        function handleCollisions() {
            for (let i = 0; i < particles.length; i++) {
                for (let j = i + 1; j < particles.length; j++) {
                    const p1 = particles[i];
                    const p2 = particles[j];
                    
                    // åªæ£€æŸ¥Aå’ŒBä¹‹é—´çš„ç¢°æ’
                    if ((p1.type === 'A' && p2.type === 'B') || (p1.type === 'B' && p2.type === 'A')) {
                        const dx = p2.x - p1.x;
                        const dy = p2.y - p1.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        // å¦‚æœå‘ç”Ÿç¢°æ’
                        if (distance < p1.radius + p2.radius) {
                            totalCollisions++;
                            
                            // è®¡ç®—ç›¸å¯¹é€Ÿåº¦ï¼ˆç”¨äºèƒ½é‡è®¡ç®—ï¼‰
                            const relativeSpeed = Math.sqrt(
                                Math.pow(p1.vx - p2.vx, 2) + 
                                Math.pow(p1.vy - p2.vy, 2)
                            );
                            const collisionEnergy = relativeSpeed * 8;
                            
                            // æœ‰æ•ˆç¢°æ’ï¼šèƒ½é‡è¶³å¤Ÿé«˜
                            const effectiveEnergy = catalystActive ? 
                                activationEnergy * 0.6 : activationEnergy;
                            
                            if (collisionEnergy >= effectiveEnergy) {
                                effectiveCollisions++;
                                
                                // é«˜äº®ç¢°æ’ç²’å­
                                if (highlightCollisions.checked) {
                                    p1.highlightParticle();
                                    p2.highlightParticle();
                                }
                                
                                // æœ‰ä¸€å®šæ¦‚ç‡ç”Ÿæˆäº§ç‰©Cï¼ˆæ¨¡æ‹Ÿå–å‘å› ç´ ï¼‰
                                if (Math.random() < 0.7) {
                                    createProduct(p1, p2);
                                }
                            }
                            
                            // å¼¹æ€§ç¢°æ’å“åº”ï¼ˆç®€åŒ–ç‰ˆï¼‰
                            const angle = Math.atan2(dy, dx);
                            const sin = Math.sin(angle);
                            const cos = Math.cos(angle);
                            
                            // æ—‹è½¬é€Ÿåº¦
                            const vx1 = p1.vx * cos + p1.vy * sin;
                            const vy1 = p1.vy * cos - p1.vx * sin;
                            const vx2 = p2.vx * cos + p2.vy * sin;
                            const vy2 = p2.vy * cos - p2.vx * sin;
                            
                            // äº¤æ¢xæ–¹å‘é€Ÿåº¦ï¼ˆä¸€ç»´å¼¹æ€§ç¢°æ’ï¼‰
                            const finalVx1 = vx2;
                            const finalVx2 = vx1;
                            
                            // æ—‹è½¬å›åŸå§‹åæ ‡ç³»
                            p1.vx = finalVx1 * cos - vy1 * sin;
                            p1.vy = vy1 * cos + finalVx1 * sin;
                            p2.vx = finalVx2 * cos - vy2 * sin;
                            p2.vy = vy2 * cos + finalVx2 * sin;
                            
                            // é˜²æ­¢ç²’å­é‡å 
                            const overlap = (p1.radius + p2.radius - distance) / 2;
                            p1.x -= overlap * (dx / distance);
                            p1.y -= overlap * (dy / distance);
                            p2.x += overlap * (dx / distance);
                            p2.y += overlap * (dy / distance);
                        }
                    }
                }
            }
        }

        // åˆ›å»ºäº§ç‰©C
        function createProduct(p1, p2) {
            // ç§»é™¤åŸæ¥çš„ä¸¤ä¸ªç²’å­
            const index1 = particles.indexOf(p1);
            const index2 = particles.indexOf(p2);
            
            // ç¡®ä¿index2 > index1ï¼Œè¿™æ ·å…ˆåˆ é™¤index2ä¸ä¼šå½±å“index1
            if (index1 > index2) {
                particles.splice(index1, 1);
                particles.splice(index2, 1);
            } else {
                particles.splice(index2, 1);
                particles.splice(index1, 1);
            }
            
            // åˆ›å»ºæ–°çš„äº§ç‰©Cç²’å­
            const avgX = (p1.x + p2.x) / 2;
            const avgY = (p1.y + p2.y) / 2;
            const avgVx = (p1.vx + p2.vx) / 2;
            const avgVy = (p1.vy + p2.vy) / 2;
            
            particles.push(new Particle(
                'C',
                avgX,
                avgY,
                avgVx * 0.8,
                avgVy * 0.8,
                10
            ));
            
            productsCount++;
            lastProductTime = Date.now();
        }

        // ç»˜åˆ¶èƒ½é‡åˆ†å¸ƒæ›²çº¿
        function drawEnergyDistribution() {
            if (!showCurve.checked) return;
            
            const curveWidth = canvas.width * 0.8;
            const curveHeight = 100;
            const curveX = canvas.width * 0.1;
            const curveY = 30;
            
            // è®¡ç®—ç²’å­èƒ½é‡åˆ†å¸ƒ
            const energyBins = new Array(20).fill(0);
            let maxCount = 1;
            
            for (const p of particles) {
                if (p.type === 'C') continue; // ä¸è®¡å…¥äº§ç‰©
                
                const energy = p.energy;
                const binIndex = Math.min(19, Math.floor(energy / 10));
                energyBins[binIndex]++;
                maxCount = Math.max(maxCount, energyBins[binIndex]);
            }
            
            // ç»˜åˆ¶èƒŒæ™¯
            ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
            ctx.fillRect(curveX - 5, curveY - 5, curveWidth + 10, curveHeight + 10);
            
            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = COLOR_CURVE;
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(curveX, curveY + curveHeight);
            ctx.lineTo(curveX + curveWidth, curveY + curveHeight);
            ctx.moveTo(curveX, curveY);
            ctx.lineTo(curveX, curveY + curveHeight);
            ctx.stroke();
            
            // ç»˜åˆ¶æ›²çº¿
            ctx.strokeStyle = COLOR_CURVE;
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            for (let i = 0; i < energyBins.length; i++) {
                const x = curveX + (i / energyBins.length) * curveWidth;
                const height = (energyBins[i] / maxCount) * curveHeight;
                const y = curveY + curveHeight - height;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // å¡«å……æ›²çº¿ä¸‹æ–¹åŒºåŸŸ
            ctx.fillStyle = 'rgba(170, 170, 170, 0.2)';
            ctx.beginPath();
            ctx.moveTo(curveX, curveY + curveHeight);
            for (let i = 0; i < energyBins.length; i++) {
                const x = curveX + (i / energyBins.length) * curveWidth;
                const height = (energyBins[i] / maxCount) * curveHeight;
                const y = curveY + curveHeight - height;
                ctx.lineTo(x, y);
            }
            ctx.lineTo(curveX + curveWidth, curveY + curveHeight);
            ctx.closePath();
            ctx.fill();
            
            // ç»˜åˆ¶æ´»åŒ–èƒ½é˜ˆå€¼çº¿
            const eaX = curveX + (activationEnergy / 200) * curveWidth;
            ctx.strokeStyle = COLOR_THRESHOLD;
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 3]);
            ctx.beginPath();
            ctx.moveTo(eaX, curveY);
            ctx.lineTo(eaX, curveY + curveHeight);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // å¡«å……é«˜èƒ½é‡åŒºåŸŸ
            const fillStartX = catalystActive ? 
                curveX + (activationEnergy * 0.6 / 200) * curveWidth : eaX;
            
            ctx.fillStyle = 'rgba(255, 154, 61, 0.3)';
            ctx.fillRect(fillStartX, curveY, curveX + curveWidth - fillStartX, curveHeight);
            
            // æ·»åŠ æ ‡ç­¾
            ctx.fillStyle = COLOR_CURVE;
            ctx.font = '12px Arial';
            ctx.fillText('èƒ½é‡åˆ†å¸ƒ', curveX + 5, curveY - 5);
            ctx.fillText('ä½', curveX - 15, curveY + curveHeight + 15);
            ctx.fillText('é«˜', curveX + curveWidth - 10, curveY + curveHeight + 15);
            
            ctx.fillStyle = COLOR_THRESHOLD;
            ctx.fillText(`æ´»åŒ–èƒ½: ${activationEnergy}`, eaX + 5, curveY + 15);
            
            if (catalystActive) {
                ctx.fillStyle = '#2ecc71';
                ctx.fillText(`å‚¬åŒ–å‰‚é™ä½æ´»åŒ–èƒ½`, fillStartX + 5, curveY + 30);
            }
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®æ˜¾ç¤º
        function updateStats() {
            totalCollisionsEl.textContent = totalCollisions;
            effectiveCollisionsEl.textContent = effectiveCollisions;
            
            // è®¡ç®—ååº”é€Ÿç‡ï¼ˆæœ€è¿‘5ç§’å†…çš„å¹³å‡äº§ç‰©ç”Ÿæˆé€Ÿç‡ï¼‰
            const now = Date.now();
            const timeWindow = 5000; // 5ç§’
            const recentProducts = Math.min(productsCount, 10); // ç®€åŒ–è®¡ç®—
            
            reactionRate = recentProducts / (timeWindow / 1000); // äº§ç‰©/ç§’
            reactionRateEl.textContent = reactionRate.toFixed(2);
            
            // è®¡ç®—æœ‰æ•ˆç¢°æ’ç‡
            const efficiency = totalCollisions > 0 ? 
                Math.round((effectiveCollisions / totalCollisions) * 100) : 0;
            efficiencyEl.textContent = `${efficiency}%`;
            
            // æ›´æ–°UIæ˜¾ç¤º
            tempValue.textContent = `${temperature} K`;
            concentrationAValue.textContent = concentrationA;
            concentrationBValue.textContent = concentrationB;
            eaValue.textContent = activationEnergy;
            eaValueOverlay.textContent = activationEnergy;
            
            catalystStatus.textContent = catalystActive ? 'å·²æ¿€æ´»' : 'æœªä½¿ç”¨';
            catalystStatus.style.color = catalystActive ? '#2ecc71' : '#ff6b6b';
            catalystBtn.textContent = catalystActive ? 'ç§»é™¤å‚¬åŒ–å‰‚' : 'æ·»åŠ å‚¬åŒ–å‰‚';
        }

        // ä¸»åŠ¨ç”»å¾ªç¯
        function animate(timestamp) {
            if (!lastTime) lastTime = timestamp;
            const deltaTime = timestamp - lastTime;
            lastTime = timestamp;
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.fillStyle = BG_COLOR;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // æ›´æ–°æ‰€æœ‰ç²’å­
            for (const particle of particles) {
                particle.update();
            }
            
            // å¤„ç†ç¢°æ’
            handleCollisions();
            
            // ç»˜åˆ¶æ‰€æœ‰ç²’å­
            for (const particle of particles) {
                particle.draw();
            }
            
            // ç»˜åˆ¶èƒ½é‡åˆ†å¸ƒæ›²çº¿
            drawEnergyDistribution();
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            updateStats();
            
            // ç»§ç»­åŠ¨ç”»å¾ªç¯
            if (isRunning) {
                animationId = requestAnimationFrame(animate);
            }
        }

        // å¼€å§‹åŠ¨ç”»
        function startAnimation() {
            if (!isRunning) {
                isRunning = true;
                lastTime = 0;
                animationId = requestAnimationFrame(animate);
            }
        }

        // æš‚åœåŠ¨ç”»
        function pauseAnimation() {
            isRunning = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
        }

        // é‡ç½®åŠ¨ç”»
        function resetAnimation() {
            pauseAnimation();
            temperature = 300;
            concentrationA = 30;
            concentrationB = 30;
            activationEnergy = 100;
            catalystActive = false;
            
            // æ›´æ–°æ»‘å—
            tempSlider.value = temperature;
            concentrationASlider.value = concentrationA;
            concentrationBSlider.value = concentrationB;
            eaSlider.value = activationEnergy;
            
            initParticles();
            updateStats();
        }

        // åˆ‡æ¢å‚¬åŒ–å‰‚
        function toggleCatalyst() {
            catalystActive = !catalystActive;
            updateStats();
        }

        // äº‹ä»¶ç›‘å¬å™¨
        startBtn.addEventListener('click', startAnimation);
        pauseBtn.addEventListener('click', pauseAnimation);
        resetBtn.addEventListener('click', resetAnimation);
        catalystBtn.addEventListener('click', toggleCatalyst);

        tempSlider.addEventListener('input', function() {
            temperature = parseInt(this.value);
            
            // æ›´æ–°æ‰€æœ‰ç²’å­çš„é€Ÿåº¦ï¼ˆåŸºäºæ¸©åº¦ï¼‰
            const speedFactor = temperature / 300;
            for (const p of particles) {
                p.vx *= speedFactor;
                p.vy *= speedFactor;
            }
            
            updateStats();
        });

        concentrationASlider.addEventListener('input', function() {
            const newCount = parseInt(this.value);
            const diff = newCount - concentrationA;
            
            if (diff > 0) {
                // æ·»åŠ Aç²’å­
                for (let i = 0; i < diff; i++) {
                    const speed = 1 + Math.random() * (temperature / 150);
                    const angle = Math.random() * Math.PI * 2;
                    particles.push(new Particle(
                        'A',
                        Math.random() * (canvas.width - 40) + 20,
                        Math.random() * (canvas.height - 40) + 20,
                        Math.cos(angle) * speed,
                        Math.sin(angle) * speed,
                        8
                    ));
                }
            }
<!--æ£€æµ‹åˆ°ä»£ç æˆªæ–­ï¼Œè‡ªåŠ¨ç»­å†™ä¸­...-->
} else if (diff < 0) {
                // ç§»é™¤Aç²’å­
                let removed = 0;
                for (let i = particles.length - 1; i >= 0 && removed < -diff; i--) {
                    if (particles[i].type === 'A') {
                        particles.splice(i, 1);
                        removed++;
                    }
                }
            }
            
            concentrationA = newCount;
            updateStats();
        });

        concentrationBSlider.addEventListener('input', function() {
            const newCount = parseInt(this.value);
            const diff = newCount - concentrationB;
            
            if (diff > 0) {
                // æ·»åŠ Bç²’å­
                for (let i = 0; i < diff; i++) {
                    const speed = 1 + Math.random() * (temperature / 150);
                    const angle = Math.random() * Math.PI * 2;
                    particles.push(new Particle(
                        'B',
                        Math.random() * (canvas.width - 40) + 20,
                        Math.random() * (canvas.height - 40) + 20,
                        Math.cos(angle) * speed,
                        Math.sin(angle) * speed,
                        8
                    ));
                }
            } else if (diff < 0) {
                // ç§»é™¤Bç²’å­
                let removed = 0;
                for (let i = particles.length - 1; i >= 0 && removed < -diff; i--) {
                    if (particles[i].type === 'B') {
                        particles.splice(i, 1);
                        removed++;
                    }
                }
            }
            
            concentrationB = newCount;
            updateStats();
        });

        eaSlider.addEventListener('input', function() {
            activationEnergy = parseInt(this.value);
            updateStats();
        });

        // åˆå§‹åŒ–
        initParticles();
        startAnimation();

        // æ·»åŠ é¢„è®¾åœºæ™¯ç¤ºä¾‹ï¼ˆå¯é€šè¿‡æ§åˆ¶å°è°ƒç”¨ï¼‰
        window.demoScenes = {
            lowTemp: function() {
                pauseAnimation();
                temperature = 150;
                tempSlider.value = temperature;
                initParticles();
                startAnimation();
            },
            highTemp: function() {
                pauseAnimation();
                temperature = 450;
                tempSlider.value = temperature;
                initParticles();
                startAnimation();
            },
            highEa: function() {
                pauseAnimation();
                activationEnergy = 180;
                eaSlider.value = activationEnergy;
                initParticles();
                startAnimation();
            },
            withCatalyst: function() {
                pauseAnimation();
                catalystActive = true;
                initParticles();
                startAnimation();
            }
        };
    </script>
</body>
</html>