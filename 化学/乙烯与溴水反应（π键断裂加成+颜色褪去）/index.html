<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹™çƒ¯ä¸æº´æ°´ååº”æ•™å­¦åŠ¨ç”»</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #f1f5f9;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
            width: 100%;
            max-width: 1200px;
        }

        h1 {
            color: #38bdf8;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 8px rgba(56, 189, 248, 0.3);
        }

        .subtitle {
            color: #cbd5e1;
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            width: 100%;
            max-width: 1200px;
            justify-content: center;
        }

        .scene {
            flex: 1;
            min-width: 500px;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(56, 189, 248, 0.1);
        }

        .scene-title {
            font-size: 1.5rem;
            color: #38bdf8;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(56, 189, 248, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .scene-title i {
            font-size: 1.3rem;
        }

        .canvas-container {
            position: relative;
            width: 100%;
            height: 400px;
            background: rgba(15, 23, 42, 0.7);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(56, 189, 248, 0.2);
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        .test-tube {
            position: relative;
            width: 120px;
            height: 300px;
            margin: 40px auto;
        }

        .tube-body {
            position: absolute;
            width: 100%;
            height: 250px;
            bottom: 0;
            background: linear-gradient(to right, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border-radius: 60px 60px 0 0;
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-bottom: none;
            overflow: hidden;
        }

        .liquid {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 80%;
            background-color: #8B4513;
            border-radius: 60px 60px 0 0;
            transition: background-color 2s ease;
        }

        .tube-neck {
            position: absolute;
            width: 40px;
            height: 50px;
            top: -50px;
            left: 40px;
            background: linear-gradient(to right, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-bottom: none;
        }

        .tube-rim {
            position: absolute;
            width: 50px;
            height: 10px;
            top: -60px;
            left: 35px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 5px;
        }

        .macro-label {
            text-align: center;
            margin-top: 20px;
            font-size: 1.2rem;
            color: #fbbf24;
            padding: 8px 16px;
            background: rgba(251, 191, 36, 0.1);
            border-radius: 8px;
            display: inline-block;
        }

        .controls {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 16px;
            padding: 25px;
            margin-top: 30px;
            width: 100%;
            max-width: 1200px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(56, 189, 248, 0.1);
        }

        .step-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 28px;
            font-size: 1.1rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #38bdf8 0%, #0ea5e9 100%);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(56, 189, 248, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #cbd5e1;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 25px;
        }

        .step-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .step-dot.active {
            background: #38bdf8;
            transform: scale(1.2);
            box-shadow: 0 0 10px rgba(56, 189, 248, 0.7);
        }

        .step-info {
            text-align: center;
            background: rgba(15, 23, 42, 0.7);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 4px solid #38bdf8;
        }

        .step-title {
            font-size: 1.4rem;
            color: #fbbf24;
            margin-bottom: 10px;
        }

        .step-desc {
            color: #cbd5e1;
            line-height: 1.6;
            font-size: 1.1rem;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .legend-text {
            color: #cbd5e1;
            font-size: 0.9rem;
        }

        .reaction-equation {
            text-align: center;
            font-size: 1.8rem;
            margin: 30px 0;
            color: #fbbf24;
            font-weight: bold;
            padding: 15px;
            background: rgba(251, 191, 36, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        @media (max-width: 1100px) {
            .container {
                flex-direction: column;
                align-items: center;
            }
            
            .scene {
                min-width: 100%;
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .scene {
                padding: 15px;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 1rem;
            }
            
            .reaction-equation {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ä¹™çƒ¯ä¸æº´æ°´ååº”æ•™å­¦åŠ¨ç”»</h1>
        <p class="subtitle">å¯è§†åŒ–å±•ç¤ºÏ€é”®æ–­è£‚çš„äº²ç”µåŠ æˆæœºç†ä¸æº´æ°´é¢œè‰²è¤ªå»çš„å®å¾®è”ç³»</p>
    </div>

    <div class="container">
        <div class="scene">
            <h2 class="scene-title">
                <span>ğŸ”¬ å¾®è§‚åˆ†å­ååº”è¿‡ç¨‹</span>
            </h2>
            <div class="canvas-container">
                <canvas id="molecularCanvas"></canvas>
            </div>
        </div>

        <div class="scene">
            <h2 class="scene-title">
                <span>ğŸ§ª å®è§‚å®éªŒç°è±¡</span>
            </h2>
            <div class="test-tube">
                <div class="tube-body">
                    <div class="liquid" id="bromineLiquid"></div>
                </div>
                <div class="tube-neck"></div>
                <div class="tube-rim"></div>
            </div>
            <div class="macro-label" id="macroLabel">çº¢æ£•è‰²æº´æ°´</div>
        </div>
    </div>

    <div class="controls">
        <div class="step-indicator" id="stepIndicator">
            <!-- æ­¥éª¤æŒ‡ç¤ºç‚¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
        </div>

        <div class="step-controls">
            <button class="btn btn-secondary" id="resetBtn">
                <span>ğŸ”„</span> é‡ç½®
            </button>
            <button class="btn btn-secondary" id="prevBtn">
                <span>â—€</span> ä¸Šä¸€æ­¥
            </button>
            <button class="btn btn-primary" id="nextBtn">
                ä¸‹ä¸€æ­¥ <span>â–¶</span>
            </button>
        </div>

        <div class="step-info">
            <div class="step-title" id="stepTitle">åˆå§‹çŠ¶æ€ï¼šä¹™çƒ¯ä¸æº´åˆ†å­</div>
            <div class="step-desc" id="stepDesc">å·¦ä¾§ï¼šä¹™çƒ¯åˆ†å­ï¼ˆé»‘è‰²çƒä¸ºç¢³åŸå­ï¼Œç™½è‰²çƒä¸ºæ°¢åŸå­ï¼‰å…·æœ‰ç¢³ç¢³åŒé”®ï¼Œå…¶ä¸­Ï€é”®ç”µå­äº‘ï¼ˆæµ…è“è‰²ï¼‰åˆ†å¸ƒåœ¨åˆ†å­å¹³é¢ä¸Šæ–¹å’Œä¸‹æ–¹ã€‚å³ä¾§ï¼šæº´åˆ†å­ï¼ˆçº¢æ£•è‰²çƒï¼‰æ­£åœ¨æ¥è¿‘ã€‚</div>
        </div>

        <div class="reaction-equation">
            CHâ‚‚=CHâ‚‚ + Brâ‚‚ â†’ CHâ‚‚BrCHâ‚‚Br
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background-color: #333333;"></div>
                <div class="legend-text">ç¢³åŸå­ (C)</div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #FFFFFF;"></div>
                <div class="legend-text">æ°¢åŸå­ (H)</div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #8B4513;"></div>
                <div class="legend-text">æº´åŸå­ (Br)</div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #87CEEB;"></div>
                <div class="legend-text">Ï€é”®ç”µå­äº‘</div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #FFD700;"></div>
                <div class="legend-text">ååº”é«˜äº®</div>
            </div>
        </div>
    </div>

    <script>
        // åŠ¨ç”»æ­¥éª¤å®šä¹‰
        const steps = [
            {
                title: "åˆå§‹çŠ¶æ€ï¼šä¹™çƒ¯ä¸æº´åˆ†å­",
                description: "å·¦ä¾§ï¼šä¹™çƒ¯åˆ†å­ï¼ˆé»‘è‰²çƒä¸ºç¢³åŸå­ï¼Œç™½è‰²çƒä¸ºæ°¢åŸå­ï¼‰å…·æœ‰ç¢³ç¢³åŒé”®ï¼Œå…¶ä¸­Ï€é”®ç”µå­äº‘ï¼ˆæµ…è“è‰²ï¼‰åˆ†å¸ƒåœ¨åˆ†å­å¹³é¢ä¸Šæ–¹å’Œä¸‹æ–¹ã€‚å³ä¾§ï¼šæº´åˆ†å­ï¼ˆçº¢æ£•è‰²çƒï¼‰æ­£åœ¨æ¥è¿‘ã€‚",
                liquidColor: "#8B4513",
                macroLabel: "çº¢æ£•è‰²æº´æ°´"
            },
            {
                title: "æ¥è¿‘ä¸æåŒ–",
                description: "æº´åˆ†å­åœ¨ä¹™çƒ¯Ï€é”®ç”µå­äº‘çš„å½±å“ä¸‹å‘ç”ŸæåŒ–ã€‚é è¿‘Ï€é”®çš„æº´åŸå­å¸¦éƒ¨åˆ†æ­£ç”µè·ï¼ˆÎ´âºï¼‰ï¼Œå¦ä¸€ä¸ªæº´åŸå­å¸¦éƒ¨åˆ†è´Ÿç”µè·ï¼ˆÎ´â»ï¼‰ã€‚æº´åˆ†å­å¼€å§‹å‘Ï€é”®ç”µå­äº‘é è¿‘ã€‚",
                liquidColor: "#8B4513",
                macroLabel: "çº¢æ£•è‰²æº´æ°´"
            },
            {
                title: "Ï€é”®æ–­è£‚ä¸æº´é“ç¦»å­å½¢æˆ",
                description: "å¸¦éƒ¨åˆ†æ­£ç”µè·çš„æº´åŸå­ï¼ˆBrâºï¼‰è¿›æ”»Ï€é”®ç”µå­äº‘ï¼ŒÏ€é”®æ–­è£‚ã€‚åŒæ—¶Br-Bré”®å¼‚è£‚ï¼Œå½¢æˆç¯çŠ¶æº´é“ç¦»å­ä¸­é—´ä½“ã€‚å¦ä¸€ä¸ªæº´åŸå­ä»¥Brâ»å½¢å¼ç¦»å¼€ã€‚",
                liquidColor: "#A0522D",
                macroLabel: "æº´æ°´é¢œè‰²å¼€å§‹å˜æµ…"
            },
            {
                title: "Brâ»èƒŒé¢è¿›æ”»",
                description: "Brâ»ä»æº´é“ç¦»å­çš„èƒŒé¢è¿›æ”»ç¢³åŸå­ï¼Œå‘ç”Ÿäº²æ ¸åŠ æˆã€‚è¿™æ˜¯ååº”çš„ç¬¬äºŒæ­¥ï¼Œä¹Ÿæ˜¯å†³å®šäº§ç‰©ç«‹ä½“æ„å‹çš„å…³é”®æ­¥éª¤ã€‚",
                liquidColor: "#CD853F",
                macroLabel: "æº´æ°´é¢œè‰²æ˜æ˜¾å˜æµ…"
            },
            {
                title: "äº§ç‰©ç”Ÿæˆï¼š1,2-äºŒæº´ä¹™çƒ·",
                description: "Brâ»ä¸ç¢³åŸå­å½¢æˆæ–°çš„C-Bré”®ï¼Œç”Ÿæˆæœ€ç»ˆäº§ç‰©1,2-äºŒæº´ä¹™çƒ·ã€‚åˆ†å­ä¸­ä¸å†æœ‰åŒé”®ï¼Œæ‰€æœ‰åŸå­å‡è¾¾åˆ°ç¨³å®šç»“æ„ã€‚",
                liquidColor: "transparent",
                macroLabel: "æº´æ°´å®Œå…¨è¤ªè‰²ï¼Œç”Ÿæˆæ— è‰²äº§ç‰©"
            }
        ];

        // è·å–DOMå…ƒç´ 
        const canvas = document.getElementById('molecularCanvas');
        const ctx = canvas.getContext('2d');
        const bromineLiquid = document.getElementById('bromineLiquid');
        const macroLabel = document.getElementById('macroLabel');
        const stepTitle = document.getElementById('stepTitle');
        const stepDesc = document.getElementById('stepDesc');
        const stepIndicator = document.getElementById('stepIndicator');
        const resetBtn = document.getElementById('resetBtn');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');

        // è®¾ç½®Canvaså°ºå¯¸
        function resizeCanvas() {
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = canvas.parentElement.clientHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // åŠ¨ç”»çŠ¶æ€
        let currentStep = 0;
        let animationProgress = 0;
        let animationId = null;

        // åˆ†å­æ•°æ®
        const molecules = {
            ethylene: {
                atoms: [
                    { type: 'C', x: 0, y: 0, color: '#333333' },
                    { type: 'C', x: 80, y: 0, color: '#333333' },
                    { type: 'H', x: -40, y: -40, color: '#FFFFFF' },
                    { type: 'H', x: -40, y: 40, color: '#FFFFFF' },
                    { type: 'H', x: 120, y: -40, color: '#FFFFFF' },
                    { type: 'H', x: 120, y: 40, color: '#FFFFFF' }
                ],
                bonds: [
                    { from: 0, to: 1, type: 'double', color: '#FFFFFF' },
                    { from: 0, to: 2, type: 'single', color: '#AAAAAA' },
                    { from: 0, to: 3, type: 'single', color: '#AAAAAA' },
                    { from: 1, to: 4, type: 'single', color: '#AAAAAA' },
                    { from: 1, to: 5, type: 'single', color: '#AAAAAA' }
                ],
                piBond: {
                    visible: true,
                    opacity: 1,
                    color: '#87CEEB'
                }
            },
            bromine: {
                atoms: [
                    { type: 'Br', x: 200, y: 0, color: '#8B4513', charge: 'Î´âº' },
                    { type: 'Br', x: 250, y: 0, color: '#8B4513', charge: 'Î´â»' }
                ],
                bonds: [
                    { from: 0, to: 1, type: 'single', color: '#8B4513' }
                ]
            },
            bromonium: {
                atoms: [],
                bonds: []
            },
            product: {
                atoms: [],
                bonds: []
            }
        };

        // åŠ¨ç”»å‚æ•°
        const animationParams = {
            bromineX: 200,
            bromineTargetX: [200, 140, 100, 60, 60],
            bromineY: 0,
            piBondOpacity: [1, 1, 0, 0, 0],
            highlightAtoms: [[], [], [0, 1], [6], []],
            highlightColor: '#FFD700',
            showCharges: [false, true, true, true, false],
            showPiCloud: [true, true, false, false, false],
            showBromonium: [false, false, true, false, false],
            showProduct: [false, false, false, false, true]
        };

        // åˆå§‹åŒ–æ­¥éª¤æŒ‡ç¤ºå™¨
        function initStepIndicator() {
            stepIndicator.innerHTML = '';
            steps.forEach((step, index) => {
                const dot = document.createElement('div');
                dot.className = `step-dot ${index === currentStep ? 'active' : ''}`;
                dot.dataset.step = index;
                dot.addEventListener('click', () => goToStep(index));
                stepIndicator.appendChild(dot);
            });
        }

        // æ›´æ–°UI
        function updateUI() {
            // æ›´æ–°æ­¥éª¤ä¿¡æ¯
            stepTitle.textContent = steps[currentStep].title;
            stepDesc.textContent = steps[currentStep].description;
            
            // æ›´æ–°è¯•ç®¡é¢œè‰²
            bromineLiquid.style.backgroundColor = steps[currentStep].liquidColor;
            macroLabel.textContent = steps[currentStep].macroLabel;
            
            // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
            document.querySelectorAll('.step-dot').forEach((dot, index) => {
                dot.classList.toggle('active', index === currentStep);
            });
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            prevBtn.disabled = currentStep === 0;
            nextBtn.disabled = currentStep === steps.length - 1;
            
            // å¼€å§‹åŠ¨ç”»
            startAnimation();
        }

        // å¼€å§‹åŠ¨ç”»
        function startAnimation() {
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            
            animationProgress = 0;
            animate();
        }

        // åŠ¨ç”»å¾ªç¯
        function animate() {
            animationProgress += 0.02;
            if (animationProgress > 1) {
                animationProgress = 1;
            }
            
            drawScene();
            
            if (animationProgress < 1) {
                animationId = requestAnimationFrame(animate);
            }
        }

        // ç»˜åˆ¶åœºæ™¯
        function drawScene() {
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // è®¡ç®—åŠ¨ç”»å€¼
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            // è®¡ç®—æº´åˆ†å­ä½ç½®
            const startX = animationParams.bromineTargetX[currentStep];
            const endX = animationParams.bromineTargetX[Math.min(currentStep + 1, steps.length - 1)];
            const bromineX = startX + (endX - startX) * animationProgress;
            
            // è®¡ç®—Ï€é”®é€æ˜åº¦
            const piOpacity = animationParams.piBondOpacity[currentStep] + 
                            (animationParams.piBondOpacity[Math.min(currentStep + 1, steps.length - 1)] - 
                             animationParams.piBondOpacity[currentStep]) * animationProgress;
            
            // ç»˜åˆ¶ä¹™çƒ¯åˆ†å­
            drawEthylene(centerX - 150, centerY, piOpacity);
            
            // æ ¹æ®æ­¥éª¤ç»˜åˆ¶ä¸åŒçŠ¶æ€
            if (currentStep < 2) {
                drawBromine(centerX + bromineX, centerY, animationParams.showCharges[currentStep]);
            } else if (currentStep === 2) {
                drawBromonium(centerX - 50, centerY);
                drawBrMinus(centerX + 100, centerY);
            } else if (currentStep === 3) {
                drawBromonium(centerX - 50, centerY);
                drawBrMinus(centerX + 50 - 100 * animationProgress, centerY - 50 * animationProgress);
            } else if (currentStep === 4) {
                drawProduct(centerX - 50, centerY);
            }
            
            // ç»˜åˆ¶é«˜äº®
            drawHighlights(centerX - 150, centerY);
        }

        // ç»˜åˆ¶ä¹™çƒ¯åˆ†å­
        function drawEthylene(x, y, piOpacity) {
            // ç»˜åˆ¶Ï€é”®ç”µå­äº‘
            if (piOpacity > 0) {
                ctx.save();
                ctx.globalAlpha = piOpacity;
                
                // ä¸Šæ–¹ç”µå­äº‘
                drawPiCloud(x + 40, y - 30, 80, 40);
                
                // ä¸‹æ–¹ç”µå­äº‘
                drawPiCloud(x + 40, y + 30, 80, 40);
                
                ctx.restore();
            }
            
            // ç»˜åˆ¶é”®
            molecules.ethylene.bonds.forEach(bond => {
                const from = molecules.ethylene.atoms[bond.from];
                const to = molecules.ethylene.atoms[bond.to];
                
                ctx.beginPath();
                ctx.strokeStyle = bond.color;
                ctx.lineWidth = bond.type === 'double' ? 3 : 2;
                
                if (bond.type === 'double') {
                    // ç»˜åˆ¶åŒé”®
                    ctx.moveTo(x + from.x, y + from.y - 2);
                    ctx.lineTo(x + to.x, y + to.y - 2);
                    ctx.stroke();
                    
                    ctx.beginPath();
                    ctx.moveTo(x + from.x, y + from.y + 2);
                    ctx.lineTo(x + to.x, y + to.y + 2);
                } else {
                    ctx.moveTo(x + from.x, y + from.y);
                    ctx.lineTo(x + to.x, y + to.y);
                }
                
                ctx.stroke();
            });
            
            // ç»˜åˆ¶åŸå­
            molecules.ethylene.atoms.forEach(atom => {
                drawAtom(x + atom.x, y + atom.y, atom.type, atom.color);
            });
        }

        // ç»˜åˆ¶Ï€é”®ç”µå­äº‘
        function drawPiCloud(x, y, width, height) {
            ctx.fillStyle = molecules.ethylene.piBond.color;
            
            // åˆ›å»ºæ¤­åœ†è·¯å¾„
            ctx.beginPath();
            ctx.ellipse(x, y, width / 2, height / 2, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // æ·»åŠ å…‰æ™•æ•ˆæœ
            ctx.shadowColor = molecules.ethylene.piBond.color;
            ctx.shadowBlur = 20;
            ctx.beginPath();
            ctx.ellipse(x, y, width / 2 - 5, height / 2 - 5, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 0;
        }

        // ç»˜åˆ¶æº´åˆ†å­
        function drawBromine(x, y, showCharges) {
            // ç»˜åˆ¶é”®
            ctx.beginPath();
            ctx.strokeStyle = '#8B4513';
            ctx.lineWidth = 2;
            ctx.moveTo(x, y);
            ctx.lineTo(x + 50, y);
            ctx.stroke();
            
            // ç»˜åˆ¶åŸå­
            molecules.bromine.atoms.forEach((atom, index) => {
                drawAtom(x + atom.x - 200, y + atom.y, atom.type, atom.color);
                
                // ç»˜åˆ¶ç”µè·
                if (showCharges && atom.charge) {
                    ctx.fillStyle = '#FFD700';
                    ctx.font = 'bold 16px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(atom.charge, x + atom.x - 200, y + atom.y - 25);
                }
            });
        }

        // ç»˜åˆ¶æº´é“ç¦»å­
        function drawBromonium(x, y) {
            // ç»˜åˆ¶ç¯çŠ¶ç»“æ„
            ctx.beginPath();
            ctx.strokeStyle = '#FFD700';
            ctx.lineWidth = 3;
            ctx.moveTo(x, y);
            ctx.lineTo(x + 40, y - 30);
            ctx.lineTo(x + 80, y);
            ctx.closePath();
            ctx.stroke();
            
            // ç»˜åˆ¶åŸå­
            drawAtom(x, y, 'C', '#333333');
            drawAtom(x + 80, y, 'C', '#333333');
            drawAtom(x + 40, y - 30, 'Br', '#8B4513');
            
            // ç»˜åˆ¶æ­£ç”µè·
            ctx.fillStyle = '#FF6B6B';
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('âº', x + 40, y - 50);
        }

        // ç»˜åˆ¶Brâ»
        function drawBrMinus(x, y) {
            drawAtom(x, y, 'Br', '#8B4513');
            
            // ç»˜åˆ¶è´Ÿç”µè·
            ctx.fillStyle = '#4ECDC4';
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('â»', x, y - 25);
        }

        // ç»˜åˆ¶äº§ç‰©ï¼š1,2-äºŒæº´ä¹™çƒ·
        function drawProduct(x, y) {
            // åŸå­ä½ç½®
            const atoms = [
                { type: 'C', x: 0, y: 0, color: '#333333' },
                { type: 'C', x: 60, y: 0, color: '#333333' },
                { type: 'H', x: -20, y: -35, color: '#FFFFFF' },
                { type: 'H', x: -20, y: 35, color: '#FFFFFF' },
                { type: 'H', x: 80, y: -35, color: '#FFFFFF' },
                { type: 'H', x: 80, y: 35, color: '#FFFFFF' },
                { type: 'Br', x: -40, y: 0, color: '#8B4513' },
                { type: 'Br', x: 100, y: 0, color: '#8B4513' }
            ];
            
            // é”®
            const bonds = [
                { from: 0, to: 1, type: 'single', color: '#FFFFFF' },
                { from: 0, to: 2, type: 'single', color: '#AAAAAA' },
                { from: 0, to: 3, type: 'single', color: '#AAAAAA' },
                { from: 0, to: 6, type: 'single', color: '#8B4513' },
                { from: 1, to: 4, type: 'single', color: '#AAAAAA' },
                { from: 1, to: 5, type: 'single', color: '#AAAAAA' },
                { from: 1, to: 7, type: 'single', color: '#8B4513' }
            ];
            
            // ç»˜åˆ¶é”®
            bonds.forEach(bond => {
                const from = atoms[bond.from];
                const to = atoms[bond.to];
                
                ctx.beginPath();
                ctx.strokeStyle = bond.color;
                ctx.lineWidth = 2;
                ctx.moveTo(x + from.x, y + from.y);
                ctx.lineTo(x + to.x, y + to.y);
                ctx.stroke();
            });
            
            // ç»˜åˆ¶åŸå­
            atoms.forEach(atom => {
                drawAtom(x + atom.x, y + atom.y, atom.type, atom.color);
            });
        }

        // ç»˜åˆ¶é«˜äº®æ•ˆæœ
        function drawHighlights(x, y) {
            const highlights = animationParams.highlightAtoms[currentStep];
            if (highlights.length === 0) return;
            
            ctx.save();
            ctx.strokeStyle = animationParams.highlightColor;
            ctx.lineWidth = 4;
            ctx.setLineDash([5, 5]);
            
            highlights.forEach(atomIndex => {
                const atom = molecules.ethylene.atoms[atomIndex];
                ctx.beginPath();
                ctx.arc(x + atom.x, y + atom.y, 25, 0, Math.PI * 2);
                ctx.stroke();
            });
            
            ctx.restore();
        }

        // ç»˜åˆ¶åŸå­
        function drawAtom(x, y, type, color) {
            // ç»˜åˆ¶åŸå­çƒ
            const gradient = ctx.createRadialGradient(x, y, 0, x, y, 15);
            gradient.addColorStop(0, color);
            gradient.addColorStop(1, darkenColor(color, 40));
            
            ctx.beginPath();
            ctx.fillStyle = gradient;
            ctx.arc(x, y, 15, 0, Math.PI * 2);
            ctx.fill();
            
            // ç»˜åˆ¶è¾¹æ¡†
            ctx.beginPath();
            ctx.strokeStyle = lightenColor(color, 20);
            ctx.lineWidth = 1;
            ctx.arc(x, y, 15, 0, Math.PI * 2);
            ctx.stroke();
            
            // ç»˜åˆ¶åŸå­ç¬¦å·
            ctx.fillStyle = type === 'C' || type === 'Br' ? '#FFFFFF' : '#333333';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(type, x, y);
        }

        // å·¥å…·å‡½æ•°ï¼šåŠ æ·±é¢œè‰²
        function darkenColor(color, percent) {
            const num = parseInt(color.slice(1), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) - amt;
            const G = (num >> 8 & 0x00FF) - amt;
            const B = (num & 0x0000FF) - amt;
            
            return '#' + (
                0x1000000 +
                (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)
            ).toString(16).slice(1);
        }

        // å·¥å…·å‡½æ•°ï¼šå˜äº®é¢œè‰²
        function lightenColor(color, percent) {
            const num = parseInt(color.slice(1), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            
            return '#' + (
                0x1000000 +
                (R > 255 ? 255 : R) * 0x10000 +
                (G > 255 ? 255 : G) * 0x100 +
                (B > 255 ? 255 : B)
            ).toString(16).slice(1);
        }

        // è·³è½¬åˆ°æŒ‡å®šæ­¥éª¤
        function goToStep(step) {
            currentStep = Math.max(0, Math.min(step, steps.length - 1));
            updateUI();
        }

        // ä¸‹ä¸€æ­¥
        function nextStep() {
            if (currentStep < steps.length - 1) {
                currentStep++;
                updateUI();
            }
        }

        // ä¸Šä¸€æ­¥
        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                updateUI();
            }
        }

        // é‡ç½®
        function reset() {
            currentStep = 0;
            updateUI();
        }

        // äº‹ä»¶ç›‘å¬
        nextBtn.addEventListener('click', nextStep);
        prevBtn.addEventListener('click', prevStep);
        resetBtn.addEventListener('click', reset);

        // é”®ç›˜æ§åˆ¶
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') nextStep();
            if (e.key === 'ArrowLeft') prevStep();
            if (e.key === 'Home') reset();
        });

        // åˆå§‹åŒ–
        initStepIndicator();
        updateUI();
    </script>
</body>
</html>