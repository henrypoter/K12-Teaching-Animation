<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‡¸é€é•œæˆåƒå…¨è¿‡ç¨‹åŠ¨æ€æ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #1a237e;
            color: #f5f5f5;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #3949ab;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
            color: #bbdefb;
        }
        
        .header p {
            font-size: 16px;
            color: #90caf9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.5;
        }
        
        .container {
            display: flex;
            flex: 1;
            gap: 20px;
            max-height: calc(100vh - 150px);
        }
        
        .simulation-area {
            flex: 7;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }
        
        .canvas-container {
            flex: 1;
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            background-color: rgba(13, 19, 33, 0.9);
            border: 1px solid #3949ab;
        }
        
        #simulationCanvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        
        .controls-area {
            flex: 3;
            background-color: #f5f5f5;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
            color: #212121;
        }
        
        .control-section {
            background-color: white;
            border-radius: 8px;
            padding: 18px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border-left: 4px solid #3949ab;
        }
        
        .control-section h3 {
            color: #1a237e;
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-section h3 i {
            font-size: 20px;
        }
        
        .control-group {
            margin-bottom: 16px;
        }
        
        .control-group:last-child {
            margin-bottom: 0;
        }
        
        .control-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 14px;
            color: #555;
        }
        
        .control-value {
            font-weight: bold;
            color: #1a237e;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3949ab;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3949ab;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
        }
        
        input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: #3949ab;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        button {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            background-color: #3949ab;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
            font-size: 14px;
        }
        
        button:hover {
            background-color: #303f9f;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button.reset {
            background-color: #d32f2f;
        }
        
        button.reset:hover {
            background-color: #c62828;
        }
        
        .data-panel {
            background-color: white;
            border-radius: 8px;
            padding: 18px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border-left: 4px solid #4caf50;
        }
        
        .data-panel h3 {
            color: #1a237e;
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .data-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .data-item {
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 6px;
            border-left: 3px solid #3949ab;
        }
        
        .data-label {
            font-size: 13px;
            color: #666;
            margin-bottom: 4px;
        }
        
        .data-value {
            font-size: 18px;
            font-weight: bold;
            color: #1a237e;
        }
        
        .image-property {
            grid-column: span 2;
            padding: 12px;
            background-color: #f0f7ff;
            border-radius: 6px;
            border-left: 3px solid #f44336;
            text-align: center;
        }
        
        .chart-container {
            background-color: white;
            border-radius: 8px;
            padding: 18px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border-left: 4px solid #ff9800;
        }
        
        .chart-container h3 {
            color: #1a237e;
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        #chartCanvas {
            width: 100%;
            height: 200px;
            display: block;
        }
        
        .instructions {
            margin-top: 15px;
            font-size: 13px;
            color: #777;
            line-height: 1.5;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 6px;
        }
        
        .footer {
            text-align: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #3949ab;
            color: #90caf9;
            font-size: 14px;
        }
        
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
                max-height: none;
            }
            
            .simulation-area, .controls-area {
                width: 100%;
            }
            
            .canvas-container {
                min-height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>å‡¸é€é•œæˆåƒå…¨è¿‡ç¨‹åŠ¨æ€æ¼”ç¤º</h1>
        <p>æ‹–æ‹½ç‰©ä½“è§‚å¯Ÿæˆåƒå˜åŒ– | è°ƒèŠ‚ç„¦è·æ¢ç´¢ä¸åŒé€é•œ | å®æ—¶æŸ¥çœ‹æ•°æ®ä¸å›¾è¡¨</p>
    </div>
    
    <div class="container">
        <div class="simulation-area">
            <div class="canvas-container">
                <canvas id="simulationCanvas"></canvas>
            </div>
        </div>
        
        <div class="controls-area">
            <div class="control-section">
                <h3>ğŸ“ å‚æ•°æ§åˆ¶</h3>
                
                <div class="control-group">
                    <div class="control-label">
                        <span>ç‰©è· (u)</span>
                        <span class="control-value" id="uValue">300 px</span>
                    </div>
                    <input type="range" id="uSlider" min="50" max="800" value="300" step="1">
                    <div class="control-label" style="font-size: 12px; margin-top: 4px;">
                        <span>â† æ‹–æ‹½ç‰©ä½“æˆ–ä½¿ç”¨æ»‘å—</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="control-label">
                        <span>ç„¦è· (f)</span>
                        <span class="control-value" id="fValue">150 px</span>
                    </div>
                    <input type="range" id="fSlider" min="50" max="300" value="150" step="1">
                </div>
                
                <div class="control-group">
                    <div class="control-label">
                        <span>ç‰©ä½“é«˜åº¦</span>
                        <span class="control-value" id="hValue">80 px</span>
                    </div>
                    <input type="range" id="hSlider" min="20" max="150" value="80" step="1">
                </div>
            </div>
            
            <div class="control-section">
                <h3>ğŸ‘ï¸ æ˜¾ç¤ºé€‰é¡¹</h3>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="showRays" checked>
                        <label for="showRays">æ˜¾ç¤ºå…‰çº¿</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="showFocus" checked>
                        <label for="showFocus">æ˜¾ç¤ºç„¦ç‚¹</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="show2F" checked>
                        <label for="show2F">æ˜¾ç¤º2Fç‚¹</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="showRuler" checked>
                        <label for="showRuler">æ˜¾ç¤ºæ ‡å°º</label>
                    </div>
                </div>
                
                <div class="button-group">
                    <button id="resetBtn">é‡ç½®</button>
                    <button id="simplifyViewBtn">ç®€åŒ–è§†å›¾</button>
                </div>
            </div>
            
            <div class="data-panel">
                <h3>ğŸ“Š å®æ—¶æ•°æ®</h3>
                <div class="data-grid">
                    <div class="data-item">
                        <div class="data-label">ç‰©è· (u)</div>
                        <div class="data-value" id="dataU">300 px</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">åƒè· (v)</div>
                        <div class="data-value" id="dataV">300 px</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">ç„¦è· (f)</div>
                        <div class="data-value" id="dataF">150 px</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">æ”¾å¤§ç‡ (m)</div>
                        <div class="data-value" id="dataM">1.00</div>
                    </div>
                    <div class="image-property">
                        <div class="data-label">åƒçš„æ€§è´¨</div>
                        <div class="data-value" id="imageProperty">å€’ç«‹ã€ç­‰å¤§ã€å®åƒ</div>
                    </div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>ğŸ“ˆ åƒè·ä¸æ”¾å¤§ç‡æ›²çº¿</h3>
                <canvas id="chartCanvas"></canvas>
                <div class="instructions">
                    <p>â€¢ çº¢è‰²æ›²çº¿ï¼šåƒè·(v)éšç‰©è·(u)å˜åŒ–å…³ç³»</p>
                    <p>â€¢ æ©™è‰²æ›²çº¿ï¼šæ”¾å¤§ç‡(m)éšç‰©è·(u)å˜åŒ–å…³ç³»</p>
                    <p>â€¢ è™šçº¿ï¼šu=f (ç„¦ç‚¹) å’Œ u=2f (äºŒå€ç„¦è·) ä½ç½®</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>å‡¸é€é•œæˆåƒè§„å¾‹æ•™å­¦åŠ¨ç”» | å½“ u>2f æ—¶æˆå€’ç«‹ç¼©å°å®åƒ | å½“ u=2f æ—¶æˆå€’ç«‹ç­‰å¤§å®åƒ | å½“ f<u<2f æ—¶æˆå€’ç«‹æ”¾å¤§å®åƒ | å½“ u<f æ—¶æˆæ­£ç«‹æ”¾å¤§è™šåƒ</p>
    </div>

    <script>
        // è·å–Canvaså…ƒç´ å’Œä¸Šä¸‹æ–‡
        const simCanvas = document.getElementById('simulationCanvas');
        const chartCanvas = document.getElementById('chartCanvas');
        const simCtx = simCanvas.getContext('2d');
        const chartCtx = chartCanvas.getContext('2d');
        
        // è·å–æ§åˆ¶å…ƒç´ 
        const uSlider = document.getElementById('uSlider');
        const fSlider = document.getElementById('fSlider');
        const hSlider = document.getElementById('hSlider');
        const resetBtn = document.getElementById('resetBtn');
        const simplifyViewBtn = document.getElementById('simplifyViewBtn');
        
        // è·å–æ˜¾ç¤ºé€‰é¡¹
        const showRays = document.getElementById('showRays');
        const showFocus = document.getElementById('showFocus');
        const show2F = document.getElementById('show2F');
        const showRuler = document.getElementById('showRuler');
        
        // è·å–æ•°æ®æ˜¾ç¤ºå…ƒç´ 
        const uValue = document.getElementById('uValue');
        const fValue = document.getElementById('fValue');
        const hValue = document.getElementById('hValue');
        const dataU = document.getElementById('dataU');
        const dataV = document.getElementById('dataV');
        const dataF = document.getElementById('dataF');
        const dataM = document.getElementById('dataM');
        const imageProperty = document.getElementById('imageProperty');
        
        // åˆå§‹åŒ–å˜é‡
        let u = 300; // ç‰©è·
        let f = 150; // ç„¦è·
        let objectHeight = 80; // ç‰©ä½“é«˜åº¦
        let isDragging = false;
        let simplifyView = false;
        
        // é€é•œä½ç½®å’Œå°ºå¯¸
        const lensX = 400;
        const lensWidth = 20;
        const lensHeight = 200;
        
        // å›¾è¡¨æ•°æ®
        let chartData = [];
        
        // åˆå§‹åŒ–Canvaså°ºå¯¸
        function initCanvasSize() {
            const container = simCanvas.parentElement;
            simCanvas.width = container.clientWidth;
            simCanvas.height = container.clientHeight;
            
            chartCanvas.width = chartCanvas.parentElement.clientWidth;
            chartCanvas.height = 200;
            
            // ç”Ÿæˆå›¾è¡¨æ•°æ®
            generateChartData();
            
            // ç»˜åˆ¶åˆå§‹çŠ¶æ€
            drawSimulation();
            drawChart();
        }
        
        // ç”Ÿæˆå›¾è¡¨æ•°æ®
        function generateChartData() {
            chartData = [];
            const step = 5;
            
            for (let uVal = 50; uVal <= 800; uVal += step) {
                let v, m;
                
                if (uVal > f) {
                    // å®åƒåŒºåŸŸ
                    v = 1 / (1/f - 1/uVal);
                    m = v / uVal;
                } else if (uVal < f) {
                    // è™šåƒåŒºåŸŸ
                    v = 1 / (1/f - 1/uVal);
                    m = Math.abs(v / uVal);
                } else {
                    // u = fï¼Œåƒåœ¨æ— ç©·è¿œå¤„
                    v = Infinity;
                    m = Infinity;
                }
                
                chartData.push({
                    u: uVal,
                    v: v,
                    m: m
                });
            }
        }
        
        // è®¡ç®—åƒè·å’Œæ”¾å¤§ç‡
        function calculateImage() {
            let v, m, imageHeight, imageType, imagePropertyText;
            
            if (u > f) {
                // å®åƒ
                v = 1 / (1/f - 1/u);
                m = v / u;
                imageHeight = objectHeight * m;
                imageType = 'real';
                
                if (u > 2*f) {
                    imagePropertyText = "å€’ç«‹ã€ç¼©å°ã€å®åƒ";
                } else if (Math.abs(u - 2*f) < 1) {
                    imagePropertyText = "å€’ç«‹ã€ç­‰å¤§ã€å®åƒ";
                } else {
                    imagePropertyText = "å€’ç«‹ã€æ”¾å¤§ã€å®åƒ";
                }
            } else if (u < f) {
                // è™šåƒ
                v = 1 / (1/f - 1/u);
                m = Math.abs(v / u);
                imageHeight = objectHeight * m;
                imageType = 'virtual';
                imagePropertyText = "æ­£ç«‹ã€æ”¾å¤§ã€è™šåƒ";
            } else {
                // u = fï¼Œå¹³è¡Œå…‰ï¼Œä¸æˆåƒ
                v = Infinity;
                m = Infinity;
                imageHeight = Infinity;
                imageType = 'none';
                imagePropertyText = "ä¸æˆåƒï¼ˆå¹³è¡Œå…‰ï¼‰";
            }
            
            return { v, m, imageHeight, imageType, imagePropertyText };
        }
        
        // ç»˜åˆ¶ä¸»æ¨¡æ‹ŸåŒºåŸŸ
        function drawSimulation() {
            // æ¸…é™¤ç”»å¸ƒ
            simCtx.clearRect(0, 0, simCanvas.width, simCanvas.height);
            
            // è®¡ç®—åƒçš„ä½ç½®å’Œå±æ€§
            const image = calculateImage();
            
            // ç»˜åˆ¶èƒŒæ™¯ç½‘æ ¼ï¼ˆæš—å®¤æ•ˆæœï¼‰
            drawDarkRoomBackground();
            
            // ç»˜åˆ¶ä¸»å…‰è½´
            drawPrincipalAxis();
            
            // ç»˜åˆ¶æ ‡å°º
            if (showRuler.checked) {
                drawRuler();
            }
            
            // ç»˜åˆ¶é€é•œ
            drawLens();
            
            // ç»˜åˆ¶ç„¦ç‚¹å’Œ2Fç‚¹
            if (showFocus.checked) {
                drawFocusPoints();
            }
            
            if (show2F.checked) {
                draw2FPoints();
            }
            
            // ç»˜åˆ¶ç‰©ä½“
            drawObject();
            
            // ç»˜åˆ¶åƒ
            if (image.imageType !== 'none') {
                drawImage(image);
            }
            
            // ç»˜åˆ¶å…‰çº¿
            if (showRays.checked && !simplifyView) {
                drawRays(image);
            }
            
            // æ›´æ–°æ•°æ®æ˜¾ç¤º
            updateDataDisplay(image);
        }
        
        // ç»˜åˆ¶æš—å®¤èƒŒæ™¯
        function drawDarkRoomBackground() {
            // æš—å®¤èƒŒæ™¯è‰²
            simCtx.fillStyle = 'rgba(13, 19, 33, 1)';
            simCtx.fillRect(0, 0, simCanvas.width, simCanvas.height);
            
            // æ·»åŠ å¾®å¼±çš„ç½‘æ ¼
            simCtx.strokeStyle = 'rgba(30, 40, 70, 0.3)';
            simCtx.lineWidth = 0.5;
            const gridSize = 50;
            
            // å‚ç›´çº¿
            for (let x = 0; x < simCanvas.width; x += gridSize) {
                simCtx.beginPath();
                simCtx.moveTo(x, 0);
                simCtx.lineTo(x, simCanvas.height);
                simCtx.stroke();
            }
            
            // æ°´å¹³çº¿
            for (let y = 0; y < simCanvas.height; y += gridSize) {
                simCtx.beginPath();
                simCtx.moveTo(0, y);
                simCtx.lineTo(simCanvas.width, y);
                simCtx.stroke();
            }
        }
        
        // ç»˜åˆ¶ä¸»å…‰è½´
        function drawPrincipalAxis() {
            const centerY = simCanvas.height / 2;
            
            simCtx.strokeStyle = 'rgba(255, 255, 255, 0.6)';
            simCtx.lineWidth = 1.5;
            simCtx.setLineDash([]);
            
            simCtx.beginPath();
            simCtx.moveTo(50, centerY);
            simCtx.lineTo(simCanvas.width - 50, centerY);
            simCtx.stroke();
        }
        
        // ç»˜åˆ¶æ ‡å°º
        function drawRuler() {
            const centerY = simCanvas.height / 2;
            const startX = 50;
            const endX = simCanvas.width - 50;
            
            simCtx.strokeStyle = 'rgba(200, 200, 255, 0.5)';
            simCtx.lineWidth = 1;
            simCtx.font = '12px Arial';
            simCtx.fillStyle = 'rgba(200, 200, 255, 0.8)';
            simCtx.textAlign = 'center';
            
            // ç»˜åˆ¶åˆ»åº¦
            for (let x = startX; x <= endX; x += 50) {
                const distanceFromLens = x - lensX;
                
                simCtx.beginPath();
                simCtx.moveTo(x, centerY - 10);
                simCtx.lineTo(x, centerY + 10);
                simCtx.stroke();
                
                // æ˜¾ç¤ºåˆ»åº¦å€¼ï¼ˆç›¸å¯¹äºé€é•œï¼‰
                if (Math.abs(distanceFromLens) > 20) {
                    simCtx.fillText(distanceFromLens.toString(), x, centerY + 25);
                }
            }
            
            // æ ‡è®°é€é•œä½ç½®
            simCtx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            simCtx.fillText('O (å…‰å¿ƒ)', lensX, centerY + 40);
        }
        
        // ç»˜åˆ¶é€é•œ
        function drawLens() {
            const centerY = simCanvas.height / 2;
            
            // é€é•œä¸»ä½“
            simCtx.fillStyle = 'rgba(200, 200, 220, 0.7)';
            simCtx.strokeStyle = 'rgba(100, 100, 150, 1)';
            simCtx.lineWidth = 2;
            
            // ç»˜åˆ¶å‡¸é€é•œå½¢çŠ¶
            simCtx.beginPath();
            simCtx.rect(lensX - lensWidth/2, centerY - lensHeight/2, lensWidth, lensHeight);
            simCtx.fill();
            simCtx.stroke();
            
            // æ·»åŠ é€é•œå¼§çº¿æ•ˆæœ
            simCtx.strokeStyle = 'rgba(80, 80, 120, 0.8)';
            simCtx.lineWidth = 1;
            
            // å·¦ä¾§å¼§çº¿
            simCtx.beginPath();
            simCtx.arc(lensX - lensWidth/2, centerY, lensHeight/3, -Math.PI/2, Math.PI/2);
            simCtx.stroke();
            
            // å³ä¾§å¼§çº¿
            simCtx.beginPath();
            simCtx.arc(lensX + lensWidth/2, centerY, lensHeight/3, Math.PI/2, -Math.PI/2);
            simCtx.stroke();
            
            // æ ‡è®°é€é•œ
            simCtx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            simCtx.font = 'bold 16px Arial';
            simCtx.textAlign = 'center';
            simCtx.fillText('å‡¸é€é•œ', lensX, centerY - lensHeight/2 - 15);
        }
        
        // ç»˜åˆ¶ç„¦ç‚¹
        function drawFocusPoints() {
            const centerY = simCanvas.height / 2;
            
            // å·¦ä¾§ç„¦ç‚¹F
            const leftFocusX = lensX - f;
            simCtx.fillStyle = '#FF9800';
            simCtx.beginPath();
            simCtx.arc(leftFocusX, centerY, 6, 0, Math.PI * 2);
            simCtx.fill();
            simCtx.strokeStyle = '#FF9800';
            simCtx.lineWidth = 2;
            simCtx.stroke();
            
            simCtx.fillStyle = '#FF9800';
            simCtx.font = 'bold 14px Arial';
            simCtx.textAlign = 'center';
            simCtx.fillText('F', leftFocusX, centerY - 15);
            
            // å³ä¾§ç„¦ç‚¹F'
            const rightFocusX = lensX + f;
            simCtx.fillStyle = '#FF9800';
            simCtx.beginPath();
            simCtx.arc(rightFocusX, centerY, 6, 0, Math.PI * 2);
            simCtx.fill();
            simCtx.strokeStyle = '#FF9800';
            simCtx.lineWidth = 2;
            simCtx.stroke();
            
            simCtx.fillText("F'", rightFocusX, centerY - 15);
        }
        
        // ç»˜åˆ¶2Fç‚¹
        function draw2FPoints() {
            const centerY = simCanvas.height / 2;
            
            // å·¦ä¾§2Fç‚¹
            const left2FX = lensX - 2*f;
            simCtx.fillStyle = '#4CAF50';
            simCtx.beginPath();
            simCtx.arc(left2FX, centerY, 6, 0, Math.PI * 2);
            simCtx.fill();
            simCtx.strokeStyle = '#4CAF50';
            simCtx.lineWidth = 2;
            simCtx.stroke();
            
            simCtx.fillStyle = '#4CAF50';
            simCtx.font = 'bold 14px Arial';
            simCtx.textAlign = 'center';
            simCtx.fillText('2F', left2FX, centerY - 15);
            
            // å³ä¾§2Fç‚¹
            const right2FX = lensX + 2*f;
            simCtx.fillStyle = '#4CAF50';
            simCtx.beginPath();
            simCtx.arc(right2FX, centerY, 6, 0, Math.PI * 2);
            simCtx.fill();
            simCtx.strokeStyle = '#4CAF50';
            simCtx.lineWidth = 2;
            simCtx.stroke();
            
            simCtx.fillText("2F'", right2FX, centerY - 15);
        }
        
        // ç»˜åˆ¶ç‰©ä½“
        function drawObject() {
            const centerY = simCanvas.height / 2;
            const objectX = lensX - u;
            
            // ç‰©ä½“ç®­å¤´
            simCtx.fillStyle = '#4CAF50';
            simCtx.strokeStyle = '#2E7D32';
            simCtx.lineWidth = 2;
            
            // ç»˜åˆ¶ç®­å¤´ä¸»ä½“
            simCtx.beginPath();
            simCtx.moveTo(objectX, centerY);
            simCtx.lineTo(objectX, centerY - objectHeight);
            simCtx.lineTo(objectX - 10, centerY - objectHeight + 15);
            simCtx.moveTo(objectX, centerY - objectHeight);
            simCtx.lineTo(objectX + 10, centerY - objectHeight + 15);
            simCtx.stroke();
            
            // å¡«å……ç®­å¤´
            simCtx.beginPath();
            simCtx.moveTo(objectX, centerY);
            simCtx.lineTo(objectX, centerY - objectHeight);
            simCtx.lineTo(objectX - 10, centerY - objectHeight + 15);
            simCtx.lineTo(objectX + 10, centerY - objectHeight + 15);
            simCtx.closePath();
            simCtx.fill();
            
            // æ ‡è®°ç‰©ä½“
            simCtx.fillStyle = '#4CAF50';
            simCtx.font = 'bold 14px Arial';
            simCtx.textAlign = 'center';
            simCtx.fillText('ç‰©ä½“', objectX, centerY - objectHeight - 15);
            
            // ç»˜åˆ¶å¯æ‹–æ‹½åŒºåŸŸ
            simCtx.fillStyle = 'rgba(76, 175, 80, 0.2)';
            simCtx.beginPath();
            simCtx.arc(objectX, centerY, 15, 0, Math.PI * 2);
            simCtx.fill();
            
            simCtx.strokeStyle = '#4CAF50';
            simCtx.lineWidth = 1;
            simCtx.setLineDash([5, 3]);
            simCtx.beginPath();
            simCtx.arc(objectX, centerY, 15, 0, Math.PI * 2);
            simCtx.stroke();
            simCtx.setLineDash([]);
        }
        
        // ç»˜åˆ¶åƒ
        function drawImage(image) {
            const centerY = simCanvas.height / 2;
            let imageX;
            
            if (image.imageType === 'real') {
                // å®åƒåœ¨é€é•œå³ä¾§
                imageX = lensX + image.v;
                
                // å®åƒç®­å¤´ï¼ˆå€’ç«‹ï¼‰
                simCtx.fillStyle = 'rgba(244, 67, 54, 0.9)';
                simCtx.strokeStyle = '#C62828';
                simCtx.lineWidth = 2;
                
                // ç»˜åˆ¶ç®­å¤´ä¸»ä½“ï¼ˆå€’ç«‹ï¼‰
                simCtx.beginPath();
                simCtx.moveTo(imageX, centerY);
                simCtx.lineTo(imageX, centerY + image.imageHeight);
                simCtx.lineTo(imageX - 10, centerY + image.imageHeight - 15);
                simCtx.moveTo(imageX, centerY + image.imageHeight);
                simCtx.lineTo(imageX + 10, centerY + image.imageHeight - 15);
                simCtx.stroke();
                
                // å¡«å……ç®­å¤´
                simCtx.beginPath();
                simCtx.moveTo(imageX, centerY);
                simCtx.lineTo(imageX, centerY + image.imageHeight);
                simCtx.lineTo(imageX - 10, centerY + image.imageHeight - 15);
                simCtx.lineTo(imageX + 10, centerY + image.imageHeight - 15);
                simCtx.closePath();
                simCtx.fill();
                
                // æ ‡è®°å®åƒ
                simCtx.fillStyle = '#F44336';
                simCtx.font = 'bold 14px Arial';
                simCtx.textAlign = 'center';
                simCtx.fillText('å®åƒ', imageX, centerY + image.imageHeight + 20);
            } else if (image.imageType === 'virtual') {
                // è™šåƒåœ¨é€é•œå·¦ä¾§ï¼ˆä¸ç‰©ä½“åŒä¾§ï¼‰
                imageX = lensX - Math.abs(image.v);
                
                // è™šåƒç®­å¤´ï¼ˆæ­£ç«‹ï¼Œè™šçº¿ï¼‰
                simCtx.fillStyle = 'rgba(255, 152, 0, 0.7)';
                simCtx.strokeStyle = '#EF6C00';
                simCtx.lineWidth = 2;
                simCtx.setLineDash([5, 3]);
                
                // ç»˜åˆ¶ç®­å¤´ä¸»ä½“ï¼ˆæ­£ç«‹ï¼‰
                simCtx.beginPath();
                simCtx.moveTo(imageX, centerY);
                simCtx.lineTo(imageX, centerY - image.imageHeight);
                simCtx.lineTo(imageX - 10, centerY - image.imageHeight + 15);
                simCtx.moveTo(imageX, centerY - image.imageHeight);
                simCtx.lineTo(imageX + 10, centerY - image.imageHeight + 15);
                simCtx.stroke();
                
                // å¡«å……ç®­å¤´ï¼ˆåŠé€æ˜ï¼‰
                simCtx.beginPath();
                simCtx.moveTo(imageX, centerY);
                simCtx.lineTo(imageX, centerY - image.imageHeight);
                simCtx.lineTo(imageX - 10, centerY - image.imageHeight + 15);
                simCtx.lineTo(imageX + 10, centerY - image.imageHeight + 15);
                simCtx.closePath();
                simCtx.fill();
                
                simCtx.setLineDash([]);
                
                // æ ‡è®°è™šåƒ
                simCtx.fillStyle = '#FF9800';
                simCtx.font = 'bold 14px Arial';
                simCtx.textAlign = 'center';
                simCtx.fillText('è™šåƒ', imageX, centerY - image.imageHeight - 20);
            }
        }
        
        // ç»˜åˆ¶å…‰çº¿
        function drawRays(image) {
            const centerY = simCanvas.height / 2;
            const objectX = lensX - u;
            const objectTopY = centerY - objectHeight;
            
            // å…‰çº¿1ï¼šå¹³è¡Œäºä¸»å…‰è½´çš„å…‰çº¿ï¼Œç»è¿‡ç„¦ç‚¹
            simCtx.strokeStyle = '#2196F3';
            simCtx.lineWidth = 2;
            simCtx.setLineDash([]);
            
            simCtx.beginPath();
            simCtx.moveTo(objectX, objectTopY);
            
            if (u > f) {
                // å®åƒæƒ…å†µï¼šå…‰çº¿é€šè¿‡é€é•œåç»è¿‡å³ä¾§ç„¦ç‚¹
                simCtx.lineTo(lensX, objectTopY);
                simCtx.lineTo(lensX + f, centerY);
                
                if (image.imageType === 'real') {
                    simCtx.lineTo(lensX + image.v, centerY + image.imageHeight);
                }
            } else {
                // è™šåƒæƒ…å†µï¼šå…‰çº¿é€šè¿‡é€é•œåå‘æ•£ï¼Œåå‘å»¶é•¿çº¿ç»è¿‡å·¦ä¾§ç„¦ç‚¹
                simCtx.lineTo(lensX, objectTopY);
                
                // å®é™…å…‰çº¿
                const slope = (centerY - objectTopY) / f;
                simCtx.lineTo(lensX + 100, objectTopY + slope * 100);
                
                // åå‘å»¶é•¿çº¿ï¼ˆè™šçº¿ï¼‰
                simCtx.setLineDash([5, 3]);
                simCtx.beginPath();
                simCtx.moveTo(lensX, objectTopY);
                simCtx.lineTo(lensX - f, centerY);
                if (image.imageType === 'virtual') {
                    simCtx.lineTo(lensX - Math.abs(image.v), centerY - image.imageHeight);
                }
                simCtx.stroke();
                simCtx.setLineDash([]);
            }
            simCtx.stroke();
            
            // å…‰çº¿2ï¼šç»è¿‡å…‰å¿ƒçš„å…‰çº¿ï¼Œæ–¹å‘ä¸å˜
            simCtx.strokeStyle = '#FFEB3B';
            simCtx.lineWidth = 2;
            
            simCtx.beginPath();
            simCtx.moveTo(objectX, objectTopY);
            simCtx.lineTo(lensX, centerY);
            
            if (image.imageType === 'real') {
                simCtx.lineTo(lensX + image.v, centerY + image.imageHeight);
            } else if (image.imageType === 'virtual') {
                // è™šåƒæƒ…å†µï¼šåå‘å»¶é•¿çº¿
                simCtx.setLineDash([5, 3]);
                simCtx.beginPath();
                simCtx.moveTo(lensX, centerY);
                simCtx.lineTo(lensX - Math.abs(image.v), centerY - image.imageHeight);
                simCtx.stroke();
                simCtx.setLineDash([]);
            }
            simCtx.stroke();
            
            // å…‰çº¿3ï¼šç»è¿‡ç„¦ç‚¹çš„å…‰çº¿ï¼Œå¹³è¡Œäºä¸»å…‰è½´å°„å‡º
            simCtx.strokeStyle = '#9C27B0';
            simCtx.lineWidth = 2;
            
            if (u > f) {
                // å®åƒæƒ…å†µï¼šå…‰çº¿ç»è¿‡å·¦ä¾§ç„¦ç‚¹ï¼Œé€šè¿‡é€é•œåå¹³è¡Œäºä¸»å…‰è½´
                simCtx.beginPath();
                simCtx.moveTo(objectX, objectTopY);
                simCtx.lineTo(lensX - f, centerY);
                sim
<!--æ£€æµ‹åˆ°ä»£ç æˆªæ–­ï¼Œè‡ªåŠ¨ç»­å†™ä¸­...-->
Ctx.lineTo(lensX, centerY);
                simCtx.lineTo(lensX + 100, centerY);
                
                if (image.imageType === 'real') {
                    simCtx.lineTo(lensX + image.v, centerY + image.imageHeight);
                }
                simCtx.stroke();
            } else {
                // è™šåƒæƒ…å†µï¼šå…‰çº¿æŒ‡å‘å³ä¾§ç„¦ç‚¹ï¼Œé€šè¿‡é€é•œåå¹³è¡Œäºä¸»å…‰è½´
                simCtx.beginPath();
                simCtx.moveTo(objectX, objectTopY);
                
                // å®é™…å…‰çº¿
                simCtx.lineTo(lensX, objectTopY);
                simCtx.lineTo(lensX + 100, objectTopY);
                
                // åå‘å»¶é•¿çº¿ï¼ˆè™šçº¿ï¼‰æŒ‡å‘å³ä¾§ç„¦ç‚¹
                simCtx.setLineDash([5, 3]);
                simCtx.beginPath();
                simCtx.moveTo(lensX, objectTopY);
                simCtx.lineTo(lensX + f, centerY);
                if (image.imageType === 'virtual') {
                    simCtx.lineTo(lensX - Math.abs(image.v), centerY - image.imageHeight);
                }
                simCtx.stroke();
                simCtx.setLineDash([]);
            }
            
            // åœ¨å…‰çº¿äº¤ç‚¹å¤„æ·»åŠ äº®ç‚¹æ•ˆæœ
            if (image.imageType === 'real') {
                const imageX = lensX + image.v;
                const imageY = centerY + image.imageHeight;
                
                // å…‰çº¿äº¤æ±‡ç‚¹é«˜äº®
                const gradient = simCtx.createRadialGradient(
                    imageX, imageY, 0,
                    imageX, imageY, 10
                );
                gradient.addColorStop(0, 'rgba(255, 255, 255, 0.9)');
                gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
                
                simCtx.fillStyle = gradient;
                simCtx.beginPath();
                simCtx.arc(imageX, imageY, 10, 0, Math.PI * 2);
                simCtx.fill();
            }
        }
        
        // æ›´æ–°æ•°æ®æ˜¾ç¤º
        function updateDataDisplay(image) {
            // æ›´æ–°æ»‘å—æ˜¾ç¤ºå€¼
            uValue.textContent = `${u} px`;
            fValue.textContent = `${f} px`;
            hValue.textContent = `${objectHeight} px`;
            
            // æ›´æ–°æ•°æ®é¢æ¿
            dataU.textContent = `${u} px`;
            dataF.textContent = `${f} px`;
            
            if (image.imageType !== 'none') {
                if (Math.abs(image.v) > 10000) {
                    dataV.textContent = "âˆ";
                } else {
                    dataV.textContent = `${Math.abs(image.v).toFixed(1)} px`;
                }
                
                if (image.m > 100) {
                    dataM.textContent = "âˆ";
                } else {
                    dataM.textContent = image.m.toFixed(2);
                }
                
                imageProperty.textContent = image.imagePropertyText;
            } else {
                dataV.textContent = "âˆ";
                dataM.textContent = "âˆ";
                imageProperty.textContent = "ä¸æˆåƒï¼ˆå¹³è¡Œå…‰ï¼‰";
            }
        }
        
        // ç»˜åˆ¶å›¾è¡¨
        function drawChart() {
            const width = chartCanvas.width;
            const height = chartCanvas.height;
            const padding = { top: 20, right: 20, bottom: 30, left: 50 };
            const chartWidth = width - padding.left - padding.right;
            const chartHeight = height - padding.top - padding.bottom;
            
            // æ¸…é™¤ç”»å¸ƒ
            chartCtx.clearRect(0, 0, width, height);
            
            // ç»˜åˆ¶èƒŒæ™¯
            chartCtx.fillStyle = '#f9f9f9';
            chartCtx.fillRect(0, 0, width, height);
            
            // ç»˜åˆ¶åæ ‡è½´
            chartCtx.strokeStyle = '#aaa';
            chartCtx.lineWidth = 1;
            
            // Yè½´
            chartCtx.beginPath();
            chartCtx.moveTo(padding.left, padding.top);
            chartCtx.lineTo(padding.left, height - padding.bottom);
            chartCtx.stroke();
            
            // Xè½´
            chartCtx.beginPath();
            chartCtx.moveTo(padding.left, height - padding.bottom);
            chartCtx.lineTo(width - padding.right, height - padding.bottom);
            chartCtx.stroke();
            
            // ç»˜åˆ¶ç½‘æ ¼çº¿
            chartCtx.strokeStyle = '#e0e0e0';
            chartCtx.lineWidth = 0.5;
            
            // å‚ç›´ç½‘æ ¼çº¿
            for (let i = 0; i <= 10; i++) {
                const x = padding.left + (i / 10) * chartWidth;
                chartCtx.beginPath();
                chartCtx.moveTo(x, padding.top);
                chartCtx.lineTo(x, height - padding.bottom);
                chartCtx.stroke();
            }
            
            // æ°´å¹³ç½‘æ ¼çº¿
            for (let i = 0; i <= 5; i++) {
                const y = height - padding.bottom - (i / 5) * chartHeight;
                chartCtx.beginPath();
                chartCtx.moveTo(padding.left, y);
                chartCtx.lineTo(width - padding.right, y);
                chartCtx.stroke();
            }
            
            // ç»˜åˆ¶åæ ‡è½´æ ‡ç­¾
            chartCtx.fillStyle = '#555';
            chartCtx.font = '12px Arial';
            chartCtx.textAlign = 'center';
            
            // Xè½´æ ‡ç­¾
            chartCtx.fillText('ç‰©è· u (px)', width / 2, height - 5);
            
            // Yè½´æ ‡ç­¾ï¼ˆå·¦ä¾§ï¼‰
            chartCtx.save();
            chartCtx.translate(15, height / 2);
            chartCtx.rotate(-Math.PI / 2);
            chartCtx.fillText('åƒè· v (px)', 0, 0);
            chartCtx.restore();
            
            // Yè½´æ ‡ç­¾ï¼ˆå³ä¾§ï¼‰
            chartCtx.save();
            chartCtx.translate(width - 15, height / 2);
            chartCtx.rotate(-Math.PI / 2);
            chartCtx.fillText('æ”¾å¤§ç‡ m', 0, 0);
            chartCtx.restore();
            
            // ç»˜åˆ¶åˆ»åº¦
            chartCtx.textAlign = 'right';
            chartCtx.fillStyle = '#777';
            
            // Yè½´åˆ»åº¦ï¼ˆåƒè·ï¼‰
            for (let i = 0; i <= 5; i++) {
                const value = i * 200;
                const y = height - padding.bottom - (i / 5) * chartHeight;
                chartCtx.fillText(value.toString(), padding.left - 5, y + 4);
            }
            
            // Yè½´åˆ»åº¦ï¼ˆæ”¾å¤§ç‡ï¼‰
            chartCtx.textAlign = 'left';
            for (let i = 0; i <= 5; i++) {
                const value = i;
                const y = height - padding.bottom - (i / 5) * chartHeight;
                chartCtx.fillText(value.toFixed(1), width - padding.right + 5, y + 4);
            }
            
            // Xè½´åˆ»åº¦
            chartCtx.textAlign = 'center';
            for (let i = 0; i <= 10; i++) {
                const value = i * 80;
                const x = padding.left + (i / 10) * chartWidth;
                chartCtx.fillText(value.toString(), x, height - padding.bottom + 15);
            }
            
            // ç»˜åˆ¶ç‰¹æ®Šä½ç½®çº¿ï¼ˆu=f å’Œ u=2fï¼‰
            chartCtx.strokeStyle = 'rgba(0, 0, 0, 0.2)';
            chartCtx.lineWidth = 1;
            chartCtx.setLineDash([5, 3]);
            
            // u = f çº¿
            const fX = padding.left + (f / 800) * chartWidth;
            chartCtx.beginPath();
            chartCtx.moveTo(fX, padding.top);
            chartCtx.lineTo(fX, height - padding.bottom);
            chartCtx.stroke();
            
            // u = 2f çº¿
            const twoFX = padding.left + (2*f / 800) * chartWidth;
            chartCtx.beginPath();
            chartCtx.moveTo(twoFX, padding.top);
            chartCtx.lineTo(twoFX, height - padding.bottom);
            chartCtx.stroke();
            
            chartCtx.setLineDash([]);
            
            // æ ‡è®°ç‰¹æ®Šä½ç½®
            chartCtx.fillStyle = '#FF9800';
            chartCtx.font = 'bold 10px Arial';
            chartCtx.fillText('u=f', fX, padding.top - 5);
            chartCtx.fillStyle = '#4CAF50';
            chartCtx.fillText('u=2f', twoFX, padding.top - 5);
            
            // ç»˜åˆ¶åƒè·æ›²çº¿ (v vs u)
            chartCtx.strokeStyle = '#F44336';
            chartCtx.lineWidth = 2;
            chartCtx.beginPath();
            
            let firstPoint = true;
            for (const point of chartData) {
                if (point.v > 5000 || point.v < -5000) continue; // è·³è¿‡æ— ç©·å¤§å€¼
                
                const x = padding.left + (point.u / 800) * chartWidth;
                const y = height - padding.bottom - (Math.min(point.v, 1000) / 1000) * chartHeight;
                
                if (firstPoint) {
                    chartCtx.moveTo(x, y);
                    firstPoint = false;
                } else {
                    chartCtx.lineTo(x, y);
                }
            }
            chartCtx.stroke();
            
            // ç»˜åˆ¶æ”¾å¤§ç‡æ›²çº¿ (m vs u)
            chartCtx.strokeStyle = '#FF9800';
            chartCtx.lineWidth = 2;
            chartCtx.beginPath();
            
            firstPoint = true;
            for (const point of chartData) {
                if (point.m > 10) continue; // è·³è¿‡è¿‡å¤§çš„æ”¾å¤§ç‡
                
                const x = padding.left + (point.u / 800) * chartWidth;
                const y = height - padding.bottom - (Math.min(point.m, 5) / 5) * chartHeight;
                
                if (firstPoint) {
                    chartCtx.moveTo(x, y);
                    firstPoint = false;
                } else {
                    chartCtx.lineTo(x, y);
                }
            }
            chartCtx.stroke();
            
            // ç»˜åˆ¶å½“å‰ç‰©è·ä½ç½®ç‚¹
            const currentX = padding.left + (u / 800) * chartWidth;
            const image = calculateImage();
            
            // åƒè·ç‚¹
            if (image.v < 5000 && image.v > -5000) {
                const vY = height - padding.bottom - (Math.min(Math.abs(image.v), 1000) / 1000) * chartHeight;
                
                chartCtx.fillStyle = '#F44336';
                chartCtx.beginPath();
                chartCtx.arc(currentX, vY, 5, 0, Math.PI * 2);
                chartCtx.fill();
                chartCtx.strokeStyle = '#C62828';
                chartCtx.lineWidth = 1;
                chartCtx.stroke();
            }
            
            // æ”¾å¤§ç‡ç‚¹
            if (image.m < 10) {
                const mY = height - padding.bottom - (Math.min(image.m, 5) / 5) * chartHeight;
                
                chartCtx.fillStyle = '#FF9800';
                chartCtx.beginPath();
                chartCtx.arc(currentX, mY, 5, 0, Math.PI * 2);
                chartCtx.fill();
                chartCtx.strokeStyle = '#EF6C00';
                chartCtx.lineWidth = 1;
                chartCtx.stroke();
            }
            
            // ç»˜åˆ¶å‚ç›´çº¿æŒ‡ç¤ºå½“å‰ç‰©è·
            chartCtx.strokeStyle = '#3949ab';
            chartCtx.lineWidth = 1;
            chartCtx.setLineDash([3, 3]);
            chartCtx.beginPath();
            chartCtx.moveTo(currentX, padding.top);
            chartCtx.lineTo(currentX, height - padding.bottom);
            chartCtx.stroke();
            chartCtx.setLineDash([]);
            
            // æ·»åŠ å›¾ä¾‹
            chartCtx.fillStyle = '#333';
            chartCtx.font = '12px Arial';
            chartCtx.textAlign = 'left';
            
            // åƒè·å›¾ä¾‹
            chartCtx.fillStyle = '#F44336';
            chartCtx.fillRect(width - 120, 15, 15, 10);
            chartCtx.fillStyle = '#333';
            chartCtx.fillText('åƒè· v', width - 100, 25);
            
            // æ”¾å¤§ç‡å›¾ä¾‹
            chartCtx.fillStyle = '#FF9800';
            chartCtx.fillRect(width - 120, 35, 15, 10);
            chartCtx.fillStyle = '#333';
            chartCtx.fillText('æ”¾å¤§ç‡ m', width - 100, 45);
        }
        
        // äº‹ä»¶å¤„ç†å‡½æ•°
        function handleMouseDown(e) {
            const rect = simCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const centerY = simCanvas.height / 2;
            const objectX = lensX - u;
            
            // æ£€æŸ¥æ˜¯å¦ç‚¹å‡»åœ¨ç‰©ä½“æ‹–æ‹½åŒºåŸŸ
            const distance = Math.sqrt((x - objectX) ** 2 + (y - centerY) ** 2);
            if (distance < 20) {
                isDragging = true;
                simCanvas.style.cursor = 'grabbing';
            }
        }
        
        function handleMouseMove(e) {
            if (!isDragging) return;
            
            const rect = simCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            
            // è®¡ç®—æ–°çš„ç‰©è·ï¼ˆé™åˆ¶èŒƒå›´ï¼‰
            let newU = lensX - x;
            newU = Math.max(50, Math.min(800, newU));
            
            // æ›´æ–°ç‰©è·
            u = newU;
            uSlider.value = u;
            
            // é‡ç»˜
            drawSimulation();
            drawChart();
        }
        
        function handleMouseUp() {
            isDragging = false;
            simCanvas.style.cursor = 'default';
        }
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
        function initEventListeners() {
            // é¼ æ ‡äº‹ä»¶ï¼ˆç”¨äºæ‹–æ‹½ç‰©ä½“ï¼‰
            simCanvas.addEventListener('mousedown', handleMouseDown);
            simCanvas.addEventListener('mousemove', handleMouseMove);
            simCanvas.addEventListener('mouseup', handleMouseUp);
            simCanvas.addEventListener('mouseleave', handleMouseUp);
            
            // è§¦æ‘¸äº‹ä»¶ï¼ˆç”¨äºç§»åŠ¨è®¾å¤‡ï¼‰
            simCanvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                handleMouseDown(e.touches[0]);
            });
            
            simCanvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                handleMouseMove(e.touches[0]);
            });
            
            simCanvas.addEventListener('touchend', (e) => {
                e.preventDefault();
                handleMouseUp();
            });
            
            // æ»‘å—äº‹ä»¶
            uSlider.addEventListener('input', () => {
                u = parseInt(uSlider.value);
                drawSimulation();
                drawChart();
            });
            
            fSlider.addEventListener('input', () => {
                f = parseInt(fSlider.value);
                generateChartData();
                drawSimulation();
                drawChart();
            });
            
            hSlider.addEventListener('input', () => {
                objectHeight = parseInt(hSlider.value);
                drawSimulation();
            });
            
            // æ˜¾ç¤ºé€‰é¡¹äº‹ä»¶
            showRays.addEventListener('change', drawSimulation);
            showFocus.addEventListener('change', drawSimulation);
            show2F.addEventListener('change', drawSimulation);
            showRuler.addEventListener('change', drawSimulation);
            
            // æŒ‰é’®äº‹ä»¶
            resetBtn.addEventListener('click', () => {
                u = 300;
                f = 150;
                objectHeight = 80;
                
                uSlider.value = u;
                fSlider.value = f;
                hSlider.value = objectHeight;
                
                generateChartData();
                drawSimulation();
                drawChart();
            });
            
            simplifyViewBtn.addEventListener('click', () => {
                simplifyView = !simplifyView;
                simplifyViewBtn.textContent = simplifyView ? "è¯¦ç»†è§†å›¾" : "ç®€åŒ–è§†å›¾";
                drawSimulation();
            });
            
            // çª—å£å¤§å°å˜åŒ–äº‹ä»¶
            window.addEventListener('resize', () => {
                initCanvasSize();
            });
        }
        
        // åˆå§‹åŒ–å‡½æ•°
        function init() {
            initCanvasSize();
            initEventListeners();
            
            // åˆå§‹ç»˜åˆ¶
            drawSimulation();
            drawChart();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', init);
    </script>
</body>
</html>