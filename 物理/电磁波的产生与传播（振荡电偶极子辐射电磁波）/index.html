<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”µç£æ³¢çš„äº§ç”Ÿä¸ä¼ æ’­ - æŒ¯è¡ç”µå¶æå­è¾å°„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0c0e2a 0%, #1a1d3c 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(30, 33, 64, 0.7);
            border-radius: 12px;
            border: 1px solid rgba(76, 195, 247, 0.2);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            color: #4FC3F7;
            margin-bottom: 10px;
            font-size: 2.2rem;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.5);
        }
        
        .subtitle {
            color: #69F0AE;
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .canvas-container {
            flex: 1;
            min-width: 600px;
            background: rgba(20, 22, 45, 0.8);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(76, 195, 247, 0.2);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        #animationCanvas {
            width: 100%;
            height: 500px;
            display: block;
            background: transparent;
        }
        
        .controls-panel {
            flex: 0 0 300px;
            background: rgba(30, 33, 64, 0.7);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(105, 240, 174, 0.2);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .control-section {
            background: rgba(40, 44, 80, 0.6);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4FC3F7;
        }
        
        .control-section.magnetic {
            border-left-color: #69F0AE;
        }
        
        .control-section.other {
            border-left-color: #FFEB3B;
        }
        
        h2 {
            color: #4FC3F7;
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        h2.magnetic {
            color: #69F0AE;
        }
        
        h2.other {
            color: #FFEB3B;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            background: rgba(76, 195, 247, 0.2);
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            flex: 1;
        }
        
        button:hover {
            background: rgba(76, 195, 247, 0.4);
            transform: translateY(-2px);
        }
        
        button.active {
            background: rgba(76, 195, 247, 0.7);
            color: white;
            box-shadow: 0 0 10px rgba(76, 195, 247, 0.5);
        }
        
        .magnetic-btn {
            background: rgba(105, 240, 174, 0.2);
        }
        
        .magnetic-btn:hover {
            background: rgba(105, 240, 174, 0.4);
        }
        
        .magnetic-btn.active {
            background: rgba(105, 240, 174, 0.7);
            box-shadow: 0 0 10px rgba(105, 240, 174, 0.5);
        }
        
        .slider-container {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #b0b0b0;
            font-size: 0.95rem;
        }
        
        .slider-value {
            color: #FFEB3B;
            font-weight: bold;
            float: right;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(100, 100, 120, 0.5);
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4FC3F7;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(79, 195, 247, 0.8);
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .legend-color {
            width: 20px;
            height: 10px;
            border-radius: 2px;
        }
        
        .legend-color.electric {
            background: #4FC3F7;
        }
        
        .legend-color.magnetic {
            background: #69F0AE;
        }
        
        .legend-color.positive {
            background: #FF5252;
        }
        
        .legend-color.negative {
            background: #FFAB40;
        }
        
        .legend-color.grid {
            background: #CCCCCC;
        }
        
        .instructions {
            background: rgba(30, 33, 64, 0.7);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid rgba(255, 235, 59, 0.2);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .instructions h2 {
            color: #FFEB3B;
            margin-bottom: 10px;
        }
        
        .instructions p {
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        .instructions ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }
        
        .instructions li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .key-point {
            color: #FFEB3B;
            font-weight: bold;
        }
        
        .detector-info {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 6px;
            font-size: 0.9rem;
            border: 1px solid rgba(255, 235, 59, 0.3);
            max-width: 250px;
            display: none;
        }
        
        .detector-info.active {
            display: block;
        }
        
        @media (max-width: 1000px) {
            .main-content {
                flex-direction: column;
            }
            
            .canvas-container, .controls-panel {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ç”µç£æ³¢çš„äº§ç”Ÿä¸ä¼ æ’­</h1>
            <div class="subtitle">æŒ¯è¡ç”µå¶æå­è¾å°„ç”µç£æ³¢ - äº¤äº’å¼æ•™å­¦åŠ¨ç”»</div>
        </header>
        
        <div class="main-content">
            <div class="canvas-container">
                <canvas id="animationCanvas"></canvas>
                <div class="detector-info" id="detectorInfo">
                    <div>æ¢æµ‹å™¨ä½ç½®: (<span id="detectorX">0</span>, <span id="detectorY">0</span>)</div>
                    <div>ç”µåœºå¼ºåº¦ E: <span id="detectorE">0.00</span></div>
                    <div>ç£åœºå¼ºåº¦ B: <span id="detectorB">0.00</span></div>
                    <div>ç›¸ä½å·®: <span id="detectorPhase">0.00</span> Ï€</div>
                </div>
            </div>
            
            <div class="controls-panel">
                <div class="control-section">
                    <h2>ğŸ“Š åŠ¨ç”»æ§åˆ¶</h2>
                    <div class="button-group">
                        <button id="playBtn">â–¶ æ’­æ”¾</button>
                        <button id="pauseBtn">â¸ æš‚åœ</button>
                        <button id="resetBtn">â†º é‡ç½®</button>
                    </div>
                    
                    <div class="slider-container">
                        <label>åŠ¨ç”»é€Ÿåº¦: <span class="slider-value" id="speedValue">1.0x</span></label>
                        <input type="range" id="speedSlider" min="0.1" max="3" step="0.1" value="1">
                    </div>
                </div>
                
                <div class="control-section">
                    <h2>ğŸ‘ï¸ è§†å›¾é€‰æ‹©</h2>
                    <div class="button-group">
                        <button id="viewElectric" class="active">ä»…ç”µåœº</button>
                        <button id="viewMagnetic" class="magnetic-btn">ä»…ç£åœº</button>
                        <button id="viewBoth">ç”µç£æ³¢</button>
                    </div>
                </div>
                
                <div class="control-section">
                    <h2>âš™ï¸ å‚æ•°è°ƒèŠ‚</h2>
                    <div class="slider-container">
                        <label>æŒ¯è¡é¢‘ç‡ (f): <span class="slider-value" id="freqValue">1.0 Hz</span></label>
                        <input type="range" id="freqSlider" min="0.5" max="3" step="0.1" value="1">
                    </div>
                    
                    <div class="slider-container">
                        <label>å¶æçŸ©å¤§å°: <span class="slider-value" id="dipoleValue">1.0</span></label>
                        <input type="range" id="dipoleSlider" min="0.5" max="2" step="0.1" value="1">
                    </div>
                </div>
                
                <div class="control-section other">
                    <h2 class="other">ğŸ”§ æ˜¾ç¤ºé€‰é¡¹</h2>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="showGrid" checked>
                            <label for="showGrid">ç©ºé—´ç½‘æ ¼</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="showArrows" checked>
                            <label for="showArrows">åœºçº¿ç®­å¤´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="showWavefront">
                            <label for="showWavefront">æ³¢å‰æ ‡è®°</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="showLabels" checked>
                            <label for="showLabels">ç‰©ç†é‡æ ‡ç­¾</label>
                        </div>
                    </div>
                </div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color electric"></div>
                        <span>ç”µåœº (E)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color magnetic"></div>
                        <span>ç£åœº (B)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color positive"></div>
                        <span>æ­£ç”µè· (+)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color negative"></div>
                        <span>è´Ÿç”µè· (-)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color grid"></div>
                        <span>å‚è€ƒç½‘æ ¼</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="instructions">
            <h2>ğŸ“š æ•™å­¦è¯´æ˜</h2>
            <p>æœ¬åŠ¨ç”»å±•ç¤ºäº†æŒ¯è¡ç”µå¶æå­å¦‚ä½•äº§ç”Ÿå¹¶è¾å°„ç”µç£æ³¢çš„è¿‡ç¨‹ï¼š</p>
            <ul>
                <li><span class="key-point">çº¢è‰²å’Œæ©™è‰²çƒä½“</span>åˆ†åˆ«ä»£è¡¨æ­£è´Ÿç”µè·ï¼Œå®ƒä»¬ä»¥ç®€è°è¿åŠ¨æ–¹å¼æŒ¯è¡ï¼Œå½¢æˆæŒ¯è¡ç”µå¶æå­ã€‚</li>
                <li><span class="key-point">è“è‰²çº¿æ¡/æ³¢é¢</span>è¡¨ç¤ºç”µåœºçº¿ï¼Œå…¶ç–å¯†ä»£è¡¨ç”µåœºå¼ºåº¦å¤§å°ã€‚</li>
                <li><span class="key-point">ç»¿è‰²åœ†åœˆ/ç¯çŠ¶é¢</span>è¡¨ç¤ºç£æ„Ÿçº¿ï¼Œç¯ç»•åœ¨ç”µåœºå‘¨å›´ã€‚</li>
                <li>åœ¨è¿‘åœºåŒºï¼ˆé è¿‘å¶æå­ï¼‰ï¼Œç”µåœºå’Œç£åœºåˆ†å¸ƒå¤æ‚ï¼›åœ¨è¿œåœºåŒºï¼Œå½¢æˆç¨³å®šçš„<span class="key-point">æ¨ªç”µç£æ³¢</span>ã€‚</li>
                <li>ç”µç£æ³¢ä¼ æ’­æ–¹å‘ã€ç”µåœºæ–¹å‘ã€ç£åœºæ–¹å‘ä¸‰è€…<span class="key-point">ä¸¤ä¸¤å‚ç›´</span>ï¼Œç¬¦åˆå³æ‰‹èºæ—‹å®šåˆ™ã€‚</li>
                <li>è°ƒèŠ‚é¢‘ç‡å¯è§‚å¯Ÿæ³¢é•¿å˜åŒ–ï¼šé¢‘ç‡è¶Šé«˜ï¼Œæ³¢é•¿è¶ŠçŸ­ï¼ˆÎ» = c/fï¼‰ã€‚</li>
            </ul>
            <p><span class="key-point">äº¤äº’æç¤ºï¼š</span>ç‚¹å‡»ç”»å¸ƒä»»æ„ä½ç½®å¯æ”¾ç½®è™šæ‹Ÿæ¢æµ‹å™¨ï¼Œæ˜¾ç¤ºè¯¥ç‚¹çš„ç”µåœºå’Œç£åœºå®æ—¶æ•°å€¼ã€‚</p>
        </div>
    </div>

    <script>
        // è·å–Canvaså’Œä¸Šä¸‹æ–‡
        const canvas = document.getElementById('animationCanvas');
        const ctx = canvas.getContext('2d');
        
        // è®¾ç½®Canvaså°ºå¯¸
        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = 500;
        }
        
        // åˆå§‹è°ƒæ•´å°ºå¯¸
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // åŠ¨ç”»çŠ¶æ€
        let animationId = null;
        let isPlaying = true;
        let time = 0;
        let speed = 1.0;
        
        // è§†å›¾æ¨¡å¼ï¼š0=ä»…ç”µåœºï¼Œ1=ä»…ç£åœºï¼Œ2=ç”µç£æ³¢
        let viewMode = 0;
        
        // ç‰©ç†å‚æ•°
        let frequency = 1.0; // Hz
        let dipoleMoment = 1.0;
        
        // æ˜¾ç¤ºé€‰é¡¹
        let showGrid = true;
        let showArrows = true;
        let showWavefront = false;
        let showLabels = true;
        
        // æ¢æµ‹å™¨ä½ç½®
        let detector = null;
        
        // é¢œè‰²å®šä¹‰
        const colors = {
            background: '#0c0e2a',
            electric: '#4FC3F7',
            magnetic: '#69F0AE',
            positive: '#FF5252',
            negative: '#FFAB40',
            grid: 'rgba(204, 204, 204, 0.3)',
            wavefront: 'rgba(255, 235, 59, 0.6)',
            text: '#e0e0e0',
            highlight: '#FFEB3B'
        };
        
        // åˆå§‹åŒ–UIæ§ä»¶
        document.getElementById('playBtn').addEventListener('click', () => {
            isPlaying = true;
            if (!animationId) animate();
        });
        
        document.getElementById('pauseBtn').addEventListener('click', () => {
            isPlaying = false;
        });
        
        document.getElementById('resetBtn').addEventListener('click', () => {
            time = 0;
            detector = null;
            document.getElementById('detectorInfo').classList.remove('active');
        });
        
        document.getElementById('speedSlider').addEventListener('input', (e) => {
            speed = parseFloat(e.target.value);
            document.getElementById('speedValue').textContent = speed.toFixed(1) + 'x';
        });
        
        document.getElementById('viewElectric').addEventListener('click', () => {
            viewMode = 0;
            updateViewButtons();
        });
        
        document.getElementById('viewMagnetic').addEventListener('click', () => {
            viewMode = 1;
            updateViewButtons();
        });
        
        document.getElementById('viewBoth').addEventListener('click', () => {
            viewMode = 2;
            updateViewButtons();
        });
        
        document.getElementById('freqSlider').addEventListener('input', (e) => {
            frequency = parseFloat(e.target.value);
            document.getElementById('freqValue').textContent = frequency.toFixed(1) + ' Hz';
        });
        
        document.getElementById('dipoleSlider').addEventListener('input', (e) => {
            dipoleMoment = parseFloat(e.target.value);
            document.getElementById('dipoleValue').textContent = dipoleMoment.toFixed(1);
        });
        
        document.getElementById('showGrid').addEventListener('change', (e) => {
            showGrid = e.target.checked;
        });
        
        document.getElementById('showArrows').addEventListener('change', (e) => {
            showArrows = e.target.checked;
        });
        
        document.getElementById('showWavefront').addEventListener('change', (e) => {
            showWavefront = e.target.checked;
        });
        
        document.getElementById('showLabels').addEventListener('change', (e) => {
            showLabels = e.target.checked;
        });
        
        // ç‚¹å‡»Canvasæ”¾ç½®æ¢æµ‹å™¨
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // è½¬æ¢ä¸ºç‰©ç†åæ ‡ï¼ˆåŸç‚¹åœ¨ç”»å¸ƒä¸­å¿ƒï¼‰
            const physX = (x - canvas.width/2) / 50;
            const physY = (canvas.height/2 - y) / 50;
            
            detector = {x: physX, y: physY};
            
            // æ›´æ–°æ¢æµ‹å™¨ä¿¡æ¯æ˜¾ç¤º
            const detectorInfo = document.getElementById('detectorInfo');
            detectorInfo.classList.add('active');
            document.getElementById('detectorX').textContent = physX.toFixed(2);
            document.getElementById('detectorY').textContent = physY.toFixed(2);
        });
        
        // æ›´æ–°è§†å›¾æŒ‰é’®çŠ¶æ€
        function updateViewButtons() {
            const electricBtn = document.getElementById('viewElectric');
            const magneticBtn = document.getElementById('viewMagnetic');
            const bothBtn = document.getElementById('viewBoth');
            
            electricBtn.classList.toggle('active', viewMode === 0);
            magneticBtn.classList.toggle('active', viewMode === 1);
            bothBtn.classList.toggle('active', viewMode === 2);
        }
        
        // è®¡ç®—ç”µåœºå’Œç£åœº
        function calculateFields(x, y, t) {
            // ç®€åŒ–æ¨¡å‹ï¼šæŒ¯è¡ç”µå¶æå­ä½äºåŸç‚¹ï¼Œæ²¿yè½´æ–¹å‘æŒ¯è¡
            const r = Math.sqrt(x*x + y*y);
            if (r < 0.1) return {E: 0, B: 0, Ex: 0, Ey: 0, Bz: 0};
            
            const theta = Math.atan2(y, x);
            const k = 2 * Math.PI * frequency / 3; // æ³¢æ•°ï¼ˆç®€åŒ–ï¼Œå…‰é€Ÿc=3å•ä½ï¼‰
            const omega = 2 * Math.PI * frequency;
            
            // æŒ¯è¡å¶æçŸ© p = p0 * cos(Ï‰t)
            const p = dipoleMoment * Math.cos(omega * t);
            
            // è¿œåœºè¿‘ä¼¼ä¸‹çš„ç”µåœºå’Œç£åœºï¼ˆç®€åŒ–æ¨¡å‹ï¼‰
            const E0 = p * Math.sin(theta) / (r * r);
            const B0 = p * Math.sin(theta) / (r * r);
            
            // è€ƒè™‘æ³¢åŠ¨æ€§ï¼šcos(kr - Ï‰t) / r
            const waveFactor = Math.cos(k * r - omega * t) / Math.max(r, 1);
            
            // ç”µåœºåˆ†é‡ï¼ˆåœ¨xyå¹³é¢å†…ï¼Œå‚ç›´äºä¼ æ’­æ–¹å‘ï¼‰
            const Ex = -E0 * Math.sin(theta) * waveFactor;
            const Ey = E0 * Math.cos(theta) * waveFactor;
            
            // ç£åœºåˆ†é‡ï¼ˆå‚ç›´äºå±å¹•ï¼Œzæ–¹å‘ï¼‰
            const Bz = B0 * waveFactor;
            
            // æ€»åœºå¼ºï¼ˆç”¨äºæ˜¾ç¤ºï¼‰
            const E = Math.sqrt(Ex*Ex + Ey*Ey);
            const B = Math.abs(Bz);
            
            return {E, B, Ex, Ey, Bz, r, theta};
        }
        
        // ç»˜åˆ¶ç½‘æ ¼
        function drawGrid() {
            if (!showGrid) return;
            
            ctx.strokeStyle = colors.grid;
            ctx.lineWidth = 0.5;
            ctx.setLineDash([2, 2]);
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const gridSize = 50; // åƒç´ /å•ä½
            
            // å‚ç›´çº¿
            for (let x = -5; x <= 5; x++) {
                ctx.beginPath();
                ctx.moveTo(centerX + x * gridSize, 0);
                ctx.lineTo(centerX + x * gridSize, canvas.height);
                ctx.stroke();
            }
            
            // æ°´å¹³çº¿
            for (let y = -5; y <= 5; y++) {
                ctx.beginPath();
                ctx.moveTo(0, centerY + y * gridSize);
                ctx.lineTo(canvas.width, centerY + y * gridSize);
                ctx.stroke();
            }
            
            ctx.setLineDash([]);
            
            // åæ ‡è½´
            ctx.strokeStyle = colors.text;
            ctx.lineWidth = 1.5;
            
            // Xè½´
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(canvas.width, centerY);
            ctx.stroke();
            
            // Yè½´
            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, canvas.height);
            ctx.stroke();
            
            // åæ ‡è½´æ ‡ç­¾
            if (showLabels) {
                ctx.fillStyle = colors.text;
                ctx.font = '12px Arial';
                ctx.fillText('x (ä¼ æ’­æ–¹å‘)', canvas.width - 60, centerY - 10);
                ctx.fillText('y', centerX + 10, 20);
            }
        }
        
        // ç»˜åˆ¶ç”µå¶æå­
        function drawDipole(t) {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const gridSize = 50;
            
            // è®¡ç®—ç”µè·ä½ç½®ï¼ˆæ²¿yè½´æŒ¯è¡ï¼‰
            const amplitude = 0.8 * dipoleMoment;
            const omega = 2 * Math.PI * frequency;
            const dy = amplitude * Math.cos(omega * t);
            
            // æ­£ç”µè·ï¼ˆçº¢è‰²ï¼‰
            const posY = centerY - dy * gridSize;
            ctx.fillStyle = colors.positive;
            ctx.beginPath();
            ctx.arc(centerX, posY, 10, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = 'white';
            ctx.font = 'bold 12px Arial';
            ctx.fillText('+', centerX - 4, posY + 4);
            
            // è´Ÿç”µè·ï¼ˆæ©™è‰²ï¼‰
            const negY = centerY + dy * gridSize;
            ctx.fillStyle = colors.negative;
            ctx.beginPath();
            ctx.arc(centerX, negY, 10, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = 'white';
            ctx.font = 'bold 12px Arial';
            ctx.fillText('-', centerX - 4, negY + 4);
            
            // è¿æ¥çº¿
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(centerX, posY);
            ctx.lineTo(centerX, negY);
            ctx.stroke();
            
            // æ ‡ç­¾
            if (showLabels) {
                ctx.fillStyle = colors.highlight;
                ctx.font = '14px Arial';
                ctx.fillText('æŒ¯è¡ç”µå¶æå­', centerX - 50, Math.min(posY, negY) - 15);
            }
        }
        
        // ç»˜åˆ¶ç”µåœº
        function drawElectricField(t) {
            if (viewMode === 1) return; // ä»…ç£åœºè§†å›¾æ—¶ä¸ç»˜åˆ¶
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const gridSize = 50;
            
            ctx.strokeStyle = colors.electric;
            ctx.lineWidth = 1.5;
            ctx.globalAlpha = 0.7;
            
            // ç»˜åˆ¶ç”µåœºçº¿/æ³¢é¢
            for (let r = 1; r <= 4; r += 0.5) {
                for (let theta = 0; theta < Math.PI * 2; theta += Math.PI / 8) {
                    const x = r * Math.cos(theta);
                    const y = r * Math.sin(theta);
                    
                    const fields = calculateFields(x, y, t);
                    if (fields.E < 0.01) continue;
                    
                    // è½¬æ¢ä¸ºç”»å¸ƒåæ ‡
                    const canvasX = centerX + x * gridSize;
                    const canvasY = centerY - y * gridSize;
                    
                    // ç”µåœºæ–¹å‘
                    const angle = Math.atan2(fields.Ey, fields.Ex);
                    const length = 15 * fields.E;
                    
                    // ç»˜åˆ¶ç”µåœºçº¿ç‰‡æ®µ
                    ctx.beginPath();
                    ctx.moveTo(canvasX, canvasY);
                    ctx.lineTo(
                        canvasX + length * Math.cos(angle),
                        canvasY - length * Math.sin(angle)
                    );
                    ctx.stroke();
                    
                    // ç»˜åˆ¶ç®­å¤´
                    if (showArrows && fields.E > 0.05) {
                        drawArrow(canvasX, canvasY, angle, length, colors.electric);
                    }
                }
            }
            
            // ç»˜åˆ¶æ³¢å‰ï¼ˆç­‰ç›¸ä½é¢ï¼‰
            if (showWavefront && (viewMode === 0 || viewMode === 2)) {
                ctx.strokeStyle = colors.wavefront;
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                
                const omega = 2 * Math.PI * frequency;
                const phase = omega * t;
                
                for (let r = 1; r <= 4; r += 1) {
                    ctx.beginPath();
                    for (let theta = 0; theta < Math.PI * 2; theta += 0.1) {
                        const x = r * Math.cos(theta);
                        const y = r * Math.sin(theta);
                        
                        const canvasX = centerX + x * gridSize;
                        const canvasY = centerY - y * gridSize;
                        
                        if (theta === 0) {
                            ctx.moveTo(canvasX, canvasY);
                        } else {
                            ctx.lineTo(canvasX, canvasY);
                        }
                    }
                    ctx.closePath();
                    ctx.stroke();
                }
                
                ctx.setLineDash([]);
            }
            
            ctx.globalAlpha = 1.0;
        }
        
        // ç»˜åˆ¶ç£åœº
        function drawMagneticField(t) {
            if (viewMode === 0) return; // ä»…ç”µåœºè§†å›¾æ—¶ä¸ç»˜åˆ¶
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const gridSize = 50;
            
            ctx.strokeStyle = colors.magnetic;
            ctx.lineWidth = 1.5;
            ctx.globalAlpha = 0.7;
            
            // ç»˜åˆ¶ç£æ„Ÿçº¿ç¯
            for (let r = 1; r <= 4; r += 0.5) {
                for (let theta = 0; theta < Math.PI * 2; theta += Math.PI / 8) {
                    const x = r * Math.cos(theta);
                    const y = r * Math.sin(theta);
                    
                    const fields = calculateFields(x, y, t);
                    if (fields.B < 0.01) continue;
                    
                    // è½¬æ¢ä¸ºç”»å¸ƒåæ ‡
                    const canvasX = centerX + x * gridSize;
                    const canvasY = centerY - y * gridSize;
                    
                    // ç£åœºç¯åŠå¾„ä¸ç£åœºå¼ºåº¦æˆæ­£æ¯”
                    const ringRadius = 8 * fields.B;
                    
                    // ç»˜åˆ¶ç£åœºç¯
                    ctx.beginPath();
                    ctx.arc(canvasX, canvasY, ringRadius, 0, Math.PI * 2);
                    ctx.stroke();
                    
                    // ç»˜åˆ¶ç£åœºæ–¹å‘ç®­å¤´ï¼ˆå‚ç›´äºå±å¹•ï¼Œç”¨ç¯ä¸Šçš„ç®­å¤´è¡¨ç¤ºï¼‰
                    if (showArrows && fields.B > 0.05) {
                        // æ ¹æ®Bzçš„æ­£è´Ÿå†³å®šç®­å¤´æ–¹å‘
                        const direction = fields.Bz > 0 ? 1 : -1;
                        const arrowAngle = theta + direction * Math.PI / 2;
                        
                        drawArrow(
                            canvasX + ringRadius * Math.cos(arrowAngle),
                            canvasY - ringRadius * Math.sin(arrowAngle),
                            arrowAngle + Math.PI / 2,
                            6,
                            colors.magnetic
                        );
                    }
                }
            }
            
            ctx.globalAlpha = 1.0;
        }
        
        // ç»˜åˆ¶ç®­å¤´
        function drawArrow(x, y, angle, length, color) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(-angle); // æ³¨æ„ï¼šCanvasçš„yè½´å‘ä¸‹ï¼Œæ‰€ä»¥éœ€è¦è°ƒæ•´
            
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(length, 0);
            ctx.lineTo(length - 6, -4);
            ctx.lineTo(length - 6, 4);
            ctx.closePath();
            ctx.fill();
            
            ctx.restore();
        }
        
        // ç»˜åˆ¶æ¢æµ‹å™¨
        function drawDetector() {
            if (!detector) return;
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const gridSize = 50;
            
            // è½¬æ¢ä¸ºç”»å¸ƒåæ ‡
            const canvasX = centerX + detector.x * gridSize;
            const canvasY = centerY - detector.y * gridSize;
            
            // ç»˜åˆ¶æ¢æµ‹å™¨å›¾æ ‡
            ctx.fillStyle = colors.highlight;
            ctx.beginPath();
            ctx.arc(canvasX, canvasY, 8, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.strokeStyle = colors.highlight;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(canvasX - 12, canvasY);
            ctx.lineTo(canvasX + 12, canvasY);
            ctx.moveTo(canvasX, canvasY - 12);
            ctx.lineTo(canvasX, canvasY + 12);
            ctx.stroke();
            
            // è®¡ç®—å¹¶æ˜¾ç¤ºæ¢æµ‹å™¨å¤„çš„åœºå€¼
            const fields = calculateFields(detector.x, detector.y, time);
            
            // æ›´æ–°æ¢æµ‹å™¨ä¿¡æ¯æ˜¾ç¤º
            document.getElementById('detectorE').textContent = fields.E.toFixed(2);
            document.getElementById('detectorB').textContent = fields.B.toFixed(2);
            
            // è®¡ç®—ç›¸ä½å·®ï¼ˆç†æƒ³æƒ…å†µä¸‹åº”ä¸º0ï¼‰
            const phaseDiff = 0; // ç®€åŒ–æ¨¡å‹ä¸­åŒç›¸
            document.getElementById('detectorPhase').textContent = phaseDiff.toFixed(2);
        }
        
        // ç»˜åˆ¶ç‰©ç†é‡æ ‡ç­¾
        function drawLabels() {
            if (!showLabels) return;
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            ctx.fillStyle = colors.text;
            ctx.font = '14px Arial';
            
            // æ³¢é•¿æ ‡ç­¾
            const wavelength = 3 / frequency; // Î» = c/fï¼Œc=3å•ä½
            ctx.fillText(`æ³¢é•¿ Î» = ${wavelength.toFixed(2)} å•ä½`, 20, 30);
            
            // é¢‘ç‡æ ‡ç­¾
            ctx.fillText(`é¢‘ç‡ f = ${frequency.toFixed(2)} Hz`, 20, 55);
            
            // ä¼ æ’­æ–¹å‘æŒ‡ç¤º
            ctx.fillStyle = colors.highlight;
            ctx.font = 'bold 16px Arial';
            ctx.fillText('â†’ ç”µç£æ³¢ä¼ æ’­æ–¹å‘', centerX + 100, centerY - 20);
            
            // å³æ‰‹èºæ—‹å®šåˆ™æç¤º
            ctx.fillStyle = colors.text;
            ctx.font = '12px Arial';
            ctx.fillText('E âŠ¥ B âŠ¥ k (å³æ‰‹èºæ—‹å®šåˆ™)', centerX - 100, 30);
        }
        
        // ç»˜åˆ¶å‡½æ•°
        function draw() {
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶èƒŒæ™¯
            ctx.fillStyle = colors.background;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶å„ä¸ªç»„ä»¶
            drawGrid();
            drawDipole(time);
            
            if (viewMode === 0 || viewMode === 2) {
                drawElectricField(time);
            }
            
            if (viewMode === 1 || viewMode === 2) {
                drawMagneticField(time);
            }
            
            drawDetector();
            drawLabels();
            
            // ç»˜åˆ¶æ—¶é—´æŒ‡ç¤º
            ctx.fillStyle = colors.text;
            ctx.font = '14px Arial';
            ctx.fillText(`æ—¶é—´ t = ${time.toFixed(2)} s`, canvas.width - 150, 30);
        }
        
        // åŠ¨ç”»å¾ªç¯
        function animate() {
            if (isPlaying) {
                time += 0.02 * speed;
            }
            
            draw();
            
            animationId = requestAnimationFrame(animate);
        }
        
        // å¯åŠ¨åŠ¨ç”»
        animate();
        
        // åˆå§‹æ›´æ–°è§†å›¾æŒ‰é’®çŠ¶æ€
        updateViewButtons();
    </script>
</body>
</html>