<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ¨é‡å®ˆæ’å®šå¾‹ï¼šç¢°æ’å¯è§†åŒ–æ•™å­¦åŠ¨ç”»</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        header {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        h1 {
            color: #ffd166;
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        .subtitle {
            color: #9b5de5;
            font-size: 1.1rem;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .simulation-area {
            flex: 1;
            min-width: 600px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .control-panel {
            flex: 0 0 350px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .canvas-container {
            position: relative;
            width: 100%;
            height: 400px;
            background: rgba(10, 15, 30, 0.7);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        #simulationCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .vector-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .vector-title {
            color: #ffd166;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .vector-canvas-container {
            width: 100%;
            height: 150px;
            background: rgba(10, 15, 30, 0.7);
            border-radius: 5px;
            overflow: hidden;
        }
        
        #vectorCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .panel-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .section-title {
            color: #4ecdc4;
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .section-title i {
            font-size: 1.1rem;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.95rem;
        }
        
        .value-display {
            color: #ffd166;
            font-weight: bold;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ff6b6b;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.8);
        }
        
        input[type="range"]#mass2Slider::-webkit-slider-thumb {
            background: #4ecdc4;
        }
        
        input[type="range"]#velocity1Slider::-webkit-slider-thumb {
            background: #ff6b6b;
        }
        
        input[type="range"]#velocity2Slider::-webkit-slider-thumb {
            background: #4ecdc4;
        }
        
        .collision-type-selector {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .collision-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .collision-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .collision-btn.active {
            background: #9b5de5;
            color: white;
            box-shadow: 0 0 10px rgba(155, 93, 229, 0.5);
        }
        
        .control-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .control-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .control-btn#playBtn {
            background: rgba(78, 205, 196, 0.2);
        }
        
        .control-btn#playBtn:hover {
            background: rgba(78, 205, 196, 0.4);
        }
        
        .control-btn#resetBtn {
            background: rgba(255, 107, 107, 0.2);
        }
        
        .control-btn#resetBtn:hover {
            background: rgba(255, 107, 107, 0.4);
        }
        
        .data-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }
        
        .data-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 12px;
            border-left: 4px solid;
        }
        
        .data-box.ball1 {
            border-left-color: #ff6b6b;
        }
        
        .data-box.ball2 {
            border-left-color: #4ecdc4;
        }
        
        .data-box.system {
            border-left-color: #9b5de5;
            grid-column: span 2;
        }
        
        .data-title {
            font-size: 0.9rem;
            color: #aaa;
            margin-bottom: 5px;
        }
        
        .data-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffd166;
        }
        
        .energy-bars {
            margin-top: 15px;
        }
        
        .energy-bar-container {
            margin-bottom: 10px;
        }
        
        .energy-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .energy-bar {
            height: 20px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            overflow: hidden;
            position: relative;
        }
        
        .energy-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .energy-fill.ball1 {
            background: linear-gradient(90deg, rgba(255, 107, 107, 0.7), rgba(255, 107, 107, 1));
        }
        
        .energy-fill.ball2 {
            background: linear-gradient(90deg, rgba(78, 205, 196, 0.7), rgba(78, 205, 196, 1));
        }
        
        .energy-fill.system {
            background: linear-gradient(90deg, rgba(155, 93, 229, 0.7), rgba(155, 93, 229, 1));
        }
        
        .energy-fill.lost {
            background: linear-gradient(90deg, rgba(128, 128, 128, 0.7), rgba(128, 128, 128, 1));
        }
        
        .formula-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .formula {
            color: #ffd166;
            font-family: 'Cambria Math', serif;
            margin: 5px 0;
        }
        
        .hint {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 10px 15px;
            font-size: 0.9rem;
            color: #ffd166;
            border-left: 4px solid #ffd166;
            display: none;
        }
        
        footer {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            color: #888;
            font-size: 0.9rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            width: 100%;
        }
        
        @media (max-width: 1000px) {
            .main-content {
                flex-direction: column;
            }
            
            .simulation-area, .control-panel {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>åŠ¨é‡å®ˆæ’å®šå¾‹ï¼šç¢°æ’å¯è§†åŒ–æ•™å­¦åŠ¨ç”»</h1>
            <p class="subtitle">æ¢ç´¢å®Œå…¨å¼¹æ€§ç¢°æ’ä¸å®Œå…¨éå¼¹æ€§ç¢°æ’ä¸­çš„åŠ¨é‡ä¸èƒ½é‡å˜åŒ–</p>
        </header>
        
        <div class="main-content">
            <div class="simulation-area">
                <div class="canvas-container">
                    <canvas id="simulationCanvas"></canvas>
                    <div class="hint" id="collisionHint">ç¢°æ’å‘ç”Ÿï¼è§‚å¯Ÿé€Ÿåº¦çŸ¢é‡å’ŒåŠ¨é‡çš„å˜åŒ–ã€‚</div>
                </div>
                
                <div class="vector-display">
                    <div class="vector-title">åŠ¨é‡çŸ¢é‡åˆæˆå›¾ (æ€»åŠ¨é‡å®ˆæ’)</div>
                    <div class="vector-canvas-container">
                        <canvas id="vectorCanvas"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="control-panel">
                <div class="panel-section">
                    <div class="section-title">ğŸ® åœºæ™¯æ§åˆ¶</div>
                    <div class="control-buttons">
                        <button class="control-btn" id="playBtn">
                            <span id="playIcon">â–¶</span> <span id="playText">æ’­æ”¾</span>
                        </button>
                        <button class="control-btn" id="resetBtn">â†º é‡ç½®</button>
                    </div>
                </div>
                
                <div class="panel-section">
                    <div class="section-title">âš™ï¸ å‚æ•°è°ƒèŠ‚</div>
                    
                    <div class="control-group">
                        <div class="control-label">
                            <span>å°çƒ1è´¨é‡ (mâ‚): <span class="value-display" id="mass1Value">2.0 kg</span></span>
                        </div>
                        <input type="range" id="mass1Slider" min="0.5" max="5" step="0.1" value="2">
                    </div>
                    
                    <div class="control-group">
                        <div class="control-label">
                            <span>å°çƒ2è´¨é‡ (mâ‚‚): <span class="value-display" id="mass2Value">1.0 kg</span></span>
                        </div>
                        <input type="range" id="mass2Slider" min="0.5" max="5" step="0.1" value="1">
                    </div>
                    
                    <div class="control-group">
                        <div class="control-label">
                            <span>å°çƒ1åˆé€Ÿåº¦ (vâ‚): <span class="value-display" id="velocity1Value">2.0 m/s</span></span>
                        </div>
                        <input type="range" id="velocity1Slider" min="-5" max="5" step="0.1" value="2">
                    </div>
                    
                    <div class="control-group">
                        <div class="control-label">
                            <span>å°çƒ2åˆé€Ÿåº¦ (vâ‚‚): <span class="value-display" id="velocity2Value">-1.0 m/s</span></span>
                        </div>
                        <input type="range" id="velocity2Slider" min="-5" max="5" step="0.1" value="-1">
                    </div>
                    
                    <div class="collision-type-selector">
                        <button class="collision-btn active" id="elasticBtn">å®Œå…¨å¼¹æ€§ç¢°æ’</button>
                        <button class="collision-btn" id="inelasticBtn">å®Œå…¨éå¼¹æ€§ç¢°æ’</button>
                    </div>
                </div>
                
                <div class="panel-section">
                    <div class="section-title">ğŸ“Š å®æ—¶æ•°æ®</div>
                    <div class="data-panel">
                        <div class="data-box ball1">
                            <div class="data-title">å°çƒ1 (çº¢è‰²)</div>
                            <div class="data-value" id="ball1Speed">vâ‚ = 2.00 m/s</div>
                            <div class="data-value" id="ball1Momentum">pâ‚ = 4.00 kgÂ·m/s</div>
                            <div class="data-value" id="ball1Energy">Eâ‚–â‚ = 4.00 J</div>
                        </div>
                        
                        <div class="data-box ball2">
                            <div class="data-title">å°çƒ2 (é’è‰²)</div>
                            <div class="data-value" id="ball2Speed">vâ‚‚ = -1.00 m/s</div>
                            <div class="data-value" id="ball2Momentum">pâ‚‚ = -1.00 kgÂ·m/s</div>
                            <div class="data-value" id="ball2Energy">Eâ‚–â‚‚ = 0.50 J</div>
                        </div>
                        
                        <div class="data-box system">
                            <div class="data-title">ç³»ç»Ÿæ€»é‡</div>
                            <div class="data-value" id="totalMomentum">P = 3.00 kgÂ·m/s</div>
                            <div class="data-value" id="totalEnergy">Eâ‚– = 4.50 J</div>
                            <div class="data-value" id="energyLost">åŠ¨èƒ½æŸå¤±: 0.00 J</div>
                        </div>
                    </div>
                    
                    <div class="energy-bars">
                        <div class="energy-bar-container">
                            <div class="energy-label">
                                <span>ç³»ç»Ÿæ€»åŠ¨èƒ½</span>
                                <span id="totalEnergyValue">4.50 J</span>
                            </div>
                            <div class="energy-bar">
                                <div class="energy-fill system" id="totalEnergyBar" style="width: 100%"></div>
                                <div class="energy-fill lost" id="lostEnergyBar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="formula-box">
                    <div><strong>æ ¸å¿ƒå…¬å¼:</strong></div>
                    <div class="formula">åŠ¨é‡å®ˆæ’: mâ‚vâ‚ + mâ‚‚vâ‚‚ = mâ‚vâ‚' + mâ‚‚vâ‚‚'</div>
                    <div class="formula">å®Œå…¨å¼¹æ€§ç¢°æ’åŠ¨èƒ½å®ˆæ’: (1/2)mâ‚vâ‚Â² + (1/2)mâ‚‚vâ‚‚Â² = (1/2)mâ‚vâ‚'Â² + (1/2)mâ‚‚vâ‚‚'Â²</div>
                    <div class="formula">å®Œå…¨éå¼¹æ€§ç¢°æ’åå…±åŒé€Ÿåº¦: v' = (mâ‚vâ‚ + mâ‚‚vâ‚‚) / (mâ‚ + mâ‚‚)</div>
                </div>
            </div>
        </div>
        
        <footer>
            åŠ¨é‡å®ˆæ’å®šå¾‹æ•™å­¦åŠ¨ç”» | è®¾è®¡åŸç†ï¼šç³»ç»Ÿä¸å—å¤–åŠ›æ—¶ï¼Œæ€»åŠ¨é‡ä¿æŒä¸å˜ | æ³¨æ„è§‚å¯Ÿç¢°æ’å‰ååŠ¨é‡çŸ¢é‡çš„åˆæˆå…³ç³»
        </footer>
    </div>

    <script>
        // è·å–Canvaså…ƒç´ å’Œä¸Šä¸‹æ–‡
        const simCanvas = document.getElementById('simulationCanvas');
        const vecCanvas = document.getElementById('vectorCanvas');
        const simCtx = simCanvas.getContext('2d');
        const vecCtx = vecCanvas.getContext('2d');
        
        // è®¾ç½®Canvaså°ºå¯¸
        function resizeCanvases() {
            const simContainer = document.querySelector('.canvas-container');
            const vecContainer = document.querySelector('.vector-canvas-container');
            
            simCanvas.width = simContainer.clientWidth;
            simCanvas.height = simContainer.clientHeight;
            
            vecCanvas.width = vecContainer.clientWidth;
            vecCanvas.height = vecContainer.clientHeight;
        }
        
        window.addEventListener('resize', resizeCanvases);
        resizeCanvases();
        
        // ç‰©ç†å‚æ•°
        let m1 = 2.0; // å°çƒ1è´¨é‡ (kg)
        let m2 = 1.0; // å°çƒ2è´¨é‡ (kg)
        let v1 = 2.0; // å°çƒ1åˆé€Ÿåº¦ (m/s)
        let v2 = -1.0; // å°çƒ2åˆé€Ÿåº¦ (m/s)
        
        let v1_final = v1; // å°çƒ1æœ€ç»ˆé€Ÿåº¦
        let v2_final = v2; // å°çƒ2æœ€ç»ˆé€Ÿåº¦
        
        let isElastic = true; // ç¢°æ’ç±»å‹ï¼štrue=å®Œå…¨å¼¹æ€§ï¼Œfalse=å®Œå…¨éå¼¹æ€§
        let isPlaying = false; // åŠ¨ç”»æ˜¯å¦æ’­æ”¾ä¸­
        let animationId = null; // åŠ¨ç”»ID
        
        // å°çƒå¯¹è±¡
        const ball1 = {
            x: 150,
            y: simCanvas.height / 2,
            radius: 30,
            color: '#FF6B6B',
            vx: v1,
            vy: 0,
            mass: m1
        };
        
        const ball2 = {
            x: simCanvas.width - 150,
            y: simCanvas.height / 2,
            radius: 30,
            color: '#4ECDC4',
            vx: v2,
            vy: 0,
            mass: m2
        };
        
        // è½¨é“å‚æ•°
        const trackY = simCanvas.height / 2;
        const trackHeight = 10;
        
        // åˆå§‹åŒ–å°çƒä½ç½®
        function resetBallPositions() {
            ball1.x = 150;
            ball2.x = simCanvas.width - 150;
            ball1.vx = v1;
            ball2.vx = v2;
            
            // è®¡ç®—ç¢°æ’åçš„æœ€ç»ˆé€Ÿåº¦
            calculateFinalVelocities();
        }
        
        // è®¡ç®—ç¢°æ’åçš„æœ€ç»ˆé€Ÿåº¦
        function calculateFinalVelocities() {
            if (isElastic) {
                // å®Œå…¨å¼¹æ€§ç¢°æ’å…¬å¼
                v1_final = ((m1 - m2) * v1 + 2 * m2 * v2) / (m1 + m2);
                v2_final = ((m2 - m1) * v2 + 2 * m1 * v1) / (m1 + m2);
            } else {
                // å®Œå…¨éå¼¹æ€§ç¢°æ’å…¬å¼
                const commonVelocity = (m1 * v1 + m2 * v2) / (m1 + m2);
                v1_final = commonVelocity;
                v2_final = commonVelocity;
            }
        }
        
        // ç»˜åˆ¶ä¸»æ¨¡æ‹Ÿåœºæ™¯
        function drawSimulation() {
            // æ¸…é™¤ç”»å¸ƒ
            simCtx.clearRect(0, 0, simCanvas.width, simCanvas.height);
            
            // ç»˜åˆ¶è½¨é“
            simCtx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            simCtx.fillRect(0, trackY - trackHeight/2, simCanvas.width, trackHeight);
            
            // ç»˜åˆ¶è½¨é“è¾¹ç¼˜
            simCtx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            simCtx.lineWidth = 2;
            simCtx.beginPath();
            simCtx.moveTo(0, trackY - trackHeight/2);
            simCtx.lineTo(simCanvas.width, trackY - trackHeight/2);
            simCtx.moveTo(0, trackY + trackHeight/2);
            simCtx.lineTo(simCanvas.width, trackY + trackHeight/2);
            simCtx.stroke();
            
            // ç»˜åˆ¶å°çƒ
            drawBall(ball1);
            drawBall(ball2);
            
            // ç»˜åˆ¶é€Ÿåº¦çŸ¢é‡
            drawVelocityVectors();
            
            // ç»˜åˆ¶ç¢°æ’æ£€æµ‹åŒºåŸŸ
            const collisionDistance = ball1.radius + ball2.radius;
            const actualDistance = Math.abs(ball2.x - ball1.x);
            
            // å¦‚æœå°çƒå³å°†ç¢°æ’ï¼Œç»˜åˆ¶æç¤º
            if (actualDistance < collisionDistance + 50 && actualDistance > collisionDistance) {
                simCtx.fillStyle = 'rgba(255, 215, 102, 0.2)';
                simCtx.fillRect(
                    Math.min(ball1.x, ball2.x) - 10,
                    trackY - 60,
                    actualDistance + 20,
                    40
                );
                
                simCtx.fillStyle = '#FFD166';
                simCtx.font = '14px Arial';
                simCtx.textAlign = 'center';
                simCtx.fillText('å³å°†ç¢°æ’', (ball1.x + ball2.x) / 2, trackY - 40);
            }
            
            // å¦‚æœå°çƒæ­£åœ¨ç¢°æ’ï¼ˆé‡å ï¼‰
            if (actualDistance < collisionDistance) {
                // æ˜¾ç¤ºç¢°æ’æç¤º
                document.getElementById('collisionHint').style.display = 'block';
                
                // ç»˜åˆ¶ç¢°æ’æ•ˆæœ
                simCtx.fillStyle = 'rgba(255, 215, 102, 0.3)';
                simCtx.beginPath();
                simCtx.arc(
                    (ball1.x + ball2.x) / 2,
                    trackY,
                    collisionDistance * 1.2,
                    0,
                    Math.PI * 2
                );
                simCtx.fill();
                
                // ç»˜åˆ¶"ç¢°æ’!"æ–‡å­—
                simCtx.fillStyle = '#FFD166';
                simCtx.font = 'bold 18px Arial';
                simCtx.textAlign = 'center';
                simCtx.fillText('ç¢°æ’!', (ball1.x + ball2.x) / 2, trackY - collisionDistance * 1.5);
            } else {
                document.getElementById('collisionHint').style.display = 'none';
            }
        }
        
        // ç»˜åˆ¶å•ä¸ªå°çƒ
        function drawBall(ball) {
            // å°çƒé˜´å½±
            simCtx.beginPath();
            simCtx.arc(ball.x, ball.y + 5, ball.radius, 0, Math.PI * 2);
            simCtx.fillStyle = 'rgba(0, 0, 0, 0.3)';
            simCtx.fill();
            
            // å°çƒä¸»ä½“
            simCtx.beginPath();
            simCtx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
            simCtx.fillStyle = ball.color;
            simCtx.fill();
            
            // å°çƒè¾¹æ¡†
            simCtx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
            simCtx.lineWidth = 2;
            simCtx.stroke();
            
            // å°çƒæ ‡ç­¾
            simCtx.fillStyle = 'white';
            simCtx.font = 'bold 16px Arial';
            simCtx.textAlign = 'center';
            simCtx.textBaseline = 'middle';
            simCtx.fillText(ball === ball1 ? 'mâ‚' : 'mâ‚‚', ball.x, ball.y);
            
            // å°çƒè´¨é‡æ˜¾ç¤º
            simCtx.font = '14px Arial';
            simCtx.fillText(`${ball.mass.toFixed(1)} kg`, ball.x, ball.y + ball.radius + 20);
        }
        
        // ç»˜åˆ¶é€Ÿåº¦çŸ¢é‡
        function drawVelocityVectors() {
            // å°çƒ1é€Ÿåº¦çŸ¢é‡
            drawVector(
                ball1.x, 
                ball1.y - ball1.radius - 30, 
                ball1.vx * 20, 
                0, 
                '#FF8E8E', 
                `vâ‚ = ${ball1.vx.toFixed(2)} m/s`
            );
            
            // å°çƒ2é€Ÿåº¦çŸ¢é‡
            drawVector(
                ball2.x, 
                ball2.y - ball2.radius - 30, 
                ball2.vx * 20, 
                0, 
                '#6EDBD3', 
                `vâ‚‚ = ${ball2.vx.toFixed(2)} m/s`
            );
            
            // ç»˜åˆ¶æœ€ç»ˆé€Ÿåº¦é¢„æµ‹ï¼ˆè™šçº¿ï¼‰
            if (isPlaying) {
                // å°çƒ1æœ€ç»ˆé€Ÿåº¦é¢„æµ‹
                if (Math.abs(v1_final) > 0.01) {
                    drawVector(
                        ball1.x, 
                        ball1.y + ball1.radius + 30, 
                        v1_final * 20, 
                        0, 
                        '#FF8E8E', 
                        `vâ‚' = ${v1_final.toFixed(2)} m/s`,
                        true
                    );
                }
                
                // å°çƒ2æœ€ç»ˆé€Ÿåº¦é¢„æµ‹
                if (Math.abs(v2_final) > 0.01) {
                    drawVector(
                        ball2.x, 
                        ball2.y + ball2.radius + 30, 
                        v2_final * 20, 
                        0, 
                        '#6EDBD3', 
                        `vâ‚‚' = ${v2_final.toFixed(2)} m/s`,
                        true
                    );
                }
            }
        }
        
        // ç»˜åˆ¶çŸ¢é‡ç®­å¤´
        function drawVector(x, y, dx, dy, color, label, isDashed = false) {
            const magnitude = Math.sqrt(dx * dx + dy * dy);
            if (magnitude < 0.5) return; // å¿½ç•¥å¤ªå°çš„çŸ¢é‡
            
            simCtx.save();
            
            // è®¾ç½®çº¿æ¡æ ·å¼
            if (isDashed) {
                simCtx.setLineDash([5, 5]);
                simCtx.strokeStyle = color + 'AA';
                simCtx.fillStyle = color + 'AA';
            } else {
                simCtx.setLineDash([]);
                simCtx.strokeStyle = color;
                simCtx.fillStyle = color;
            }
            
            simCtx.lineWidth = 3;
            
            // ç»˜åˆ¶çŸ¢é‡çº¿
            simCtx.beginPath();
            simCtx.moveTo(x, y);
            simCtx.lineTo(x + dx, y + dy);
            simCtx.stroke();
            
            // ç»˜åˆ¶ç®­å¤´å¤´éƒ¨
            const angle = Math.atan2(dy, dx);
            const arrowSize = 10;
            
            simCtx.beginPath();
            simCtx.moveTo(x + dx, y + dy);
            simCtx.lineTo(
                x + dx - arrowSize * Math.cos(angle - Math.PI / 6),
                y + dy - arrowSize * Math.sin(angle - Math.PI / 6)
            );
            simCtx.lineTo(
                x + dx - arrowSize * Math.cos(angle + Math.PI / 6),
                y + dy - arrowSize * Math.sin(angle + Math.PI / 6)
            );
            simCtx.closePath();
            simCtx.fill();
            
            // ç»˜åˆ¶æ ‡ç­¾
            simCtx.fillStyle = isDashed ? color + 'AA' : color;
            simCtx.font = '12px Arial';
            simCtx.textAlign = dx >= 0 ? 'left' : 'right';
            simCtx.fillText(
                label, 
                x + dx + (dx >= 0 ? 5 : -5), 
                y + dy - 10
            );
            
            simCtx.restore();
        }
        
        // ç»˜åˆ¶åŠ¨é‡çŸ¢é‡åˆæˆå›¾
        function drawVectorDiagram() {
            // æ¸…é™¤ç”»å¸ƒ
            vecCtx.clearRect(0, 0, vecCanvas.width, vecCanvas.height);
            
            // è®¡ç®—åŠ¨é‡
            const p1 = ball1.mass * ball1.vx; // å°çƒ1åŠ¨é‡
            const p2 = ball2.mass * ball2.vx; // å°çƒ2åŠ¨é‡
            const totalP = p1 + p2; // æ€»åŠ¨é‡
            
            // è®¡ç®—é¢„æµ‹çš„æœ€ç»ˆåŠ¨é‡
            const p1_final = ball1.mass * v1_final;
            const p2_final = ball2.mass * v2_final;
            const totalP_final = p1_final + p2_final;
            
            // çŸ¢é‡å›¾ä¸­å¿ƒç‚¹
            const centerX = vecCanvas.width / 2;
            const centerY = vecCanvas.height / 2;
            
            // ç¼©æ”¾å› å­ï¼ˆä½¿çŸ¢é‡é€‚åº”ç”»å¸ƒï¼‰
            const scale = 15;
            
            // ç»˜åˆ¶åæ ‡è½´
            vecCtx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            vecCtx.lineWidth = 1;
            
            // Xè½´
            vecCtx.beginPath();
            vecCtx.moveTo(50, centerY);
            vecCtx.lineTo(vecCanvas.width - 50, centerY);
            vecCtx.stroke();
            
            // Yè½´
            vecCtx.beginPath();
            vecCtx.moveTo(centerX, 20);
            vecCtx.lineTo(centerX, vecCanvas.height - 20);
            vecCtx.stroke();
            
            // ç»˜åˆ¶å½“å‰åŠ¨é‡çŸ¢é‡
            drawMomentumVector(centerX, centerY, p1, 0, '#FF8E8E', 'pâ‚', scale);
            drawMomentumVector(centerX + p1 * scale, centerY, p2, 0, '#6EDBD3', 'pâ‚‚', scale);
            
            // ç»˜åˆ¶æ€»åŠ¨é‡çŸ¢é‡ï¼ˆä»èµ·ç‚¹åˆ°p1+p2çš„ç»ˆç‚¹ï¼‰
            drawMomentumVector(centerX, centerY, totalP, 0, '#FFD166', 'P = pâ‚ + pâ‚‚', scale, 4);
            
            // ç»˜åˆ¶æœ€ç»ˆåŠ¨é‡é¢„æµ‹ï¼ˆè™šçº¿ï¼‰
            if (isPlaying) {
                vecCtx.setLineDash([5, 5]);
                
                // æœ€ç»ˆåŠ¨é‡çŸ¢é‡p1'
                if (Math.abs(p1_final) > 0.1) {
                    drawMomentumVector(centerX, centerY, p1_final, 0, '#FF8E8E', `pâ‚'`, scale, 2, true);
                }
                
                // æœ€ç»ˆåŠ¨é‡çŸ¢é‡p2'
                if (Math.abs(p2_final) > 0.1) {
                    drawMomentumVector(centerX + p1_final * scale, centerY, p2_final, 0, '#6EDBD3', `pâ‚‚'`, scale, 2, true);
                }
                
                // æœ€ç»ˆæ€»åŠ¨é‡çŸ¢é‡ï¼ˆåº”è¯¥ä¸åˆå§‹æ€»åŠ¨é‡ç›¸åŒï¼‰
                drawMomentumVector(centerX, centerY, totalP_final, 0, '#FFD166AA', `P'`, scale, 2, true);
                
                vecCtx.setLineDash([]);
            }
            
            // ç»˜åˆ¶æ ‡é¢˜
            vecCtx.fillStyle = '#FFD166';
            vecCtx.font = 'bold 14px Arial';
            vecCtx.textAlign = 'center';
            vecCtx.fillText('åŠ¨é‡çŸ¢é‡åˆæˆ (æ€»åŠ¨é‡å®ˆæ’)', centerX, 15);
            
            // ç»˜åˆ¶å›¾ä¾‹
            const legendY = vecCanvas.height - 10;
            vecCtx.font = '12px Arial';
            vecCtx.textAlign = 'left';
            
            vecCtx.fillStyle = '#FF8E8E';
            vecCtx.fillText('pâ‚: å°çƒ1åŠ¨é‡', 10, legendY - 30);
            
            vecCtx.fillStyle = '#6EDBD3';
            vecCtx.fillText('pâ‚‚: å°çƒ2åŠ¨é‡', 10, legendY - 15);
            
            vecCtx.fillStyle = '#FFD166';
            vecCtx.fillText('P: æ€»åŠ¨é‡ (å®ˆæ’)', 10, legendY);
        }
        
        // ç»˜åˆ¶åŠ¨é‡çŸ¢é‡
        function drawMomentumVector(x, y, px, py, color, label, scale, lineWidth = 3, isDashed = false) {
            const dx = px * scale;
            const dy = py * scale;
            const magnitude = Math.sqrt(dx * dx + dy * dy);
            
            if (magnitude < 2) return; // å¿½ç•¥å¤ªå°çš„çŸ¢é‡
            
            vecCtx.save();
            
            if (isDashed) {
                vecCtx.setLineDash([5, 5]);
                vecCtx.strokeStyle = color + 'AA';
                vecCtx.fillStyle = color + 'AA';
            } else {
                vecCtx.setLineDash([]);
                vecCtx.strokeStyle = color;
                vecCtx.fillStyle = color;
            }
            
            vecCtx.lineWidth = lineWidth;
            
            // ç»˜åˆ¶çŸ¢é‡çº¿
            vecCtx.beginPath();
            vecCtx.moveTo(x, y);
            vecCtx.lineTo(x + dx, y + dy);
            vecCtx.stroke();
            
            // ç»˜åˆ¶ç®­å¤´å¤´éƒ¨
            const angle = Math.atan2(dy, dx);
            const arrowSize = 8;
            
            vecCtx.beginPath();
            vecCtx.moveTo(x + dx, y + dy);
            vecCtx.lineTo(
                x + dx - arrowSize * Math.cos(angle - Math.PI / 6),
                y + dy - arrowSize * Math.sin(angle - Math.PI / 6)
            );
            vecCtx.lineTo(
                x + dx - arrowSize * Math.cos(angle + Math.PI / 6),
                y + dy - arrowSize * Math.sin(angle + Math.PI / 6)
            );
            vecCtx.closePath();
            vecCtx.fill();
            
            // ç»˜åˆ¶
<!--æ£€æµ‹åˆ°ä»£ç æˆªæ–­ï¼Œè‡ªåŠ¨ç»­å†™ä¸­...-->
// ç»˜åˆ¶æ ‡ç­¾
            vecCtx.fillStyle = isDashed ? color + 'AA' : color;
            vecCtx.font = '12px Arial';
            vecCtx.textAlign = dx >= 0 ? 'left' : 'right';
            vecCtx.fillText(
                label, 
                x + dx + (dx >= 0 ? 10 : -10), 
                y + dy - (dy >= 0 ? 10 : -10)
            );
            
            vecCtx.restore();
        }
        
        // æ›´æ–°å°çƒä½ç½®
        function updateBalls() {
            // æ›´æ–°å°çƒ1ä½ç½®
            ball1.x += ball1.vx;
            
            // æ›´æ–°å°çƒ2ä½ç½®
            ball2.x += ball2.vx;
            
            // è¾¹ç•Œæ£€æµ‹
            if (ball1.x < ball1.radius) {
                ball1.x = ball1.radius;
                if (ball1.vx < 0) ball1.vx = -ball1.vx;
            }
            
            if (ball1.x > simCanvas.width - ball1.radius) {
                ball1.x = simCanvas.width - ball1.radius;
                if (ball1.vx > 0) ball1.vx = -ball1.vx;
            }
            
            if (ball2.x < ball2.radius) {
                ball2.x = ball2.radius;
                if (ball2.vx < 0) ball2.vx = -ball2.vx;
            }
            
            if (ball2.x > simCanvas.width - ball2.radius) {
                ball2.x = simCanvas.width - ball2.radius;
                if (ball2.vx > 0) ball2.vx = -ball2.vx;
            }
            
            // ç¢°æ’æ£€æµ‹
            const dx = ball2.x - ball1.x;
            const distance = Math.abs(dx);
            const minDistance = ball1.radius + ball2.radius;
            
            if (distance < minDistance) {
                // å¤„ç†ç¢°æ’
                handleCollision();
            }
        }
        
        // å¤„ç†ç¢°æ’
        function handleCollision() {
            // è®¡ç®—ç¢°æ’åçš„é€Ÿåº¦
            if (isElastic) {
                // å®Œå…¨å¼¹æ€§ç¢°æ’
                const v1_new = ((m1 - m2) * ball1.vx + 2 * m2 * ball2.vx) / (m1 + m2);
                const v2_new = ((m2 - m1) * ball2.vx + 2 * m1 * ball1.vx) / (m1 + m2);
                
                ball1.vx = v1_new;
                ball2.vx = v2_new;
            } else {
                // å®Œå…¨éå¼¹æ€§ç¢°æ’
                const commonVelocity = (m1 * ball1.vx + m2 * ball2.vx) / (m1 + m2);
                ball1.vx = commonVelocity;
                ball2.vx = commonVelocity;
            }
            
            // é˜²æ­¢å°çƒç²˜åœ¨ä¸€èµ·
            const overlap = (ball1.radius + ball2.radius) - Math.abs(ball2.x - ball1.x);
            if (overlap > 0) {
                if (ball1.x < ball2.x) {
                    ball1.x -= overlap / 2;
                    ball2.x += overlap / 2;
                } else {
                    ball1.x += overlap / 2;
                    ball2.x -= overlap / 2;
                }
            }
        }
        
        // æ›´æ–°æ•°æ®æ˜¾ç¤º
        function updateDataDisplay() {
            // è®¡ç®—ç‰©ç†é‡
            const p1 = m1 * ball1.vx;
            const p2 = m2 * ball2.vx;
            const totalP = p1 + p2;
            
            const ek1 = 0.5 * m1 * ball1.vx * ball1.vx;
            const ek2 = 0.5 * m2 * ball2.vx * ball2.vx;
            const totalEk = ek1 + ek2;
            
            // è®¡ç®—åˆå§‹åŠ¨èƒ½ï¼ˆç”¨äºèƒ½é‡æ¡æ˜¾ç¤ºï¼‰
            const ek1_initial = 0.5 * m1 * v1 * v1;
            const ek2_initial = 0.5 * m2 * v2 * v2;
            const totalEk_initial = ek1_initial + ek2_initial;
            
            // è®¡ç®—åŠ¨èƒ½æŸå¤±ï¼ˆä»…éå¼¹æ€§ç¢°æ’ï¼‰
            let energyLost = 0;
            if (!isElastic) {
                const ek1_final = 0.5 * m1 * v1_final * v1_final;
                const ek2_final = 0.5 * m2 * v2_final * v2_final;
                const totalEk_final = ek1_final + ek2_final;
                energyLost = totalEk_initial - totalEk_final;
            }
            
            // æ›´æ–°å°çƒ1æ•°æ®
            document.getElementById('ball1Speed').textContent = `vâ‚ = ${ball1.vx.toFixed(2)} m/s`;
            document.getElementById('ball1Momentum').textContent = `pâ‚ = ${p1.toFixed(2)} kgÂ·m/s`;
            document.getElementById('ball1Energy').textContent = `Eâ‚–â‚ = ${ek1.toFixed(2)} J`;
            
            // æ›´æ–°å°çƒ2æ•°æ®
            document.getElementById('ball2Speed').textContent = `vâ‚‚ = ${ball2.vx.toFixed(2)} m/s`;
            document.getElementById('ball2Momentum').textContent = `pâ‚‚ = ${p2.toFixed(2)} kgÂ·m/s`;
            document.getElementById('ball2Energy').textContent = `Eâ‚–â‚‚ = ${ek2.toFixed(2)} J`;
            
            // æ›´æ–°ç³»ç»Ÿæ•°æ®
            document.getElementById('totalMomentum').textContent = `P = ${totalP.toFixed(2)} kgÂ·m/s`;
            document.getElementById('totalEnergy').textContent = `Eâ‚– = ${totalEk.toFixed(2)} J`;
            document.getElementById('energyLost').textContent = `åŠ¨èƒ½æŸå¤±: ${energyLost.toFixed(2)} J`;
            
            // æ›´æ–°èƒ½é‡æ¡
            document.getElementById('totalEnergyValue').textContent = `${totalEk.toFixed(2)} J`;
            
            // è®¡ç®—èƒ½é‡æ¡å®½åº¦
            const maxEnergy = Math.max(totalEk_initial, 10); // é˜²æ­¢é™¤é›¶
            const currentEnergyPercent = (totalEk / maxEnergy) * 100;
            const lostEnergyPercent = (energyLost / maxEnergy) * 100;
            
            document.getElementById('totalEnergyBar').style.width = `${currentEnergyPercent}%`;
            document.getElementById('lostEnergyBar').style.width = `${lostEnergyPercent}%`;
            
            // æ›´æ–°æ»‘å—å€¼æ˜¾ç¤º
            document.getElementById('mass1Value').textContent = `${m1.toFixed(1)} kg`;
            document.getElementById('mass2Value').textContent = `${m2.toFixed(1)} kg`;
            document.getElementById('velocity1Value').textContent = `${v1.toFixed(1)} m/s`;
            document.getElementById('velocity2Value').textContent = `${v2.toFixed(1)} m/s`;
        }
        
        // åŠ¨ç”»å¾ªç¯
        function animate() {
            if (!isPlaying) return;
            
            updateBalls();
            drawSimulation();
            drawVectorDiagram();
            updateDataDisplay();
            
            animationId = requestAnimationFrame(animate);
        }
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
        function initEventListeners() {
            // è´¨é‡æ»‘å—
            document.getElementById('mass1Slider').addEventListener('input', function() {
                m1 = parseFloat(this.value);
                ball1.mass = m1;
                ball1.radius = 20 + m1 * 5; // è´¨é‡è¶Šå¤§ï¼ŒåŠå¾„è¶Šå¤§
                calculateFinalVelocities();
                updateDataDisplay();
            });
            
            document.getElementById('mass2Slider').addEventListener('input', function() {
                m2 = parseFloat(this.value);
                ball2.mass = m2;
                ball2.radius = 20 + m2 * 5; // è´¨é‡è¶Šå¤§ï¼ŒåŠå¾„è¶Šå¤§
                calculateFinalVelocities();
                updateDataDisplay();
            });
            
            // é€Ÿåº¦æ»‘å—
            document.getElementById('velocity1Slider').addEventListener('input', function() {
                v1 = parseFloat(this.value);
                calculateFinalVelocities();
                if (!isPlaying) {
                    ball1.vx = v1;
                    updateDataDisplay();
                }
            });
            
            document.getElementById('velocity2Slider').addEventListener('input', function() {
                v2 = parseFloat(this.value);
                calculateFinalVelocities();
                if (!isPlaying) {
                    ball2.vx = v2;
                    updateDataDisplay();
                }
            });
            
            // ç¢°æ’ç±»å‹æŒ‰é’®
            document.getElementById('elasticBtn').addEventListener('click', function() {
                isElastic = true;
                this.classList.add('active');
                document.getElementById('inelasticBtn').classList.remove('active');
                calculateFinalVelocities();
                updateDataDisplay();
            });
            
            document.getElementById('inelasticBtn').addEventListener('click', function() {
                isElastic = false;
                this.classList.add('active');
                document.getElementById('elasticBtn').classList.remove('active');
                calculateFinalVelocities();
                updateDataDisplay();
            });
            
            // æ’­æ”¾/æš‚åœæŒ‰é’®
            document.getElementById('playBtn').addEventListener('click', function() {
                isPlaying = !isPlaying;
                
                if (isPlaying) {
                    document.getElementById('playIcon').textContent = 'â¸';
                    document.getElementById('playText').textContent = 'æš‚åœ';
                    animate();
                } else {
                    document.getElementById('playIcon').textContent = 'â–¶';
                    document.getElementById('playText').textContent = 'æ’­æ”¾';
                    if (animationId) {
                        cancelAnimationFrame(animationId);
                    }
                }
            });
            
            // é‡ç½®æŒ‰é’®
            document.getElementById('resetBtn').addEventListener('click', function() {
                isPlaying = false;
                document.getElementById('playIcon').textContent = 'â–¶';
                document.getElementById('playText').textContent = 'æ’­æ”¾';
                
                if (animationId) {
                    cancelAnimationFrame(animationId);
                }
                
                resetBallPositions();
                drawSimulation();
                drawVectorDiagram();
                updateDataDisplay();
            });
        }
        
        // åˆå§‹åŒ–
        function init() {
            resizeCanvases();
            calculateFinalVelocities();
            drawSimulation();
            drawVectorDiagram();
            updateDataDisplay();
            initEventListeners();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', init);
    </script>
</body>
</html>