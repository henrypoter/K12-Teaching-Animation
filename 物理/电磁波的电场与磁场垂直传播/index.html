<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”µç£æ³¢ï¼šç”µåœºä¸ç£åœºçš„å‚ç›´ä¼ æ’­</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(to bottom, #0A0A2A, #1a1a40);
            color: #EEEEEE;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #FF00FF, #00FFFF);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.8;
            max-width: 800px;
            margin: 0 auto;
        }

        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            margin-bottom: 30px;
        }

        .canvas-container {
            flex: 3;
            min-width: 300px;
            background-color: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        #waveCanvas {
            display: block;
            width: 100%;
            height: 600px;
            cursor: grab;
        }

        #waveCanvas:active {
            cursor: grabbing;
        }

        .controls-panel {
            flex: 1;
            min-width: 300px;
            background-color: rgba(20, 20, 40, 0.8);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .control-section {
            background-color: rgba(30, 30, 60, 0.6);
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #00FFFF;
        }

        .control-section:nth-child(2) {
            border-left-color: #FF00FF;
        }

        .control-section:nth-child(3) {
            border-left-color: #FFCC00;
        }

        h2 {
            font-size: 1.4rem;
            margin-bottom: 18px;
            color: #FFFFFF;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        h2 i {
            font-size: 1.2rem;
        }

        .control-group {
            margin-bottom: 18px;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        .control-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #CCCCCC;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 5px 0;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .color-indicator {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            display: inline-block;
        }

        .color-e {
            background-color: #FF00FF;
        }

        .color-b {
            background-color: #00FFFF;
        }

        .color-path {
            background-color: #CCCCCC;
        }

        .color-grid {
            background-color: #444444;
        }

        button {
            background-color: #3399FF;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
        }

        button:hover {
            background-color: #4DA6FF;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(51, 153, 255, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        #resetBtn {
            background-color: #6666CC;
        }

        #resetBtn:hover {
            background-color: #7777DD;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        input[type="range"] {
            flex: 1;
            height: 8px;
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #00FFFF;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .slider-value {
            min-width: 40px;
            text-align: center;
            font-weight: 600;
            color: #00FFFF;
        }

        .view-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .view-btn {
            background-color: rgba(60, 60, 100, 0.7);
            padding: 10px;
            font-size: 0.9rem;
        }

        .view-btn:hover {
            background-color: rgba(80, 80, 120, 0.9);
        }

        .info-panel {
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 20px;
            margin-top: 10px;
            border-top: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-title {
            font-weight: 600;
            color: #FFCC00;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .info-content {
            font-size: 0.95rem;
            color: #DDDDDD;
        }

        .info-content p {
            margin-bottom: 8px;
        }

        .highlight {
            color: #FF00FF;
            font-weight: 600;
        }

        .highlight-b {
            color: #00FFFF;
            font-weight: 600;
        }

        .highlight-k {
            color: #FFFFFF;
            font-weight: 600;
        }

        .coordinate-info {
            position: absolute;
            bottom: 15px;
            left: 15px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            border-left: 3px solid #FFCC00;
        }

        .point-info {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 12px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            max-width: 250px;
            border-left: 3px solid #3399FF;
            display: none;
        }

        .point-info.active {
            display: block;
        }

        .legend {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 12px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .legend-item:last-child {
            margin-bottom: 0;
        }

        @media (max-width: 1100px) {
            .main-content {
                flex-direction: column;
            }
            
            .canvas-container, .controls-panel {
                width: 100%;
            }
            
            #waveCanvas {
                height: 500px;
            }
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 2rem;
            }
            
            #waveCanvas {
                height: 400px;
            }
            
            .controls-panel {
                padding: 15px;
            }
            
            .control-section {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ç”µç£æ³¢ï¼šç”µåœºä¸ç£åœºçš„å‚ç›´ä¼ æ’­</h1>
            <p class="subtitle">å¯è§†åŒ–ç”µç£æ³¢ä½œä¸ºæ¨ªæ³¢çš„ä¸‰ç»´ç‰¹æ€§ï¼šç”µåœº(E)ã€ç£åœº(B)ä¸ä¼ æ’­æ–¹å‘(k)ä¸¤ä¸¤å‚ç›´ï¼Œä¸”åŒæ­¥æŒ¯è¡ä¼ æ’­ã€‚</p>
        </header>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="waveCanvas"></canvas>
                <div class="coordinate-info">
                    <div>Xè½´: ä¼ æ’­æ–¹å‘ (k)</div>
                    <div>Yè½´: ç”µåœºæ–¹å‘ (E) <span style="color:#FF00FF;">â—</span></div>
                    <div>Zè½´: ç£åœºæ–¹å‘ (B) <span style="color:#00FFFF;">â—</span></div>
                </div>
                <div class="point-info" id="pointInfo">
                    <div class="info-title">æ¢æµ‹ç‚¹ä¿¡æ¯</div>
                    <div>ä½ç½®: <span id="posX">0</span>, <span id="posY">0</span>, <span id="posZ">0</span></div>
                    <div>ç”µåœº E: <span id="eValue" class="highlight">0</span> (Yæ–¹å‘)</div>
                    <div>ç£åœº B: <span id="bValue" class="highlight-b">0</span> (Zæ–¹å‘)</div>
                    <div>ç›¸ä½: <span id="phaseValue">0</span>Â°</div>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="color-indicator color-e"></div>
                        <span>ç”µåœº (E)</span>
                    </div>
                    <div class="legend-item">
                        <div class="color-indicator color-b"></div>
                        <span>ç£åœº (B)</span>
                    </div>
                    <div class="legend-item">
                        <div class="color-indicator color-path"></div>
                        <span>ä¼ æ’­è·¯å¾„</span>
                    </div>
                </div>
            </div>

            <div class="controls-panel">
                <div class="control-section">
                    <h2>ğŸ“Š åŠ¨ç”»æ§åˆ¶</h2>
                    
                    <div class="control-group">
                        <div class="slider-container">
                            <span class="control-label">åŠ¨ç”»é€Ÿåº¦</span>
                            <input type="range" id="speedSlider" min="0.1" max="3" step="0.1" value="1">
                            <span class="slider-value" id="speedValue">1.0x</span>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <div class="slider-container">
                            <span class="control-label">æ³¢é•¿</span>
                            <input type="range" id="wavelengthSlider" min="50" max="200" step="10" value="100">
                            <span class="slider-value" id="wavelengthValue">100</span>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <button id="playPauseBtn">
                            <span id="playIcon">â¸ï¸</span>
                            <span id="playText">æš‚åœåŠ¨ç”»</span>
                        </button>
                    </div>
                    
                    <div class="control-group">
                        <button id="resetBtn">ğŸ”„ é‡ç½®è§†å›¾ä¸åŠ¨ç”»</button>
                    </div>
                </div>

                <div class="control-section">
                    <h2>ğŸ‘ï¸ å¯è§†åŒ–é€‰é¡¹</h2>
                    
                    <div class="control-group">
                        <div class="control-label">æ˜¾ç¤º/éšè—å…ƒç´ </div>
                        <div class="checkbox-group">
                            <label class="checkbox-item">
                                <input type="checkbox" id="showE" checked>
                                <div class="color-indicator color-e"></div>
                                <span>ç”µåœº (E)</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" id="showB" checked>
                                <div class="color-indicator color-b"></div>
                                <span>ç£åœº (B)</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" id="showPath" checked>
                                <div class="color-indicator color-path"></div>
                                <span>ä¼ æ’­è·¯å¾„</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" id="showGrid" checked>
                                <div class="color-indicator color-grid"></div>
                                <span>åæ ‡ç½‘æ ¼</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" id="showVectors">
                                <span>çŸ¢é‡ç®­å¤´</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" id="showSnapshot">
                                <span>ç¬æ—¶å¿«ç…§</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <div class="control-label">é¢„è®¾è§†å›¾</div>
                        <div class="view-buttons">
                            <button class="view-btn" id="frontView">æ­£è§†å›¾ (X-Yå¹³é¢)</button>
                            <button class="view-btn" id="sideView">ä¾§è§†å›¾ (X-Zå¹³é¢)</button>
                            <button class="view-btn" id="topView">ä¿¯è§†å›¾ (Y-Zå¹³é¢)</button>
                            <button class="view-btn" id="isoView">ç­‰è½´è§†å›¾</button>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h2>ğŸ“ æ•™å­¦è¾…åŠ©</h2>
                    
                    <div class="control-group">
                        <button id="stepDemoBtn">â–¶ï¸ å¯åŠ¨åˆ†æ­¥æ¼”ç¤º</button>
                    </div>
                    
                    <div class="control-group">
                        <button id="rightHandBtn">ğŸ–ï¸ æ˜¾ç¤ºå³æ‰‹å®šåˆ™</button>
                    </div>
                    
                    <div class="control-group">
                        <div class="control-label">æ¢æµ‹æ¨¡å¼</div>
                        <div class="checkbox-group">
                            <label class="checkbox-item">
                                <input type="checkbox" id="probeMode">
                                <span>å¯ç”¨ç‚¹æ¢æµ‹ (ç‚¹å‡»ç”»å¸ƒ)</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="info-panel">
            <div class="info-title">ğŸ“š æ ¸å¿ƒæ¦‚å¿µ</div>
            <div class="info-content">
                <p>1. ç”µç£æ³¢æ˜¯<strong>æ¨ªæ³¢</strong>ï¼šç”µåœº <span class="highlight">E</span> å’Œç£åœº <span class="highlight-b">B</span> çš„æŒ¯åŠ¨æ–¹å‘éƒ½ä¸æ³¢çš„ä¼ æ’­æ–¹å‘ <span class="highlight-k">k</span> å‚ç›´ã€‚</p>
                <p>2. <strong>æ­£äº¤å…³ç³»</strong>ï¼š<span class="highlight">E</span> âŠ¥ <span class="highlight-b">B</span>ï¼Œä¸” <span class="highlight">E</span> âŠ¥ <span class="highlight-k">k</span>ï¼Œ<span class="highlight-b">B</span> âŠ¥ <span class="highlight-k">k</span>ï¼Œä¸‰è€…ä¸¤ä¸¤å‚ç›´ã€‚</p>
                <p>3. <strong>åŒç›¸æŒ¯è¡</strong>ï¼šåœ¨è‡ªç”±ç©ºé—´ä¸­ï¼Œ<span class="highlight">E</span> å’Œ <span class="highlight-b">B</span> åŒæ—¶è¾¾åˆ°æœ€å¤§å€¼ï¼ŒåŒæ—¶è¿‡é›¶ç‚¹ï¼Œç›¸ä½ç›¸åŒã€‚</p>
                <p>4. <strong>å³æ‰‹å®šåˆ™</strong>ï¼šå³æ‰‹å››æŒ‡ä» <span class="highlight">E</span> æ–¹å‘å¼¯å‘ <span class="highlight-b">B</span> æ–¹å‘ï¼Œæ‹‡æŒ‡æŒ‡å‘å³ä¸ºæ³¢çš„ä¼ æ’­æ–¹å‘ <span class="highlight-k">k</span>ã€‚</p>
            </div>
        </div>
    </div>

    <script>
        // è·å–Canvaså’Œä¸Šä¸‹æ–‡
        const canvas = document.getElementById('waveCanvas');
        const ctx = canvas.getContext('2d');
        
        // è®¾ç½®Canvaså°ºå¯¸
        function resizeCanvas() {
            canvas.width = canvas.clientWidth;
            canvas.height = canvas.clientHeight;
        }
        
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        
        // åŠ¨ç”»çŠ¶æ€
        let animationId = null;
        let isPlaying = true;
        let time = 0;
        
        // è§†å›¾å‚æ•°
        let viewRotationX = -30 * Math.PI / 180;
        let viewRotationY = 30 * Math.PI / 180;
        let zoom = 1.0;
        let offsetX = 0;
        let offsetY = 0;
        
        // æ³¢å½¢å‚æ•°
        let wavelength = 100;
        let amplitude = 40;
        let speed = 1.0;
        
        // æ˜¾ç¤ºé€‰é¡¹
        let showE = true;
        let showB = true;
        let showPath = true;
        let showGrid = true;
        let showVectors = false;
        let showSnapshot = false;
        let probeMode = false;
        
        // æ¢æµ‹ç‚¹ä¿¡æ¯
        let probePoint = null;
        
        // é¼ æ ‡äº¤äº’
        let isDragging = false;
        let lastMouseX = 0;
        let lastMouseY = 0;
        
        // åˆ†æ­¥æ¼”ç¤ºçŠ¶æ€
        let stepDemoActive = false;
        let stepDemoPhase = 0;
        let stepDemoTimer = null;
        
        // å³æ‰‹å®šåˆ™æ˜¾ç¤º
        let showRightHandRule = false;
        
        // åˆå§‹åŒ–æ§ä»¶çŠ¶æ€
        document.getElementById('showE').checked = showE;
        document.getElementById('showB').checked = showB;
        document.getElementById('showPath').checked = showPath;
        document.getElementById('showGrid').checked = showGrid;
        document.getElementById('showVectors').checked = showVectors;
        document.getElementById('showSnapshot').checked = showSnapshot;
        document.getElementById('probeMode').checked = probeMode;
        
        // æ›´æ–°æ»‘å—æ˜¾ç¤ºå€¼
        document.getElementById('speedValue').textContent = speed.toFixed(1) + 'x';
        document.getElementById('wavelengthValue').textContent = wavelength;
        
        // æ§ä»¶äº‹ä»¶ç›‘å¬
        document.getElementById('speedSlider').addEventListener('input', function() {
            speed = parseFloat(this.value);
            document.getElementById('speedValue').textContent = speed.toFixed(1) + 'x';
        });
        
        document.getElementById('wavelengthSlider').addEventListener('input', function() {
            wavelength = parseInt(this.value);
            document.getElementById('wavelengthValue').textContent = wavelength;
        });
        
        document.getElementById('playPauseBtn').addEventListener('click', function() {
            isPlaying = !isPlaying;
            document.getElementById('playText').textContent = isPlaying ? 'æš‚åœåŠ¨ç”»' : 'æ’­æ”¾åŠ¨ç”»';
            document.getElementById('playIcon').textContent = isPlaying ? 'â¸ï¸' : 'â–¶ï¸';
            
            if (isPlaying) {
                animate();
            } else {
                if (animationId) {
                    cancelAnimationFrame(animationId);
                }
            }
        });
        
        document.getElementById('resetBtn').addEventListener('click', function() {
            viewRotationX = -30 * Math.PI / 180;
            viewRotationY = 30 * Math.PI / 180;
            zoom = 1.0;
            offsetX = 0;
            offsetY = 0;
            time = 0;
            probePoint = null;
            document.getElementById('pointInfo').classList.remove('active');
            showRightHandRule = false;
            
            if (!isPlaying) {
                isPlaying = true;
                document.getElementById('playText').textContent = 'æš‚åœåŠ¨ç”»';
                document.getElementById('playIcon').textContent = 'â¸ï¸';
                animate();
            }
        });
        
        document.getElementById('showE').addEventListener('change', function() {
            showE = this.checked;
        });
        
        document.getElementById('showB').addEventListener('change', function() {
            showB = this.checked;
        });
        
        document.getElementById('showPath').addEventListener('change', function() {
            showPath = this.checked;
        });
        
        document.getElementById('showGrid').addEventListener('change', function() {
            showGrid = this.checked;
        });
        
        document.getElementById('showVectors').addEventListener('change', function() {
            showVectors = this.checked;
        });
        
        document.getElementById('showSnapshot').addEventListener('change', function() {
            showSnapshot = this.checked;
        });
        
        document.getElementById('probeMode').addEventListener('change', function() {
            probeMode = this.checked;
        });
        
        // è§†å›¾æŒ‰é’®
        document.getElementById('frontView').addEventListener('click', function() {
            viewRotationX = 0;
            viewRotationY = 0;
        });
        
        document.getElementById('sideView').addEventListener('click', function() {
            viewRotationX = 0;
            viewRotationY = 90 * Math.PI / 180;
        });
        
        document.getElementById('topView').addEventListener('click', function() {
            viewRotationX = -90 * Math.PI / 180;
            viewRotationY = 0;
        });
        
        document.getElementById('isoView').addEventListener('click', function() {
            viewRotationX = -30 * Math.PI / 180;
            viewRotationY = 30 * Math.PI / 180;
        });
        
        // æ•™å­¦è¾…åŠ©æŒ‰é’®
        document.getElementById('stepDemoBtn').addEventListener('click', function() {
            startStepDemo();
        });
        
        document.getElementById('rightHandBtn').addEventListener('click', function() {
            showRightHandRule = !showRightHandRule;
            this.textContent = showRightHandRule ? 'ğŸ–ï¸ éšè—å³æ‰‹å®šåˆ™' : 'ğŸ–ï¸ æ˜¾ç¤ºå³æ‰‹å®šåˆ™';
        });
        
        // é¼ æ ‡äº‹ä»¶
        canvas.addEventListener('mousedown', function(e) {
            isDragging = true;
            lastMouseX = e.clientX;
            lastMouseY = e.clientY;
            
            // å¦‚æœæ¢æµ‹æ¨¡å¼å¼€å¯ï¼Œå¤„ç†ç‚¹å‡»æ¢æµ‹
            if (probeMode) {
                handleCanvasClick(e);
            }
        });
        
        canvas.addEventListener('mousemove', function(e) {
            if (isDragging && !probeMode) {
                const deltaX = e.clientX - lastMouseX;
                const deltaY = e.clientY - lastMouseY;
                
                viewRotationY += deltaX * 0.01;
                viewRotationX += deltaY * 0.01;
                
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
            }
        });
        
        canvas.addEventListener('mouseup', function() {
            isDragging = false;
        });
        
        canvas.addEventListener('mouseleave', function() {
            isDragging = false;
        });
        
        // é¼ æ ‡æ»šè½®ç¼©æ”¾
        canvas.addEventListener('wheel', function(e) {
            e.preventDefault();
            zoom += e.deltaY * -0.001;
            zoom = Math.max(0.5, Math.min(3, zoom));
        });
        
        // å¤„ç†ç”»å¸ƒç‚¹å‡»ï¼ˆæ¢æµ‹æ¨¡å¼ï¼‰
        function handleCanvasClick(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // å°†å±å¹•åæ ‡è½¬æ¢ä¸º3Dç©ºé—´åæ ‡ï¼ˆç®€åŒ–ç‰ˆï¼‰
            // è¿™é‡Œæˆ‘ä»¬å‡è®¾ç‚¹å‡»çš„æ˜¯ä¼ æ’­è·¯å¾„ä¸Šçš„ç‚¹
            const canvasX = (x - canvas.width/2) / zoom;
            const canvasY = (y - canvas.height/2) / zoom;
            
            // é€†å‘æ—‹è½¬åˆ°3Dç©ºé—´ï¼ˆç®€åŒ–è®¡ç®—ï¼‰
            const cosX = Math.cos(viewRotationX);
            const sinX = Math.sin(viewRotationX);
            const cosY = Math.cos(viewRotationY);
            const sinY = Math.sin(viewRotationY);
            
            // ç®€åŒ–ï¼šå‡è®¾ç‚¹å‡»ç‚¹åœ¨z=0å¹³é¢ä¸Š
            let worldX = canvasX * cosY - canvasY * sinX * sinY;
            let worldY = canvasY * cosX;
            
            // é™åˆ¶åœ¨åˆç†èŒƒå›´å†…
            worldX = Math.max(-200, Math.min(200, worldX));
            worldY = Math.max(-100, Math.min(100, worldY));
            
            // è®¾ç½®æ¢æµ‹ç‚¹
            probePoint = {
                x: worldX,
                y: worldY,
                z: 0
            };
            
            // æ›´æ–°æ˜¾ç¤ºä¿¡æ¯
            updateProbeInfo();
            document.getElementById('pointInfo').classList.add('active');
        }
        
        // æ›´æ–°æ¢æµ‹ç‚¹ä¿¡æ¯
        function updateProbeInfo() {
            if (!probePoint) return;
            
            const k = 2 * Math.PI / wavelength;
            const phase = k * probePoint.x - time * 0.05 * speed;
            
            const eValue = amplitude * Math.sin(phase);
            const bValue = amplitude * Math.sin(phase);
            
            document.getElementById('posX').textContent = probePoint.x.toFixed(1);
            document.getElementById('posY').textContent = probePoint.y.toFixed(1);
            document.getElementById('posZ').textContent = probePoint.z.toFixed(1);
            document.getElementById('eValue').textContent = eValue.toFixed(1);
            document.getElementById('bValue').textContent = bValue.toFixed(1);
            document.getElementById('phaseValue').textContent = ((phase * 180 / Math.PI) % 360).toFixed(0);
        }
        
        // 3DæŠ•å½±å‡½æ•°
        function projectPoint(x, y, z) {
            // åº”ç”¨è§†å›¾æ—‹è½¬
            const cosX = Math.cos(viewRotationX);
            const sinX = Math.sin(viewRotationX);
            const cosY = Math.cos(viewRotationY);
            const sinY = Math.sin(viewRotationY);
            
            // ç»•Yè½´æ—‹è½¬
            let x1 = x * cosY + z * sinY;
            let z1 = z * cosY - x * sinY;
            
            // ç»•Xè½´æ—‹è½¬
            let y1 = y * cosX - z1 * sinX;
            z1 = z1 * cosX + y * sinX;
            
            // åº”ç”¨ç¼©æ”¾å’Œåç§»
            const scale = 2 * zoom;
            const screenX = canvas.width/2 + (x1 + offsetX) * scale;
            const screenY = canvas.height/2 + (y1 + offsetY) * scale;
            
            return {x: screenX, y: screenY, z: z1};
        }
        
        // ç»˜åˆ¶åæ ‡ç³»ç½‘æ ¼
        function drawGrid() {
            if (!showGrid) return;
            
            ctx.strokeStyle = 'rgba(68, 68, 68, 0.6)';
            ctx.lineWidth = 1;
            
            // ç»˜åˆ¶X-Yå¹³é¢ç½‘æ ¼
            for (let x = -200; x <= 200; x += 50) {
                const p1 = projectPoint(x, -100, 0);
                const p2 = projectPoint(x, 100, 0);
                
                ctx.beginPath();
                ctx.moveTo(p1.x, p1.y);
                ctx.lineTo(p2.x, p2.y);
                ctx.stroke();
            }
            
            for (let y = -100; y <= 100; y += 50) {
                const p1 = projectPoint(-200, y, 0);
                const p2 = projectPoint(200, y, 0);
                
                ctx.beginPath();
                ctx.moveTo(p1.x, p1.y);
                ctx.lineTo(p2.x, p2.y);
                ctx.stroke();
            }
            
            // ç»˜åˆ¶åæ ‡è½´
            ctx.lineWidth = 2;
            
            // Xè½´ (çº¢è‰²)
            const xStart = projectPoint(-220, 0, 0);
            const xEnd = projectPoint(220, 0, 0);
            ctx.strokeStyle = '#FF3333';
            ctx.beginPath();
            ctx.moveTo(xStart.x, xStart.y);
            ctx.lineTo(xEnd.x, xEnd.y);
            ctx.stroke();
            
            // Yè½´ (ç»¿è‰²)
            const yStart = projectPoint(0, -120, 0);
            const yEnd = projectPoint(0, 120, 0);
            ctx.strokeStyle = '#33FF33';
            ctx.beginPath();
            ctx.moveTo(yStart.x, yStart.y);
            ctx.lineTo(yEnd.x, yEnd.y);
            ctx.stroke();
            
            // Zè½´ (è“è‰²)
            const zStart = projectPoint(0, 0, -120);
            const zEnd = projectPoint(0, 0, 120);
            ctx.strokeStyle = '#3399FF';
            ctx.beginPath();
            ctx.moveTo(zStart.x, zStart.y);
            ctx.lineTo(zEnd.x, zEnd.y);
            ctx.stroke();
            
            // åæ ‡è½´æ ‡ç­¾
            ctx.font = '14px Arial';
            ctx.fillStyle = '#FF3333';
            ctx.fillText('X (ä¼ æ’­æ–¹å‘ k)', xEnd.x + 5, xEnd.y + 5);
            
            ctx.fillStyle = '#33FF33';
            ctx.fillText('Y (ç”µåœº E)', yEnd.x + 5, yEnd.y - 10);
            
            ctx.fillStyle = '#3399FF';
            ctx.fillText('Z (ç£åœº B)', zEnd.x + 5, zEnd.y + 5);
        }
        
        // ç»˜åˆ¶ä¼ æ’­è·¯å¾„
        function drawPropagationPath() {
            if (!showPath) return;
            
            ctx.strokeStyle = 'rgba(204, 204, 204, 0.7)';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            
            const points = [];
            for (let x = -200; x <= 200; x += 5) {
                points.push(projectPoint(x, 0, 0));
            }
            
            ctx.beginPath();
            ctx.moveTo(points[0].x, points[0].y);
            for (let i = 1; i < points.length; i++) {
                ctx.lineTo(points[i].x, points[i].y);
            }
            ctx.stroke();
            
            ctx.setLineDash([]);
        }
        
        // ç»˜åˆ¶ç”µåœºæ³¢å½¢
        function drawElectricField() {
            if (!showE) return;
            
            const k = 2 * Math.PI / wavelength;
            
            // ç»˜åˆ¶ç”µåœºæ³¢å½¢çº¿
            ctx.strokeStyle = '#FF00FF';
            ctx.lineWidth = 2;
            
            const points = [];
            for (let x = -200; x <= 200; x += 2) {
                const y = amplitude * Math.sin(k * x - time * 0.05 * speed);
                points.push(projectPoint(x, y, 0));
            }
            
            ctx.beginPath();
            ctx.moveTo(points[0].x, points[0].y);
            for (let i = 1; i < points.length; i++) {
                ctx.lineTo(points[i].x, points[i].y);
            }
            ctx.stroke();
            
            // ç»˜åˆ¶ç”µåœºçŸ¢é‡ç®­å¤´
            if (showVectors) {
                ctx.fillStyle = '#FF00FF';
                for (let x = -180; x <= 180; x += 40) {
                    const y = amplitude * Math.sin(k * x - time * 0.05 * speed);
                    const p = projectPoint(x, 0, 0);
                    const p2 = projectPoint(x, y, 0);
                    
                    drawArrow(p.x, p.y, p2.x, p2.y, '#FF00FF');
                    
                    // åœ¨ç®­å¤´ä¸­ç‚¹ç»˜åˆ¶åœ†ç‚¹
                    ctx.beginPath();
                    ctx.arc(p2.x, p2.y, 4, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            // ç»˜åˆ¶ç¬æ—¶å¿«ç…§
            if (showSnapshot) {
                ctx.strokeStyle = 'rgba(255, 0, 255, 0.4)';
                ctx.lineWidth = 1;
                ctx.setLineDash([3, 3]);
                
                const snapshotPoints = [];
                for (let x = -200; x <= 200; x += 2) {
                    const y = amplitude * Math.sin(k * x - (time - 10) * 0.05 * speed);
                    snapshotPoints.push(projectPoint(x, y, 0));
                }
                
                ctx.beginPath();
                ctx.moveTo(snapshotPoints[0].x, snapshotPoints[0].y);
                for (let i = 1; i < snapshotPoints.length; i++) {
                    ctx.lineTo(snapshotPoints[i].x, snapshotPoints[i].y);
                }
                ctx.stroke();
                
                ctx.setLineDash([]);
            }
        }
        
        // ç»˜åˆ¶ç£åœºæ³¢å½¢
        function drawMagneticField() {
            if (!showB) return;
            
            const k = 2 * Math.PI / wavelength;
            
            // ç»˜åˆ¶ç£åœºæ³¢å½¢çº¿
            ctx.strokeStyle = '#00FFFF';
            ctx.lineWidth = 2;
            
            const points = [];
            for (let x = -200; x <= 200; x += 2) {
                const z = amplitude * Math.sin(k * x - time * 0.05 * speed);
                points.push(projectPoint(x, 0, z));
            }
            
            ctx.beginPath();
            ctx.moveTo(points[0].x, points[0].y);
            for (let i = 1; i < points.length; i++) {
                ctx.lineTo(points[i].x, points[i].y);
            }
            ctx.stroke();
            
            // ç»˜åˆ¶ç£åœºçŸ¢é‡ç®­å¤´
            if (showVectors) {
                ctx.fillStyle = '#00FFFF';
                for (let x = -180; x <= 180; x += 40) {
                    const z = amplitude * Math.sin(k * x - time * 0.05 * speed);
                    const p = projectPoint(x, 0, 0);
                    const p2 = projectPoint(x, 0, z);
                    
                    drawArrow(p.x, p.y, p2.x, p2.y, '#00FFFF');
                    
                    // åœ¨ç®­å¤´ä¸­ç‚¹ç»˜åˆ¶åœ†ç‚¹
                    ctx.beginPath();
                    ctx.arc(p2.x, p2.y, 4, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            // ç»˜åˆ¶ç¬æ—¶å¿«ç…§
            if (showSnapshot) {
                ctx.strokeStyle = 'rgba(0, 255, 255, 0.4)';
                ctx.lineWidth = 1;
                ctx.setLineDash([3, 3]);
                
                const snapshotPoints = [];
                for (let x = -200; x <= 200; x += 2) {
                    const z = amplitude * Math.sin(k * x - (time - 10) * 0.05 * speed);
                    snapshotPoints.push(projectPoint(x, 0, z));
                }
                
                ctx.beginPath();
                ctx.moveTo(snapshotPoints[0].x, snapshot
<!--æ£€æµ‹åˆ°ä»£ç æˆªæ–­ï¼Œè‡ªåŠ¨ç»­å†™ä¸­...-->
                ctx.moveTo(snapshotPoints[0].x, snapshotPoints[0].y);
                for (let i = 1; i < snapshotPoints.length; i++) {
                    ctx.lineTo(snapshotPoints[i].x, snapshotPoints[i].y);
                }
                ctx.stroke();
                
                ctx.setLineDash([]);
            }
        }
        
        // ç»˜åˆ¶æ¢æµ‹ç‚¹
        function drawProbePoint() {
            if (!probePoint) return;
            
            const p = projectPoint(probePoint.x, probePoint.y, probePoint.z);
            
            // ç»˜åˆ¶æ¢æµ‹ç‚¹
            ctx.fillStyle = '#FFCC00';
            ctx.beginPath();
            ctx.arc(p.x, p.y, 8, 0, Math.PI * 2);
            ctx.fill();
            
            // ç»˜åˆ¶ä»æ¢æµ‹ç‚¹åˆ°æ³¢å½¢çš„è¿çº¿
            const k = 2 * Math.PI / wavelength;
            const phase = k * probePoint.x - time * 0.05 * speed;
            
            const eValue = amplitude * Math.sin(phase);
            const bValue = amplitude * Math.sin(phase);
            
            // ç”µåœºè¿çº¿
            const pE = projectPoint(probePoint.x, eValue, 0);
            ctx.strokeStyle = 'rgba(255, 0, 255, 0.6)';
            ctx.lineWidth = 1;
            ctx.setLineDash([2, 2]);
            ctx.beginPath();
            ctx.moveTo(p.x, p.y);
            ctx.lineTo(pE.x, pE.y);
            ctx.stroke();
            
            // ç£åœºè¿çº¿
            const pB = projectPoint(probePoint.x, 0, bValue);
            ctx.strokeStyle = 'rgba(0, 255, 255, 0.6)';
            ctx.beginPath();
            ctx.moveTo(p.x, p.y);
            ctx.lineTo(pB.x, pB.y);
            ctx.stroke();
            
            ctx.setLineDash([]);
            
            // åœ¨æ¢æµ‹ç‚¹å¤„ç»˜åˆ¶Eå’ŒBçŸ¢é‡
            drawArrow(p.x, p.y, pE.x, pE.y, '#FF00FF');
            drawArrow(p.x, p.y, pB.x, pB.y, '#00FFFF');
        }
        
        // ç»˜åˆ¶å³æ‰‹å®šåˆ™ç¤ºæ„å›¾
        function drawRightHandRule() {
            if (!showRightHandRule) return;
            
            // åœ¨ç”»å¸ƒå³ä¸Šè§’ç»˜åˆ¶ç¤ºæ„å›¾
            const centerX = canvas.width - 150;
            const centerY = 150;
            const size = 80;
            
            // ç»˜åˆ¶EçŸ¢é‡ (æ´‹çº¢è‰²)
            ctx.strokeStyle = '#FF00FF';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(centerX, centerY - size);
            ctx.stroke();
            
            // ç»˜åˆ¶BçŸ¢é‡ (é’è‰²)
            ctx.strokeStyle = '#00FFFF';
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(centerX + size, centerY);
            ctx.stroke();
            
            // ç»˜åˆ¶kçŸ¢é‡ (ç™½è‰²)
            ctx.strokeStyle = '#FFFFFF';
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(centerX, centerY + size);
            ctx.stroke();
            
            // ç»˜åˆ¶å³æ‰‹ç¤ºæ„å›¾
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            // æ‰‹æŒéƒ¨åˆ†
            ctx.arc(centerX, centerY, 25, 0, Math.PI * 2);
            ctx.stroke();
            
            // æ‹‡æŒ‡ (kæ–¹å‘)
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(centerX, centerY + 35);
            ctx.stroke();
            
            // å››æŒ‡ (ä»Eå¼¯å‘B)
            ctx.beginPath();
            ctx.arc(centerX, centerY, 20, -Math.PI/2, 0, false);
            ctx.stroke();
            
            // æ ‡ç­¾
            ctx.font = 'bold 14px Arial';
            ctx.fillStyle = '#FF00FF';
            ctx.fillText('E', centerX - 10, centerY - size - 5);
            
            ctx.fillStyle = '#00FFFF';
            ctx.fillText('B', centerX + size + 5, centerY + 5);
            
            ctx.fillStyle = '#FFFFFF';
            ctx.fillText('k', centerX - 10, centerY + size + 15);
            
            ctx.fillStyle = '#FFCC00';
            ctx.font = '12px Arial';
            ctx.fillText('å³æ‰‹å®šåˆ™: E â†’ B = k', centerX - 50, centerY + size + 35);
        }
        
        // ç»˜åˆ¶ç®­å¤´å‡½æ•°
        function drawArrow(fromX, fromY, toX, toY, color) {
            const headlen = 10;
            const angle = Math.atan2(toY - fromY, toX - fromX);
            
            ctx.strokeStyle = color;
            ctx.fillStyle = color;
            ctx.lineWidth = 2;
            
            // ç»˜åˆ¶çº¿
            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            ctx.lineTo(toX, toY);
            ctx.stroke();
            
            // ç»˜åˆ¶ç®­å¤´å¤´éƒ¨
            ctx.beginPath();
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headlen * Math.cos(angle - Math.PI/6), toY - headlen * Math.sin(angle - Math.PI/6));
            ctx.lineTo(toX - headlen * Math.cos(angle + Math.PI/6), toY - headlen * Math.sin(angle + Math.PI/6));
            ctx.closePath();
            ctx.fill();
        }
        
        // å¼€å§‹åˆ†æ­¥æ¼”ç¤º
        function startStepDemo() {
            if (stepDemoActive) return;
            
            stepDemoActive = true;
            stepDemoPhase = 0;
            
            // é‡ç½®æ˜¾ç¤ºé€‰é¡¹
            showE = false;
            showB = false;
            showPath = false;
            showVectors = false;
            showSnapshot = false;
            
            document.getElementById('showE').checked = false;
            document.getElementById('showB').checked = false;
            document.getElementById('showPath').checked = false;
            document.getElementById('showVectors').checked = false;
            document.getElementById('showSnapshot').checked = false;
            
            // å¼€å§‹æ¼”ç¤ºåºåˆ—
            stepDemoTimer = setInterval(() => {
                stepDemoPhase++;
                
                switch(stepDemoPhase) {
                    case 1:
                        // æ­¥éª¤1: æ˜¾ç¤ºä¼ æ’­è½´
                        showPath = true;
                        document.getElementById('showPath').checked = true;
                        break;
                    case 2:
                        // æ­¥éª¤2: æ˜¾ç¤ºç”µåœº
                        showE = true;
                        document.getElementById('showE').checked = true;
                        break;
                    case 3:
                        // æ­¥éª¤3: æ˜¾ç¤ºç”µåœºçŸ¢é‡
                        showVectors = true;
                        document.getElementById('showVectors').checked = true;
                        break;
                    case 4:
                        // æ­¥éª¤4: æ˜¾ç¤ºç£åœº
                        showB = true;
                        document.getElementById('showB').checked = true;
                        break;
                    case 5:
                        // æ­¥éª¤5: æ˜¾ç¤ºç£åœºçŸ¢é‡
                        // (å·²ç»æ˜¾ç¤º)
                        break;
                    case 6:
                        // æ­¥éª¤6: æ˜¾ç¤ºç¬æ—¶å¿«ç…§
                        showSnapshot = true;
                        document.getElementById('showSnapshot').checked = true;
                        break;
                    case 7:
                        // æ­¥éª¤7: æ¼”ç¤ºç»“æŸ
                        clearInterval(stepDemoTimer);
                        stepDemoActive = false;
                        break;
                }
            }, 1500);
        }
        
        // ä¸»ç»˜åˆ¶å‡½æ•°
        function draw() {
            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶é»‘è‰²èƒŒæ™¯
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶å„ä¸ªç»„ä»¶
            drawGrid();
            drawPropagationPath();
            drawElectricField();
            drawMagneticField();
            
            // ç»˜åˆ¶æ¢æµ‹ç‚¹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            if (probeMode && probePoint) {
                drawProbePoint();
                updateProbeInfo();
            }
            
            // ç»˜åˆ¶å³æ‰‹å®šåˆ™
            drawRightHandRule();
            
            // ç»˜åˆ¶æ³¢å‰æ ‡è®°
            const waveFrontX = 200 * Math.cos(time * 0.02 * speed);
            const pFront = projectPoint(waveFrontX, 0, 0);
            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            ctx.beginPath();
            ctx.arc(pFront.x, pFront.y, 6, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.font = '12px Arial';
            ctx.fillStyle = '#FFFFFF';
            ctx.fillText('æ³¢å‰', pFront.x + 10, pFront.y);
        }
        
        // åŠ¨ç”»å¾ªç¯
        function animate() {
            if (isPlaying) {
                time += 1;
                draw();
            }
            
            animationId = requestAnimationFrame(animate);
        }
        
        // å¯åŠ¨åŠ¨ç”»
        animate();
    </script>
</body>
</html>