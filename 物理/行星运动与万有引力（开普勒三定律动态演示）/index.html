<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡Œæ˜Ÿè¿åŠ¨ä¸ä¸‡æœ‰å¼•åŠ› - å¼€æ™®å‹’ä¸‰å®šå¾‹åŠ¨æ€æ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(to bottom, #0d1b2a, #000814);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        h1 {
            color: #ffffff;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #4A90E2, #00FFFF);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .subtitle {
            color: #a0d2ff;
            font-size: 1.2rem;
            font-weight: 300;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .simulation-panel {
            flex: 3;
            min-width: 300px;
            background: rgba(20, 30, 48, 0.7);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(100, 150, 255, 0.1);
        }
        
        .controls-panel {
            flex: 2;
            min-width: 300px;
            background: rgba(20, 30, 48, 0.7);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(100, 150, 255, 0.1);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .panel-title {
            color: #00FFFF;
            font-size: 1.4rem;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(0, 255, 255, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel-title i {
            font-size: 1.2rem;
        }
        
        #simulationCanvas {
            width: 100%;
            height: 500px;
            background-color: rgba(5, 10, 25, 0.8);
            border-radius: 10px;
            display: block;
            border: 1px solid rgba(100, 150, 255, 0.2);
        }
        
        .law-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .law-tab {
            flex: 1;
            min-width: 120px;
            padding: 12px 15px;
            background: rgba(40, 60, 100, 0.5);
            border: none;
            border-radius: 8px;
            color: #a0d2ff;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .law-tab:hover {
            background: rgba(60, 100, 180, 0.7);
            transform: translateY(-2px);
        }
        
        .law-tab.active {
            background: linear-gradient(90deg, #4A90E2, #2E8B57);
            color: white;
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.4);
        }
        
        .control-group {
            background: rgba(30, 45, 70, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
        }
        
        .control-title {
            color: #FFD700;
            font-size: 1.1rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .slider-container {
            margin-bottom: 15px;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .slider-label span:last-child {
            color: #00FF7F;
            font-weight: bold;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(100, 100, 150, 0.5);
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #00FFFF;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.7);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .control-btn {
            flex: 1;
            min-width: 80px;
            padding: 12px 15px;
            background: rgba(60, 100, 180, 0.7);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .control-btn:hover {
            background: rgba(80, 130, 220, 0.9);
            transform: translateY(-2px);
        }
        
        .control-btn.primary {
            background: linear-gradient(90deg, #FF375F, #FF00FF);
        }
        
        .control-btn.primary:hover {
            background: linear-gradient(90deg, #FF557F, #FF20FF);
        }
        
        .data-panel {
            background: rgba(30, 45, 70, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
        }
        
        .data-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .data-item:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }
        
        .data-label {
            color: #a0d2ff;
        }
        
        .data-value {
            color: #00FF7F;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }
        
        .instructions {
            background: rgba(40, 60, 100, 0.5);
            border-radius: 10px;
            padding: 20px;
            margin-top: 25px;
            border-left: 5px solid #FFD700;
        }
        
        .instructions h3 {
            color: #FFD700;
            margin-bottom: 10px;
        }
        
        .instructions ul {
            padding-left: 20px;
            line-height: 1.6;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        .highlight {
            color: #00FFFF;
            font-weight: bold;
        }
        
        .kepler-law {
            color: #FF8C00;
            font-weight: bold;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #a0d2ff;
            font-size: 0.9rem;
        }
        
        @media (max-width: 1100px) {
            .main-content {
                flex-direction: column;
            }
            
            .simulation-panel, .controls-panel {
                width: 100%;
            }
            
            #simulationCanvas {
                height: 400px;
            }
        }
        
        @media (max-width: 600px) {
            h1 {
                font-size: 2rem;
            }
            
            #simulationCanvas {
                height: 350px;
            }
            
            .law-tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>è¡Œæ˜Ÿè¿åŠ¨ä¸ä¸‡æœ‰å¼•åŠ›</h1>
            <p class="subtitle">å¼€æ™®å‹’ä¸‰å®šå¾‹åŠ¨æ€æ¼”ç¤ºä¸äº¤äº’æ¢ç´¢</p>
        </header>
        
        <div class="main-content">
            <div class="simulation-panel">
                <h2 class="panel-title">â­ å¤©ä½“è¿åŠ¨æ¨¡æ‹Ÿ</h2>
                
                <div class="law-tabs">
                    <button class="law-tab active" data-law="first">ç¬¬ä¸€å®šå¾‹ï¼šè½¨é“å®šå¾‹</button>
                    <button class="law-tab" data-law="second">ç¬¬äºŒå®šå¾‹ï¼šé¢ç§¯å®šå¾‹</button>
                    <button class="law-tab" data-law="third">ç¬¬ä¸‰å®šå¾‹ï¼šå‘¨æœŸå®šå¾‹</button>
                    <button class="law-tab" data-law="gravity">ä¸‡æœ‰å¼•åŠ›</button>
                    <button class="law-tab" data-law="combined">ç»¼åˆè§†å›¾</button>
                </div>
                
                <canvas id="simulationCanvas"></canvas>
            </div>
            
            <div class="controls-panel">
                <div class="control-group">
                    <h3 class="control-title">â±ï¸ åŠ¨ç”»æ§åˆ¶</h3>
                    <div class="button-group">
                        <button id="playPauseBtn" class="control-btn primary">æš‚åœ</button>
                        <button id="stepBtn" class="control-btn">æ­¥è¿›</button>
                        <button id="resetBtn" class="control-btn">é‡ç½®</button>
                        <button id="addPlanetBtn" class="control-btn">æ·»åŠ å¯¹æ¯”è¡Œæ˜Ÿ</button>
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>æ¨¡æ‹Ÿé€Ÿåº¦</span>
                            <span id="speedValue">1.0x</span>
                        </div>
                        <input type="range" id="speedSlider" min="0.1" max="3" step="0.1" value="1">
                    </div>
                </div>
                
                <div class="control-group">
                    <h3 class="control-title">âš™ï¸ å‚æ•°è°ƒèŠ‚</h3>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>æ’æ˜Ÿè´¨é‡</span>
                            <span id="starMassValue">1.0 Mâ˜‰</span>
                        </div>
                        <input type="range" id="starMassSlider" min="0.5" max="3" step="0.1" value="1">
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>è¡Œæ˜Ÿè´¨é‡</span>
                            <span id="planetMassValue">1.0 MâŠ•</span>
                        </div>
                        <input type="range" id="planetMassSlider" min="0.1" max="5" step="0.1" value="1">
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>è½¨é“åŠé•¿è½´</span>
                            <span id="semiMajorAxisValue">200</span>
                        </div>
                        <input type="range" id="semiMajorAxisSlider" min="100" max="400" step="10" value="200">
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>è½¨é“åå¿ƒç‡</span>
                            <span id="eccentricityValue">0.5</span>
                        </div>
                        <input type="range" id="eccentricitySlider" min="0" max="0.9" step="0.05" value="0.5">
                    </div>
                </div>
                
                <div class="data-panel">
                    <h3 class="control-title">ğŸ“Š å®æ—¶æ•°æ®</h3>
                    
                    <div class="data-item">
                        <span class="data-label">è¡Œæ˜Ÿ-å¤ªé˜³è·ç¦»ï¼š</span>
                        <span id="distanceValue" class="data-value">200.0</span>
                    </div>
                    
                    <div class="data-item">
                        <span class="data-label">è¡Œæ˜Ÿé€Ÿåº¦ï¼š</span>
                        <span id="velocityValue" class="data-value">1.00</span>
                    </div>
                    
                    <div class="data-item">
                        <span class="data-label">è½¨é“å‘¨æœŸï¼š</span>
                        <span id="periodValue" class="data-value">1256.6</span>
                    </div>
                    
                    <div class="data-item">
                        <span class="data-label">æ‰«è¿‡é¢ç§¯ï¼š</span>
                        <span id="areaValue" class="data-value">0.00</span>
                    </div>
                    
                    <div class="data-item">
                        <span class="data-label">å¼•åŠ›å¤§å°ï¼š</span>
                        <span id="forceValue" class="data-value">0.00</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="instructions">
            <h3>ä½¿ç”¨è¯´æ˜ä¸æ•™å­¦è¦ç‚¹</h3>
            <ul>
                <li><span class="kepler-law">ç¬¬ä¸€å®šå¾‹ï¼ˆè½¨é“å®šå¾‹ï¼‰</span>ï¼šè¡Œæ˜Ÿç»•å¤ªé˜³è¿åŠ¨çš„è½¨é“æ˜¯æ¤­åœ†ï¼Œå¤ªé˜³ä½äºæ¤­åœ†çš„ä¸€ä¸ª<span class="highlight">ç„¦ç‚¹</span>ä¸Šã€‚</li>
                <li><span class="kepler-law">ç¬¬äºŒå®šå¾‹ï¼ˆé¢ç§¯å®šå¾‹ï¼‰</span>ï¼šè¡Œæ˜Ÿä¸å¤ªé˜³çš„è¿çº¿åœ¨ç›¸ç­‰æ—¶é—´å†…æ‰«è¿‡çš„<span class="highlight">é¢ç§¯ç›¸ç­‰</span>ã€‚æ³¨æ„è§‚å¯Ÿè¿‘å¤ªé˜³æ—¶è¡Œæ˜Ÿé€Ÿåº¦å¿«ã€è¿œå¤ªé˜³æ—¶é€Ÿåº¦æ…¢çš„ç°è±¡ã€‚</li>
                <li><span class="kepler-law">ç¬¬ä¸‰å®šå¾‹ï¼ˆå‘¨æœŸå®šå¾‹ï¼‰</span>ï¼šè¡Œæ˜Ÿè½¨é“å‘¨æœŸçš„å¹³æ–¹ä¸è½¨é“åŠé•¿è½´çš„ç«‹æ–¹æˆ<span class="highlight">æ­£æ¯”</span>ã€‚æ·»åŠ å¯¹æ¯”è¡Œæ˜Ÿå¯ç›´è§‚éªŒè¯æ­¤å…³ç³»ã€‚</li>
                <li><span class="highlight">ä¸‡æœ‰å¼•åŠ›</span>ï¼šçº¢è‰²ç®­å¤´è¡¨ç¤ºå¼•åŠ›æ–¹å‘ä¸å¤§å°ï¼Œå®ƒå§‹ç»ˆæŒ‡å‘å¤ªé˜³ï¼Œæ˜¯ç»´æŒè¡Œæ˜Ÿæ¤­åœ†è¿åŠ¨çš„å‘å¿ƒåŠ›ã€‚</li>
                <li>å°è¯•è°ƒèŠ‚å‚æ•°ï¼Œè§‚å¯Ÿè½¨é“å½¢çŠ¶ã€è¿åŠ¨é€Ÿåº¦å’Œå‘¨æœŸçš„å˜åŒ–ï¼Œæ·±å…¥ç†è§£å¼€æ™®å‹’å®šå¾‹ä¸ä¸‡æœ‰å¼•åŠ›çš„å…³ç³»ã€‚</li>
            </ul>
        </div>
        
        <footer>
            <p>è¡Œæ˜Ÿè¿åŠ¨ä¸ä¸‡æœ‰å¼•åŠ›æ•™å­¦åŠ¨ç”» | åŸºäºå¼€æ™®å‹’ä¸‰å®šå¾‹çš„äº¤äº’å¼æ¼”ç¤º | è®¾è®¡ï¼šç†ŠçŒ«è€å¸ˆ</p>
            <p>æç¤ºï¼šä½¿ç”¨æ»‘å—è°ƒèŠ‚å‚æ•°ï¼Œç‚¹å‡»é€‰é¡¹å¡åˆ‡æ¢ä¸åŒå®šå¾‹çš„è§†å›¾æ¨¡å¼</p>
        </footer>
    </div>

    <script>
        // è·å–Canvaså…ƒç´ å’Œä¸Šä¸‹æ–‡
        const canvas = document.getElementById('simulationCanvas');
        const ctx = canvas.getContext('2d');
        
        // è®¾ç½®Canvaså°ºå¯¸
        function resizeCanvas() {
            canvas.width = canvas.clientWidth;
            canvas.height = canvas.clientHeight;
        }
        
        // åˆå§‹è°ƒæ•´å°ºå¯¸
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // æ¨¡æ‹ŸçŠ¶æ€
        let simulation = {
            running: true,
            time: 0,
            speed: 1.0,
            activeLaw: 'first',
            planets: [],
            trailPoints: []
        };
        
        // ç‰©ç†å‚æ•°
        const G = 1; // å¼•åŠ›å¸¸æ•°ï¼ˆç®€åŒ–å•ä½ï¼‰
        let starMass = 1.0;
        let planetMass = 1.0;
        let semiMajorAxis = 200;
        let eccentricity = 0.5;
        
        // è®¡ç®—è½¨é“å‚æ•°
        function calculateOrbitParams() {
            // åŠçŸ­è½´
            const semiMinorAxis = semiMajorAxis * Math.sqrt(1 - eccentricity * eccentricity);
            
            // ç„¦è·
            const focalDistance = Math.sqrt(semiMajorAxis * semiMajorAxis - semiMinorAxis * semiMinorAxis);
            
            // è½¨é“å‘¨æœŸï¼ˆå¼€æ™®å‹’ç¬¬ä¸‰å®šå¾‹ç®€åŒ–ç‰ˆï¼‰
            const period = 2 * Math.PI * Math.sqrt(Math.pow(semiMajorAxis, 3) / (G * starMass));
            
            return {
                semiMinorAxis,
                focalDistance,
                period
            };
        }
        
        // åˆå§‹åŒ–è¡Œæ˜Ÿ
        function initPlanet() {
            const orbitParams = calculateOrbitParams();
            
            simulation.planets = [{
                x: semiMajorAxis + orbitParams.focalDistance, // ä»è¿‘æ—¥ç‚¹å¼€å§‹
                y: 0,
                vx: 0,
                vy: Math.sqrt(G * starMass * (2/(semiMajorAxis - orbitParams.focalDistance) - 1/semiMajorAxis)), // åˆå§‹é€Ÿåº¦
                color: '#4A90E2',
                trail: [],
                areaSwept: 0,
                lastAreaTime: 0,
                period: orbitParams.period,
                semiMajorAxis: semiMajorAxis,
                eccentricity: eccentricity
            }];
            
            simulation.trailPoints = [];
            simulation.time = 0;
        }
        
        // æ·»åŠ å¯¹æ¯”è¡Œæ˜Ÿ
        function addComparisonPlanet() {
            const orbitParams = calculateOrbitParams();
            const newSemiMajorAxis = semiMajorAxis * 1.5;
            const newEccentricity = eccentricity * 0.8;
            const newSemiMinorAxis = newSemiMajorAxis * Math.sqrt(1 - newEccentricity * newEccentricity);
            const newFocalDistance = Math.sqrt(newSemiMajorAxis * newSemiMajorAxis - newSemiMinorAxis * newSemiMinorAxis);
            const newPeriod = 2 * Math.PI * Math.sqrt(Math.pow(newSemiMajorAxis, 3) / (G * starMass));
            
            // éšæœºé¢œè‰²
            const colors = ['#2E8B57', '#FF8C00', '#9B30FF', '#00CED1', '#FF6B6B'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            
            simulation.planets.push({
                x: newSemiMajorAxis + newFocalDistance,
                y: 0,
                vx: 0,
                vy: Math.sqrt(G * starMass * (2/(newSemiMajorAxis - newFocalDistance) - 1/newSemiMajorAxis)),
                color: randomColor,
                trail: [],
                areaSwept: 0,
                lastAreaTime: 0,
                period: newPeriod,
                semiMajorAxis: newSemiMajorAxis,
                eccentricity: newEccentricity
            });
        }
        
        // è®¡ç®—è¡Œæ˜Ÿä½ç½®ï¼ˆä½¿ç”¨ç®€åŒ–çš„æ•°å€¼ç§¯åˆ†ï¼‰
        function updatePlanetPosition(planet, dt) {
            // è®¡ç®—åˆ°å¤ªé˜³çš„è·ç¦»
            const dx = -planet.x;
            const dy = -planet.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            // è®¡ç®—å¼•åŠ›åŠ é€Ÿåº¦
            const forceMagnitude = G * starMass * planetMass / (distance * distance);
            const ax = -forceMagnitude * dx / distance;
            const ay = -forceMagnitude * dy / distance;
            
            // æ›´æ–°é€Ÿåº¦
            planet.vx += ax * dt;
            planet.vy += ay * dt;
            
            // æ›´æ–°ä½ç½®
            planet.x += planet.vx * dt;
            planet.y += planet.vy * dt;
            
            // è®°å½•è½¨è¿¹ç‚¹
            planet.trail.push({x: planet.x, y: planet.y});
            if (planet.trail.length > 500) {
                planet.trail.shift();
            }
            
            // è®¡ç®—æ‰«è¿‡çš„é¢ç§¯ï¼ˆç¬¬äºŒå®šå¾‹ï¼‰
            const currentTime = simulation.time;
            if (currentTime - planet.lastAreaTime > planet.period / 24) { // æ¯1/24å‘¨æœŸè®¡ç®—ä¸€æ¬¡
                // ä½¿ç”¨å‰ç§¯è®¡ç®—é¢ç§¯
                const r1 = Math.sqrt(planet.x * planet.x + planet.y * planet.y);
                const r2 = Math.sqrt(planet.trail[planet.trail.length-2]?.x * planet.trail[planet.trail.length-2]?.x + 
                                    planet.trail[planet.trail.length-2]?.y * planet.trail[planet.trail.length-2]?.y) || r1;
                const deltaArea = 0.5 * r1 * r2 * Math.abs(Math.sin(Math.atan2(planet.y, planet.x) - 
                                    Math.atan2(planet.trail[planet.trail.length-2]?.y || planet.y, 
                                              planet.trail[planet.trail.length-2]?.x || planet.x)));
                
                planet.areaSwept = deltaArea;
                planet.lastAreaTime = currentTime;
            }
            
            return {
                distance,
                velocity: Math.sqrt(planet.vx * planet.vx + planet.vy * planet.vy),
                force: forceMagnitude,
                area: planet.areaSwept
            };
        }
        
        // ç»˜åˆ¶å‡½æ•°
        function draw() {
            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶æ˜Ÿç©ºèƒŒæ™¯
            drawStars();
            
            // è®¡ç®—ç”»å¸ƒä¸­å¿ƒï¼ˆå¤ªé˜³ä½ç½®ï¼‰
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const scale = Math.min(canvas.width, canvas.height) / 800;
            
            // ä¿å­˜ä¸Šä¸‹æ–‡çŠ¶æ€
            ctx.save();
            
            // å¹³ç§»å’Œç¼©æ”¾åæ ‡ç³»
            ctx.translate(centerX, centerY);
            ctx.scale(scale, scale);
            
            // ç»˜åˆ¶åæ ‡è½´ï¼ˆå¯é€‰ï¼‰
            if (simulation.activeLaw === 'first' || simulation.activeLaw === 'combined') {
                drawGrid();
            }
            
            // ç»˜åˆ¶å¤ªé˜³
            drawSun();
            
            // ç»˜åˆ¶æ¤­åœ†è½¨é“ï¼ˆç¬¬ä¸€å®šå¾‹ï¼‰
            if (simulation.activeLaw === 'first' || simulation.activeLaw === 'combined') {
                drawOrbit();
            }
            
            // ç»˜åˆ¶ç„¦ç‚¹ï¼ˆç¬¬ä¸€å®šå¾‹ï¼‰
            if (simulation.activeLaw === 'first' || simulation.activeLaw === 'combined') {
                drawFoci();
            }
            
            // ç»˜åˆ¶æ‰€æœ‰è¡Œæ˜Ÿ
            simulation.planets.forEach((planet, index) => {
                // ç»˜åˆ¶è½¨è¿¹
                if (planet.trail.length > 1) {
                    drawTrail(planet.trail, planet.color);
                }
                
                // ç»˜åˆ¶è¡Œæ˜Ÿ
                drawPlanet(planet.x, planet.y, planet.color, index === 0);
                
                // ç»˜åˆ¶é¢ç§¯æ‰‡å½¢ï¼ˆç¬¬äºŒå®šå¾‹ï¼‰
                if ((simulation.activeLaw === 'second' || simulation.activeLaw === 'combined') && index === 0) {
                    drawAreaSector(planet);
                }
                
                // ç»˜åˆ¶å¼•åŠ›çŸ¢é‡ï¼ˆä¸‡æœ‰å¼•åŠ›ï¼‰
                if ((simulation.activeLaw === 'gravity' || simulation.activeLaw === 'combined') && index === 0) {
                    drawForceVector(planet);
                }
                
                // ç»˜åˆ¶å‘¨æœŸä¿¡æ¯ï¼ˆç¬¬ä¸‰å®šå¾‹ï¼‰
                if (simulation.activeLaw === 'third' || simulation.activeLaw === 'combined') {
                    drawPeriodInfo(planet, index);
                }
            });
            
            // æ¢å¤ä¸Šä¸‹æ–‡çŠ¶æ€
            ctx.restore();
            
            // æ›´æ–°æ•°æ®é¢æ¿
            if (simulation.planets.length > 0) {
                const mainPlanet = simulation.planets[0];
                const physics = updatePlanetPosition(mainPlanet, 0.05 * simulation.speed); // ä»…ç”¨äºæ•°æ®æ›´æ–°
                
                document.getElementById('distanceValue').textContent = physics.distance.toFixed(1);
                document.getElementById('velocityValue').textContent = physics.velocity.toFixed(2);
                document.getElementById('periodValue').textContent = mainPlanet.period.toFixed(1);
                document.getElementById('areaValue').textContent = physics.area.toFixed(2);
                document.getElementById('forceValue').textContent = physics.force.toFixed(2);
            }
        }
        
        // ç»˜åˆ¶æ˜Ÿç©ºèƒŒæ™¯
        function drawStars() {
            // åˆ›å»ºé™æ€æ˜Ÿç©º
            if (simulation.trailPoints.length === 0) {
                for (let i = 0; i < 100; i++) {
                    simulation.trailPoints.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height,
                        size: Math.random() * 1.5,
                        brightness: Math.random() * 0.5 + 0.5
                    });
                }
            }
            
            // ç»˜åˆ¶æ˜Ÿæ˜Ÿ
            simulation.trailPoints.forEach(star => {
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255, 255, 255, ${star.brightness})`;
                ctx.fill();
            });
        }
        
        // ç»˜åˆ¶ç½‘æ ¼
        function drawGrid() {
            ctx.strokeStyle = 'rgba(100, 150, 255, 0.2)';
            ctx.lineWidth = 0.5;
            
            // æ°´å¹³çº¿
            for (let y = -300; y <= 300; y += 50) {
                ctx.beginPath();
                ctx.moveTo(-350, y);
                ctx.lineTo(350, y);
                ctx.stroke();
            }
            
            // å‚ç›´çº¿
            for (let x = -350; x <= 350; x += 50) {
                ctx.beginPath();
                ctx.moveTo(x, -300);
                ctx.lineTo(x, 300);
                ctx.stroke();
            }
            
            // åæ ‡è½´
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.lineWidth = 1;
            
            ctx.beginPath();
            ctx.moveTo(-350, 0);
            ctx.lineTo(350, 0);
            ctx.moveTo(0, -300);
            ctx.lineTo(0, 300);
            ctx.stroke();
        }
        
        // ç»˜åˆ¶å¤ªé˜³
        function drawSun() {
            // å¤ªé˜³å…‰æ™•
            const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, 25);
            gradient.addColorStop(0, '#FFD700');
            gradient.addColorStop(0.7, '#FF8C00');
            gradient.addColorStop(1, 'rgba(255, 140, 0, 0)');
            
            ctx.beginPath();
            ctx.arc(0, 0, 25, 0, Math.PI * 2);
            ctx.fillStyle = gradient;
            ctx.fill();
            
            // å¤ªé˜³æ ¸å¿ƒ
            ctx.beginPath();
            ctx.arc(0, 0, 15, 0, Math.PI * 2);
            ctx.fillStyle = '#FFD700';
            ctx.fill();
            
            // å¤ªé˜³æ ‡ç­¾
            ctx.fillStyle = '#FF8C00';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('å¤ªé˜³', 0, -40);
        }
        
        // ç»˜åˆ¶æ¤­åœ†è½¨é“
        function drawOrbit() {
            const orbitParams = calculateOrbitParams();
            
            ctx.beginPath();
            ctx.ellipse(orbitParams.focalDistance, 0, semiMajorAxis, orbitParams.semiMinorAxis, 0, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(160, 210, 255, 0.6)';
            ctx.lineWidth = 1.5;
            ctx.stroke();
            
            // ä¸ºå…¶ä»–è¡Œæ˜Ÿç»˜åˆ¶è½¨é“
            simulation.planets.forEach((planet, index) => {
                if (index > 0) {
                    const planetSemiMinorAxis = planet.semiMajorAxis * Math.sqrt(1 - planet.eccentricity * planet.eccentricity);
                    const planetFocalDistance = Math.sqrt(planet.semiMajorAxis * planet.semiMajorAxis - planetSemiMinorAxis * planetSemiMinorAxis);
                    
                    ctx.beginPath();
                    ctx.ellipse(planetFocalDistance, 0, planet.semiMajorAxis, planetSemiMinorAxis, 0, 0, Math.PI * 2);
                    ctx.strokeStyle = planet.color.replace(')', ', 0.4)').replace('rgb', 'rgba');
                    ctx.lineWidth = 1;
                    ctx.stroke();
                }
            });
        }
        
        // ç»˜åˆ¶ç„¦ç‚¹
        function drawFoci() {
            const orbitParams = calculateOrbitParams();
            
            // ä¸»ç„¦ç‚¹ï¼ˆå¤ªé˜³ä½ç½®ï¼‰
            ctx.beginPath();
            ctx.arc(0, 0, 5, 0, Math.PI * 2);
            ctx.fillStyle = '#FFFF00';
            ctx.fill();
            
            // å¦ä¸€ä¸ªç„¦ç‚¹
            ctx.beginPath();
            ctx.arc(2 * orbitParams.focalDistance, 0, 5, 0, Math.PI * 2);
            ctx.fillStyle = '#FFFF00';
            ctx.fill();
            
            // ç„¦ç‚¹æ ‡ç­¾
            ctx.fillStyle = '#FFFF00';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ç„¦ç‚¹1', 0, 20);
            ctx.fillText('ç„¦ç‚¹2', 2 * orbitParams.focalDistance, 20);
        }
        
        // ç»˜åˆ¶è¡Œæ˜Ÿè½¨è¿¹
        function drawTrail(trail, color) {
            if (trail.length < 2) return;
            
            ctx.beginPath();
            ctx.moveTo(trail[0].x, trail[0].y);
            
            for (let i = 1; i < trail.length; i++) {
                ctx.lineTo(trail[i].x, trail[i].y);
            }
            
            ctx.strokeStyle = color.replace(')', ', 0.3)').replace('rgb', 'rgba');
            ctx.lineWidth = 1.5;
            ctx.stroke();
        }
        
        // ç»˜åˆ¶è¡Œæ˜Ÿ
        function drawPlanet(x, y, color, isMain) {
            // è¡Œæ˜Ÿ
            ctx.beginPath();
            ctx.arc(x, y, isMain ? 10 : 8, 0, Math.PI * 2);
            
            // æ·»åŠ æ¸å˜æ•ˆæœ
            const planetGradient = ctx.createRadialGradient(x - 3, y - 3, 0, x, y, isMain ? 10 : 8);
            planetGradient.addColorStop(0, color);
            planetGradient.addColorStop(1, isMain ? '#2A5CA0' : '#1A4C80');
            
            ctx.fillStyle = planetGradient;
            ctx.fill();
            
            // è¡Œæ˜Ÿè½®å»“
            ctx.strokeStyle = isMain ? '#FFFFFF' : '#CCCCCC';
            ctx.lineWidth = 1;
            ctx.stroke();
            
            // ä¸»è¡Œæ˜Ÿæ ‡ç­¾
            if (isMain) {
                ctx.fillStyle = '#FFFFFF';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('è¡Œæ˜Ÿ', x, y - 20);
            }
        }
        
        // ç»˜åˆ¶é¢ç§¯æ‰‡å½¢ï¼ˆç¬¬äºŒå®šå¾‹ï¼‰
        function drawAreaSector(planet) {
            if (planet.trail.length < 2) return;
            
            // è·å–æœ€è¿‘çš„ä¸¤ä¸ªè½¨è¿¹ç‚¹
            const point1 = planet.trail[planet.trail.length - 2] || {x: planet.x, y: planet.y};
            const point2 = {x: planet.x, y: planet.y};
            
            // ç»˜åˆ¶æ‰‡å½¢
            ctx.beginPath();
            ctx.moveTo(0, 0); // å¤ªé˜³ä½ç½®
            ctx.lineTo(point1.x, point1.y);
            ctx.arc(0, 0, Math.sqrt(point1.x*point1.x + point1.y*point1.y), 
                   Math.atan2(point1.y, point1.x), Math.atan2(point2.y, point2.x));
            ctx.lineTo(0, 0);
            
            // å¡«å……æ‰‡å½¢
            ctx.fillStyle = 'rgba(0, 255, 127, 0.4)';
            ctx.fill();
            
            // æ‰‡å½¢è¾¹æ¡†
            ctx.strokeStyle = '#00FF7F';
            ctx.lineWidth = 1;
            ctx.stroke();
            
            // é¢ç§¯æ ‡ç­¾
            ctx.fillStyle = '#00FF7F';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            
            // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼ˆæ‰‡å½¢ä¸­é—´ï¼‰
            const midAngle = (Math.atan2(point1.y, point1.x) + Math.atan2(point2.y, point2.x)) / 2;
            const labelRadius = Math.sqrt(point1.x*point1.x + point1.y*point1.y) * 0.6;
            const labelX = labelRadius * Math.cos(midAngle);
            const labelY = labelRadius * Math.sin(midAngle);
            
            ctx.fillText('é¢ç§¯ A', labelX, labelY);
        }
        
        // ç»˜åˆ¶å¼•åŠ›çŸ¢é‡
        function drawForceVector(planet) {
            // è®¡ç®—å¼•åŠ›æ–¹å‘ï¼ˆæŒ‡å‘å¤ªé˜³ï¼‰
            const dx = -planet.x;
            const dy = -planet.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            // å½’ä¸€åŒ–æ–¹å‘å‘é‡
            const dirX = dx / distance;
            const dirY = dy / distance;
            
            // è®¡ç®—åŠ›çš„å¤§å°ï¼ˆç”¨äºç®­å¤´é•¿åº¦ï¼‰
            const forceMagnitude = G * starMass * planetMass / (distance * distance);
            const arrowLength = Math.min(forceMagnitude * 50, 100);
            
            // ç»˜åˆ¶ç®­å¤´çº¿
            ctx.beginPath();
            ctx.moveTo(planet.x, planet.y);
            ctx.lineTo(planet.x + dirX * arrowLength, planet.y + dirY * arrowLength);
            ctx.strokeStyle = '#FF375F';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // ç»˜åˆ¶ç®­å¤´å¤´éƒ¨
            const headlen = 10;
            const angle = Math.atan2(dirY, dirX);
            
            ctx.beginPath();
            ctx.moveTo(planet.x + dirX * arrowLength, planet.y + dirY * arrowLength);
            ctx.lineTo(
                planet.x + dirX * arrowLength - headlen * Math.cos(angle - Math.PI/6),
                planet.y + dirY * arrowLength - headlen * Math.sin(angle - Math.PI/6)
            );
            ctx.lineTo(
                planet.x + dirX * arrowLength - headlen * Math.cos(angle + Math.PI/6),
                planet.y + dirY * arrowLength - headlen * Math.sin(angle + Math.PI/6)
            );
            ctx.closePath();
            ctx.fillStyle = '#FF375F';
            ctx.fill();
            
            // å¼•åŠ›æ ‡ç­¾
            ctx.fillStyle = '#FF375F';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            
            const labelX = planet.x + dirX * arrowLength / 2;
            const labelY = planet.y + dirY * arrowLength / 2;
            
            ctx.fillText('ä¸‡æœ‰å¼•åŠ›', labelX, labelY - 10);
        }
        
        // ç»˜åˆ¶å‘¨æœŸä¿¡æ¯ï¼ˆç¬¬ä¸‰å®šå¾‹ï¼‰
        function drawPeriodInfo(planet, index) {
            // åªæ˜¾ç¤ºå‰3ä¸ªè¡Œæ˜Ÿçš„å‘¨æœŸä¿¡æ¯
            if (index >= 3) return;
            
            const labelY = -250 + index * 30;
            
            ctx.fillStyle = planet.color;
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'left';
            
            // è¡Œæ˜Ÿæ ‡è¯†
            ctx.beginPath();
            ctx.arc(-300, labelY, 6, 0, Math.PI * 2);
            ctx
<!--æ£€æµ‹åˆ°ä»£ç æˆªæ–­ï¼Œè‡ªåŠ¨ç»­å†™ä¸­...-->
.fillStyle = planet.color;
            ctx.fill();
            
            // å‘¨æœŸä¿¡æ¯
            const periodRatio = Math.pow(planet.period / simulation.planets[0].period, 2);
            const axisRatio = Math.pow(planet.semiMajorAxis / simulation.planets[0].semiMajorAxis, 3);
            
            ctx.fillText(`è¡Œæ˜Ÿ${index+1}: TÂ²=${periodRatio.toFixed(2)}, aÂ³=${axisRatio.toFixed(2)}`, -285, labelY + 5);
            
            // æ˜¾ç¤ºç¬¬ä¸‰å®šå¾‹å…¬å¼
            if (index === 0) {
                ctx.fillStyle = '#FF8C00';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('å¼€æ™®å‹’ç¬¬ä¸‰å®šå¾‹: TÂ² âˆ aÂ³', 0, -280);
            }
        }
        
        // åŠ¨ç”»å¾ªç¯
        function animate() {
            if (simulation.running) {
                simulation.time += 0.05 * simulation.speed;
                
                // æ›´æ–°æ‰€æœ‰è¡Œæ˜Ÿä½ç½®
                simulation.planets.forEach(planet => {
                    updatePlanetPosition(planet, 0.05 * simulation.speed);
                });
            }
            
            draw();
            requestAnimationFrame(animate);
        }
        
        // åˆå§‹åŒ–
        function init() {
            initPlanet();
            animate();
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            setupEventListeners();
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // å®šå¾‹é€‰é¡¹å¡
            document.querySelectorAll('.law-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    document.querySelectorAll('.law-tab').forEach(t => t.classList.remove('active'));
                    
                    // æ·»åŠ activeç±»åˆ°å½“å‰é€‰é¡¹å¡
                    this.classList.add('active');
                    
                    // æ›´æ–°æ´»åŠ¨å®šå¾‹
                    simulation.activeLaw = this.getAttribute('data-law');
                });
            });
            
            // æ’­æ”¾/æš‚åœæŒ‰é’®
            document.getElementById('playPauseBtn').addEventListener('click', function() {
                simulation.running = !simulation.running;
                this.textContent = simulation.running ? 'æš‚åœ' : 'æ’­æ”¾';
            });
            
            // æ­¥è¿›æŒ‰é’®
            document.getElementById('stepBtn').addEventListener('click', function() {
                simulation.running = false;
                document.getElementById('playPauseBtn').textContent = 'æ’­æ”¾';
                
                // æ‰‹åŠ¨æ­¥è¿›
                simulation.planets.forEach(planet => {
                    updatePlanetPosition(planet, 0.05 * simulation.speed);
                });
                simulation.time += 0.05 * simulation.speed;
                draw();
            });
            
            // é‡ç½®æŒ‰é’®
            document.getElementById('resetBtn').addEventListener('click', function() {
                initPlanet();
                simulation.running = true;
                document.getElementById('playPauseBtn').textContent = 'æš‚åœ';
            });
            
            // æ·»åŠ å¯¹æ¯”è¡Œæ˜ŸæŒ‰é’®
            document.getElementById('addPlanetBtn').addEventListener('click', function() {
                if (simulation.planets.length < 5) {
                    addComparisonPlanet();
                } else {
                    alert('æœ€å¤šåªèƒ½æ·»åŠ 4ä¸ªå¯¹æ¯”è¡Œæ˜Ÿ');
                }
            });
            
            // é€Ÿåº¦æ»‘å—
            document.getElementById('speedSlider').addEventListener('input', function() {
                simulation.speed = parseFloat(this.value);
                document.getElementById('speedValue').textContent = this.value + 'x';
            });
            
            // æ’æ˜Ÿè´¨é‡æ»‘å—
            document.getElementById('starMassSlider').addEventListener('input', function() {
                starMass = parseFloat(this.value);
                document.getElementById('starMassValue').textContent = this.value + ' Mâ˜‰';
                initPlanet();
            });
            
            // è¡Œæ˜Ÿè´¨é‡æ»‘å—
            document.getElementById('planetMassSlider').addEventListener('input', function() {
                planetMass = parseFloat(this.value);
                document.getElementById('planetMassValue').textContent = this.value + ' MâŠ•';
            });
            
            // åŠé•¿è½´æ»‘å—
            document.getElementById('semiMajorAxisSlider').addEventListener('input', function() {
                semiMajorAxis = parseFloat(this.value);
                document.getElementById('semiMajorAxisValue').textContent = this.value;
                initPlanet();
            });
            
            // åå¿ƒç‡æ»‘å—
            document.getElementById('eccentricitySlider').addEventListener('input', function() {
                eccentricity = parseFloat(this.value);
                document.getElementById('eccentricityValue').textContent = this.value;
                initPlanet();
            });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', init);
    </script>
</body>
</html>