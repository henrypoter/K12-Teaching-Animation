<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœºæ¢°èƒ½å®ˆæ’ï¼šæ–œé¢-å°è½¦-åœ†å½¢è½¨é“å…¨è¿‡ç¨‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        header {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #2c3e50, #4a6491);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .left-panel {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .right-panel {
            flex: 2;
            min-width: 500px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .control-panel, .data-panel, .visualization-panel {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .panel-title {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #eaeaea;
            display: flex;
            align-items: center;
        }
        
        .panel-title i {
            margin-right: 10px;
            color: #3498db;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 4px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .value-display {
            min-width: 60px;
            text-align: center;
            padding: 5px 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .primary-btn {
            background-color: #3498db;
            color: white;
            flex: 1;
        }
        
        .primary-btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        .secondary-btn {
            background-color: #ecf0f1;
            color: #2c3e50;
            flex: 1;
        }
        
        .secondary-btn:hover {
            background-color: #d5dbdb;
        }
        
        .toggle-btn {
            background-color: #2ecc71;
            color: white;
        }
        
        .toggle-btn:hover {
            background-color: #27ae60;
        }
        
        .toggle-btn.off {
            background-color: #e74c3c;
        }
        
        .toggle-btn.off:hover {
            background-color: #c0392b;
        }
        
        .canvas-container {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            position: relative;
        }
        
        #mainCanvas {
            display: block;
            width: 100%;
            background-color: #f8f9fa;
        }
        
        .data-display {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .data-item {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .data-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        
        .data-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .data-unit {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-left: 3px;
        }
        
        .energy-bar-container {
            margin-top: 15px;
        }
        
        .energy-bar-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #444;
        }
        
        .energy-bar {
            height: 25px;
            background-color: #ecf0f1;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            margin-bottom: 5px;
        }
        
        .kinetic-bar {
            height: 100%;
            background-color: #e67e22;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .potential-bar {
            height: 100%;
            background-color: #3498db;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .total-energy-line {
            position: absolute;
            top: 0;
            height: 100%;
            width: 3px;
            background-color: #2ecc71;
            left: 0%;
            transition: left 0.3s ease;
        }
        
        .energy-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #7f8c8d;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }
        
        .kinetic-color {
            background-color: #e67e22;
        }
        
        .potential-color {
            background-color: #3498db;
        }
        
        .total-color {
            background-color: #2ecc71;
        }
        
        .status-panel {
            background-color: #fff8e1;
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
            border-left: 4px solid #f39c12;
        }
        
        .status-title {
            font-weight: 600;
            color: #d35400;
            margin-bottom: 5px;
        }
        
        .status-text {
            color: #7d6608;
        }
        
        footer {
            text-align: center;
            padding: 15px;
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        
        @media (max-width: 900px) {
            .main-content {
                flex-direction: column;
            }
            
            .left-panel, .right-panel {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>æœºæ¢°èƒ½å®ˆæ’å®šå¾‹</h1>
            <div class="subtitle">æ–œé¢-å°è½¦-åœ†å½¢è½¨é“å…¨è¿‡ç¨‹æ¨¡æ‹Ÿ</div>
        </header>
        
        <div class="main-content">
            <div class="left-panel">
                <div class="control-panel">
                    <div class="panel-title">
                        <i>âš™ï¸</i> å‚æ•°æ§åˆ¶
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">åˆå§‹é«˜åº¦ H: <span id="heightValue">2.5</span> m</label>
                        <div class="slider-container">
                            <input type="range" id="heightSlider" min="1.5" max="5" step="0.1" value="2.5">
                            <div class="value-display" id="heightDisplay">2.5 m</div>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">åœ†å½¢è½¨é“åŠå¾„ R: <span id="radiusValue">1.0</span> m</label>
                        <div class="slider-container">
                            <input type="range" id="radiusSlider" min="0.5" max="2.0" step="0.1" value="1.0">
                            <div class="value-display" id="radiusDisplay">1.0 m</div>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">é‡åŠ›åŠ é€Ÿåº¦ g: <span id="gravityValue">9.8</span> m/sÂ²</label>
                        <div class="slider-container">
                            <input type="range" id="gravitySlider" min="5" max="15" step="0.1" value="9.8">
                            <div class="value-display" id="gravityDisplay">9.8 m/sÂ²</div>
                        </div>
                    </div>
                    
                    <div class="button-group">
                        <button id="applyBtn" class="primary-btn">
                            <span>ğŸš€</span> åº”ç”¨å‚æ•°å¹¶é‡ç½®
                        </button>
                    </div>
                </div>
                
                <div class="control-panel">
                    <div class="panel-title">
                        <i>ğŸ®</i> åŠ¨ç”»æ§åˆ¶
                    </div>
                    
                    <div class="button-group">
                        <button id="startPauseBtn" class="primary-btn">
                            <span>â–¶ï¸</span> å¼€å§‹
                        </button>
                        <button id="resetBtn" class="secondary-btn">
                            <span>ğŸ”„</span> é‡ç½®
                        </button>
                        <button id="stepBtn" class="secondary-btn">
                            <span>â­ï¸</span> å•æ­¥
                        </button>
                    </div>
                    
                    <div class="control-group" style="margin-top: 15px;">
                        <label class="control-label">åŠ¨ç”»é€Ÿåº¦: <span id="speedValue">1.0</span>x</label>
                        <div class="slider-container">
                            <input type="range" id="speedSlider" min="0.1" max="3" step="0.1" value="1.0">
                            <div class="value-display" id="speedDisplay">1.0x</div>
                        </div>
                    </div>
                </div>
                
                <div class="data-panel">
                    <div class="panel-title">
                        <i>ğŸ“Š</i> å®æ—¶æ•°æ®
                    </div>
                    
                    <div class="data-display">
                        <div class="data-item">
                            <div class="data-label">é«˜åº¦ h</div>
                            <div class="data-value">2.50<span class="data-unit">m</span></div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">é€Ÿåº¦ v</div>
                            <div class="data-value">0.00<span class="data-unit">m/s</span></div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">åŠ¨èƒ½ Ek</div>
                            <div class="data-value">0.00<span class="data-unit">J</span></div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">åŠ¿èƒ½ Ep</div>
                            <div class="data-value">24.50<span class="data-unit">J</span></div>
                        </div>
                    </div>
                    
                    <div class="energy-bar-container">
                        <div class="energy-bar-title">èƒ½é‡åˆ†å¸ƒ (æ€»æœºæ¢°èƒ½: <span id="totalEnergyValue">24.50</span> J)</div>
                        <div class="energy-bar">
                            <div class="kinetic-bar" id="kineticBar"></div>
                            <div class="potential-bar" id="potentialBar"></div>
                            <div class="total-energy-line" id="totalEnergyLine"></div>
                        </div>
                        <div class="energy-labels">
                            <div>0 J</div>
                            <div id="maxEnergyLabel">24.5 J</div>
                        </div>
                    </div>
                    
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color kinetic-color"></div>
                            <div>åŠ¨èƒ½ Ek</div>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color potential-color"></div>
                            <div>åŠ¿èƒ½ Ep</div>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color total-color"></div>
                            <div>æ€»æœºæ¢°èƒ½ E</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="right-panel">
                <div class="canvas-container">
                    <canvas id="mainCanvas" width="800" height="500"></canvas>
                </div>
                
                <div class="visualization-panel">
                    <div class="panel-title">
                        <i>ğŸ“ˆ</i> å¯è§†åŒ–é€‰é¡¹
                    </div>
                    
                    <div class="button-group">
                        <button id="toggleDataBtn" class="toggle-btn">
                            <span>âœ…</span> å®æ—¶æ•°æ®
                        </button>
                        <button id="toggleBarsBtn" class="toggle-btn">
                            <span>âœ…</span> èƒ½é‡æŸ±çŠ¶å›¾
                        </button>
                        <button id="toggleTrajectoryBtn" class="toggle-btn off">
                            <span>âŒ</span> è¿åŠ¨è½¨è¿¹
                        </button>
                        <button id="toggleVectorsBtn" class="toggle-btn off">
                            <span>âŒ</span> é€Ÿåº¦çŸ¢é‡
                        </button>
                    </div>
                    
                    <div class="status-panel" id="statusPanel">
                        <div class="status-title">ç³»ç»ŸçŠ¶æ€</div>
                        <div class="status-text" id="statusText">å‡†å¤‡å°±ç»ªã€‚ç‚¹å‡»"å¼€å§‹"æŒ‰é’®è§‚å¯Ÿæœºæ¢°èƒ½å®ˆæ’è¿‡ç¨‹ã€‚</div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>ç‰©ç†æ•™å­¦åŠ¨ç”» | æœºæ¢°èƒ½å®ˆæ’å®šå¾‹ï¼šE = Ek + Ep = å¸¸æ•° | è®¾è®¡ï¼šæ•™è‚²æŠ€æœ¯ä¸“å®¶</p>
        </footer>
    </div>

    <script>
        // è·å–Canvaså’Œä¸Šä¸‹æ–‡
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        
        // ç‰©ç†å‚æ•°
        let H = 2.5;      // åˆå§‹é«˜åº¦ (m)
        let R = 1.0;      // åœ†å½¢è½¨é“åŠå¾„ (m)
        let g = 9.8;      // é‡åŠ›åŠ é€Ÿåº¦ (m/sÂ²)
        let m = 1.0;      // å°è½¦è´¨é‡ (kg) - å›ºå®šä¸º1ç®€åŒ–è®¡ç®—
        
        // åŠ¨ç”»çŠ¶æ€
        let animationId = null;
        let isPlaying = false;
        let animationSpeed = 1.0;
        let time = 0;
        
        // å°è½¦çŠ¶æ€
        let car = {
            x: 0,
            y: 0,
            vx: 0,
            vy: 0,
            angle: 0, // åœ¨åœ†å½¢è½¨é“ä¸Šçš„è§’åº¦
            onIncline: true, // æ˜¯å¦åœ¨æ–œé¢ä¸Š
            onCircle: false, // æ˜¯å¦åœ¨åœ†å½¢è½¨é“ä¸Š
            finished: false, // æ˜¯å¦å®Œæˆè¿åŠ¨
            trajectory: [] // è¿åŠ¨è½¨è¿¹ç‚¹
        };
        
        // å¯è§†åŒ–é€‰é¡¹
        let showData = true;
        let showBars = true;
        let showTrajectory = false;
        let showVectors = false;
        
        // æ–œé¢å‚æ•°
        const inclineLength = 300;
        const inclineAngle = Math.PI / 6; // 30åº¦
        const carSize = 20;
        
        // è®¡ç®—åˆå§‹ä½ç½®
        function initializeCar() {
            // æ–œé¢èµ·ç‚¹
            const startX = 100;
            const startY = canvas.height - 100;
            
            // æ ¹æ®é«˜åº¦Hè®¡ç®—æ–œé¢é•¿åº¦
            const inclineHeight = H * 50; // ç¼©æ”¾å› å­ï¼š1m = 50åƒç´ 
            const actualInclineLength = inclineHeight / Math.sin(inclineAngle);
            
            // å°è½¦åˆå§‹ä½ç½®ï¼ˆæ–œé¢é¡¶ç«¯ï¼‰
            car.x = startX;
            car.y = startY - inclineHeight;
            car.vx = 0;
            car.vy = 0;
            car.angle = 0;
            car.onIncline = true;
            car.onCircle = false;
            car.finished = false;
            car.trajectory = [{x: car.x, y: car.y}];
            
            time = 0;
            
            // æ›´æ–°æ•°æ®æ˜¾ç¤º
            updateDataDisplay();
        }
        
        // æ›´æ–°æ•°æ®æ˜¾ç¤º
        function updateDataDisplay() {
            // è®¡ç®—å½“å‰é«˜åº¦ï¼ˆç›¸å¯¹äºå‚è€ƒå¹³é¢ï¼‰
            let currentHeight;
            if (car.onIncline) {
                // åœ¨æ–œé¢ä¸Š
                const startY = canvas.height - 100;
                currentHeight = (startY - car.y) / 50; // è½¬æ¢ä¸ºç±³
            } else if (car.onCircle) {
                // åœ¨åœ†å½¢è½¨é“ä¸Š
                const circleCenterY = canvas.height - 100 - R * 50;
                currentHeight = (circleCenterY + R * 50 * Math.cos(car.angle)) / 50;
            } else {
                // å·²å®Œæˆæˆ–è„±è½¨
                currentHeight = car.y / 50;
            }
            
            // è®¡ç®—é€Ÿåº¦å¤§å°
            const speed = Math.sqrt(car.vx * car.vx + car.vy * car.vy);
            
            // è®¡ç®—åŠ¨èƒ½å’ŒåŠ¿èƒ½
            const Ek = 0.5 * m * speed * speed;
            const Ep = m * g * currentHeight;
            const E = Ek + Ep;
            
            // æ›´æ–°æ•°æ®é¢æ¿
            document.querySelector('.data-item:nth-child(1) .data-value').innerHTML = 
                currentHeight.toFixed(2) + '<span class="data-unit">m</span>';
            document.querySelector('.data-item:nth-child(2) .data-value').innerHTML = 
                speed.toFixed(2) + '<span class="data-unit">m/s</span>';
            document.querySelector('.data-item:nth-child(3) .data-value').innerHTML = 
                Ek.toFixed(2) + '<span class="data-unit">J</span>';
            document.querySelector('.data-item:nth-child(4) .data-value').innerHTML = 
                Ep.toFixed(2) + '<span class="data-unit">J</span>';
            
            // æ›´æ–°èƒ½é‡æŸ±çŠ¶å›¾
            const totalEnergy = m * g * H; // åˆå§‹æ€»æœºæ¢°èƒ½
            document.getElementById('totalEnergyValue').textContent = totalEnergy.toFixed(2);
            document.getElementById('maxEnergyLabel').textContent = totalEnergy.toFixed(1) + ' J';
            
            const kineticPercent = (Ek / totalEnergy) * 100;
            const potentialPercent = (Ep / totalEnergy) * 100;
            
            document.getElementById('kineticBar').style.width = kineticPercent + '%';
            document.getElementById('potentialBar').style.width = potentialPercent + '%';
            document.getElementById('totalEnergyLine').style.left = '100%';
            
            // æ›´æ–°çŠ¶æ€é¢æ¿
            updateStatusPanel(speed, currentHeight, Ek, Ep, E);
        }
        
        // æ›´æ–°çŠ¶æ€é¢æ¿
        function updateStatusPanel(speed, height, Ek, Ep, E) {
            const statusPanel = document.getElementById('statusPanel');
            const statusText = document.getElementById('statusText');
            
            if (car.finished) {
                statusPanel.style.backgroundColor = '#e8f5e9';
                statusPanel.style.borderLeftColor = '#2ecc71';
                statusText.innerHTML = `âœ… è¿åŠ¨å®Œæˆï¼æœ€ç»ˆé€Ÿåº¦: ${speed.toFixed(2)} m/s<br>
                                        æœºæ¢°èƒ½å®ˆæ’éªŒè¯: åˆå§‹E = ${(m*g*H).toFixed(2)} J, æœ€ç»ˆE = ${E.toFixed(2)} J`;
                return;
            }
            
            if (car.onIncline) {
                statusPanel.style.backgroundColor = '#fff8e1';
                statusPanel.style.borderLeftColor = '#f39c12';
                statusText.innerHTML = `ğŸ“‰ æ–œé¢ä¸‹æ»‘é˜¶æ®µ: åŠ¿èƒ½è½¬åŒ–ä¸ºåŠ¨èƒ½<br>
                                        å½“å‰: Ek = ${Ek.toFixed(2)} J, Ep = ${Ep.toFixed(2)} J, E = ${E.toFixed(2)} J`;
            } else if (car.onCircle) {
                // æ£€æŸ¥æ˜¯å¦èƒ½é€šè¿‡æœ€é«˜ç‚¹
                const criticalSpeed = Math.sqrt(g * R);
                const currentSpeed = speed;
                
                if (car.angle > Math.PI/2 && car.angle < 3*Math.PI/2) {
                    // åœ¨ä¸ŠåŠåœ†
                    if (currentSpeed < criticalSpeed * 0.8) {
                        statusPanel.style.backgroundColor = '#ffebee';
                        statusPanel.style.borderLeftColor = '#e74c3c';
                        statusText.innerHTML = `âš ï¸ åœ†å½¢è½¨é“ä¸ŠåŠéƒ¨åˆ†: é€Ÿåº¦è¾ƒä½ (${currentSpeed.toFixed(2)} m/s)<br>
                                                ä¸´ç•Œé€Ÿåº¦: ${criticalSpeed.toFixed(2)} m/s | å¯èƒ½éœ€è¦å¤–åŠ›æ‰èƒ½é€šè¿‡æœ€é«˜ç‚¹`;
                    } else if (currentSpeed < criticalSpeed) {
                        statusPanel.style.backgroundColor = '#fff3e0';
                        statusPanel.style.borderLeftColor = '#f39c12';
                        statusText.innerHTML = `âš ï¸ åœ†å½¢è½¨é“ä¸ŠåŠéƒ¨åˆ†: æ¥è¿‘ä¸´ç•Œé€Ÿåº¦ (${currentSpeed.toFixed(2)} m/s)<br>
                                                ä¸´ç•Œé€Ÿåº¦: ${criticalSpeed.toFixed(2)} m/s | æ°å¥½é€šè¿‡æœ€é«˜ç‚¹æ—¶é€Ÿåº¦ä¸ºä¸´ç•Œå€¼`;
                    } else {
                        statusPanel.style.backgroundColor = '#e8f5e9';
                        statusPanel.style.borderLeftColor = '#2ecc71';
                        statusText.innerHTML = `âœ… åœ†å½¢è½¨é“ä¸ŠåŠéƒ¨åˆ†: é€Ÿåº¦è¶³å¤Ÿ (${currentSpeed.toFixed(2)} m/s)<br>
                                                ä¸´ç•Œé€Ÿåº¦: ${criticalSpeed.toFixed(2)} m/s | å¯ä»¥é¡ºåˆ©é€šè¿‡æœ€é«˜ç‚¹`;
                    }
                } else {
                    // åœ¨ä¸‹åŠåœ†
                    statusPanel.style.backgroundColor = '#e3f2fd';
                    statusPanel.style.borderLeftColor = '#3498db';
                    statusText.innerHTML = `ğŸ”„ åœ†å½¢è½¨é“ä¸‹åŠéƒ¨åˆ†: åŠ¨èƒ½ä¸åŠ¿èƒ½ç›¸äº’è½¬åŒ–<br>
                                            å½“å‰: Ek = ${Ek.toFixed(2)} J, Ep = ${Ep.toFixed(2)} J`;
                }
            }
        }
        
        // ç»˜åˆ¶åœºæ™¯
        function drawScene() {
            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶å‚è€ƒå¹³é¢ï¼ˆåœ°é¢ï¼‰
            ctx.beginPath();
            ctx.moveTo(0, canvas.height - 100);
            ctx.lineTo(canvas.width, canvas.height - 100);
            ctx.strokeStyle = '#95a5a6';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // ç»˜åˆ¶æ–œé¢
            const startX = 100;
            const startY = canvas.height - 100;
            const inclineHeight = H * 50; // ç¼©æ”¾å› å­
            const actualInclineLength = inclineHeight / Math.sin(inclineAngle);
            
            ctx.beginPath();
            ctx.moveTo(startX, startY);
            ctx.lineTo(startX + actualInclineLength * Math.cos(inclineAngle), startY - inclineHeight);
            ctx.strokeStyle = '#34495e';
            ctx.lineWidth = 4;
            ctx.stroke();
            
            // ç»˜åˆ¶åœ†å½¢è½¨é“
            const circleCenterX = startX + actualInclineLength * Math.cos(inclineAngle);
            const circleCenterY = startY - inclineHeight;
            
            ctx.beginPath();
            ctx.arc(circleCenterX, circleCenterY, R * 50, Math.PI, 2 * Math.PI);
            ctx.strokeStyle = '#8e44ad';
            ctx.lineWidth = 4;
            ctx.stroke();
            
            // æ ‡è®°åœ†å½¢è½¨é“æœ€é«˜ç‚¹å’Œæœ€ä½ç‚¹
            ctx.fillStyle = '#8e44ad';
            ctx.beginPath();
            ctx.arc(circleCenterX, circleCenterY - R * 50, 5, 0, 2 * Math.PI); // æœ€é«˜ç‚¹
            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(circleCenterX, circleCenterY, 5, 0, 2 * Math.PI); // æœ€ä½ç‚¹
            ctx.fill();
            
            // ç»˜åˆ¶é«˜åº¦æ ‡è®°
            ctx.strokeStyle = '#7f8c8d';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(startX, startY);
            ctx.lineTo(startX, startY - inclineHeight);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // ç»˜åˆ¶é«˜åº¦æ ‡ç­¾
            ctx.fillStyle = '#2c3e50';
            ctx.font = '14px Arial';
            ctx.fillText(`H = ${H.toFixed(1)} m`, startX - 40, startY - inclineHeight / 2);
            
            // ç»˜åˆ¶åŠå¾„æ ‡è®°
            ctx.strokeStyle = '#7f8c8d';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(circleCenterX, circleCenterY);
            ctx.lineTo(circleCenterX, circleCenterY - R * 50);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // ç»˜åˆ¶åŠå¾„æ ‡ç­¾
            ctx.fillText(`R = ${R.toFixed(1)} m`, circleCenterX + 10, circleCenterY - R * 25);
            
            // ç»˜åˆ¶è¿åŠ¨è½¨è¿¹ï¼ˆå¦‚æœå¯ç”¨ï¼‰
            if (showTrajectory && car.trajectory.length > 1) {
                ctx.beginPath();
                ctx.moveTo(car.trajectory[0].x, car.trajectory[0].y);
                
                for (let i = 1; i < car.trajectory.length; i++) {
                    ctx.lineTo(car.trajectory[i].x, car.trajectory[i].y);
                }
                
                ctx.strokeStyle = 'rgba(231, 76, 60, 0.6)';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
            
            // ç»˜åˆ¶å°è½¦
            drawCar();
            
            // ç»˜åˆ¶é€Ÿåº¦çŸ¢é‡ï¼ˆå¦‚æœå¯ç”¨ï¼‰
            if (showVectors && (car.vx !== 0 || car.vy !== 0)) {
                const speed = Math.sqrt(car.vx * car.vx + car.vy * car.vy);
                const scale = 10; // çŸ¢é‡ç¼©æ”¾å› å­
                
                ctx.beginPath();
                ctx.moveTo(car.x, car.y);
                ctx.lineTo(car.x + car.vx * scale, car.y + car.vy * scale);
                ctx.strokeStyle = '#e74c3c';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // ç»˜åˆ¶ç®­å¤´
                const angle = Math.atan2(car.vy, car.vx);
                const arrowLength = 8;
                
                ctx.beginPath();
                ctx.moveTo(car.x + car.vx * scale, car.y + car.vy * scale);
                ctx.lineTo(
                    car.x + car.vx * scale - arrowLength * Math.cos(angle - Math.PI/6),
                    car.y + car.vy * scale - arrowLength * Math.sin(angle - Math.PI/6)
                );
                ctx.moveTo(car.x + car.vx * scale, car.y + car.vy * scale);
                ctx.lineTo(
                    car.x + car.vx * scale - arrowLength * Math.cos(angle + Math.PI/6),
                    car.y + car.vy * scale - arrowLength * Math.sin(angle + Math.PI/6)
                );
                ctx.stroke();
                
                // é€Ÿåº¦å€¼æ ‡ç­¾
                ctx.fillStyle = '#e74c3c';
                ctx.font = '12px Arial';
                ctx.fillText(`v = ${speed.toFixed(2)} m/s`, car.x + car.vx * scale + 10, car.y + car.vy * scale - 10);
            }
            
            // ç»˜åˆ¶èƒ½é‡æ ‡ç­¾
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 16px Arial';
            ctx.fillText('æœºæ¢°èƒ½å®ˆæ’: E = Ek + Ep = å¸¸æ•°', canvas.width / 2 - 150, 30);
            
            // ç»˜åˆ¶å›¾ä¾‹
            ctx.font = '14px Arial';
            ctx.fillStyle = '#e67e22';
            ctx.fillRect(canvas.width - 200, 50, 15, 15);
            ctx.fillStyle = '#2c3e50';
            ctx.fillText('åŠ¨èƒ½ Ek', canvas.width - 180, 62);
            
            ctx.fillStyle = '#3498db';
            ctx.fillRect(canvas.width - 200, 75, 15, 15);
            ctx.fillStyle = '#2c3e50';
            ctx.fillText('åŠ¿èƒ½ Ep', canvas.width - 180, 87);
            
            ctx.fillStyle = '#2ecc71';
            ctx.fillRect(canvas.width - 200, 100, 15, 15);
            ctx.fillStyle = '#2c3e50';
            ctx.fillText('æ€»æœºæ¢°èƒ½ E', canvas.width - 180, 112);
        }
        
        // ç»˜åˆ¶å°è½¦
        function drawCar() {
            // æ ¹æ®é€Ÿåº¦æ”¹å˜å°è½¦é¢œè‰²ï¼ˆé€Ÿåº¦è¶Šå¿«è¶Šçº¢ï¼‰
            const speed = Math.sqrt(car.vx * car.vx + car.vy * car.vy);
            const maxSpeed = Math.sqrt(2 * g * H); // æœ€å¤§å¯èƒ½é€Ÿåº¦
            const colorIntensity = Math.min(255, Math.floor(150 + (speed / maxSpeed) * 105));
            
            ctx.fillStyle = `rgb(231, ${Math.max(50, 255 - colorIntensity)}, 60)`;
            
            // ç»˜åˆ¶å°è½¦ä¸»ä½“
            ctx.beginPath();
            ctx.rect(car.x - carSize/2, car.y - carSize/2, carSize, carSize);
            ctx.fill();
            
            // ç»˜åˆ¶å°è½¦è½®å»“
            ctx.strokeStyle = '#2c3e50';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // ç»˜åˆ¶å°è½¦æ–¹å‘æŒ‡ç¤ºå™¨
            ctx.fillStyle = '#2c3e50';
            ctx.beginPath();
            ctx.moveTo(car.x + carSize/4, car.y);
            ctx.lineTo(car.x + carSize/2, car.y - carSize/4);
            ctx.lineTo(car.x + carSize/2, car.y + carSize/4);
            ctx.closePath();
            ctx.fill();
            
            // ç»˜åˆ¶è½¦è½®
            ctx.fillStyle = '#2c3e50';
            ctx.beginPath();
            ctx.arc(car.x - carSize/4, car.y - carSize/2, 4, 0, 2 * Math.PI);
            ctx.arc(car.x + carSize/4, car.y - carSize/2, 4, 0, 2 * Math.PI);
            ctx.arc(car.x - carSize/4, car.y + carSize/2, 4, 0, 2 * Math.PI);
            ctx.arc(car.x + carSize/4, car.y + carSize/2, 4, 0, 2 * Math.PI);
            ctx.fill();
        }
        
        // æ›´æ–°ç‰©ç†çŠ¶æ€
        function updatePhysics(deltaTime) {
            if (car.finished) return;
            
            // åº”ç”¨åŠ¨ç”»é€Ÿåº¦
            deltaTime *= animationSpeed;
            time += deltaTime;
            
            // è®°å½•è½¨è¿¹ç‚¹ï¼ˆæ¯0.1ç§’è®°å½•ä¸€æ¬¡ï¼‰
            if (time % 0.1 < deltaTime) {
                car.trajectory.push({x: car.x, y: car.y});
                
                // é™åˆ¶è½¨è¿¹ç‚¹æ•°é‡
                if (car.trajectory.length > 100) {
                    car.trajectory.shift();
                }
            }
            
            // æ–œé¢èµ·ç‚¹å’Œåœ†å½¢è½¨é“ä¸­å¿ƒ
            const startX = 100;
            const startY = canvas.height - 100;
            const inclineHeight = H * 50;
            const actualInclineLength = inclineHeight / Math.sin(inclineAngle);
            const circleCenterX = startX + actualInclineLength * Math.cos(inclineAngle);
            const circleCenterY = startY - inclineHeight;
            
            if (car.onIncline) {
                // åœ¨æ–œé¢ä¸Šè¿åŠ¨
                const distanceOnIncline = 0.5 * g * time * time * 50; // è½¬æ¢ä¸ºåƒç´ 
                
                if (distanceOnIncline < actualInclineLength) {
                    // ä»åœ¨æ–œé¢ä¸Š
                    car.x = startX + distanceOnIncline * Math.cos(inclineAngle);
                    car.y = startY - distanceOnIncline * Math.sin(inclineAngle);
                    
                    const velocity = g * time * 50; // è½¬æ¢ä¸ºåƒç´ /ç§’
                    car.vx = velocity * Math.cos(inclineAngle);
                    car.vy = -velocity * Math.sin(inclineAngle);
                } else {
                    // åˆ°è¾¾æ–œé¢åº•ç«¯ï¼Œè¿›å…¥åœ†å½¢è½¨é“
                    car.onIncline = false;
                    car.onCircle = true;
                    car.angle = Math.PI; // ä»åœ†å½¢è½¨é“æœ€å·¦ä¾§å¼€å§‹ï¼ˆÏ€å¼§åº¦ï¼‰
                    time = 0; // é‡ç½®åœ†å½¢è½¨é“è¿åŠ¨æ—¶é—´
                }
            } else if (car.onCircle) {
                // åœ¨åœ†å½¢è½¨é“ä¸Šè¿åŠ¨
                // è®¡ç®—è¿›å…¥åœ†å½¢è½¨é“æ—¶çš„é€Ÿåº¦
                const entrySpeed = Math.sqrt(2 * g * H) * 50; // è½¬æ¢ä¸ºåƒç´ /ç§’
                
                // è®¡ç®—è§’é€Ÿåº¦
                const omega = entrySpeed / (R * 50);
                
                // æ›´æ–°è§’åº¦
                car.angle = Math.PI + omega * time;
                
                // è®¡ç®—ä½ç½®
                car.x = circleCenterX + R * 50 * Math.cos(car.angle);
                car.y = circleCenterY + R * 50 * Math.sin(car.angle);
                
                // è®¡ç®—é€Ÿåº¦åˆ†é‡
                const tangentialSpeed = entrySpeed; // åœ¨æ— èƒ½é‡æŸå¤±çš„æƒ…å†µä¸‹ï¼Œé€Ÿåº¦å¤§å°ä¸å˜ï¼Ÿ
                // å®é™…ä¸Šï¼Œåœ¨åœ†å½¢è½¨é“ä¸Šé€Ÿåº¦ä¼šå˜åŒ–ï¼Œä½†è¿™é‡Œç®€åŒ–å¤„ç†
                // æ›´ç²¾ç¡®çš„æ¨¡æ‹Ÿéœ€è¦è€ƒè™‘å‘å¿ƒåŠ›å’Œé‡åŠ›åˆ†é‡
                
                // ç®€åŒ–æ¨¡å‹ï¼šé€Ÿåº¦æ–¹å‘æ²¿åˆ‡çº¿æ–¹å‘ï¼Œå¤§å°æ ¹æ®èƒ½é‡å®ˆæ’è®¡ç®—
                const currentHeight = (circleCenterY + R * 50 * Math.cos(car.angle)) / 50;
                const currentSpeed = Math.sqrt(2 * g * (H - currentHeight +
<!--æ£€æµ‹åˆ°ä»£ç æˆªæ–­ï¼Œè‡ªåŠ¨ç»­å†™ä¸­...-->
R)) * 50; // æ ¹æ®èƒ½é‡å®ˆæ’è®¡ç®—å½“å‰é€Ÿåº¦
                
                // é€Ÿåº¦æ–¹å‘æ²¿åˆ‡çº¿æ–¹å‘ï¼ˆå‚ç›´äºåŠå¾„æ–¹å‘ï¼‰
                const tangentAngle = car.angle + Math.PI/2;
                car.vx = currentSpeed * Math.cos(tangentAngle);
                car.vy = currentSpeed * Math.sin(tangentAngle);
                
                // æ£€æŸ¥æ˜¯å¦å®Œæˆåœ†å½¢è½¨é“ï¼ˆè§’åº¦è¶…è¿‡2Ï€ï¼‰
                if (car.angle >= 2 * Math.PI) {
                    car.onCircle = false;
                    car.finished = true;
                    
                    // è®¡ç®—æœ€ç»ˆæ°´å¹³é€Ÿåº¦
                    const finalSpeed = Math.sqrt(2 * g * H) * 50;
                    car.vx = finalSpeed;
                    car.vy = 0;
                }
                
                // æ£€æŸ¥æ˜¯å¦ä»è½¨é“è„±è½ï¼ˆå¦‚æœé«˜åº¦ä¸è¶³ï¼‰
                const criticalHeight = 2.5 * R; // æ°å¥½é€šè¿‡æœ€é«˜ç‚¹æ‰€éœ€çš„æœ€å°é«˜åº¦
                if (H < criticalHeight && car.angle > Math.PI/2 && car.angle < 3*Math.PI/2) {
                    // ä»è½¨é“è„±è½ï¼ŒåšæŠ›ä½“è¿åŠ¨
                    car.onCircle = false;
                    car.finished = false;
                    
                    // è®°å½•è„±è½æ—¶çš„çŠ¶æ€
                    const fallTime = 0;
                    const fallX = car.x;
                    const fallY = car.y;
                    const fallVx = car.vx;
                    const fallVy = car.vy;
                    
                    // æ›´æ–°çŠ¶æ€ä¸ºæŠ›ä½“è¿åŠ¨
                    setTimeout(() => {
                        car.x = fallX + fallVx * fallTime;
                        car.y = fallY + fallVy * fallTime + 0.5 * g * 50 * fallTime * fallTime;
                        car.vx = fallVx;
                        car.vy = fallVy + g * 50 * fallTime;
                    }, 0);
                }
            } else if (!car.finished) {
                // æŠ›ä½“è¿åŠ¨ï¼ˆå¦‚æœä»è½¨é“è„±è½ï¼‰
                car.x += car.vx * deltaTime;
                car.y += car.vy * deltaTime + 0.5 * g * 50 * deltaTime * deltaTime;
                car.vy += g * 50 * deltaTime;
                
                // æ£€æŸ¥æ˜¯å¦è½åœ°
                if (car.y > canvas.height - 100 - carSize/2) {
                    car.y = canvas.height - 100 - carSize/2;
                    car.finished = true;
                    car.vx = 0;
                    car.vy = 0;
                }
            }
            
            // æ›´æ–°æ•°æ®æ˜¾ç¤º
            updateDataDisplay();
        }
        
        // åŠ¨ç”»å¾ªç¯
        function animate() {
            const currentTime = Date.now();
            if (!lastTime) lastTime = currentTime;
            const deltaTime = (currentTime - lastTime) / 1000; // è½¬æ¢ä¸ºç§’
            lastTime = currentTime;
            
            updatePhysics(deltaTime);
            drawScene();
            
            if (isPlaying) {
                animationId = requestAnimationFrame(animate);
            }
        }
        
        let lastTime = null;
        
        // åˆå§‹åŒ–
        function init() {
            initializeCar();
            drawScene();
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            setupEventListeners();
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // é«˜åº¦æ»‘å—
            const heightSlider = document.getElementById('heightSlider');
            const heightValue = document.getElementById('heightValue');
            const heightDisplay = document.getElementById('heightDisplay');
            
            heightSlider.addEventListener('input', function() {
                H = parseFloat(this.value);
                heightValue.textContent = H.toFixed(1);
                heightDisplay.textContent = H.toFixed(1) + ' m';
            });
            
            // åŠå¾„æ»‘å—
            const radiusSlider = document.getElementById('radiusSlider');
            const radiusValue = document.getElementById('radiusValue');
            const radiusDisplay = document.getElementById('radiusDisplay');
            
            radiusSlider.addEventListener('input', function() {
                R = parseFloat(this.value);
                radiusValue.textContent = R.toFixed(1);
                radiusDisplay.textContent = R.toFixed(1) + ' m';
            });
            
            // é‡åŠ›æ»‘å—
            const gravitySlider = document.getElementById('gravitySlider');
            const gravityValue = document.getElementById('gravityValue');
            const gravityDisplay = document.getElementById('gravityDisplay');
            
            gravitySlider.addEventListener('input', function() {
                g = parseFloat(this.value);
                gravityValue.textContent = g.toFixed(1);
                gravityDisplay.textContent = g.toFixed(1) + ' m/sÂ²';
            });
            
            // é€Ÿåº¦æ»‘å—
            const speedSlider = document.getElementById('speedSlider');
            const speedValue = document.getElementById('speedValue');
            const speedDisplay = document.getElementById('speedDisplay');
            
            speedSlider.addEventListener('input', function() {
                animationSpeed = parseFloat(this.value);
                speedValue.textContent = animationSpeed.toFixed(1);
                speedDisplay.textContent = animationSpeed.toFixed(1) + 'x';
            });
            
            // åº”ç”¨å‚æ•°æŒ‰é’®
            document.getElementById('applyBtn').addEventListener('click', function() {
                if (isPlaying) {
                    toggleAnimation();
                }
                initializeCar();
                drawScene();
            });
            
            // å¼€å§‹/æš‚åœæŒ‰é’®
            document.getElementById('startPauseBtn').addEventListener('click', toggleAnimation);
            
            // é‡ç½®æŒ‰é’®
            document.getElementById('resetBtn').addEventListener('click', function() {
                if (isPlaying) {
                    toggleAnimation();
                }
                initializeCar();
                drawScene();
            });
            
            // å•æ­¥æŒ‰é’®
            document.getElementById('stepBtn').addEventListener('click', function() {
                if (isPlaying) {
                    toggleAnimation();
                }
                updatePhysics(0.05); // å•æ­¥å‰è¿›0.05ç§’
                drawScene();
            });
            
            // åˆ‡æ¢æŒ‰é’®
            document.getElementById('toggleDataBtn').addEventListener('click', function() {
                showData = !showData;
                const dataPanel = document.querySelector('.data-panel');
                dataPanel.style.display = showData ? 'block' : 'none';
                this.classList.toggle('off', !showData);
                this.innerHTML = showData ? '<span>âœ…</span> å®æ—¶æ•°æ®' : '<span>âŒ</span> å®æ—¶æ•°æ®';
            });
            
            document.getElementById('toggleBarsBtn').addEventListener('click', function() {
                showBars = !showBars;
                const barsContainer = document.querySelector('.energy-bar-container');
                barsContainer.style.display = showBars ? 'block' : 'none';
                this.classList.toggle('off', !showBars);
                this.innerHTML = showBars ? '<span>âœ…</span> èƒ½é‡æŸ±çŠ¶å›¾' : '<span>âŒ</span> èƒ½é‡æŸ±çŠ¶å›¾';
            });
            
            document.getElementById('toggleTrajectoryBtn').addEventListener('click', function() {
                showTrajectory = !showTrajectory;
                this.classList.toggle('off', !showTrajectory);
                this.innerHTML = showTrajectory ? '<span>âœ…</span> è¿åŠ¨è½¨è¿¹' : '<span>âŒ</span> è¿åŠ¨è½¨è¿¹';
                drawScene();
            });
            
            document.getElementById('toggleVectorsBtn').addEventListener('click', function() {
                showVectors = !showVectors;
                this.classList.toggle('off', !showVectors);
                this.innerHTML = showVectors ? '<span>âœ…</span> é€Ÿåº¦çŸ¢é‡' : '<span>âŒ</span> é€Ÿåº¦çŸ¢é‡';
                drawScene();
            });
        }
        
        // åˆ‡æ¢åŠ¨ç”»çŠ¶æ€
        function toggleAnimation() {
            isPlaying = !isPlaying;
            const btn = document.getElementById('startPauseBtn');
            
            if (isPlaying) {
                btn.innerHTML = '<span>â¸ï¸</span> æš‚åœ';
                lastTime = Date.now();
                animationId = requestAnimationFrame(animate);
            } else {
                btn.innerHTML = '<span>â–¶ï¸</span> ç»§ç»­';
                if (animationId) {
                    cancelAnimationFrame(animationId);
                }
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', init);
        
        // çª—å£å¤§å°è°ƒæ•´æ—¶é‡æ–°è°ƒæ•´Canvaså¤§å°
        window.addEventListener('resize', function() {
            const container = document.querySelector('.canvas-container');
            canvas.width = container.clientWidth;
            canvas.height = 500;
            drawScene();
        });
    </script>
</body>
</html>