<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç„¦è€³å®šå¾‹å¾®è§‚è§£é‡Šæ•™å­¦åŠ¨ç”»</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0a1929 0%, #1a2b3c 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        header {
            text-align: center;
            padding: 20px;
            background: rgba(16, 36, 64, 0.8);
            border-radius: 15px;
            border: 1px solid rgba(64, 156, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #4a9eff;
            margin-bottom: 10px;
            font-size: 2.2em;
            text-shadow: 0 2px 8px rgba(74, 158, 255, 0.4);
        }

        .subtitle {
            color: #a0c8ff;
            font-size: 1.1em;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.5;
        }

        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .simulation-area {
            flex: 3;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .view-container {
            background: rgba(16, 36, 64, 0.8);
            border-radius: 15px;
            border: 1px solid rgba(64, 156, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            position: relative;
        }

        #macroCanvas, #microCanvas {
            display: block;
            width: 100%;
            background: transparent;
        }

        .view-tabs {
            display: flex;
            background: rgba(12, 28, 50, 0.9);
            border-bottom: 1px solid rgba(64, 156, 255, 0.3);
        }

        .view-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: transparent;
            border: none;
            color: #a0c8ff;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-tab:hover {
            background: rgba(64, 156, 255, 0.1);
        }

        .view-tab.active {
            background: rgba(74, 158, 255, 0.2);
            color: #4a9eff;
            font-weight: 600;
            border-bottom: 2px solid #4a9eff;
        }

        .control-panel {
            flex: 2;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel {
            background: rgba(16, 36, 64, 0.8);
            border-radius: 15px;
            border: 1px solid rgba(64, 156, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            padding: 25px;
        }

        .panel h2 {
            color: #4a9eff;
            margin-bottom: 20px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel h2 i {
            font-size: 1.2em;
        }

        .control-group {
            margin-bottom: 25px;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        .control-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #a0c8ff;
            font-weight: 500;
        }

        .control-value {
            color: #4a9eff;
            font-weight: 600;
            background: rgba(74, 158, 255, 0.1);
            padding: 2px 8px;
            border-radius: 10px;
        }

        .slider-container {
            position: relative;
            height: 40px;
            display: flex;
            align-items: center;
        }

        .slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, #1a3a5f, #4a9eff);
            border-radius: 4px;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #4a9eff;
            cursor: pointer;
            border: 3px solid #ffffff;
            box-shadow: 0 0 10px rgba(74, 158, 255, 0.8);
            transition: all 0.2s ease;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(74, 158, 255, 1);
        }

        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #4a9eff;
            cursor: pointer;
            border: 3px solid #ffffff;
            box-shadow: 0 0 10px rgba(74, 158, 255, 0.8);
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            min-width: 120px;
            padding: 14px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4a9eff 0%, #2a7de5 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(74, 158, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 158, 255, 0.4);
        }

        .btn-secondary {
            background: rgba(64, 156, 255, 0.1);
            color: #4a9eff;
            border: 1px solid rgba(64, 156, 255, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(64, 156, 255, 0.2);
            transform: translateY(-2px);
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: background 0.3s ease;
        }

        .checkbox-item:hover {
            background: rgba(64, 156, 255, 0.1);
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #4a9eff;
        }

        .checkbox-label {
            color: #a0c8ff;
            font-weight: 500;
        }

        .data-panel {
            margin-top: 20px;
        }

        .formula-display {
            background: rgba(12, 28, 50, 0.9);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid rgba(64, 156, 255, 0.2);
        }

        .formula {
            font-size: 1.8em;
            color: #ffffff;
            font-family: 'Cambria Math', serif;
            margin: 10px 0;
        }

        .formula-var {
            padding: 2px 8px;
            border-radius: 6px;
            transition: background 0.3s ease;
        }

        .formula-var.active {
            background: rgba(255, 107, 53, 0.3);
            color: #ff6b35;
            box-shadow: 0 0 15px rgba(255, 107, 53, 0.4);
        }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .data-item {
            background: rgba(12, 28, 50, 0.7);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #4a9eff;
        }

        .data-label {
            color: #a0c8ff;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .data-value {
            color: #ffffff;
            font-size: 1.4em;
            font-weight: 700;
            font-family: 'Courier New', monospace;
        }

        .data-unit {
            color: #4a9eff;
            font-size: 0.9em;
            margin-left: 5px;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(64, 156, 255, 0.2);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #a0c8ff;
            font-size: 0.9em;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }

        .explanation {
            background: rgba(16, 36, 64, 0.8);
            border-radius: 15px;
            border: 1px solid rgba(64, 156, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            padding: 25px;
            margin-top: 20px;
        }

        .explanation h2 {
            color: #4a9eff;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .explanation p {
            color: #c0d6ff;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .explanation ul {
            color: #c0d6ff;
            padding-left: 20px;
            margin-bottom: 15px;
        }

        .explanation li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                min-width: 100%;
            }
            
            .data-grid {
                grid-template-columns: 1fr;
            }
            
            .formula {
                font-size: 1.4em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ”¬ ç„¦è€³å®šå¾‹å¾®è§‚è§£é‡Š</h1>
            <p class="subtitle">æ¢ç´¢ç”µæµçƒ­æ•ˆåº”çš„å¾®è§‚ä¸–ç•Œï¼šç”µå­ç¢°æ’å¦‚ä½•å°†ç”µèƒ½è½¬åŒ–ä¸ºçƒ­èƒ½</p>
        </header>

        <div class="main-content">
            <div class="simulation-area">
                <div class="view-container">
                    <div class="view-tabs">
                        <button class="view-tab active" id="macroTab">å®è§‚ç”µè·¯</button>
                        <button class="view-tab" id="microTab">å¾®è§‚ä¸–ç•Œ</button>
                    </div>
                    <canvas id="macroCanvas" width="800" height="400"></canvas>
                    <canvas id="microCanvas" width="800" height="400" style="display: none;"></canvas>
                </div>
            </div>

            <div class="control-panel">
                <div class="panel">
                    <h2>âš™ï¸ å®éªŒæ§åˆ¶</h2>
                    
                    <div class="control-group">
                        <div class="control-label">
                            <span>ç”µæµå¼ºåº¦ (I)</span>
                            <span class="control-value" id="currentValue">1.0 A</span>
                        </div>
                        <div class="slider-container">
                            <input type="range" min="0.5" max="3.0" step="0.1" value="1.0" class="slider" id="currentSlider">
                        </div>
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span>ç”µé˜»å€¼ (R)</span>
                            <span class="control-value" id="resistanceValue">2.0 Î©</span>
                        </div>
                        <div class="slider-container">
                            <input type="range" min="0.5" max="5.0" step="0.1" value="2.0" class="slider" id="resistanceSlider">
                        </div>
                    </div>

                    <div class="button-group">
                        <button class="btn btn-primary" id="playBtn">
                            <span>â–¶ï¸</span> æ’­æ”¾
                        </button>
                        <button class="btn btn-secondary" id="resetBtn">
                            <span>ğŸ”„</span> é‡ç½®
                        </button>
                    </div>
                </div>

                <div class="panel">
                    <h2>ğŸ‘ï¸ å¯è§†åŒ–é€‰é¡¹</h2>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" id="showPaths" checked>
                            <span class="checkbox-label">æ˜¾ç¤ºç”µå­è·¯å¾„è½¨è¿¹</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="highlightCollisions" checked>
                            <span class="checkbox-label">é«˜äº®ç¢°æ’æ•ˆæœ</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="showVibration">
                            <span class="checkbox-label">æ˜¾ç¤ºæ™¶æ ¼æŒ¯åŠ¨</span>
                        </label>
                    </div>
                </div>

                <div class="panel data-panel">
                    <h2>ğŸ“Š å®æ—¶æ•°æ®</h2>
                    
                    <div class="formula-display">
                        <div>ç„¦è€³å®šå¾‹å…¬å¼ï¼š</div>
                        <div class="formula">
                            Q = <span class="formula-var" id="iSquared">IÂ²</span> Ã— 
                            <span class="formula-var" id="rVar">R</span> Ã— 
                            <span class="formula-var" id="tVar">t</span>
                        </div>
                        <div style="color: #a0c8ff; font-size: 0.9em; margin-top: 10px;">
                            å½“å‰è°ƒèŠ‚çš„å˜é‡ä¼šé«˜äº®æ˜¾ç¤º
                        </div>
                    </div>

                    <div class="data-grid">
                        <div class="data-item">
                            <div class="data-label">ç”µæµ (I)</div>
                            <div class="data-value">1.0<span class="data-unit">A</span></div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">ç”µé˜» (R)</div>
                            <div class="data-value">2.0<span class="data-unit">Î©</span></div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">æ—¶é—´ (t)</div>
                            <div class="data-value">0.0<span class="data-unit">s</span></div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">çƒ­é‡ (Q)</div>
                            <div class="data-value">0.0<span class="data-unit">J</span></div>
                        </div>
                    </div>

                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #4a9eff;"></div>
                            <span>è‡ªç”±ç”µå­</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #aaa;"></div>
                            <span>é‡‘å±æ™¶æ ¼</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #ff6b35;"></div>
                            <span>ç¢°æ’èƒ½é‡</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="explanation">
            <h2>ğŸ’¡ ç‰©ç†åŸç†è¯´æ˜</h2>
            <p>ç„¦è€³å®šå¾‹ Q = IÂ²Rt æè¿°äº†ç”µæµé€šè¿‡å¯¼ä½“æ—¶äº§ç”Ÿçš„çƒ­é‡ã€‚è¿™ä¸ªåŠ¨ç”»å±•ç¤ºäº†å…¶å¾®è§‚æœºç†ï¼š</p>
            <ul>
                <li><strong>è‡ªç”±ç”µå­</strong>ï¼ˆè“è‰²ç²’å­ï¼‰åœ¨ç”µåœºä½œç”¨ä¸‹å®šå‘ç§»åŠ¨å½¢æˆç”µæµ</li>
                <li>ç”µå­åœ¨ç§»åŠ¨è¿‡ç¨‹ä¸­ä¸<strong>é‡‘å±æ™¶æ ¼</strong>ï¼ˆç°è‰²åŸå­ï¼‰å‘ç”Ÿé¢‘ç¹ç¢°æ’</li>
                <li>æ¯æ¬¡ç¢°æ’ï¼Œç”µå­å°†éƒ¨åˆ†åŠ¨èƒ½ä¼ é€’ç»™æ™¶æ ¼ï¼ŒåŠ å‰§å…¶çƒ­æŒ¯åŠ¨ â†’ äº§ç”Ÿçƒ­é‡</li>
                <li><strong>ç”µæµå¢å¤§</strong>ï¼šç”µå­é€Ÿåº¦æ›´å¿«ï¼Œç¢°æ’æ›´å‰§çƒˆï¼Œä¼ é€’èƒ½é‡æ›´å¤šï¼ˆä¸IÂ²æˆæ­£æ¯”ï¼‰</li>
                <li><strong>ç”µé˜»å¢å¤§</strong>ï¼šæ™¶æ ¼æ’åˆ—æ›´å¯†é›†ï¼Œç¢°æ’æ›´é¢‘ç¹ï¼Œäº§çƒ­æ›´å¤š</li>
            </ul>
            <p>å°è¯•è°ƒèŠ‚ç”µæµå’Œç”µé˜»ï¼Œè§‚å¯Ÿå¾®è§‚ç²’å­è¿åŠ¨å’Œå®è§‚çƒ­é‡äº§ç”Ÿçš„å˜åŒ–ï¼</p>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentView = 'macro';
        let isPlaying = false;
        let startTime = null;
        let lastTime = null;
        let elapsedTime = 0;
        
        // ç‰©ç†å‚æ•°
        let current = 1.0;      // ç”µæµ (A)
        let resistance = 2.0;   // ç”µé˜» (Î©)
        let heat = 0.0;         // çƒ­é‡ (J)
        
        // å¯è§†åŒ–é€‰é¡¹
        let showPaths = true;
        let highlightCollisions = true;
        let showVibration = false;
        
        // è·å–Canvaså…ƒç´ å’Œä¸Šä¸‹æ–‡
        const macroCanvas = document.getElementById('macroCanvas');
        const microCanvas = document.getElementById('microCanvas');
        const macroCtx = macroCanvas.getContext('2d');
        const microCtx = microCanvas.getContext('2d');
        
        // è°ƒæ•´Canvaså¤§å°ä»¥é€‚åº”å®¹å™¨
        function resizeCanvases() {
            const container = document.querySelector('.view-container');
            const width = container.clientWidth;
            const height = 400;
            
            macroCanvas.width = width;
            macroCanvas.height = height;
            microCanvas.width = width;
            microCanvas.height = height;
            
            // é‡æ–°ç»˜åˆ¶
            if (currentView === 'macro') {
                drawMacroView();
            } else {
                drawMicroView();
            }
        }
        
        // åˆå§‹åŒ–Canvaså¤§å°
        window.addEventListener('load', resizeCanvases);
        window.addEventListener('resize', resizeCanvases);
        
        // è§†å›¾åˆ‡æ¢
        document.getElementById('macroTab').addEventListener('click', () => {
            switchView('macro');
        });
        
        document.getElementById('microTab').addEventListener('click', () => {
            switchView('micro');
        });
        
        function switchView(view) {
            currentView = view;
            
            // æ›´æ–°æ ‡ç­¾
            document.getElementById('macroTab').classList.toggle('active', view === 'macro');
            document.getElementById('microTab').classList.toggle('active', view === 'micro');
            
            // æ˜¾ç¤º/éšè—Canvas
            macroCanvas.style.display = view === 'macro' ? 'block' : 'none';
            microCanvas.style.display = view === 'micro' ? 'block' : 'none';
            
            // é‡æ–°ç»˜åˆ¶
            if (view === 'macro') {
                drawMacroView();
            } else {
                initMicroWorld();
                drawMicroView();
            }
        }
        
        // å®è§‚è§†å›¾ç»˜åˆ¶
        function drawMacroView() {
            const ctx = macroCtx;
            const width = macroCanvas.width;
            const height = macroCanvas.height;
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, width, height);
            
            // ç»˜åˆ¶èƒŒæ™¯
            ctx.fillStyle = '#0a1929';
            ctx.fillRect(0, 0, width, height);
            
            // è®¡ç®—ç¯æ³¡äº®åº¦ï¼ˆåŸºäºçƒ­é‡ï¼‰
            const bulbBrightness = Math.min(heat / 50, 1);
            const bulbGlow = 50 + bulbBrightness * 150;
            
            // ç»˜åˆ¶ç”µè·¯
            const centerX = width / 2;
            const centerY = height / 2;
            const circuitRadius = Math.min(width, height) * 0.3;
            
            // ç»˜åˆ¶ç”µæº
            ctx.strokeStyle = '#4a9eff';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(centerX - circuitRadius, centerY);
            ctx.lineTo(centerX - circuitRadius + 40, centerY);
            ctx.stroke();
            
            // ç”µæºç¬¦å·
            ctx.beginPath();
            ctx.moveTo(centerX - circuitRadius + 50, centerY - 20);
            ctx.lineTo(centerX - circuitRadius + 50, centerY + 20);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(centerX - circuitRadius + 70, centerY - 15);
            ctx.lineTo(centerX - circuitRadius + 70, centerY + 15);
            ctx.stroke();
            
            // ç»˜åˆ¶å¯¼çº¿
            ctx.beginPath();
            ctx.arc(centerX, centerY, circuitRadius, 0, Math.PI * 2);
            ctx.stroke();
            
            // ç»˜åˆ¶ç¯æ³¡ï¼ˆè´Ÿè½½ï¼‰
            const bulbX = centerX + circuitRadius;
            const bulbY = centerY;
            
            // ç¯æ³¡å‘å…‰æ•ˆæœ
            if (bulbBrightness > 0.1) {
                const gradient = ctx.createRadialGradient(
                    bulbX, bulbY, 10,
                    bulbX, bulbY, 60
                );
                gradient.addColorStop(0, `rgba(255, ${bulbGlow}, 100, 0.8)`);
                gradient.addColorStop(1, 'rgba(255, 200, 100, 0)');
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(bulbX, bulbY, 60, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // ç¯æ³¡ä¸»ä½“
            ctx.fillStyle = bulbBrightness > 0.5 ? '#ffcc00' : '#cccccc';
            ctx.beginPath();
            ctx.arc(bulbX, bulbY, 25, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.strokeStyle = '#888888';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(bulbX, bulbY, 25, 0, Math.PI * 2);
            ctx.stroke();
            
            // ç¯æ³¡åº•åº§
            ctx.fillStyle = '#666666';
            ctx.fillRect(bulbX - 15, bulbY + 25, 30, 10);
            
            // ç»˜åˆ¶ç”µæµæ–¹å‘ç®­å¤´
            const arrowCount = 5;
            for (let i = 0; i < arrowCount; i++) {
                const angle = (i / arrowCount) * Math.PI * 2;
                const arrowX = centerX + Math.cos(angle) * (circuitRadius - 30);
                const arrowY = centerY + Math.sin(angle) * (circuitRadius - 30);
                
                drawArrow(ctx, arrowX, arrowY, angle + Math.PI / 2, 20, '#4a9eff');
            }
            
            // ç»˜åˆ¶æ ‡ç­¾
            ctx.fillStyle = '#4a9eff';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ç”µæº', centerX - circuitRadius + 60, centerY - 40);
            ctx.fillText('ç¯æ³¡', bulbX, bulbY - 50);
            
            // ç»˜åˆ¶ç”µæµå€¼æ ‡ç­¾
            ctx.fillStyle = '#a0c8ff';
            ctx.font = '14px Arial';
            ctx.fillText(`ç”µæµ: ${current.toFixed(1)} A`, centerX, centerY - circuitRadius - 20);
            ctx.fillText(`ç”µé˜»: ${resistance.toFixed(1)} Î©`, centerX, centerY + circuitRadius + 30);
            
            // ç»˜åˆ¶çƒ­é‡è®¡
            const heatBarWidth = 200;
            const heatBarHeight = 20;
            const heatBarX = centerX - heatBarWidth / 2;
            const heatBarY = height - 50;
            
            // èƒŒæ™¯
            ctx.fillStyle = '#1a3a5f';
            ctx.fillRect(heatBarX, heatBarY, heatBarWidth, heatBarHeight);
            
            // çƒ­é‡å¡«å……
            const heatFillWidth = (heat / 100) * heatBarWidth;
            const heatGradient = ctx.createLinearGradient(heatBarX, heatBarY, heatBarX + heatFillWidth, heatBarY);
            heatGradient.addColorStop(0, '#4a9eff');
            heatGradient.addColorStop(1, '#ff6b35');
            
            ctx.fillStyle = heatGradient;
            ctx.fillRect(heatBarX, heatBarY, heatFillWidth, heatBarHeight);
            
            // è¾¹æ¡†
            ctx.strokeStyle = '#4a9eff';
            ctx.lineWidth = 2;
            ctx.strokeRect(heatBarX, heatBarY, heatBarWidth, heatBarHeight);
            
            // æ ‡ç­¾
            ctx.fillStyle = '#a0c8ff';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('çƒ­é‡äº§ç”Ÿ', centerX, heatBarY - 10);
            ctx.fillText(`${heat.toFixed(1)} J`, centerX, heatBarY + heatBarHeight + 20);
        }
        
        // ç»˜åˆ¶ç®­å¤´å‡½æ•°
        function drawArrow(ctx, x, y, angle, length, color) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angle);
            ctx.strokeStyle = color;
            ctx.fillStyle = color;
            ctx.lineWidth = 2;
            
            // ç®­å¤´çº¿
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(0, length);
            ctx.stroke();
            
            // ç®­å¤´å¤´
            ctx.beginPath();
            ctx.moveTo(0, length);
            ctx.lineTo(-5, length - 10);
            ctx.lineTo(5, length - 10);
            ctx.closePath();
            ctx.fill();
            
            ctx.restore();
        }
        
        // å¾®è§‚ä¸–ç•Œç²’å­ç³»ç»Ÿ
        class Electron {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 2; // çƒ­è¿åŠ¨é€Ÿåº¦
                this.vy = (Math.random() - 0.5) * 2;
                this.radius = 4;
                this.color = '#4a9eff';
                this.trail = [];
                this.maxTrailLength = 10;
                this.lastCollision = 0;
            }
            
            update(driftSpeed) {
                // çƒ­è¿åŠ¨
                this.vx += (Math.random() - 0.5) * 0.5;
                this.vy += (Math.random() - 0.5) * 0.5;
                
                // é™åˆ¶æœ€å¤§çƒ­è¿åŠ¨é€Ÿåº¦
                const speed = Math.sqrt(this.vx * this.vx + this.vy * this.vy);
                if (speed > 3) {
                    this.vx = (this.vx / speed) * 3;
                    this.vy = (this.vy / speed) * 3;
                }
                
                // æ·»åŠ å®šå‘æ¼‚ç§»ï¼ˆç”µæµæ–¹å‘ï¼šå‘å³ï¼‰
                this.vx += driftSpeed * current;
                
                // æ›´æ–°ä½ç½®
                this.x += this.vx;
                this.y += this.vy;
                
                // è¾¹ç•Œç¢°æ’
                if (this.x < this.radius || this.x > microCanvas.width - this.radius) {
                    this.vx = -this.vx * 0.8;
                    this.x = Math.max(this.radius, Math.min(microCanvas.width - this.radius, this.x));
                }
                if (this.y < this.radius || this.y > microCanvas.height - this.radius) {
                    this.vy = -this.vy * 0.8;
                    this.y = Math.max(this.radius, Math.min(microCanvas.height - this.radius, this.y));
                }
                
                // æ›´æ–°è½¨è¿¹
                this.trail.push({x: this.x, y: this.y});
                if (this.trail.length > this.maxTrailLength) {
                    this.trail.shift();
                }
            }
            
            draw(ctx) {
                // ç»˜åˆ¶è½¨è¿¹
                if (showPaths && this.trail.length > 1) {
                    ctx.strokeStyle = 'rgba(74, 158, 255, 0.3)';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(this.trail[0].x, this.trail[0].y);
                    for (let i = 1; i < this.trail.length; i++) {
                        ctx.lineTo(this.trail[i].x, this.trail[i].y);
                    }
                    ctx.stroke();
                }
                
                // ç»˜åˆ¶ç”µå­
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
                
                // ç”µå­å‘å…‰æ•ˆæœ
                const gradient = ctx.createRadialGradient(
                    this.x, this.y, this.radius,
                    this.x, this.y, this.radius * 2
                );
                gradient.addColorStop(0, 'rgba(74, 158, 255, 0.8)');
                gradient.addColorStop(1, 'rgba(74, 158, 255, 0)');
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius * 2, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        class Lattice {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.radius = 6;
                this.color = '#aaaaaa';
                this.vibration = 0;
                this.vibrationSpeed = Math.random() * 0.05 + 0.02;
                this.collisionEnergy = 0;
                this.originalX = x;
                this.originalY = y;
            }
            
            update() {
                // çƒ­æŒ¯åŠ¨
                if (showVibration) {
                    this.vibration += this.vibrationSpeed;
                    this.x = this.originalX + Math.sin(this.vibration) * 2;
                    this.y = this.originalY + Math.cos(this.vibration * 0.7) * 2;
                }
                
                // ç¢°æ’èƒ½é‡è¡°å‡
                if (this.collisionEnergy > 0) {
                    this.collisionEnergy *= 0.9;
                    if (this.collisionEnergy < 0.1) this.collisionEnergy = 0;
                }
            }
            
            draw(ctx) {
                // ç»˜åˆ¶ç¢°æ’èƒ½é‡æ•ˆæœ
                if (highlightCollisions && this.collisionEnergy > 0) {
                    const gradient = ctx.createRadialGradient(
                        this.x, this.y, 0,
                        this.x, this.y, this.radius * (1 + this.collisionEnergy)
                    );
                    gradient.addColorStop(0, `rgba(255, 107, 53, ${this.collisionEnergy})`);
                    gradient.addColorStop(1, 'rgba(255, 107, 53, 0)');
                    
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius * (1 + this.collisionEnergy), 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // ç»˜åˆ¶æ™¶æ ¼ç‚¹
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
                
                // æ™¶æ ¼å‘å…‰æ•ˆæœ
                const gradient = ctx.createRadialGradient(
                    this.x, this.y, this.radius,
                    this.x, this.y, this.radius * 2
                );
                gradient.addColorStop(0, 'rgba(170, 170, 170, 0.6)');
                gradient.addColorStop(1, 'rgba(170, 170, 170, 0)');
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius * 2, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        // å¾®è§‚ä¸–ç•Œåˆå§‹åŒ–
        let electrons = [];
        let lattices = [];
        let collisions = [];
        
        function initMicroWorld() {
            electrons = [];
            lattices = [];
            collisions = [];
            
            const width = microCanvas.width;
            const height = microCanvas.height;
            
            // åˆ›å»ºæ™¶æ ¼ç‚¹é˜µ
            const spacing = 40;
            const rows = Math.floor(height / spacing);
            const cols = Math.floor(width / spacing);
            
            // æ ¹æ®ç”µé˜»è°ƒæ•´æ™¶æ ¼å¯†åº¦
            const densityFactor = resistance / 2.0;
            const actualSpacing = spacing / densityFactor;
            
            for (let i = 0; i < rows * densityFactor; i++) {
                for (let j = 0; j < cols * densityFactor; j++) {
                    const x = (j + 0.5) * actualSpacing;
                    const y = (i + 0.5) * actualSpacing;
                    
                    if (x < width - 20 && y < height - 20) {
                        lattices.push(new Lattice(x, y));
                    }
                }
            }
            
            // åˆ›å»ºç”µå­
            const electronCount = 30;
            for (let i = 0; i < electronCount; i++) {
                electrons.push(new Electron(
                    Math.random() * (width - 40) + 20,
                    Math.random() * (height - 40) + 20
                ));
            }
        }
        
        // æ£€æµ‹ç¢°æ’
        function checkCollisions() {
            const collisionEnergy = current * resistance * 0.1;
            
            for (let electron of electrons) {
                for (let lattice of lattices) {
                    const dx = electron.x - lattice.x;
                    const dy = electron.y - lattice
<!--æ£€æµ‹åˆ°ä»£ç æˆªæ–­ï¼Œè‡ªåŠ¨ç»­å†™ä¸­...-->
.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < electron.radius + lattice.radius) {
                        // ç¢°æ’å‘ç”Ÿ
                        electron.lastCollision = Date.now();
                        
                        // ç”µå­åå¼¹
                        const angle = Math.atan2(dy, dx);
                        const speed = Math.sqrt(electron.vx * electron.vx + electron.vy * electron.vy);
                        electron.vx = -Math.cos(angle) * speed * 0.8;
                        electron.vy = -Math.sin(angle) * speed * 0.8;
                        
                        // ä¼ é€’èƒ½é‡ç»™æ™¶æ ¼
                        lattice.collisionEnergy = Math.min(collisionEnergy, 1);
                        
                        // è®°å½•ç¢°æ’æ•ˆæœ
                        collisions.push({
                            x: lattice.x,
                            y: lattice.y,
                            energy: collisionEnergy,
                            life: 1.0
                        });
                        
                        // æ›´æ–°çƒ­é‡ï¼ˆåŸºäºç¢°æ’èƒ½é‡ï¼‰
                        heat += collisionEnergy * 0.1;
                    }
                }
            }
        }
        
        // æ›´æ–°ç¢°æ’æ•ˆæœ
        function updateCollisions() {
            for (let i = collisions.length - 1; i >= 0; i--) {
                collisions[i].life -= 0.05;
                if (collisions[i].life <= 0) {
                    collisions.splice(i, 1);
                }
            }
        }
        
        // ç»˜åˆ¶å¾®è§‚è§†å›¾
        function drawMicroView() {
            const ctx = microCtx;
            const width = microCanvas.width;
            const height = microCanvas.height;
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, width, height);
            
            // ç»˜åˆ¶èƒŒæ™¯
            ctx.fillStyle = '#0a1929';
            ctx.fillRect(0, 0, width, height);
            
            // ç»˜åˆ¶ç”µåœºæ–¹å‘æŒ‡ç¤º
            ctx.strokeStyle = 'rgba(74, 158, 255, 0.5)';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(20, height / 2);
            ctx.lineTo(width - 20, height / 2);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // ç»˜åˆ¶ç”µåœºç®­å¤´
            for (let i = 0; i < 5; i++) {
                const x = 20 + (i * (width - 40) / 4);
                drawArrow(ctx, x, height / 2, 0, 20, '#4a9eff');
            }
            
            // æ›´æ–°å’Œç»˜åˆ¶æ™¶æ ¼
            for (let lattice of lattices) {
                lattice.update();
                lattice.draw(ctx);
            }
            
            // æ›´æ–°å’Œç»˜åˆ¶ç”µå­
            const driftSpeed = 0.5; // åŸºç¡€æ¼‚ç§»é€Ÿåº¦
            for (let electron of electrons) {
                electron.update(driftSpeed);
                electron.draw(ctx);
            }
            
            // æ£€æµ‹ç¢°æ’
            checkCollisions();
            updateCollisions();
            
            // ç»˜åˆ¶ç¢°æ’æ•ˆæœ
            if (highlightCollisions) {
                for (let collision of collisions) {
                    const alpha = collision.life * 0.5;
                    const radius = 20 * collision.life;
                    
                    const gradient = ctx.createRadialGradient(
                        collision.x, collision.y, 0,
                        collision.x, collision.y, radius
                    );
                    gradient.addColorStop(0, `rgba(255, 107, 53, ${alpha})`);
                    gradient.addColorStop(1, 'rgba(255, 107, 53, 0)');
                    
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(collision.x, collision.y, radius, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            // ç»˜åˆ¶æ ‡ç­¾
            ctx.fillStyle = '#4a9eff';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('ç”µåœºæ–¹å‘ â†’', width - 100, 30);
            
            ctx.fillStyle = '#a0c8ff';
            ctx.font = '14px Arial';
            ctx.fillText(`ç”µå­æ•°é‡: ${electrons.length}`, 20, 30);
            ctx.fillText(`æ™¶æ ¼å¯†åº¦: ${lattices.length}`, 20, 50);
            ctx.fillText(`ç¢°æ’é¢‘ç‡: ${collisions.length}/s`, 20, 70);
            
            // ç»˜åˆ¶ç”µé˜»æŒ‡ç¤º
            ctx.fillStyle = resistance > 3 ? '#ff6b35' : '#4a9eff';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'right';
            ctx.fillText(`ç”µé˜»å½±å“: ${resistance > 3 ? 'é«˜ç¢°æ’æ¦‚ç‡' : 'æ­£å¸¸'}`, width - 20, height - 20);
        }
        
        // åŠ¨ç”»å¾ªç¯
        function animate(timestamp) {
            if (!lastTime) lastTime = timestamp;
            const deltaTime = (timestamp - lastTime) / 1000;
            lastTime = timestamp;
            
            if (isPlaying) {
                // æ›´æ–°æ—¶é—´
                if (!startTime) startTime = timestamp;
                elapsedTime = (timestamp - startTime) / 1000;
                
                // æ›´æ–°çƒ­é‡ï¼ˆæ ¹æ®ç„¦è€³å®šå¾‹ï¼‰
                heat = current * current * resistance * elapsedTime;
                
                // æ›´æ–°æ•°æ®é¢æ¿
                updateDataPanel();
                
                // é‡æ–°ç»˜åˆ¶å½“å‰è§†å›¾
                if (currentView === 'macro') {
                    drawMacroView();
                } else {
                    drawMicroView();
                }
            }
            
            requestAnimationFrame(animate);
        }
        
        // æ›´æ–°æ•°æ®é¢æ¿
        function updateDataPanel() {
            // æ›´æ–°æ•°å€¼æ˜¾ç¤º
            document.getElementById('currentValue').textContent = `${current.toFixed(1)} A`;
            document.getElementById('resistanceValue').textContent = `${resistance.toFixed(1)} Î©`;
            
            // æ›´æ–°æ•°æ®é¡¹
            document.querySelectorAll('.data-item')[0].querySelector('.data-value').innerHTML = 
                `${current.toFixed(1)}<span class="data-unit">A</span>`;
            document.querySelectorAll('.data-item')[1].querySelector('.data-value').innerHTML = 
                `${resistance.toFixed(1)}<span class="data-unit">Î©</span>`;
            document.querySelectorAll('.data-item')[2].querySelector('.data-value').innerHTML = 
                `${elapsedTime.toFixed(1)}<span class="data-unit">s</span>`;
            document.querySelectorAll('.data-item')[3].querySelector('.data-value').innerHTML = 
                `${heat.toFixed(1)}<span class="data-unit">J</span>`;
            
            // æ›´æ–°å…¬å¼é«˜äº®
            document.getElementById('iSquared').classList.toggle('active', false);
            document.getElementById('rVar').classList.toggle('active', false);
            document.getElementById('tVar').classList.toggle('active', false);
        }
        
        // äº‹ä»¶ç›‘å¬å™¨
        document.getElementById('currentSlider').addEventListener('input', function(e) {
            current = parseFloat(e.target.value);
            updateDataPanel();
            document.getElementById('iSquared').classList.toggle('active', true);
            
            // é‡æ–°åˆå§‹åŒ–å¾®è§‚ä¸–ç•Œï¼ˆç”µæµå˜åŒ–å½±å“ç”µå­é€Ÿåº¦ï¼‰
            if (currentView === 'micro') {
                initMicroWorld();
            }
        });
        
        document.getElementById('resistanceSlider').addEventListener('input', function(e) {
            resistance = parseFloat(e.target.value);
            updateDataPanel();
            document.getElementById('rVar').classList.toggle('active', true);
            
            // é‡æ–°åˆå§‹åŒ–å¾®è§‚ä¸–ç•Œï¼ˆç”µé˜»å˜åŒ–å½±å“æ™¶æ ¼å¯†åº¦ï¼‰
            if (currentView === 'micro') {
                initMicroWorld();
            }
        });
        
        document.getElementById('playBtn').addEventListener('click', function() {
            isPlaying = !isPlaying;
            if (isPlaying) {
                this.innerHTML = '<span>â¸ï¸</span> æš‚åœ';
                if (!startTime) {
                    startTime = performance.now() - elapsedTime * 1000;
                }
            } else {
                this.innerHTML = '<span>â–¶ï¸</span> æ’­æ”¾';
            }
        });
        
        document.getElementById('resetBtn').addEventListener('click', function() {
            isPlaying = false;
            startTime = null;
            elapsedTime = 0;
            heat = 0;
            
            document.getElementById('playBtn').innerHTML = '<span>â–¶ï¸</span> æ’­æ”¾';
            
            // é‡ç½®æ»‘å—
            document.getElementById('currentSlider').value = 1.0;
            document.getElementById('resistanceSlider').value = 2.0;
            current = 1.0;
            resistance = 2.0;
            
            // é‡æ–°åˆå§‹åŒ–
            initMicroWorld();
            updateDataPanel();
            
            // é‡æ–°ç»˜åˆ¶
            if (currentView === 'macro') {
                drawMacroView();
            } else {
                drawMicroView();
            }
        });
        
        // å¯è§†åŒ–é€‰é¡¹
        document.getElementById('showPaths').addEventListener('change', function(e) {
            showPaths = e.target.checked;
            if (currentView === 'micro') {
                drawMicroView();
            }
        });
        
        document.getElementById('highlightCollisions').addEventListener('change', function(e) {
            highlightCollisions = e.target.checked;
            if (currentView === 'micro') {
                drawMicroView();
            }
        });
        
        document.getElementById('showVibration').addEventListener('change', function(e) {
            showVibration = e.target.checked;
            if (currentView === 'micro') {
                drawMicroView();
            }
        });
        
        // åˆå§‹åŒ–
        function init() {
            // åˆå§‹åŒ–å¾®è§‚ä¸–ç•Œ
            initMicroWorld();
            
            // ç»˜åˆ¶åˆå§‹è§†å›¾
            drawMacroView();
            
            // å¼€å§‹åŠ¨ç”»å¾ªç¯
            requestAnimationFrame(animate);
            
            // åˆå§‹æ•°æ®æ›´æ–°
            updateDataPanel();
            
            // æ˜¾ç¤ºåˆå§‹æç¤º
            setTimeout(() => {
                if (currentView === 'macro') {
                    alert('æç¤ºï¼šç‚¹å‡»"å¾®è§‚ä¸–ç•Œ"æ ‡ç­¾ï¼Œå¯ä»¥æŸ¥çœ‹ç”µå­ä¸æ™¶æ ¼ç¢°æ’çš„å¾®è§‚è¿‡ç¨‹ï¼');
                }
            }, 1000);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', init);
    </script>
</body>
</html>