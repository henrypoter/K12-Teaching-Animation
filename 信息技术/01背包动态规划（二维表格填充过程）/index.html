<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>01èƒŒåŒ…åŠ¨æ€è§„åˆ’ - äºŒç»´è¡¨æ ¼å¡«å……è¿‡ç¨‹å¯è§†åŒ–</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        body {
            background-color: #f8f9fa;
            color: #2c3e50;
            line-height: 1.6;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #3498db;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.2rem;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 30px;
        }

        .left-panel {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .right-panel {
            flex: 2;
            min-width: 500px;
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .panel-title {
            color: #3498db;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ecf0f1;
            font-size: 1.4rem;
        }

        .problem-config {
            margin-bottom: 25px;
        }

        .config-item {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }

        input,
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #3498db;
        }

        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .items-table th,
        .items-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }

        .items-table th {
            background-color: #f2f6fa;
            font-weight: 600;
        }

        .items-table input {
            width: 80px;
            text-align: center;
            padding: 5px;
        }

        .control-panel {
            margin-top: 30px;
        }

        .control-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-secondary {
            background-color: #2ecc71;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #27ae60;
        }

        .btn-warning {
            background-color: #e67e22;
            color: white;
        }

        .btn-warning:hover {
            background-color: #d35400;
        }

        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
        }

        .speed-slider {
            flex: 1;
        }

        .visualization-container {
            position: relative;
            width: 100%;
            height: 500px;
            border: 1px solid #ecf0f1;
            border-radius: 5px;
            overflow: auto;
            background-color: white;
        }

        #animationCanvas {
            display: block;
        }

        .status-panel {
            margin-top: 25px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .status-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        #statusText {
            min-height: 80px;
            padding: 10px;
            background-color: white;
            border-radius: 5px;
            border: 1px solid #ecf0f1;
            font-size: 1rem;
            line-height: 1.5;
            color: #2c3e50;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #ecf0f1;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ecf0f1;
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        @media (max-width: 1100px) {
            .container {
                flex-direction: column;
            }

            .left-panel,
            .right-panel {
                min-width: 100%;
            }

            .visualization-container {
                height: 400px;
            }
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>01èƒŒåŒ…åŠ¨æ€è§„åˆ’ - äºŒç»´è¡¨æ ¼å¡«å……è¿‡ç¨‹å¯è§†åŒ–</h1>
        <p class="subtitle">é€šè¿‡äº¤äº’å¼åŠ¨ç”»ç†è§£çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸è¡¨æ ¼å¡«å……è¿‡ç¨‹</p>
    </div>

    <div class="container">
        <div class="left-panel">
            <h2 class="panel-title">é—®é¢˜é…ç½®</h2>

            <div class="problem-config">
                <div class="config-item">
                    <label for="capacity">èƒŒåŒ…å®¹é‡ (C):</label>
                    <input type="number" id="capacity" min="1" max="20" value="8">
                </div>

                <div class="config-item">
                    <label for="itemCount">ç‰©å“æ•°é‡ (n):</label>
                    <input type="number" id="itemCount" min="1" max="8" value="4">
                </div>

                <div class="config-item">
                    <label>ç‰©å“åˆ—è¡¨ (é‡é‡ w, ä»·å€¼ v):</label>
                    <table class="items-table" id="itemsTable">
                        <thead>
                            <tr>
                                <th>ç‰©å“ i</th>
                                <th>é‡é‡ w</th>
                                <th>ä»·å€¼ v</th>
                            </tr>
                        </thead>
                        <tbody id="itemsBody">
                            <!-- åŠ¨æ€ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>

                <button id="applyConfig" class="btn-secondary">åº”ç”¨é…ç½®</button>
            </div>

            <div class="control-panel">
                <h2 class="panel-title">åŠ¨ç”»æ§åˆ¶</h2>

                <div class="control-buttons">
                    <button id="startBtn" class="btn-primary">â–¶ å¼€å§‹</button>
                    <button id="pauseBtn" class="btn-warning">â¸ æš‚åœ</button>
                    <button id="nextStepBtn" class="btn-secondary">â­ ä¸‹ä¸€æ­¥</button>
                    <button id="prevStepBtn" class="btn-secondary">â® ä¸Šä¸€æ­¥</button>
                    <button id="resetBtn" class="btn-danger">â†º é‡ç½®</button>
                </div>

                <div class="speed-control">
                    <span>åŠ¨ç”»é€Ÿåº¦:</span>
                    <input type="range" id="speedSlider" class="speed-slider" min="1" max="10" value="5">
                    <span id="speedValue">ä¸­é€Ÿ</span>
                </div>

                <div class="control-buttons" style="margin-top: 20px;">
                    <button id="showPathBtn" class="btn-secondary">ğŸ” æ˜¾ç¤ºæœ€ä¼˜è§£è·¯å¾„</button>
                    <button id="toggleArrowsBtn" class="btn-secondary">â†•ï¸ åˆ‡æ¢ç®­å¤´æ˜¾ç¤º</button>
                </div>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #3498db;"></div>
                    <span>å½“å‰å•å…ƒæ ¼</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ecf0f1;"></div>
                    <span>ä¾èµ–å•å…ƒæ ¼</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #e67e22;"></div>
                    <span>ä¸æ”¾å…¥å†³ç­–</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #2ecc71;"></div>
                    <span>æ”¾å…¥å†³ç­–</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #f1c40f;"></div>
                    <span>æœ€ä¼˜è§£è·¯å¾„</span>
                </div>
            </div>
        </div>

        <div class="right-panel">
            <h2 class="panel-title">åŠ¨æ€è§„åˆ’è¡¨æ ¼å¯è§†åŒ–</h2>

            <div class="visualization-container">
                <canvas id="animationCanvas"></canvas>
            </div>

            <div class="status-panel">
                <div class="status-title">å½“å‰çŠ¶æ€è¯´æ˜</div>
                <div id="statusText">
                    ç‚¹å‡»"å¼€å§‹"æŒ‰é’®å¯åŠ¨åŠ¨ç”»ï¼Œæˆ–ç‚¹å‡»"ä¸‹ä¸€æ­¥"æ‰‹åŠ¨å‰è¿›ã€‚åŠ¨ç”»å°†å±•ç¤ºäºŒç»´DPè¡¨æ ¼çš„å¡«å……è¿‡ç¨‹ã€‚
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>01èƒŒåŒ…åŠ¨æ€è§„åˆ’å¯è§†åŒ–æ•™å­¦å·¥å…· | çŠ¶æ€è½¬ç§»æ–¹ç¨‹: dp[i][j] = max(dp[i-1][j], dp[i-1][j-w[i]] + v[i])</p>
        <p>ç‚¹å‡»è¡¨æ ¼ä¸­çš„å•å…ƒæ ¼å¯ä»¥æŸ¥çœ‹å…¶è®¡ç®—è¿‡ç¨‹</p>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let canvas, ctx;
        let capacity = 8;
        let itemCount = 4;
        let items = [
            { weight: 2, value: 3 },
            { weight: 3, value: 4 },
            { weight: 4, value: 5 },
            { weight: 5, value: 8 }
        ];

        // DPè¡¨æ ¼æ•°æ®
        let dp = [];
        let decisions = []; // è®°å½•æ¯ä¸ªå•å…ƒæ ¼çš„å†³ç­–: 0=ä¸æ”¾å…¥, 1=æ”¾å…¥

        // åŠ¨ç”»çŠ¶æ€
        let animationState = {
            isPlaying: false,
            currentStep: 0,
            totalSteps: 0,
            speed: 300, // æ¯«ç§’
            showArrows: true,
            showOptimalPath: false
        };

        // å½“å‰é«˜äº®çš„å•å…ƒæ ¼
        let highlightedCell = { i: -1, j: -1 };
        let dependentCells = [];

        // åŠ¨ç”»æ­¥éª¤é˜Ÿåˆ—
        let animationSteps = [];

        // ç”»å¸ƒå°ºå¯¸
        const cellSize = 60;
        const headerSize = 40;
        const arrowLength = 25;

        // åˆå§‹åŒ–å‡½æ•°
        function init() {
            canvas = document.getElementById('animationCanvas');
            ctx = canvas.getContext('2d');

            // åˆå§‹åŒ–ç‰©å“è¡¨æ ¼
            initItemsTable();

            // åˆå§‹åŒ–DPè¡¨æ ¼
            initDPTable();

            // ç”ŸæˆåŠ¨ç”»æ­¥éª¤
            generateAnimationSteps();

            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            setupEventListeners();

            // åˆå§‹ç»˜åˆ¶
            resizeCanvas();
            drawTable();

            // æ›´æ–°çŠ¶æ€æ–‡æœ¬
            updateStatusText("åˆå§‹åŒ–å®Œæˆã€‚ç‚¹å‡»'å¼€å§‹'æŒ‰é’®å¯åŠ¨åŠ¨ç”»ã€‚");
        }

        // åˆå§‹åŒ–ç‰©å“è¡¨æ ¼
        function initItemsTable() {
            const itemsBody = document.getElementById('itemsBody');
            itemsBody.innerHTML = '';

            for (let i = 0; i < itemCount; i++) {
                const row = document.createElement('tr');

                // ç‰©å“ç¼–å·
                const idCell = document.createElement('td');
                idCell.textContent = i + 1;
                row.appendChild(idCell);

                // é‡é‡è¾“å…¥
                const weightCell = document.createElement('td');
                const weightInput = document.createElement('input');
                weightInput.type = 'number';
                weightInput.min = '1';
                weightInput.max = '10';
                weightInput.value = items[i] ? items[i].weight : Math.floor(Math.random() * 5) + 1;
                weightCell.appendChild(weightInput);
                row.appendChild(weightCell);

                // ä»·å€¼è¾“å…¥
                const valueCell = document.createElement('td');
                const valueInput = document.createElement('input');
                valueInput.type = 'number';
                valueInput.min = '1';
                valueInput.max = '20';
                valueInput.value = items[i] ? items[i].value : Math.floor(Math.random() * 10) + 1;
                valueCell.appendChild(valueInput);
                row.appendChild(valueCell);

                itemsBody.appendChild(row);
            }
        }

        // åˆå§‹åŒ–DPè¡¨æ ¼
        function initDPTable() {
            // é‡ç½®DPè¡¨æ ¼
            dp = [];
            decisions = [];

            // åˆå§‹åŒ–ç¬¬ä¸€è¡Œï¼ˆæ²¡æœ‰ç‰©å“ï¼‰å’Œç¬¬ä¸€åˆ—ï¼ˆå®¹é‡ä¸º0ï¼‰
            for (let i = 0; i <= itemCount; i++) {
                dp[i] = [];
                decisions[i] = [];
                for (let j = 0; j <= capacity; j++) {
                    if (i === 0 || j === 0) {
                        dp[i][j] = 0;
                        decisions[i][j] = -1; // -1è¡¨ç¤ºåŸºç¡€æƒ…å†µ
                    } else {
                        dp[i][j] = -1; // -1è¡¨ç¤ºæœªè®¡ç®—
                        decisions[i][j] = -1;
                    }
                }
            }

            // é‡ç½®åŠ¨ç”»çŠ¶æ€
            animationState.currentStep = 0;
            highlightedCell = { i: -1, j: -1 };
            dependentCells = [];
        }

        // ç”ŸæˆåŠ¨ç”»æ­¥éª¤
        function generateAnimationSteps() {
            animationSteps = [];

            // ä¸ºæ¯ä¸ªéœ€è¦è®¡ç®—çš„å•å…ƒæ ¼ç”Ÿæˆæ­¥éª¤
            for (let i = 1; i <= itemCount; i++) {
                for (let j = 1; j <= capacity; j++) {
                    // æ­¥éª¤1: é«˜äº®å½“å‰å•å…ƒæ ¼
                    animationSteps.push({
                        type: 'highlight',
                        i: i,
                        j: j,
                        description: `å‡†å¤‡è®¡ç®— dp[${i}][${j}]ï¼šè€ƒè™‘å‰${i}ä¸ªç‰©å“ï¼ŒèƒŒåŒ…å®¹é‡ä¸º${j}`
                    });

                    // æ­¥éª¤2: è®¡ç®—ä¸æ”¾å…¥çš„æƒ…å†µï¼ˆæŸ¥çœ‹ä¸Šæ–¹å•å…ƒæ ¼ï¼‰
                    animationSteps.push({
                        type: 'calc_no_take',
                        i: i,
                        j: j,
                        description: `é€‰é¡¹1ï¼šä¸æ”¾å…¥ç‰©å“${i}ï¼Œä»·å€¼ä¸º dp[${i - 1}][${j}] = ${dp[i - 1][j]}`
                    });

                    // æ­¥éª¤3: è®¡ç®—æ”¾å…¥çš„æƒ…å†µï¼ˆæŸ¥çœ‹å·¦ä¸Šæ–¹å•å…ƒæ ¼ï¼‰
                    if (j >= items[i - 1].weight) {
                        animationSteps.push({
                            type: 'calc_take',
                            i: i,
                            j: j,
                            description: `é€‰é¡¹2ï¼šæ”¾å…¥ç‰©å“${i}ï¼Œä»·å€¼ä¸º dp[${i - 1}][${j - items[i - 1].weight}] + v[${i}] = ${dp[i - 1][j - items[i - 1].weight]} + ${items[i - 1].value} = ${dp[i - 1][j - items[i - 1].weight] + items[i - 1].value}`
                        });
                    } else {
                        animationSteps.push({
                            type: 'calc_take_invalid',
                            i: i,
                            j: j,
                            description: `é€‰é¡¹2ï¼šæ— æ³•æ”¾å…¥ç‰©å“${i}ï¼Œå› ä¸ºç‰©å“é‡é‡${items[i - 1].weight} > å½“å‰å®¹é‡${j}`
                        });
                    }

                    // æ­¥éª¤4: æ¯”è¾ƒå¹¶å¡«å…¥ç»“æœ
                    animationSteps.push({
                        type: 'fill',
                        i: i,
                        j: j,
                        description: `æ¯”è¾ƒä¸¤ä¸ªé€‰é¡¹ï¼Œé€‰æ‹©æœ€å¤§å€¼å¡«å…¥ dp[${i}][${j}]`
                    });
                }
            }

            animationState.totalSteps = animationSteps.length;
        }

        // æ‰§è¡Œä¸‹ä¸€æ­¥åŠ¨ç”»
        function nextStep() {
            if (animationState.currentStep >= animationSteps.length) {
                animationState.isPlaying = false;
                updateStatusText("è¡¨æ ¼å¡«å……å®Œæˆï¼ç‚¹å‡»'æ˜¾ç¤ºæœ€ä¼˜è§£è·¯å¾„'æŸ¥çœ‹æœ€ç»ˆç»“æœã€‚");
                document.getElementById('startBtn').textContent = "â–¶ å¼€å§‹";
                return;
            }

            const step = animationSteps[animationState.currentStep];

            // æ ¹æ®æ­¥éª¤ç±»å‹æ‰§è¡Œç›¸åº”æ“ä½œ
            switch (step.type) {
                case 'highlight':
                    highlightedCell = { i: step.i, j: step.j };
                    dependentCells = [];
                    break;

                case 'calc_no_take':
                    dependentCells = [{ i: step.i - 1, j: step.j, type: 'no_take' }];
                    break;

                case 'calc_take':
                    dependentCells = [
                        { i: step.i - 1, j: step.j, type: 'no_take' },
                        { i: step.i - 1, j: step.j - items[step.i - 1].weight, type: 'take' }
                    ];
                    break;

                case 'calc_take_invalid':
                    dependentCells = [{ i: step.i - 1, j: step.j, type: 'no_take' }];
                    break;

                case 'fill':
                    // å®é™…è®¡ç®—DPå€¼
                    calculateDPCell(step.i, step.j);
                    highlightedCell = { i: -1, j: -1 };
                    dependentCells = [];
                    break;
            }

            // æ›´æ–°çŠ¶æ€æ–‡æœ¬
            updateStatusText(step.description);

            // é‡ç»˜è¡¨æ ¼
            drawTable();

            // å‰è¿›åˆ°ä¸‹ä¸€æ­¥
            animationState.currentStep++;

            // å¦‚æœåŠ¨ç”»æ­£åœ¨æ’­æ”¾ï¼Œå®‰æ’ä¸‹ä¸€æ­¥
            if (animationState.isPlaying) {
                setTimeout(nextStep, animationState.speed);
            }
        }

        // æ‰§è¡Œä¸Šä¸€æ­¥åŠ¨ç”»
        function prevStep() {
            if (animationState.currentStep <= 0) return;

            // åé€€ä¸€æ­¥
            animationState.currentStep--;

            // å¦‚æœå½“å‰æ­¥éª¤æ˜¯fillç±»å‹ï¼Œéœ€è¦æ¸…é™¤DPå€¼
            const step = animationSteps[animationState.currentStep];
            if (step.type === 'fill') {
                dp[step.i][step.j] = -1;
                decisions[step.i][step.j] = -1;
            }

            // è®¡ç®—å‰ä¸€æ­¥çš„çŠ¶æ€
            if (animationState.currentStep > 0) {
                const prevStep = animationSteps[animationState.currentStep - 1];

                switch (prevStep.type) {
                    case 'highlight':
                        highlightedCell = { i: prevStep.i, j: prevStep.j };
                        dependentCells = [];
                        break;

                    case 'calc_no_take':
                        highlightedCell = { i: prevStep.i, j: prevStep.j };
                        dependentCells = [{ i: prevStep.i - 1, j: prevStep.j, type: 'no_take' }];
                        break;

                    case 'calc_take':
                        highlightedCell = { i: prevStep.i, j: prevStep.j };
                        dependentCells = [
                            { i: prevStep.i - 1, j: prevStep.j, type: 'no_take' },
                            { i: prevStep.i - 1, j: prevStep.j - items[prevStep.i - 1].weight, type: 'take' }
                        ];
                        break;

                    case 'calc_take_invalid':
                        highlightedCell = { i: prevStep.i, j: prevStep.j };
                        dependentCells = [{ i: prevStep.i - 1, j: prevStep.j, type: 'no_take' }];
                        break;

                    default:
                        highlightedCell = { i: -1, j: -1 };
                        dependentCells = [];
                }

                updateStatusText(prevStep.description);
            } else {
                highlightedCell = { i: -1, j: -1 };
                dependentCells = [];
                updateStatusText("å·²å›åˆ°ç¬¬ä¸€æ­¥ã€‚");
            }

            // é‡ç»˜è¡¨æ ¼
            drawTable();
        }

        // è®¡ç®—DPå•å…ƒæ ¼çš„å€¼
        function calculateDPCell(i, j) {
            // ä¸æ”¾å…¥å½“å‰ç‰©å“
            const noTakeValue = dp[i - 1][j];

            // æ”¾å…¥å½“å‰ç‰©å“ï¼ˆå¦‚æœå¯èƒ½ï¼‰
            let takeValue = -1;
            if (j >= items[i - 1].weight) {
                takeValue = dp[i - 1][j - items[i - 1].weight] + items[i - 1].value;
            }

            // é€‰æ‹©è¾ƒå¤§å€¼
            if (takeValue > noTakeValue) {
                dp[i][j] = takeValue;
                decisions[i][j] = 1; // æ”¾å…¥
            } else {
                dp[i][j] = noTakeValue;
                decisions[i][j] = 0; // ä¸æ”¾å…¥
            }
        }

        // ç»˜åˆ¶è¡¨æ ¼
        function drawTable() {
            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // è®¡ç®—è¡¨æ ¼å°ºå¯¸
            const tableWidth = (capacity + 1) * cellSize;
            const tableHeight = (itemCount + 1) * cellSize;

            // ç»˜åˆ¶åˆ—æ ‡é¢˜ï¼ˆèƒŒåŒ…å®¹é‡ï¼‰
            ctx.fillStyle = '#2c3e50';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            for (let j = 0; j <= capacity; j++) {
                const x = headerSize + j * cellSize + cellSize / 2;
                const y = headerSize / 2;
                ctx.fillText(`å®¹é‡=${j}`, x, y);
            }

            // ç»˜åˆ¶è¡Œæ ‡é¢˜ï¼ˆç‰©å“ï¼‰
            for (let i = 0; i <= itemCount; i++) {
                const x = headerSize / 2;
                const y = headerSize + i * cellSize + cellSize / 2;

                if (i === 0) {
                    ctx.fillText('ç‰©å“/å®¹é‡', x, y);
                } else {
                    ctx.fillText(`å‰${i}ä¸ªç‰©å“`, x, y);
                }
            }

            // ç»˜åˆ¶è¡¨æ ¼å•å…ƒæ ¼
            for (let i = 0; i <= itemCount; i++) {
                for (let j = 0; j <= capacity; j++) {
                    const x = headerSize + j * cellSize;
                    const y = headerSize + i * cellSize;

                    // æ£€æŸ¥æ˜¯å¦ä¸ºé«˜äº®å•å…ƒæ ¼
                    let isHighlighted = (i === highlightedCell.i && j === highlightedCell.j);
                    let isDependent = dependentCells.some(cell => cell.i === i && cell.j === j);

                    // è®¾ç½®å•å…ƒæ ¼èƒŒæ™¯è‰²
                    if (isHighlighted) {
                        ctx.fillStyle = 'rgba(52, 152, 219, 0.2)';
                        ctx.fillRect(x, y, cellSize, cellSize);

                        // ç»˜åˆ¶é«˜äº®è¾¹æ¡†
                        ctx.strokeStyle = '#3498db';
                        ctx.lineWidth = 3;
                        ctx.strokeRect(x, y, cellSize, cellSize);
                    } else if (isDependent) {
                        ctx.fillStyle = '#ecf0f1';
                        ctx.fillRect(x, y, cellSize, cellSize);
                    }

                    // ç»˜åˆ¶å•å…ƒæ ¼è¾¹æ¡†
                    ctx.strokeStyle = '#bdc3c7';
                    ctx.lineWidth = 1;
                    ctx.strokeRect(x, y, cellSize, cellSize);

                    // ç»˜åˆ¶å•å…ƒæ ¼å†…å®¹
                    ctx.fillStyle = '#2c3e50';
                    ctx.font = '16px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';

                    const centerX = x + cellSize / 2;
                    const centerY = y + cellSize / 2;

                    if (dp[i][j] >= 0) {
                        // å·²è®¡ç®—çš„å•å…ƒæ ¼
                        ctx.fillText(dp[i][j], centerX, centerY);

                        // ç»˜åˆ¶å†³ç­–æŒ‡ç¤ºå™¨
                        if (decisions[i][j] === 0) {
                            // ä¸æ”¾å…¥
                            ctx.fillStyle = '#e67e22';
                            ctx.fillText('â†‘', centerX + 20, centerY - 20);
                        } else if (decisions[i][j] === 1) {
                            // æ”¾å…¥
                            ctx.fillStyle = '#2ecc71';
                            ctx.fillText('â†–', centerX + 20, centerY - 20);
                        }
                    } else if (i === 0 || j === 0) {
                        // åŸºç¡€æƒ…å†µ
                        ctx.fillText('0', centerX, centerY);
                    } else {
                        // æœªè®¡ç®—çš„å•å…ƒæ ¼
                        ctx.fillStyle = '#95a5a6';
                        ctx.fillText('?', centerX, centerY);
                    }
                }
            }

            // ç»˜åˆ¶ç®­å¤´ï¼ˆå¦‚æœå¯ç”¨ï¼‰
            if (animationState.showArrows && dependentCells.length > 0) {
                drawArrows();
            }

            // ç»˜åˆ¶æœ€ä¼˜è§£è·¯å¾„ï¼ˆå¦‚æœå¯ç”¨ï¼‰
            if (animationState.showOptimalPath) {
                drawOptimalPath();
            }
        }

        // ç»˜åˆ¶ç®­å¤´
        function drawArrows() {
            const currentX = headerSize + highlightedCell.j * cellSize + cellSize / 2;
            const currentY = headerSize + highlightedCell.i * cellSize + cellSize / 2;

            dependentCells.forEach(depCell => {
                const depX = headerSize + depCell.j * cellSize + cellSize / 2;
                const depY = headerSize + depCell.i * cellSize + cellSize / 2;

                // è®¾ç½®ç®­å¤´é¢œè‰²
                if (depCell.type === 'no_take') {
                    ctx.strokeStyle = '#e67e22';
                    ctx.fillStyle = '#e67e22';
                } else {
                    ctx.strokeStyle = '#2ecc71';
                    ctx.fillStyle = '#2ecc71';
                }

                ctx.lineWidth = 2;

                // è®¡ç®—ç®­å¤´æ–¹å‘
                const dx = currentX - depX;
                const dy = currentY - depY;
                const distance = Math.sqrt(dx * dx + dy * dy);

                // å¦‚æœè·ç¦»å¤ªçŸ­ï¼Œä¸ç»˜åˆ¶ç®­å¤´
                if (distance < cellSize / 2) return;

                // è®¡ç®—èµ·ç‚¹å’Œç»ˆç‚¹ï¼ˆä»ä¾èµ–å•å…ƒæ ¼è¾¹ç¼˜å¼€å§‹ï¼‰
                const startX = depX + (dx / distance) * (cellSize / 2);
                const startY = depY + (dy / distance) * (cellSize / 2);
                const endX = currentX - (dx / distance) * (cellSize / 2);
                const endY = currentY - (dy / distance) * (cellSize / 2);

                // ç»˜åˆ¶ç®­å¤´çº¿
                ctx.beginPath();
                ctx.moveTo(startX, startY);
                ctx.lineTo(endX, endY);
                ctx.stroke();

                // ç»˜åˆ¶ç®­å¤´å¤´éƒ¨
                const angle = Math.atan2(dy, dx);
                ctx.beginPath();
                ctx.moveTo(endX, endY);
                ctx.lineTo(
                    endX - arrowLength * Math.cos(angle - Math.PI / 6),
                    endY - arrowLength * Math.sin(angle - Math.PI / 6)
                );
                ctx.lineTo(
                    endX - arrowLength * Math.cos(angle + Math.PI / 6),
                    endY - arrowLength * Math.sin(angle + Math.PI / 6)
                );
                ctx.closePath();
                ctx.fill();
            });
        }

        // ç»˜åˆ¶æœ€ä¼˜è§£è·¯å¾„
        function drawOptimalPath() {
            // ä»å³ä¸‹è§’å¼€å§‹å›æº¯
            let i = itemCount;
            let j = capacity;
            let path = [];

            while (i > 0 && j > 0) {
                path.push({ i: i, j: j });

                if (decisions[i][j] === 0) {
                    // ä¸æ”¾å…¥ï¼Œå‘ä¸Šç§»åŠ¨
                    i--;
                } else if (decisions[i][j] === 1) {
                    // æ”¾å…¥ï¼Œå‘å·¦ä¸Šæ–¹ç§»åŠ¨
                    j -= items[i - 1].weight;
                    i--;
                } else {
                    break;
                }
            }

            // ç»˜åˆ¶è·¯å¾„
            ctx.strokeStyle = '#f1c40f';
            ctx.lineWidth = 3;
            ctx.setLineDash([5, 5]);

            ctx.beginPath();

            // æŒ‰é¡ºåºè¿æ¥è·¯å¾„ç‚¹
            for (let k = 0; k < path.length; k++) {
                const cell = path[k];
                const x = headerSize + cell.j * cellSize + cellSize / 2;
                const y = headerSize + cell.i * cellSize + cellSize / 2;

                if (k === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }

            ctx.stroke();
            ctx.setLineDash([]);

            // é«˜äº®è·¯å¾„ä¸Šçš„å•å…ƒæ ¼
            path.forEach(cell => {
                const x = headerSize + cell.j * cellSize;
                const y = headerSize + cell.i * cellSize;

                ctx.fillStyle = 'rgba(241, 196, 15, 0.3)';
                ctx.fillRect(x, y, cellSize, cellSize);

                ctx.strokeStyle = '#f1c40f';
                ctx.lineWidth = 2;
                ctx.strokeRect(x, y, cellSize, cellSize);
            });
        }

        // æ›´æ–°çŠ¶æ€æ–‡æœ¬
        function updateStatusText(text) {
            document.getElementById('statusText').textContent = text;
        }

        // è°ƒæ•´ç”»å¸ƒå¤§å°
        function resizeCanvas() {
            const container = document.querySelector('.visualization-container');
            const width = container.clientWidth;
            const height = container.clientHeight;

            canvas.width = width;
            canvas.height = height;
        }

        // å¤„ç†ç”»å¸ƒç‚¹å‡»äº‹ä»¶ï¼ˆæ¢æŸ¥å•å…ƒæ ¼ï¼‰
        function handleCanvasClick(event) {
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;

            // è®¡ç®—ç‚¹å‡»çš„å•å…ƒæ ¼
            const j = Math.floor((x - headerSize) / cellSize);
            const i = Math.floor((y - headerSize) / cellSize);

            // æ£€æŸ¥ç‚¹å‡»æ˜¯å¦åœ¨æœ‰æ•ˆèŒƒå›´å†…
            if (i >= 1 && i <= itemCount && j >= 1 && j <= capacity && dp[i][j] >= 0) {
                // æ˜¾ç¤ºè¯¥å•å…ƒæ ¼çš„è®¡ç®—è¿‡ç¨‹
                showCellCalculation(i, j);
            }
        }

        // æ˜¾ç¤ºå•å…ƒæ ¼çš„è®¡ç®—è¿‡ç¨‹
        function showCellCalculation(i, j) {
            // é«˜äº®å½“å‰å•å…ƒæ ¼
            highlightedCell = { i: i, j: j };

            // è®¾ç½®ä¾èµ–å•å…ƒæ ¼
            dependentCells = [{ i: i - 1, j: j, type: 'no_take' }];

            if (j >= items[i - 1].weight) {
                dependentCells.push({ i: i - 1, j: j - items[i - 1].weight, type: 'take' });
            }

            // æ›´æ–°çŠ¶æ€æ–‡æœ¬
            let description = `å•å…ƒæ ¼ dp[${i}][${j}] = ${dp[i][j]} çš„è®¡ç®—è¿‡ç¨‹ï¼š\n`;
            description += `â€¢ ä¸æ”¾å…¥ç‰©å“${i}: dp[${i - 1}][${j}] = ${dp[i - 1][j]}\n`;

            if (j >= items[i - 1].weight) {
                description += `â€¢ æ”¾å…¥ç‰©å“${i}: dp[${i - 1}][${j - items[i - 1].weight}] + v[${i}] = ${dp[i - 1][j - items[i - 1].weight]} + ${items[i - 1].value} = ${dp[i - 1][j - items[i - 1].weight] + items[i - 1].value}\n`;
            } else {
                description += `â€¢ æ— æ³•æ”¾å…¥ç‰©å“${i} (é‡é‡${items[i - 1].weight} > å®¹é‡${j})\n`;
            }

            description += `â€¢ æœ€å¤§å€¼ä¸º ${dp[i][j]}`;

            if (decisions[i][j] === 0) {
                description += `ï¼Œå†³ç­–ä¸ºä¸æ”¾å…¥ç‰©å“${i}`;
            } else {
                description += `ï¼Œå†³ç­–ä¸ºæ”¾å…¥ç‰©å“${i}`;
            }

            updateStatusText(description);

            // é‡ç»˜è¡¨æ ¼
            drawTable();
        }

        // åº”ç”¨æ–°é…ç½®
        function applyNewConfig() {
            // è·å–æ–°é…ç½®
            capacity = parseInt(document.getElementById('capacity').value);
            itemCount = parseInt(document.getElementById('itemCount').value);

            // è·å–ç‰©å“æ•°æ®
            items = [];
            const inputs = document.querySelectorAll('#itemsBody input');

            for (let i = 0; i < itemCount; i++) {
                const weight = parseInt(inputs[i * 2].value);
                const value = parseInt(inputs[i * 2 + 1].value);
                items.push({ weight, value });
            }

            // é‡æ–°åˆå§‹åŒ–
            initDPTable();
            generateAnimationSteps();
            resizeCanvas();
            drawTable();

            // æ›´æ–°çŠ¶æ€
            animationState.isPlaying = false;
            document.getElementById('startBtn').textContent = "â–¶ å¼€å§‹";
            animationState.showOptimalPath = false;

            updateStatusText(`å·²åº”ç”¨æ–°é…ç½®ï¼š${itemCount}ä¸ªç‰©å“ï¼ŒèƒŒåŒ…å®¹é‡${capacity}ã€‚ç‚¹å‡»"å¼€å§‹"æŒ‰é’®å¯åŠ¨åŠ¨ç”»ã€‚`);
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // æ§åˆ¶æŒ‰é’®
            document.getElementById('startBtn').addEventListener('click', function () {
                if (!animationState.isPlaying) {
                    animationState.isPlaying = true;
                    this.textContent = "â¸ æš‚åœ";
                    nextStep();
                }
            });

            document.getElementById('pauseBtn').addEventListener('click', function () {
                animationState.isPlaying = false;
                document.getElementById('startBtn').textContent = "â–¶ å¼€å§‹";
            });

            document.getElementById('nextStepBtn').addEventListener('click', function () {
                animationState.isPlaying = false;
                document.getElementById('startBtn').textContent = "â–¶ å¼€å§‹";
                nextStep();
            });

            document.getElementById('prevStepBtn').addEventListener('click', function () {
                animationState.isPlaying = false;
                document.getElementById('startBtn').textContent = "â–¶ å¼€å§‹";
                prevStep();
            });

            document.getElementById('resetBtn').addEventListener('click', function () {
                animationState.isPlaying = false;
                document.getElementById('startBtn').textContent = "â–¶ å¼€å§‹";
                animationState.currentStep = 0;
                animationState.showOptimalPath = false;
                initDPTable();
                drawTable();
                updateStatusText("å·²é‡ç½®ã€‚ç‚¹å‡»'å¼€å§‹'æŒ‰é’®é‡æ–°å¯åŠ¨åŠ¨ç”»ã€‚");
            });

            // é€Ÿåº¦æ§åˆ¶
            document.getElementById
                <!--æ£€æµ‹åˆ°ä»£ç æˆªæ–­ï¼Œè‡ªåŠ¨ç»­å†™ä¸­...-->
                ('speedSlider').addEventListener('input', function () {
                    const speed = parseInt(this.value);
                    animationState.speed = 550 - (speed * 50); // é€Ÿåº¦å€¼ä»500msåˆ°50ms

                    const speedText = ['ææ…¢', 'å¾ˆæ…¢', 'æ…¢', 'è¾ƒæ…¢', 'ä¸­é€Ÿ', 'è¾ƒå¿«', 'å¿«', 'å¾ˆå¿«', 'æå¿«', 'æœ€å¿«'];
                    document.getElementById('speedValue').textContent = speedText[speed - 1];
                });

            // åº”ç”¨é…ç½®æŒ‰é’®
            document.getElementById('applyConfig').addEventListener('click', applyNewConfig);

            // ç‰©å“æ•°é‡å˜åŒ–æ—¶æ›´æ–°ç‰©å“è¡¨æ ¼
            document.getElementById('itemCount').addEventListener('change', function () {
                itemCount = parseInt(this.value);
                initItemsTable();
            });

            // æ˜¾ç¤ºæœ€ä¼˜è§£è·¯å¾„æŒ‰é’®
            document.getElementById('showPathBtn').addEventListener('click', function () {
                // æ£€æŸ¥è¡¨æ ¼æ˜¯å¦å·²å®Œå…¨å¡«å……
                let isComplete = true;
                for (let i = 1; i <= itemCount; i++) {
                    for (let j = 1; j <= capacity; j++) {
                        if (dp[i][j] < 0) {
                            isComplete = false;
                            break;
                        }
                    }
                    if (!isComplete) break;
                }

                if (!isComplete) {
                    updateStatusText("è¡¨æ ¼å°šæœªå®Œå…¨å¡«å……ï¼Œæ— æ³•æ˜¾ç¤ºæœ€ä¼˜è§£è·¯å¾„ã€‚è¯·å…ˆå®Œæˆè¡¨æ ¼å¡«å……ã€‚");
                    return;
                }

                animationState.showOptimalPath = !animationState.showOptimalPath;
                this.textContent = animationState.showOptimalPath ? "ğŸ” éšè—æœ€ä¼˜è§£è·¯å¾„" : "ğŸ” æ˜¾ç¤ºæœ€ä¼˜è§£è·¯å¾„";

                if (animationState.showOptimalPath) {
                    // è®¡ç®—å¹¶æ˜¾ç¤ºæœ€ä¼˜è§£
                    let i = itemCount;
                    let j = capacity;
                    let selectedItems = [];
                    let totalValue = dp[itemCount][capacity];
                    let totalWeight = 0;

                    while (i > 0 && j > 0) {
                        if (decisions[i][j] === 1) {
                            selectedItems.push(i);
                            totalWeight += items[i - 1].weight;
                            j -= items[i - 1].weight;
                        }
                        i--;
                    }

                    selectedItems.reverse();

                    let pathDescription = `æœ€ä¼˜è§£ï¼šæœ€å¤§ä»·å€¼ = ${totalValue}\n`;
                    pathDescription += `é€‰ä¸­ç‰©å“ï¼š${selectedItems.length > 0 ? selectedItems.join(', ') : 'æ— '}\n`;
                    pathDescription += `æ€»é‡é‡ï¼š${totalWeight} (å®¹é‡ï¼š${capacity})`;

                    updateStatusText(pathDescription);
                }

                drawTable();
            });

            // åˆ‡æ¢ç®­å¤´æ˜¾ç¤ºæŒ‰é’®
            document.getElementById('toggleArrowsBtn').addEventListener('click', function () {
                animationState.showArrows = !animationState.showArrows;
                this.textContent = animationState.showArrows ? "â†•ï¸ éšè—ç®­å¤´" : "â†•ï¸ æ˜¾ç¤ºç®­å¤´";
                drawTable();
            });

            // ç”»å¸ƒç‚¹å‡»äº‹ä»¶
            canvas.addEventListener('click', handleCanvasClick);

            // çª—å£å¤§å°å˜åŒ–æ—¶è°ƒæ•´ç”»å¸ƒ
            window.addEventListener('resize', function () {
                resizeCanvas();
                drawTable();
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', init);
    </script>
</body>

</html>