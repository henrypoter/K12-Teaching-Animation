<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†’æ³¡æ’åºç®—æ³•å¯è§†åŒ–</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #4A90E2;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .visualization-section {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .controls-section {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .section-title {
            color: #4A90E2;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        #canvas-container {
            width: 100%;
            height: 300px;
            position: relative;
            margin-bottom: 20px;
        }
        
        canvas {
            display: block;
            background-color: white;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .status-display {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4A90E2;
            margin-bottom: 20px;
        }
        
        .status-text {
            font-size: 1.1rem;
            font-weight: 500;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2E8B57;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        
        button {
            padding: 12px 15px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        #play-btn {
            background-color: #2E8B57;
            color: white;
        }
        
        #pause-btn {
            background-color: #FFD700;
            color: #333;
        }
        
        #next-btn {
            background-color: #4A90E2;
            color: white;
        }
        
        #reset-btn {
            background-color: #7f8c8d;
            color: white;
        }
        
        .speed-control {
            margin-bottom: 25px;
        }
        
        .speed-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #ddd;
            outline: none;
        }
        
        .data-control {
            margin-bottom: 25px;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        input[type="text"] {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
        }
        
        #random-btn {
            background-color: #FF7F50;
            color: white;
        }
        
        #apply-btn {
            background-color: #4A90E2;
            color: white;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        .code-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-top: 20px;
        }
        
        .code-container {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            overflow-x: auto;
            line-height: 1.5;
            margin-top: 15px;
        }
        
        .code-line {
            padding: 2px 0;
        }
        
        .code-line.highlighted {
            background-color: #34495e;
            border-left: 4px solid #FFD700;
            padding-left: 10px;
        }
        
        .explanation {
            margin-top: 30px;
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .explanation h3 {
            color: #4A90E2;
            margin-bottom: 15px;
        }
        
        .explanation ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }
        
        .explanation li {
            margin-bottom: 8px;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>å†’æ³¡æ’åºç®—æ³•å¯è§†åŒ–</h1>
        <p class="subtitle">ç›¸é‚»æ¯”è¾ƒ + äº¤æ¢ï¼Œåƒæ°”æ³¡ä¸€æ ·ä¸Šå‡</p>
    </header>
    
    <div class="container">
        <section class="visualization-section">
            <h2 class="section-title">æ’åºè¿‡ç¨‹å¯è§†åŒ–</h2>
            
            <div id="canvas-container">
                <canvas id="sorting-canvas" width="800" height="300"></canvas>
            </div>
            
            <div class="status-display">
                <p class="status-text" id="status-text">ç‚¹å‡»"æ’­æ”¾"å¼€å§‹æ’åºåŠ¨ç”»</p>
            </div>
            
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="comparison-count">0</div>
                    <div class="stat-label">æ¯”è¾ƒæ¬¡æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="swap-count">0</div>
                    <div class="stat-label">äº¤æ¢æ¬¡æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="pass-count">0</div>
                    <div class="stat-label">å·²å®Œæˆè½®æ¬¡</div>
                </div>
            </div>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #4A90E2;"></div>
                    <span>é»˜è®¤ï¼ˆæœªæ’åºï¼‰</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #FFD700;"></div>
                    <span>æ­£åœ¨æ¯”è¾ƒ</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #FF7F50;"></div>
                    <span>æ­£åœ¨äº¤æ¢</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #2E8B57;"></div>
                    <span>å·²æ’åº</span>
                </div>
            </div>
        </section>
        
        <section class="controls-section">
            <h2 class="section-title">æ§åˆ¶é¢æ¿</h2>
            
            <div class="controls">
                <button id="play-btn">â–¶ æ’­æ”¾</button>
                <button id="pause-btn">â¸ æš‚åœ</button>
                <button id="next-btn">â­ ä¸‹ä¸€æ­¥</button>
                <button id="reset-btn">â†º é‡ç½®</button>
            </div>
            
            <div class="speed-control">
                <div class="speed-label">
                    <span>åŠ¨ç”»é€Ÿåº¦</span>
                    <span id="speed-value">ä¸­é€Ÿ</span>
                </div>
                <input type="range" id="speed-slider" min="1" max="10" value="5">
            </div>
            
            <div class="data-control">
                <h3 class="section-title">æ•°æ®è®¾ç½®</h3>
                <div class="input-group">
                    <input type="text" id="data-input" value="5, 3, 8, 1, 6, 9, 2, 7, 4">
                    <button id="apply-btn">åº”ç”¨</button>
                </div>
                <button id="random-btn">ğŸ² éšæœºç”Ÿæˆæ•°æ®</button>
            </div>
        </section>
    </div>
    
    <section class="code-section">
        <h2 class="section-title">ç®—æ³•ä¼ªä»£ç </h2>
        <div class="code-container">
            <div class="code-line">function bubbleSort(arr) {</div>
            <div class="code-line" id="line1">  let n = arr.length;</div>
            <div class="code-line" id="line2">  for (let i = 0; i < n-1; i++) {</div>
            <div class="code-line" id="line3">    for (let j = 0; j < n-i-1; j++) {</div>
            <div class="code-line" id="line4">      // æ¯”è¾ƒç›¸é‚»å…ƒç´ </div>
            <div class="code-line" id="line5">      if (arr[j] > arr[j+1]) {</div>
            <div class="code-line" id="line6">        // äº¤æ¢å…ƒç´ </div>
            <div class="code-line" id="line7">        swap(arr[j], arr[j+1]);</div>
            <div class="code-line" id="line8">      }</div>
            <div class="code-line" id="line9">    }</div>
            <div class="code-line" id="line10">    // ç¬¬iè½®ç»“æŸï¼Œarr[n-i-1]å·²å°±ä½</div>
            <div class="code-line" id="line11">  }</div>
            <div class="code-line" id="line12">}</div>
        </div>
    </section>
    
    <section class="explanation">
        <h3>å†’æ³¡æ’åºç®—æ³•è¯´æ˜</h3>
        <ul>
            <li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šé‡å¤éå†è¦æ’åºçš„æ•°åˆ—ï¼Œä¸€æ¬¡æ¯”è¾ƒä¸¤ä¸ªç›¸é‚»å…ƒç´ ï¼Œå¦‚æœå®ƒä»¬çš„é¡ºåºé”™è¯¯å°±æŠŠå®ƒä»¬äº¤æ¢è¿‡æ¥ã€‚</li>
            <li><strong>ç®—æ³•æ­¥éª¤</strong>ï¼š
                <ol>
                    <li>ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œæ¯”è¾ƒç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ ã€‚</li>
                    <li>å¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼ˆå‡åºæ’åºï¼‰ï¼Œå°±äº¤æ¢å®ƒä»¬ã€‚</li>
                    <li>å¯¹æ¯ä¸€å¯¹ç›¸é‚»å…ƒç´ åšåŒæ ·çš„å·¥ä½œï¼Œä»å¼€å§‹ç¬¬ä¸€å¯¹åˆ°ç»“å°¾çš„æœ€åä¸€å¯¹ã€‚è¿™æ ·ä¸€è½®ç»“æŸåï¼Œæœ€å¤§çš„å…ƒç´ ä¼š"å†’æ³¡"åˆ°æ•°åˆ—çš„æœ«ç«¯ã€‚</li>
                    <li>é’ˆå¯¹æ‰€æœ‰çš„å…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œé™¤äº†å·²ç»æ’åºå¥½çš„å…ƒç´ ã€‚</li>
                    <li>é‡å¤æ­¥éª¤1~4ï¼Œç›´åˆ°æ’åºå®Œæˆã€‚</li>
                </ol>
            </li>
            <li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šå¹³å‡å’Œæœ€åæƒ…å†µéƒ½æ˜¯O(nÂ²)ï¼Œæœ€å¥½æƒ…å†µï¼ˆå·²æ’åºï¼‰æ˜¯O(n)ã€‚</li>
            <li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(1)ï¼Œæ˜¯åŸåœ°æ’åºç®—æ³•ã€‚</li>
            <li><strong>ç¨³å®šæ€§</strong>ï¼šç¨³å®šæ’åºç®—æ³•ï¼Œç›¸ç­‰å…ƒç´ çš„ç›¸å¯¹ä½ç½®ä¸ä¼šæ”¹å˜ã€‚</li>
        </ul>
        <p><strong>è§‚å¯Ÿæç¤º</strong>ï¼šæ³¨æ„è§‚å¯Ÿæ¯ä¸€è½®ç»“æŸåï¼Œæœ€å¤§çš„å…ƒç´ å¦‚ä½•åƒ"æ°”æ³¡"ä¸€æ ·ä¸Šå‡åˆ°æ­£ç¡®ä½ç½®ï¼Œä»¥åŠå·²æ’åºåŒºåŸŸå¦‚ä½•é€æ¸æ‰©å¤§ã€‚</p>
    </section>
    
    <footer>
        <p>å†’æ³¡æ’åºç®—æ³•å¯è§†åŒ– | è®¾è®¡ç”¨äºæ•™å­¦æ¼”ç¤º | ä½¿ç”¨HTML5 Canvaså®ç°</p>
    </footer>

    <script>
        // å…¨å±€å˜é‡
        let data = [5, 3, 8, 1, 6, 9, 2, 7, 4];
        let originalData = [...data];
        let canvas, ctx;
        let animationId = null;
        let isPlaying = false;
        let speed = 5; // 1-10ï¼Œå€¼è¶Šå¤§é€Ÿåº¦è¶Šå¿«
        let currentStep = 0;
        let totalSteps = 0;
        
        // ç®—æ³•çŠ¶æ€å˜é‡
        let i = 0; // å¤–å±‚å¾ªç¯ç´¢å¼•
        let j = 0; // å†…å±‚å¾ªç¯ç´¢å¼•
        let n = data.length;
        let comparisons = 0;
        let swaps = 0;
        let passes = 0;
        let isComparing = false;
        let isSwapping = false;
        let swapIndex = -1;
        let sortedIndices = new Set();
        
        // é¢œè‰²å®šä¹‰
        const colors = {
            default: '#4A90E2',
            comparing: '#FFD700',
            swapping: '#FF7F50',
            sorted: '#2E8B57',
            text: '#333333',
            background: '#f5f5f5',
            canvasBg: '#FFFFFF'
        };
        
        // åˆå§‹åŒ–Canvas
        function initCanvas() {
            canvas = document.getElementById('sorting-canvas');
            ctx = canvas.getContext('2d');
            
            // è®¾ç½®Canvaså°ºå¯¸ä¸ºå®¹å™¨å°ºå¯¸
            const container = document.getElementById('canvas-container');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            
            drawBars();
        }
        
        // ç»˜åˆ¶æŸ±çŠ¶å›¾
        function drawBars() {
            const width = canvas.width;
            const height = canvas.height;
            const barCount = data.length;
            const barWidth = Math.min(50, (width - 20) / barCount);
            const maxValue = Math.max(...data);
            const spacing = 5;
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, width, height);
            
            // ç»˜åˆ¶èƒŒæ™¯
            ctx.fillStyle = colors.canvasBg;
            ctx.fillRect(0, 0, width, height);
            
            // ç»˜åˆ¶æ¯ä¸ªæŸ±å­
            for (let idx = 0; idx < barCount; idx++) {
                const barHeight = (data[idx] / maxValue) * (height - 80);
                const x = (width - (barCount * (barWidth + spacing))) / 2 + idx * (barWidth + spacing);
                const y = height - 60 - barHeight;
                
                // é€‰æ‹©é¢œè‰²
                let color = colors.default;
                
                if (sortedIndices.has(idx)) {
                    color = colors.sorted;
                } else if (isSwapping && (idx === j || idx === j + 1)) {
                    color = colors.swapping;
                } else if (isComparing && (idx === j || idx === j + 1)) {
                    color = colors.comparing;
                }
                
                // ç»˜åˆ¶æŸ±å­
                ctx.fillStyle = color;
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // ç»˜åˆ¶æŸ±å­è¾¹æ¡†
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 1;
                ctx.strokeRect(x, y, barWidth, barHeight);
                
                // ç»˜åˆ¶æ•°å€¼
                ctx.fillStyle = colors.text;
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(data[idx], x + barWidth / 2, y - 10);
                
                // ç»˜åˆ¶ç´¢å¼•
                ctx.fillStyle = '#7f8c8d';
                ctx.font = '14px Arial';
                ctx.fillText(`[${idx}]`, x + barWidth / 2, height - 30);
                
                // å¦‚æœæ˜¯æ­£åœ¨æ¯”è¾ƒçš„å…ƒç´ ï¼Œç»˜åˆ¶æ¯”è¾ƒç¬¦å·
                if (isComparing && (idx === j || idx === j + 1)) {
                    ctx.fillStyle = '#DC143C';
                    ctx.font = 'bold 20px Arial';
                    
                    if (idx === j) {
                        ctx.fillText("â†", x + barWidth / 2, y - 40);
                    } else {
                        ctx.fillText("â†’", x + barWidth / 2, y - 40);
                    }
                    
                    // åœ¨ä¸¤è€…ä¹‹é—´ç»˜åˆ¶æ¯”è¾ƒç¬¦å·
                    if (idx === j) {
                        const midX = x + barWidth + spacing / 2;
                        ctx.fillText(data[j] > data[j+1] ? ">" : "â‰¤", midX, height - 80);
                    }
                }
            }
            
            // ç»˜åˆ¶å·²æ’åºåŒºåŸŸæŒ‡ç¤ºçº¿
            if (sortedIndices.size > 0) {
                const sortedCount = sortedIndices.size;
                const xPos = (width - (barCount * (barWidth + spacing))) / 2 + 
                            (barCount - sortedCount) * (barWidth + spacing) - spacing/2;
                
                ctx.strokeStyle = '#2E8B57';
                ctx.lineWidth = 3;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(xPos, 20);
                ctx.lineTo(xPos, height - 40);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // æ·»åŠ æ ‡ç­¾
                ctx.fillStyle = '#2E8B57';
                ctx.font = 'bold 14px Arial';
                ctx.fillText("å·²æ’åºåŒº", xPos + 10, 30);
            }
            
            // æ›´æ–°çŠ¶æ€æ–‡æœ¬
            updateStatusText();
        }
        
        // æ›´æ–°çŠ¶æ€æ–‡æœ¬
        function updateStatusText() {
            let statusText = "";
            
            if (isComparing) {
                statusText = `æ­£åœ¨æ¯”è¾ƒç¬¬ ${j} ä¸ªå…ƒç´ (${data[j]}) å’Œç¬¬ ${j+1} ä¸ªå…ƒç´ (${data[j+1]})`;
                if (data[j] > data[j+1]) {
                    statusText += ` â†’ ${data[j]} > ${data[j+1]}ï¼Œéœ€è¦äº¤æ¢`;
                } else {
                    statusText += ` â†’ ${data[j]} â‰¤ ${data[j+1]}ï¼Œæ— éœ€äº¤æ¢`;
                }
            } else if (isSwapping) {
                statusText = `æ­£åœ¨äº¤æ¢ç¬¬ ${j} ä¸ªå…ƒç´ (${data[j+1]}) å’Œç¬¬ ${j+1} ä¸ªå…ƒç´ (${data[j]})`;
            } else if (passes === n - 1) {
                statusText = `æ’åºå®Œæˆï¼æ€»å…±è¿›è¡Œäº† ${comparisons} æ¬¡æ¯”è¾ƒå’Œ ${swaps} æ¬¡äº¤æ¢`;
            } else if (j === n - i - 1) {
                statusText = `ç¬¬ ${passes} è½®ç»“æŸï¼Œå…ƒç´  ${data[n - passes - 1]} å·²å°±ä½`;
            } else if (!isPlaying && currentStep === 0) {
                statusText = "ç‚¹å‡»'æ’­æ”¾'å¼€å§‹æ’åºåŠ¨ç”»";
            } else {
                statusText = `ç¬¬ ${passes} è½®ï¼Œç¬¬ ${j+1}/${n-passes-1} æ¬¡æ¯”è¾ƒ`;
            }
            
            document.getElementById('status-text').textContent = statusText;
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            document.getElementById('comparison-count').textContent = comparisons;
            document.getElementById('swap-count').textContent = swaps;
            document.getElementById('pass-count').textContent = passes;
            
            // æ›´æ–°ä»£ç é«˜äº®
            updateCodeHighlight();
        }
        
        // æ›´æ–°ä»£ç é«˜äº®
        function updateCodeHighlight() {
            // æ¸…é™¤æ‰€æœ‰é«˜äº®
            for (let lineNum = 1; lineNum <= 12; lineNum++) {
                document.getElementById(`line${lineNum}`).classList.remove('highlighted');
            }
            
            // æ ¹æ®å½“å‰çŠ¶æ€é«˜äº®å¯¹åº”ä»£ç è¡Œ
            if (passes === n - 1) {
                // æ’åºå®Œæˆï¼Œé«˜äº®æœ€åä¸€è¡Œ
                document.getElementById('line12').classList.add('highlighted');
            } else if (j === n - i - 1) {
                // ä¸€è½®ç»“æŸ
                document.getElementById('line10').classList.add('highlighted');
            } else if (isSwapping) {
                // æ­£åœ¨äº¤æ¢
                document.getElementById('line7').classList.add('highlighted');
            } else if (isComparing) {
                // æ­£åœ¨æ¯”è¾ƒ
                if (data[j] > data[j+1]) {
                    document.getElementById('line5').classList.add('highlighted');
                } else {
                    document.getElementById('line8').classList.add('highlighted');
                }
            } else if (j < n - i - 1) {
                // å†…å±‚å¾ªç¯
                document.getElementById('line3').classList.add('highlighted');
            } else {
                // å¤–å±‚å¾ªç¯
                document.getElementById('line2').classList.add('highlighted');
            }
        }
        
        // æ‰§è¡Œä¸€æ­¥æ’åº
        function step() {
            if (passes >= n - 1) {
                // æ’åºå·²å®Œæˆ
                isPlaying = false;
                document.getElementById('play-btn').textContent = "â–¶ æ’­æ”¾";
                return;
            }
            
            currentStep++;
            
            if (j < n - i - 1) {
                // æ‰§è¡Œæ¯”è¾ƒ
                isComparing = true;
                isSwapping = false;
                comparisons++;
                
                drawBars();
                
                // å»¶è¿Ÿåå†³å®šæ˜¯å¦äº¤æ¢
                setTimeout(() => {
                    if (data[j] > data[j + 1]) {
                        // éœ€è¦äº¤æ¢
                        isComparing = false;
                        isSwapping = true;
                        swapIndex = j;
                        
                        // æ‰§è¡Œäº¤æ¢
                        [data[j], data[j + 1]] = [data[j + 1], data[j]];
                        swaps++;
                        
                        drawBars();
                        
                        // äº¤æ¢å®Œæˆåï¼Œå‡†å¤‡ä¸‹ä¸€æ¬¡æ¯”è¾ƒ
                        setTimeout(() => {
                            isSwapping = false;
                            j++;
                            if (isPlaying) {
                                setTimeout(step, 1000 / speed);
                            }
                        }, 800 / speed);
                    } else {
                        // ä¸éœ€è¦äº¤æ¢ï¼Œç›´æ¥è¿›è¡Œä¸‹ä¸€æ¬¡æ¯”è¾ƒ
                        isComparing = false;
                        j++;
                        if (isPlaying) {
                            setTimeout(step, 800 / speed);
                        }
                    }
                }, 800 / speed);
            } else {
                // ä¸€è½®ç»“æŸ
                sortedIndices.add(n - passes - 1);
                passes++;
                i++;
                j = 0;
                
                if (isPlaying) {
                    setTimeout(step, 1000 / speed);
                }
            }
            
            drawBars();
        }
        
        // å¼€å§‹/æš‚åœåŠ¨ç”»
        function togglePlay() {
            if (passes >= n - 1) {
                reset();
                return;
            }
            
            if (isPlaying) {
                // æš‚åœ
                isPlaying = false;
                document.getElementById('play-btn').textContent = "â–¶ æ’­æ”¾";
            } else {
                // å¼€å§‹
                isPlaying = true;
                document.getElementById('play-btn').textContent = "â¸ æš‚åœ";
                step();
            }
        }
        
        // ä¸‹ä¸€æ­¥
        function nextStep() {
            if (passes >= n - 1) return;
            
            if (isPlaying) {
                isPlaying = false;
                document.getElementById('play-btn').textContent = "â–¶ æ’­æ”¾";
            }
            
            step();
        }
        
        // é‡ç½®
        function reset() {
            // åœæ­¢åŠ¨ç”»
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            // é‡ç½®çŠ¶æ€
            data = [...originalData];
            i = 0;
            j = 0;
            n = data.length;
            comparisons = 0;
            swaps = 0;
            passes = 0;
            isComparing = false;
            isSwapping = false;
            swapIndex = -1;
            sortedIndices.clear();
            isPlaying = false;
            currentStep = 0;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('play-btn').textContent = "â–¶ æ’­æ”¾";
            
            // é‡æ–°ç»˜åˆ¶
            drawBars();
        }
        
        // åº”ç”¨æ–°æ•°æ®
        function applyData() {
            const input = document.getElementById('data-input').value;
            const newData = input.split(',').map(num => parseInt(num.trim())).filter(num => !isNaN(num));
            
            if (newData.length < 2) {
                alert("è¯·è¾“å…¥è‡³å°‘2ä¸ªæœ‰æ•ˆçš„æ•°å­—ï¼Œç”¨é€—å·åˆ†éš”");
                return;
            }
            
            if (newData.length > 15) {
                alert("ä¸ºäº†å¯è§†åŒ–æ•ˆæœï¼Œè¯·ä¸è¦è¶…è¿‡15ä¸ªæ•°å­—");
                return;
            }
            
            originalData = [...newData];
            reset();
        }
        
        // ç”Ÿæˆéšæœºæ•°æ®
        function generateRandomData() {
            const count = Math.floor(Math.random() * 8) + 5; // 5-12ä¸ªæ•°å­—
            const newData = [];
            
            for (let i = 0; i < count; i++) {
                newData.push(Math.floor(Math.random() * 20) + 1);
            }
            
            document.getElementById('data-input').value = newData.join(', ');
            originalData = [...newData];
            reset();
        }
        
        // æ›´æ–°é€Ÿåº¦
        function updateSpeed() {
            const slider = document.getElementById('speed-slider');
            speed = parseInt(slider.value);
            
            const speedValue = document.getElementById('speed-value');
            if (speed <= 3) {
                speedValue.textContent = "æ…¢é€Ÿ";
            } else if (speed <= 7) {
                speedValue.textContent = "ä¸­é€Ÿ";
            } else {
                speedValue.textContent = "å¿«é€Ÿ";
            }
        }
        
        // çª—å£å¤§å°æ”¹å˜æ—¶è°ƒæ•´Canvas
        window.addEventListener('resize', () => {
            initCanvas();
        });
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            initCanvas();
            
            // äº‹ä»¶ç›‘å¬
            document.getElementById('play-btn').addEventListener('click', togglePlay);
            document.getElementById('pause-btn').addEventListener('click', () => {
                if (isPlaying) {
                    isPlaying = false;
                    document.getElementById('play-btn').textContent = "â–¶ æ’­æ”¾";
                }
            });
            document.getElementById('next-btn').addEventListener('click', nextStep);
            document.getElementById('reset-btn').addEventListener('click', reset);
            document.getElementById('apply-btn').addEventListener('click', applyData);
            document.getElementById('random-btn').addEventListener('click', generateRandomData);
            document.getElementById('speed-slider').addEventListener('input', updateSpeed);
            
            // åˆå§‹åŒ–é€Ÿåº¦æ˜¾ç¤º
            updateSpeed();
        });
    </script>
</body>
</html>