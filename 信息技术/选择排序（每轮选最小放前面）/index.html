<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€‰æ‹©æ’åºç®—æ³•åŠ¨ç”»æ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background-color: #f5f5f5;
            color: #424242;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        h1 {
            color: #2196f3;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #757575;
            font-size: 1.1em;
        }

        .container {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        @media (min-width: 900px) {
            .container {
                flex-direction: row;
            }
            
            .left-panel {
                flex: 1;
            }
            
            .right-panel {
                flex: 1;
            }
        }

        .panel {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        h2 {
            color: #424242;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        .algorithm-explanation {
            margin-bottom: 25px;
        }

        .algorithm-explanation p {
            margin-bottom: 15px;
        }

        .pseudo-code {
            background-color: #f8f9fa;
            border-left: 4px solid #2196f3;
            padding: 15px;
            font-family: 'Consolas', 'Monaco', monospace;
            line-height: 1.8;
            margin-bottom: 25px;
            border-radius: 0 5px 5px 0;
        }

        .pseudo-code .highlight {
            background-color: #fff176;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 25px;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-primary {
            background-color: #2196f3;
            color: white;
        }

        .btn-primary:hover {
            background-color: #0d8bf2;
        }

        .btn-secondary {
            background-color: #42a5f5;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #2b97f3;
        }

        .btn-success {
            background-color: #4caf50;
            color: white;
        }

        .btn-success:hover {
            background-color: #3d8b40;
        }

        .btn-warning {
            background-color: #ff9800;
            color: white;
        }

        .btn-warning:hover {
            background-color: #e68900;
        }

        .btn-reset {
            background-color: #757575;
            color: white;
        }

        .btn-reset:hover {
            background-color: #616161;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .speed-control label {
            font-weight: 600;
        }

        .speed-control input {
            flex-grow: 1;
        }

        .visualization-container {
            position: relative;
            height: 400px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            background-color: white;
        }

        #animation-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .status-panel {
            margin-top: 25px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #a5d6a7;
        }

        .status-title {
            font-weight: 700;
            color: #2e7d32;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .status-content {
            font-size: 1.05em;
            line-height: 1.8;
        }

        .variables {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .variable {
            background-color: white;
            padding: 10px 15px;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            min-width: 120px;
        }

        .variable-name {
            font-weight: 700;
            color: #2196f3;
            margin-bottom: 5px;
        }

        .variable-value {
            font-size: 1.3em;
            font-weight: 700;
            color: #ef5350;
            text-align: center;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 25px;
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .legend-text {
            font-size: 0.9em;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
            color: #757575;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <header>
        <h1>é€‰æ‹©æ’åºç®—æ³•åŠ¨ç”»æ¼”ç¤º</h1>
        <p class="subtitle">æ¯è½®é€‰æ‹©æœ€å°å€¼æ”¾åˆ°å‰é¢ - å¯è§†åŒ–ç†è§£æ’åºè¿‡ç¨‹</p>
    </header>

    <div class="container">
        <div class="left-panel">
            <div class="panel">
                <h2>ç®—æ³•åŸç†</h2>
                <div class="algorithm-explanation">
                    <p><strong>é€‰æ‹©æ’åº</strong>æ˜¯ä¸€ç§ç®€å•ç›´è§‚çš„æ’åºç®—æ³•ã€‚å®ƒçš„å·¥ä½œåŸç†æ˜¯ï¼š</p>
                    <p>1. é¦–å…ˆåœ¨æœªæ’åºåºåˆ—ä¸­æ‰¾åˆ°æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œå­˜æ”¾åˆ°æ’åºåºåˆ—çš„èµ·å§‹ä½ç½®ã€‚</p>
                    <p>2. å†ä»å‰©ä½™æœªæ’åºå…ƒç´ ä¸­ç»§ç»­å¯»æ‰¾æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œç„¶åæ”¾åˆ°å·²æ’åºåºåˆ—çš„æœ«å°¾ã€‚</p>
                    <p>3. é‡å¤ç¬¬äºŒæ­¥ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ å‡æ’åºå®Œæ¯•ã€‚</p>
                    <p>æœ¬åŠ¨ç”»æ¼”ç¤ºçš„æ˜¯<strong>æ¯è½®é€‰æ‹©æœ€å°å€¼æ”¾åˆ°å‰é¢</strong>çš„ç‰ˆæœ¬ã€‚</p>
                </div>

                <h2>ä¼ªä»£ç </h2>
                <div class="pseudo-code" id="pseudo-code">
                    for i = 0 to n-1:<br>
                    &nbsp;&nbsp;minIndex = i<br>
                    &nbsp;&nbsp;for j = i+1 to n:<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;if array[j] < array[minIndex]:<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;minIndex = j<br>
                    &nbsp;&nbsp;swap(array[i], array[minIndex])
                </div>

                <h2>æ§åˆ¶é¢æ¿</h2>
                <div class="controls">
                    <button id="prev-btn" class="btn-secondary">
                        <span>â—€</span> ä¸Šä¸€æ­¥
                    </button>
                    <button id="next-btn" class="btn-primary">
                        ä¸‹ä¸€æ­¥ <span>â–¶</span>
                    </button>
                    <button id="play-pause-btn" class="btn-success">
                        <span id="play-icon">â–¶</span> <span id="play-text">æ’­æ”¾</span>
                    </button>
                    <button id="reset-btn" class="btn-reset">
                        <span>â†º</span> é‡ç½®
                    </button>
                    <button id="randomize-btn" class="btn-warning">
                        <span>ğŸ²</span> éšæœºæ•°æ®
                    </button>
                </div>

                <div class="speed-control">
                    <label for="speed-slider">åŠ¨ç”»é€Ÿåº¦:</label>
                    <input type="range" id="speed-slider" min="1" max="10" value="5">
                    <span id="speed-value">ä¸­é€Ÿ</span>
                </div>
            </div>

            <div class="panel status-panel">
                <div class="status-title">å½“å‰çŠ¶æ€</div>
                <div class="status-content" id="status-text">
                    ç‚¹å‡»"ä¸‹ä¸€æ­¥"å¼€å§‹æ’åºæ¼”ç¤º...
                </div>
                
                <div class="variables">
                    <div class="variable">
                        <div class="variable-name">å½“å‰è½®æ¬¡ (i)</div>
                        <div class="variable-value" id="var-i">0</div>
                    </div>
                    <div class="variable">
                        <div class="variable-name">æœ€å°å€¼ç´¢å¼• (minIndex)</div>
                        <div class="variable-value" id="var-min">0</div>
                    </div>
                    <div class="variable">
                        <div class="variable-name">æ¯”è¾ƒç´¢å¼• (j)</div>
                        <div class="variable-value" id="var-j">0</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="right-panel">
            <div class="panel">
                <h2>æ’åºè¿‡ç¨‹å¯è§†åŒ–</h2>
                <div class="visualization-container">
                    <canvas id="animation-canvas"></canvas>
                </div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #a5d6a7;"></div>
                        <div class="legend-text">å·²æ’åº</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #e0e0e0;"></div>
                        <div class="legend-text">æœªæ’åº</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #ef5350;"></div>
                        <div class="legend-text">å½“å‰æœ€å°å€¼</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #42a5f5;"></div>
                        <div class="legend-text">æ­£åœ¨æ¯”è¾ƒ</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #fff176;"></div>
                        <div class="legend-text">äº¤æ¢ä½ç½®</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>é€‰æ‹©æ’åºç®—æ³•åŠ¨ç”»æ¼”ç¤º | è®¾è®¡ç”¨äºæ•™å­¦ç›®çš„ | æ—¶é—´å¤æ‚åº¦: O(nÂ²)</p>
    </footer>

    <script>
        // å…¨å±€å˜é‡
        let array = [];
        let arraySize = 10;
        let animationSteps = [];
        let currentStep = 0;
        let isPlaying = false;
        let playInterval;
        let animationSpeed = 300; // æ¯«ç§’
        let isAnimating = false;
        
        // é¢œè‰²å®šä¹‰
        const colors = {
            sorted: '#a5d6a7',      // å·²æ’åº - ç»¿è‰²
            unsorted: '#e0e0e0',    // æœªæ’åº - æµ…ç°è‰²
            currentMin: '#ef5350',  // å½“å‰æœ€å°å€¼ - çº¢è‰²
            comparing: '#42a5f5',   // æ­£åœ¨æ¯”è¾ƒ - è“è‰²
            swapping: '#fff176',    // äº¤æ¢ä½ç½® - é»„è‰²
            default: '#757575'      // é»˜è®¤ - ç°è‰²
        };
        
        // ç®—æ³•çŠ¶æ€
        let algorithmState = {
            i: 0,           // å½“å‰è½®æ¬¡
            minIndex: 0,    // å½“å‰æœ€å°å€¼ç´¢å¼•
            j: 0,           // å½“å‰æ¯”è¾ƒç´¢å¼•
            stepDescription: 'åˆå§‹åŒ–',
            isComparing: false,
            isSwapping: false,
            swapFrom: -1,
            swapTo: -1,
            sortedIndices: []  // å·²æ’åºçš„ç´¢å¼•
        };
        
        // åˆå§‹åŒ–
        function init() {
            generateRandomArray();
            generateAnimationSteps();
            setupCanvas();
            draw();
            updateStatus();
            updatePseudoCodeHighlight();
        }
        
        // ç”Ÿæˆéšæœºæ•°ç»„
        function generateRandomArray() {
            array = [];
            for (let i = 0; i < arraySize; i++) {
                array.push(Math.floor(Math.random() * 90) + 10); // 10-99ä¹‹é—´çš„éšæœºæ•°
            }
            
            // é‡ç½®ç®—æ³•çŠ¶æ€
            algorithmState = {
                i: 0,
                minIndex: 0,
                j: 1,
                stepDescription: 'åˆå§‹åŒ–æ•°ç»„',
                isComparing: false,
                isSwapping: false,
                swapFrom: -1,
                swapTo: -1,
                sortedIndices: []
            };
            
            currentStep = 0;
            updateVariablesDisplay();
        }
        
        // ç”ŸæˆåŠ¨ç”»æ­¥éª¤
        function generateAnimationSteps() {
            animationSteps = [];
            const arr = [...array];
            const steps = [];
            const sortedIndices = [];
            
            // å¤åˆ¶æ•°ç»„ç”¨äºæ¨¡æ‹Ÿ
            const simArray = [...arr];
            const n = simArray.length;
            
            // åˆå§‹çŠ¶æ€
            steps.push({
                type: 'init',
                i: 0,
                minIndex: 0,
                j: 1,
                description: 'åˆå§‹åŒ–ï¼šå‡†å¤‡å¼€å§‹ç¬¬ä¸€è½®æ’åº',
                sortedIndices: [...sortedIndices]
            });
            
            // é€‰æ‹©æ’åºç®—æ³•æ­¥éª¤ç”Ÿæˆ
            for (let i = 0; i < n - 1; i++) {
                let minIndex = i;
                
                // æ­¥éª¤ï¼šå¼€å§‹æ–°çš„ä¸€è½®ï¼Œè®¾ç½®minIndexä¸ºi
                steps.push({
                    type: 'newRound',
                    i: i,
                    minIndex: i,
                    j: i + 1,
                    description: `ç¬¬${i+1}è½®ï¼šè®¾ç½®æœ€å°å€¼ä¸ºç´¢å¼•${i}ï¼ˆå€¼ï¼š${simArray[i]}ï¼‰`,
                    sortedIndices: [...sortedIndices]
                });
                
                // å†…å±‚å¾ªç¯ï¼šå¯»æ‰¾æœ€å°å€¼
                for (let j = i + 1; j < n; j++) {
                    // æ­¥éª¤ï¼šæ¯”è¾ƒarr[j]å’Œå½“å‰æœ€å°å€¼
                    steps.push({
                        type: 'compare',
                        i: i,
                        minIndex: minIndex,
                        j: j,
                        description: `æ¯”è¾ƒï¼šç´¢å¼•${j}çš„å€¼${simArray[j]} < å½“å‰æœ€å°å€¼${simArray[minIndex]}?`,
                        sortedIndices: [...sortedIndices]
                    });
                    
                    if (simArray[j] < simArray[minIndex]) {
                        minIndex = j;
                        
                        // æ­¥éª¤ï¼šæ‰¾åˆ°æ–°çš„æœ€å°å€¼
                        steps.push({
                            type: 'newMin',
                            i: i,
                            minIndex: minIndex,
                            j: j,
                            description: `å‘ç°æ–°çš„æœ€å°å€¼ï¼šç´¢å¼•${minIndex}ï¼ˆå€¼ï¼š${simArray[minIndex]}ï¼‰`,
                            sortedIndices: [...sortedIndices]
                        });
                    }
                }
                
                // å¦‚æœæœ€å°å€¼ä¸æ˜¯å½“å‰ä½ç½®ï¼Œéœ€è¦äº¤æ¢
                if (minIndex !== i) {
                    // æ­¥éª¤ï¼šå‡†å¤‡äº¤æ¢
                    steps.push({
                        type: 'prepareSwap',
                        i: i,
                        minIndex: minIndex,
                        j: -1,
                        description: `å‡†å¤‡äº¤æ¢ï¼šå°†æœ€å°å€¼${simArray[minIndex]}æ”¾åˆ°ä½ç½®${i}`,
                        sortedIndices: [...sortedIndices],
                        swapFrom: minIndex,
                        swapTo: i
                    });
                    
                    // æ‰§è¡Œäº¤æ¢ï¼ˆåœ¨æ¨¡æ‹Ÿæ•°ç»„ä¸­ï¼‰
                    [simArray[i], simArray[minIndex]] = [simArray[minIndex], simArray[i]];
                    
                    // æ­¥éª¤ï¼šå®Œæˆäº¤æ¢
                    steps.push({
                        type: 'swap',
                        i: i,
                        minIndex: minIndex,
                        j: -1,
                        description: `å®Œæˆäº¤æ¢ï¼šç´¢å¼•${i}å’Œç´¢å¼•${minIndex}çš„å€¼å·²äº¤æ¢`,
                        sortedIndices: [...sortedIndices],
                        swapFrom: minIndex,
                        swapTo: i
                    });
                } else {
                    // æ­¥éª¤ï¼šæ— éœ€äº¤æ¢
                    steps.push({
                        type: 'noSwap',
                        i: i,
                        minIndex: minIndex,
                        j: -1,
                        description: `æœ€å°å€¼å·²åœ¨æ­£ç¡®ä½ç½®ï¼Œæ— éœ€äº¤æ¢`,
                        sortedIndices: [...sortedIndices]
                    });
                }
                
                // æœ¬è½®ç»“æŸï¼Œiä½ç½®å·²æ’åº
                sortedIndices.push(i);
                
                // æ­¥éª¤ï¼šæœ¬è½®å®Œæˆ
                steps.push({
                    type: 'roundComplete',
                    i: i,
                    minIndex: minIndex,
                    j: -1,
                    description: `ç¬¬${i+1}è½®å®Œæˆï¼šç´¢å¼•${i}å·²æ’åº`,
                    sortedIndices: [...sortedIndices]
                });
            }
            
            // æœ€åä¸€ä¸ªå…ƒç´ è‡ªåŠ¨æ’åº
            sortedIndices.push(n - 1);
            
            // æ­¥éª¤ï¼šæ’åºå®Œæˆ
            steps.push({
                type: 'complete',
                i: n - 1,
                minIndex: -1,
                j: -1,
                description: 'æ’åºå®Œæˆï¼æ‰€æœ‰å…ƒç´ å·²æŒ‰å‡åºæ’åˆ—',
                sortedIndices: [...sortedIndices]
            });
            
            animationSteps = steps;
        }
        
        // è®¾ç½®Canvas
        function setupCanvas() {
            const canvas = document.getElementById('animation-canvas');
            const container = document.querySelector('.visualization-container');
            
            // è®¾ç½®Canvaså°ºå¯¸ä¸ºå®¹å™¨å°ºå¯¸
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        }
        
        // ç»˜åˆ¶å‡½æ•°
        function draw() {
            const canvas = document.getElementById('animation-canvas');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, width, height);
            
            // è®¡ç®—æŸ±çŠ¶å›¾å‚æ•°
            const barCount = array.length;
            const barWidth = Math.min(60, (width - 40) / barCount);
            const spacing = (width - barWidth * barCount) / (barCount + 1);
            const maxValue = Math.max(...array);
            const scale = (height - 120) / maxValue; // ç•™å‡ºç©ºé—´ç»™æ ‡ç­¾
            
            // ç»˜åˆ¶æ¯ä¸ªæŸ±å­
            for (let i = 0; i < barCount; i++) {
                const x = spacing + i * (barWidth + spacing);
                const barHeight = array[i] * scale;
                const y = height - 80 - barHeight;
                
                // ç¡®å®šæŸ±å­é¢œè‰²
                let color = colors.unsorted;
                
                if (algorithmState.sortedIndices.includes(i)) {
                    color = colors.sorted; // å·²æ’åº
                } else if (algorithmState.isSwapping && 
                          (i === algorithmState.swapFrom || i === algorithmState.swapTo)) {
                    color = colors.swapping; // äº¤æ¢ä½ç½®
                } else if (i === algorithmState.minIndex) {
                    color = colors.currentMin; // å½“å‰æœ€å°å€¼
                } else if (algorithmState.isComparing && i === algorithmState.j) {
                    color = colors.comparing; // æ­£åœ¨æ¯”è¾ƒ
                }
                
                // ç»˜åˆ¶æŸ±å­
                ctx.fillStyle = color;
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // ç»˜åˆ¶æŸ±å­è¾¹æ¡†
                ctx.strokeStyle = '#424242';
                ctx.lineWidth = 1;
                ctx.strokeRect(x, y, barWidth, barHeight);
                
                // ç»˜åˆ¶æ•°å€¼
                ctx.fillStyle = '#424242';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(array[i], x + barWidth / 2, y - 10);
                
                // ç»˜åˆ¶ç´¢å¼•
                ctx.fillStyle = '#757575';
                ctx.font = '14px Arial';
                ctx.fillText(`[${i}]`, x + barWidth / 2, height - 30);
                
                // å¦‚æœå½“å‰æ˜¯iä½ç½®ï¼Œæ·»åŠ æ ‡è®°
                if (i === algorithmState.i) {
                    ctx.fillStyle = '#2196f3';
                    ctx.font = 'bold 14px Arial';
                    ctx.fillText(`i=${i}`, x + barWidth / 2, height - 50);
                }
            }
            
            // ç»˜åˆ¶å½“å‰æ­¥éª¤è¯´æ˜
            ctx.fillStyle = '#424242';
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`æ­¥éª¤: ${currentStep + 1}/${animationSteps.length}`, 20, 40);
            
            // ç»˜åˆ¶ç®—æ³•çŠ¶æ€
            ctx.font = '16px Arial';
            ctx.fillText(algorithmState.stepDescription, 20, 70);
        }
        
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus() {
            const statusElement = document.getElementById('status-text');
            if (currentStep < animationSteps.length) {
                const step = animationSteps[currentStep];
                statusElement.textContent = step.description;
                
                // æ›´æ–°ç®—æ³•çŠ¶æ€
                algorithmState.i = step.i;
                algorithmState.minIndex = step.minIndex;
                algorithmState.j = step.j;
                algorithmState.stepDescription = step.description;
                algorithmState.sortedIndices = step.sortedIndices || [];
                
                // è®¾ç½®æ¯”è¾ƒå’Œäº¤æ¢çŠ¶æ€
                algorithmState.isComparing = step.type === 'compare';
                algorithmState.isSwapping = step.type === 'prepareSwap' || step.type === 'swap';
                
                if (step.swapFrom !== undefined && step.swapTo !== undefined) {
                    algorithmState.swapFrom = step.swapFrom;
                    algorithmState.swapTo = step.swapTo;
                } else {
                    algorithmState.swapFrom = -1;
                    algorithmState.swapTo = -1;
                }
            }
            
            updateVariablesDisplay();
            updatePseudoCodeHighlight();
            draw();
        }
        
        // æ›´æ–°å˜é‡æ˜¾ç¤º
        function updateVariablesDisplay() {
            document.getElementById('var-i').textContent = algorithmState.i;
            document.getElementById('var-min').textContent = algorithmState.minIndex;
            document.getElementById('var-j').textContent = algorithmState.j >= 0 ? algorithmState.j : '-';
        }
        
        // æ›´æ–°ä¼ªä»£ç é«˜äº®
        function updatePseudoCodeHighlight() {
            const pseudoElement = document.getElementById('pseudo-code');
            let pseudoCode = `for i = 0 to n-1:<br>
&nbsp;&nbsp;minIndex = i<br>
&nbsp;&nbsp;for j = i+1 to n:<br>
&nbsp;&nbsp;&nbsp;&nbsp;if array[j] < array[minIndex]:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;minIndex = j<br>
&nbsp;&nbsp;swap(array[i], array[minIndex])`;
            
            // æ ¹æ®å½“å‰æ­¥éª¤ç±»å‹é«˜äº®ç›¸åº”çš„ä»£ç è¡Œ
            if (currentStep < animationSteps.length) {
                const step = animationSteps[currentStep];
                
                // æ ¹æ®æ­¥éª¤ç±»å‹é«˜äº®ä¸åŒçš„è¡Œ
                if (step.type === 'init' || step.type === 'newRound') {
                    pseudoCode = pseudoCode.replace('for i = 0 to n-1:', '<span class="highlight">for i = 0 to n-1:</span>');
                    pseudoCode = pseudoCode.replace('minIndex = i', '<span class="highlight">minIndex = i</span>');
                } else if (step.type === 'compare' || step.type === 'newMin') {
                    pseudoCode = pseudoCode.replace('for j = i+1 to n:', '<span class="highlight">for j = i+1 to n:</span>');
                    pseudoCode = pseudoCode.replace('if array[j] < array[minIndex]:', '<span class="highlight">if array[j] < array[minIndex]:</span>');
                    
                    if (step.type === 'newMin') {
                        pseudoCode = pseudoCode.replace('minIndex = j', '<span class="highlight">minIndex = j</span>');
                    }
                } else if (step.type === 'prepareSwap' || step.type === 'swap' || step.type === 'noSwap') {
                    pseudoCode = pseudoCode.replace('swap(array[i], array[minIndex])', '<span class="highlight">swap(array[i], array[minIndex])</span>');
                } else if (step.type === 'roundComplete') {
                    // å®Œæˆä¸€è½®ï¼Œå›åˆ°å¤–å±‚å¾ªç¯
                    pseudoCode = pseudoCode.replace('for i = 0 to n-1:', '<span class="highlight">for i = 0 to n-1:</span>');
                }
            }
            
            pseudoElement.innerHTML = pseudoCode;
        }
        
        // æ‰§è¡Œä¸‹ä¸€æ­¥
        function nextStep() {
            if (currentStep < animationSteps.length - 1) {
                currentStep++;
                updateStatus();
                
                // å¦‚æœæ˜¯æœ€åä¸€æ­¥ï¼Œåœæ­¢æ’­æ”¾
                if (currentStep === animationSteps.length - 1 && isPlaying) {
                    togglePlayPause();
                }
            }
        }
        
        // æ‰§è¡Œä¸Šä¸€æ­¥
        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                updateStatus();
            }
        }
        
        // åˆ‡æ¢æ’­æ”¾/æš‚åœ
        function togglePlayPause() {
            const playIcon = document.getElementById('play-icon');
            const playText = document.getElementById('play-text');
            
            if (isPlaying) {
                // åœæ­¢æ’­æ”¾
                clearInterval(playInterval);
                playIcon.textContent = 'â–¶';
                playText.textContent = 'æ’­æ”¾';
                isPlaying = false;
            } else {
                // å¼€å§‹æ’­æ”¾
                playIcon.textContent = 'â¸';
                playText.textContent = 'æš‚åœ';
                isPlaying = true;
                
                // å¦‚æœå·²ç»æ˜¯æœ€åä¸€æ­¥ï¼Œé‡ç½®åˆ°ç¬¬ä¸€æ­¥
                if (currentStep >= animationSteps.length - 1) {
                    currentStep = 0;
                    updateStatus();
                }
                
                playInterval = setInterval(() => {
                    if (currentStep < animationSteps.length - 1) {
                        nextStep();
                    } else {
                        togglePlayPause(); // è‡ªåŠ¨åœæ­¢
                    }
                }, animationSpeed);
            }
        }
        
        // é‡ç½®åŠ¨ç”»
        function resetAnimation() {
            // å¦‚æœæ­£åœ¨æ’­æ”¾ï¼Œå…ˆåœæ­¢
            if (isPlaying) {
                togglePlayPause();
            }
            
            currentStep = 0;
            updateStatus();
        }
        
        // æ›´æ–°åŠ¨ç”»é€Ÿåº¦
        function updateSpeed(value) {
            // å°†æ»‘å—å€¼(1-10)è½¬æ¢ä¸ºé€Ÿåº¦å€¼(600ms-100ms)
            animationSpeed = 650 - (value * 55);
            
            // æ›´æ–°æ˜¾ç¤º
            const speedText = document.getElementById('speed-value');
            if (value <= 3) {
                speedText.textContent = 'æ…¢é€Ÿ';
            } else if (value <= 7) {
                speedText.textContent = 'ä¸­é€Ÿ';
            } else {
                speedText.textContent = 'å¿«é€Ÿ';
            }
            
            // å¦‚æœæ­£åœ¨æ’­æ”¾ï¼Œé‡æ–°è®¾ç½®é—´éš”
            if (isPlaying) {
                clearInterval(playInterval);
                playInterval = setInterval(() => {
                    if (currentStep < animationSteps.length - 1) {
                        nextStep();
                    } else {
                        togglePlayPause();
                    }
                }, animationSpeed);
            }
        }
        
        // äº‹ä»¶ç›‘å¬å™¨è®¾ç½®
        function setupEventListeners() {
            // æŒ‰é’®äº‹ä»¶
            document.getElementById('prev-btn').addEventListener('click', prevStep);
            document.getElementById('next-btn').addEventListener('click', nextStep);
            document.getElementById('play-pause-btn').addEventListener('click', togglePlayPause);
            document.getElementById('reset-btn').addEventListener('click', resetAnimation);
            document.getElementById('randomize-btn').addEventListener('click', () => {
                generateRandomArray();
                generateAnimationSteps();
                resetAnimation();
            });
            
            // é€Ÿåº¦æ»‘å—äº‹ä»¶
            const speedSlider = document.getElementById('speed-slider');
            speedSlider.addEventListener('input', () => {
                updateSpeed(parseInt(speedSlider.value));
            });
            
            // çª—å£å¤§å°å˜åŒ–æ—¶è°ƒæ•´Canvas
            window.addEventListener('resize', () => {
                setupCanvas();
                draw();
            });
            
            // é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', (e) => {
                // é˜²æ­¢åœ¨è¾“å…¥æ¡†å†…è§¦å‘
                if (e.target.tagName === 'INPUT') return;
                
                switch(e.key) {
                    case 'ArrowLeft':
                        e.preventDefault();
                        prevStep();
                        break;
                    case 'ArrowRight':
                    case ' ':
                        e.preventDefault();
                        nextStep();
                        break;
                    case 'p':
                    case 'P':
                        e.preventDefault();
                        togglePlayPause();
                        break;
                    case 'r':
                    case 'R':
                        e.preventDefault();
                        resetAnimation();
                        break;
                }
            });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', () => {
            init();
            setupEventListeners();
            
            // åˆå§‹é€Ÿåº¦è®¾ç½®
            const speedSlider = document.getElementById('speed-slider');
            updateSpeed(parseInt(speedSlider.value));
        });
    </script>
</body>
</html>