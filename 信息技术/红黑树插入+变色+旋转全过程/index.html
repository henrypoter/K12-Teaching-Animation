<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çº¢é»‘æ ‘æ’å…¥è¿‡ç¨‹æ•™å­¦åŠ¨ç”»</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #2c3e50;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        header {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #2c3e50, #4a6491);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .tree-container {
            flex: 3;
            min-width: 300px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .tree-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #e8e8e8;
            padding-bottom: 8px;
        }
        
        #tree-canvas {
            flex: 1;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        
        .controls-panel {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .panel {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 20px;
        }
        
        .panel-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #e8e8e8;
            padding-bottom: 8px;
        }
        
        .control-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 12px 15px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
        }
        
        .btn-warning {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .input-group input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .preset-cases {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .case-btn {
            padding: 10px;
            background-color: #ecf0f1;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .case-btn:hover {
            background-color: #d5dbdb;
            transform: translateY(-2px);
        }
        
        .case-btn.active {
            background-color: #3498db;
            color: white;
            border-color: #2980b9;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid;
        }
        
        .info-panel {
            flex: 1;
            min-width: 300px;
        }
        
        .step-info {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
            min-height: 120px;
        }
        
        .step-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 1.1rem;
        }
        
        .step-description {
            font-size: 0.95rem;
            color: #555;
        }
        
        .properties {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .property {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #bdc3c7;
        }
        
        .property.satisfied {
            border-left-color: #2ecc71;
        }
        
        .property.violated {
            border-left-color: #e74c3c;
        }
        
        .property-check {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
        }
        
        .satisfied .property-check {
            background-color: #2ecc71;
            color: white;
        }
        
        .violated .property-check {
            background-color: #e74c3c;
            color: white;
        }
        
        .property-text {
            font-size: 0.9rem;
            flex: 1;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-top: 10px;
        }
        
        .current-step {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .node-count {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        @media (max-width: 1100px) {
            .main-content {
                flex-direction: column;
            }
            
            .control-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 600px) {
            .control-buttons {
                grid-template-columns: 1fr;
            }
            
            .preset-cases {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>çº¢é»‘æ ‘æ’å…¥è¿‡ç¨‹æ•™å­¦åŠ¨ç”»</h1>
            <p class="subtitle">å¯è§†åŒ–å±•ç¤ºçº¢é»‘æ ‘æ’å…¥èŠ‚ç‚¹åçš„å˜è‰²ä¸æ—‹è½¬å¹³è¡¡è¿‡ç¨‹ï¼Œé€šè¿‡äº¤äº’å¼åŠ¨ç”»ç†è§£çº¢é»‘æ ‘çš„å¹³è¡¡æœºåˆ¶</p>
        </header>
        
        <div class="main-content">
            <div class="tree-container">
                <h2 class="tree-title">çº¢é»‘æ ‘å¯è§†åŒ–</h2>
                <canvas id="tree-canvas" width="800" height="500"></canvas>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #666666; border-color: #000000;"></div>
                        <span>é»‘è‰²èŠ‚ç‚¹</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #FF9999; border-color: #CC3333;"></div>
                        <span>çº¢è‰²èŠ‚ç‚¹</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #FFFF99; border-color: #FF9900;"></div>
                        <span>å½“å‰ç„¦ç‚¹èŠ‚ç‚¹</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #99CCFF; border-color: #3399FF;"></div>
                        <span>å†²çªè·¯å¾„</span>
                    </div>
                </div>
            </div>
            
            <div class="controls-panel">
                <div class="panel">
                    <h2 class="panel-title">æµç¨‹æ§åˆ¶</h2>
                    
                    <div class="control-buttons">
                        <button id="prev-btn" class="btn btn-primary">
                            <span>â—€</span> ä¸Šä¸€æ­¥
                        </button>
                        <button id="play-pause-btn" class="btn btn-secondary">
                            <span id="play-icon">â–¶</span> <span id="play-text">æ’­æ”¾</span>
                        </button>
                        <button id="next-btn" class="btn btn-primary">
                            ä¸‹ä¸€æ­¥ <span>â–¶</span>
                        </button>
                        <button id="reset-btn" class="btn">
                            â†º é‡ç½®
                        </button>
                        <button id="insert-random-btn" class="btn btn-secondary">
                            ğŸ² éšæœºæ’å…¥
                        </button>
                        <button id="clear-btn" class="btn btn-warning">
                            âœ• æ¸…ç©ºæ ‘
                        </button>
                    </div>
                    
                    <div class="input-group">
                        <input type="number" id="node-value" placeholder="è¾“å…¥è¦æ’å…¥çš„æ•°å€¼" min="1" max="999" value="15">
                        <button id="insert-btn" class="btn btn-primary">æ’å…¥èŠ‚ç‚¹</button>
                    </div>
                    
                    <h3 class="panel-title">é¢„è®¾æ¡ˆä¾‹</h3>
                    <div class="preset-cases">
                        <div class="case-btn" data-case="case1">æ¡ˆä¾‹1: æ’å…¥[11,2,14,1,7]</div>
                        <div class="case-btn" data-case="case2">æ¡ˆä¾‹2: æ’å…¥[20,15,25,10,5]</div>
                        <div class="case-btn" data-case="case3">æ¡ˆä¾‹3: æ’å…¥[5,3,8,2,4,7,9]</div>
                        <div class="case-btn" data-case="case4">æ¡ˆä¾‹4: æ’å…¥[50,30,70,20,40,60,80,10]</div>
                    </div>
                </div>
                
                <div class="panel">
                    <h2 class="panel-title">çº¢é»‘æ ‘æ€§è´¨</h2>
                    <div class="properties">
                        <div class="property" id="prop1">
                            <div class="property-check">1</div>
                            <div class="property-text">æ¯ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²æˆ–é»‘è‰²</div>
                        </div>
                        <div class="property" id="prop2">
                            <div class="property-check">2</div>
                            <div class="property-text">æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²</div>
                        </div>
                        <div class="property" id="prop3">
                            <div class="property-check">3</div>
                            <div class="property-text">æ‰€æœ‰å¶å­èŠ‚ç‚¹(NIL)æ˜¯é»‘è‰²</div>
                        </div>
                        <div class="property" id="prop4">
                            <div class="property-check">4</div>
                            <div class="property-text">çº¢è‰²èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²</div>
                        </div>
                        <div class="property" id="prop5">
                            <div class="property-check">5</div>
                            <div class="property-text">ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ‰€æœ‰åä»£å¶å­èŠ‚ç‚¹çš„ç®€å•è·¯å¾„ä¸Šï¼Œé»‘è‰²èŠ‚ç‚¹æ•°ç›®ç›¸åŒ</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="info-panel panel">
                <h2 class="panel-title">å½“å‰æ­¥éª¤è¯´æ˜</h2>
                <div class="step-info">
                    <div class="step-title" id="step-title">åˆå§‹çŠ¶æ€</div>
                    <div class="step-description" id="step-description">
                        çº¢é»‘æ ‘ä¸ºç©ºï¼Œå‡†å¤‡æ’å…¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚ç‚¹å‡»"æ’å…¥èŠ‚ç‚¹"æŒ‰é’®æˆ–é€‰æ‹©ä¸€ä¸ªé¢„è®¾æ¡ˆä¾‹å¼€å§‹ã€‚
                    </div>
                </div>
                
                <h3 class="panel-title">èŠ‚ç‚¹è¯´æ˜</h3>
                <div class="step-description">
                    <p><strong>N</strong>: æ–°æ’å…¥çš„èŠ‚ç‚¹ (å½“å‰ç„¦ç‚¹)</p>
                    <p><strong>P</strong>: Nçš„çˆ¶èŠ‚ç‚¹</p>
                    <p><strong>G</strong>: Nçš„ç¥–çˆ¶èŠ‚ç‚¹ (Pçš„çˆ¶èŠ‚ç‚¹)</p>
                    <p><strong>U</strong>: Nçš„å”å”èŠ‚ç‚¹ (Pçš„å…„å¼ŸèŠ‚ç‚¹)</p>
                </div>
            </div>
        </div>
        
        <div class="status-bar">
            <div class="current-step">æ­¥éª¤: <span id="current-step">0</span>/<span id="total-steps">0</span></div>
            <div class="node-count">èŠ‚ç‚¹æ€»æ•°: <span id="node-count">0</span></div>
        </div>
    </div>

    <script>
        // çº¢é»‘æ ‘èŠ‚ç‚¹ç±»
        class RBNode {
            constructor(value, color = 'RED') {
                this.value = value;
                this.color = color; // 'RED' or 'BLACK'
                this.left = null;
                this.right = null;
                this.parent = null;
                this.x = 0; // ç”»å¸ƒä¸Šçš„xåæ ‡
                this.y = 0; // ç”»å¸ƒä¸Šçš„yåæ ‡
                this.highlight = false; // æ˜¯å¦é«˜äº®æ˜¾ç¤º
                this.highlightType = 'NONE'; // é«˜äº®ç±»å‹: 'NONE', 'FOCUS', 'CONFLICT'
                this.label = ''; // èŠ‚ç‚¹æ ‡ç­¾: 'N', 'P', 'G', 'U'
            }
            
            isRed() {
                return this.color === 'RED';
            }
            
            isBlack() {
                return this.color === 'BLACK';
            }
            
            setColor(color) {
                this.color = color;
            }
            
            toggleColor() {
                this.color = this.isRed() ? 'BLACK' : 'RED';
            }
        }

        // çº¢é»‘æ ‘ç±»
        class RedBlackTree {
            constructor() {
                this.NIL = new RBNode(null, 'BLACK'); // å¶å­èŠ‚ç‚¹
                this.root = this.NIL;
                this.history = []; // ç”¨äºè®°å½•æ“ä½œå†å²
                this.currentStep = 0;
                this.animationSteps = []; // åŠ¨ç”»æ­¥éª¤
                this.currentAnimationStep = 0;
                this.isAnimating = false;
                this.animationSpeed = 800; // åŠ¨ç”»é€Ÿåº¦(ms)
            }
            
            // æ’å…¥èŠ‚ç‚¹
            insert(value) {
                const newNode = new RBNode(value, 'RED');
                newNode.left = this.NIL;
                newNode.right = this.NIL;
                
                // è®°å½•åˆå§‹çŠ¶æ€
                this.saveState(`æ’å…¥èŠ‚ç‚¹ ${value}`, newNode);
                
                // æ ‡å‡†BSTæ’å…¥
                let parent = null;
                let current = this.root;
                
                while (current !== this.NIL) {
                    parent = current;
                    if (value < current.value) {
                        current = current.left;
                    } else {
                        current = current.right;
                    }
                }
                
                newNode.parent = parent;
                
                if (parent === null) {
                    this.root = newNode;
                    this.saveState(`èŠ‚ç‚¹ ${value} æˆä¸ºæ ¹èŠ‚ç‚¹`, newNode);
                } else if (value < parent.value) {
                    parent.left = newNode;
                    this.saveState(`èŠ‚ç‚¹ ${value} ä½œä¸ºå·¦å­èŠ‚ç‚¹æ’å…¥`, newNode);
                } else {
                    parent.right = newNode;
                    this.saveState(`èŠ‚ç‚¹ ${value} ä½œä¸ºå³å­èŠ‚ç‚¹æ’å…¥`, newNode);
                }
                
                // å¦‚æœçˆ¶èŠ‚ç‚¹æ˜¯é»‘è‰²ï¼Œç›´æ¥æ’å…¥å®Œæˆ
                if (newNode.parent === null || newNode.parent.isBlack()) {
                    newNode.setColor('BLACK');
                    this.saveState(`çˆ¶èŠ‚ç‚¹ä¸ºé»‘è‰²ï¼Œæ’å…¥å®Œæˆï¼Œå°†æ ¹èŠ‚ç‚¹æŸ“é»‘`, newNode);
                    this.fixInsert(newNode);
                    return;
                }
                
                // å¦åˆ™éœ€è¦ä¿®å¤çº¢é»‘æ ‘æ€§è´¨
                this.saveState(`çˆ¶èŠ‚ç‚¹ä¸ºçº¢è‰²ï¼Œéœ€è¦ä¿®å¤çº¢é»‘æ ‘æ€§è´¨`, newNode);
                this.fixInsert(newNode);
            }
            
            // ä¿®å¤æ’å…¥åçš„çº¢é»‘æ ‘
            fixInsert(node) {
                let current = node;
                current.highlight = true;
                current.highlightType = 'FOCUS';
                current.label = 'N';
                
                while (current !== this.root && current.parent.isRed()) {
                    this.saveState(`æ£€æŸ¥èŠ‚ç‚¹ N=${current.value} çš„çˆ¶èŠ‚ç‚¹Pä¸ºçº¢è‰²ï¼Œå­˜åœ¨å†²çª`, current);
                    
                    const parent = current.parent;
                    const grandparent = parent.parent;
                    
                    parent.label = 'P';
                    grandparent.label = 'G';
                    
                    if (parent === grandparent.left) {
                        const uncle = grandparent.right;
                        uncle.label = 'U';
                        
                        this.saveState(`çˆ¶èŠ‚ç‚¹Pæ˜¯ç¥–çˆ¶èŠ‚ç‚¹Gçš„å·¦å­èŠ‚ç‚¹ï¼Œæ£€æŸ¥å”å”èŠ‚ç‚¹U`, current, parent, grandparent, uncle);
                        
                        // æƒ…å†µ1: å”å”èŠ‚ç‚¹æ˜¯çº¢è‰²
                        if (uncle.isRed()) {
                            this.saveState(`æƒ…å†µ1: å”å”èŠ‚ç‚¹Uæ˜¯çº¢è‰²ï¼Œè¿›è¡Œé¢œè‰²ç¿»è½¬`, current, parent, grandparent, uncle);
                            
                            parent.setColor('BLACK');
                            uncle.setColor('BLACK');
                            grandparent.setColor('RED');
                            
                            this.saveState(`å°†På’ŒUæŸ“é»‘ï¼ŒGæŸ“çº¢`, current, parent, grandparent, uncle);
                            
                            current = grandparent;
                            current.label = 'N';
                            this.saveState(`å°†å½“å‰èŠ‚ç‚¹Nç§»åŠ¨åˆ°ç¥–çˆ¶èŠ‚ç‚¹Gï¼Œç»§ç»­æ£€æŸ¥`, current);
                        } else {
                            // æƒ…å†µ2: å”å”èŠ‚ç‚¹æ˜¯é»‘è‰²ï¼Œä¸”å½“å‰èŠ‚ç‚¹æ˜¯å³å­èŠ‚ç‚¹
                            if (current === parent.right) {
                                this.saveState(`æƒ…å†µ2: å”å”èŠ‚ç‚¹Uæ˜¯é»‘è‰²ï¼Œä¸”Næ˜¯Pçš„å³å­èŠ‚ç‚¹ï¼Œå·¦æ—‹P`, current, parent, grandparent, uncle);
                                current = parent;
                                current.label = 'N';
                                this.leftRotate(current);
                                this.saveState(`å·¦æ—‹åï¼ŒNå˜ä¸ºåŸæ¥çš„Pï¼Œè¿›å…¥æƒ…å†µ3`, current);
                            }
                            
                            // æƒ…å†µ3: å”å”èŠ‚ç‚¹æ˜¯é»‘è‰²ï¼Œä¸”å½“å‰èŠ‚ç‚¹æ˜¯å·¦å­èŠ‚ç‚¹
                            this.saveState(`æƒ…å†µ3: å”å”èŠ‚ç‚¹Uæ˜¯é»‘è‰²ï¼Œä¸”Næ˜¯Pçš„å·¦å­èŠ‚ç‚¹ï¼Œå³æ—‹Gå¹¶å˜è‰²`, current, parent, grandparent, uncle);
                            parent.setColor('BLACK');
                            grandparent.setColor('RED');
                            this.rightRotate(grandparent);
                            this.saveState(`å°†PæŸ“é»‘ï¼ŒGæŸ“çº¢ï¼Œå³æ—‹Gï¼Œä¿®å¤å®Œæˆ`, current, parent, grandparent, uncle);
                        }
                    } else {
                        // å¯¹ç§°æƒ…å†µï¼šçˆ¶èŠ‚ç‚¹æ˜¯å³å­èŠ‚ç‚¹
                        const uncle = grandparent.left;
                        uncle.label = 'U';
                        
                        this.saveState(`çˆ¶èŠ‚ç‚¹Pæ˜¯ç¥–çˆ¶èŠ‚ç‚¹Gçš„å³å­èŠ‚ç‚¹ï¼Œæ£€æŸ¥å”å”èŠ‚ç‚¹U`, current, parent, grandparent, uncle);
                        
                        // æƒ…å†µ1: å”å”èŠ‚ç‚¹æ˜¯çº¢è‰²
                        if (uncle.isRed()) {
                            this.saveState(`æƒ…å†µ1: å”å”èŠ‚ç‚¹Uæ˜¯çº¢è‰²ï¼Œè¿›è¡Œé¢œè‰²ç¿»è½¬`, current, parent, grandparent, uncle);
                            
                            parent.setColor('BLACK');
                            uncle.setColor('BLACK');
                            grandparent.setColor('RED');
                            
                            this.saveState(`å°†På’ŒUæŸ“é»‘ï¼ŒGæŸ“çº¢`, current, parent, grandparent, uncle);
                            
                            current = grandparent;
                            current.label = 'N';
                            this.saveState(`å°†å½“å‰èŠ‚ç‚¹Nç§»åŠ¨åˆ°ç¥–çˆ¶èŠ‚ç‚¹Gï¼Œç»§ç»­æ£€æŸ¥`, current);
                        } else {
                            // æƒ…å†µ2: å”å”èŠ‚ç‚¹æ˜¯é»‘è‰²ï¼Œä¸”å½“å‰èŠ‚ç‚¹æ˜¯å·¦å­èŠ‚ç‚¹
                            if (current === parent.left) {
                                this.saveState(`æƒ…å†µ2: å”å”èŠ‚ç‚¹Uæ˜¯é»‘è‰²ï¼Œä¸”Næ˜¯Pçš„å·¦å­èŠ‚ç‚¹ï¼Œå³æ—‹P`, current, parent, grandparent, uncle);
                                current = parent;
                                current.label = 'N';
                                this.rightRotate(current);
                                this.saveState(`å³æ—‹åï¼ŒNå˜ä¸ºåŸæ¥çš„Pï¼Œè¿›å…¥æƒ…å†µ3`, current);
                            }
                            
                            // æƒ…å†µ3: å”å”èŠ‚ç‚¹æ˜¯é»‘è‰²ï¼Œä¸”å½“å‰èŠ‚ç‚¹æ˜¯å³å­èŠ‚ç‚¹
                            this.saveState(`æƒ…å†µ3: å”å”èŠ‚ç‚¹Uæ˜¯é»‘è‰²ï¼Œä¸”Næ˜¯Pçš„å³å­èŠ‚ç‚¹ï¼Œå·¦æ—‹Gå¹¶å˜è‰²`, current, parent, grandparent, uncle);
                            parent.setColor('BLACK');
                            grandparent.setColor('RED');
                            this.leftRotate(grandparent);
                            this.saveState(`å°†PæŸ“é»‘ï¼ŒGæŸ“çº¢ï¼Œå·¦æ—‹Gï¼Œä¿®å¤å®Œæˆ`, current, parent, grandparent, uncle);
                        }
                    }
                    
                    // æ¸…é™¤æ ‡ç­¾
                    this.clearLabels();
                }
                
                // ç¡®ä¿æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²
                if (this.root.isRed()) {
                    this.saveState(`ç¡®ä¿æ ¹èŠ‚ç‚¹ä¸ºé»‘è‰²`, this.root);
                    this.root.setColor('BLACK');
                }
                
                this.clearHighlights();
                this.saveState(`æ’å…¥å®Œæˆï¼Œçº¢é»‘æ ‘æ¢å¤å¹³è¡¡`, null);
            }
            
            // å·¦æ—‹
            leftRotate(node) {
                const rightChild = node.right;
                node.right = rightChild.left;
                
                if (rightChild.left !== this.NIL) {
                    rightChild.left.parent = node;
                }
                
                rightChild.parent = node.parent;
                
                if (node.parent === null) {
                    this.root = rightChild;
                } else if (node === node.parent.left) {
                    node.parent.left = rightChild;
                } else {
                    node.parent.right = rightChild;
                }
                
                rightChild.left = node;
                node.parent = rightChild;
            }
            
            // å³æ—‹
            rightRotate(node) {
                const leftChild = node.left;
                node.left = leftChild.right;
                
                if (leftChild.right !== this.NIL) {
                    leftChild.right.parent = node;
                }
                
                leftChild.parent = node.parent;
                
                if (node.parent === null) {
                    this.root = leftChild;
                } else if (node === node.parent.right) {
                    node.parent.right = leftChild;
                } else {
                    node.parent.left = leftChild;
                }
                
                leftChild.right = node;
                node.parent = leftChild;
            }
            
            // ä¿å­˜å½“å‰çŠ¶æ€åˆ°å†å²è®°å½•
            saveState(description, ...highlightedNodes) {
                // æ¸…é™¤ä¹‹å‰çš„é«˜äº®
                this.clearHighlights();
                
                // è®¾ç½®é«˜äº®èŠ‚ç‚¹
                if (highlightedNodes && highlightedNodes.length > 0) {
                    highlightedNodes.forEach(node => {
                        if (node && node !== this.NIL) {
                            node.highlight = true;
                            if (node.label) {
                                node.highlightType = 'FOCUS';
                            } else {
                                node.highlightType = 'CONFLICT';
                            }
                        }
                    });
                }
                
                // åˆ›å»ºçŠ¶æ€å‰¯æœ¬
                const state = {
                    tree: this.cloneTree(this.root),
                    description: description,
                    step: this.currentStep + 1
                };
                
                this.history.push(state);
                this.currentStep++;
                
                // ä¸ºåŠ¨ç”»æ­¥éª¤åšå‡†å¤‡
                this.animationSteps.push({
                    tree: this.cloneTree(this.root),
                    description: description,
                    highlightedNodes: highlightedNodes.filter(n => n && n !== this.NIL).map(n => n.value)
                });
            }
            
            // å…‹éš†æ ‘ï¼ˆç”¨äºå†å²è®°å½•ï¼‰
            cloneTree(node) {
                if (node === this.NIL) return this.NIL;
                
                const clone = new RBNode(node.value, node.color);
                clone.x = node.x;
                clone.y = node.y;
                clone.highlight = node.highlight;
                clone.highlightType = node.highlightType;
                clone.label = node.label;
                
                clone.left = this.cloneTree(node.left);
                clone.right = this.cloneTree(node.right);
                
                // é‡æ–°å»ºç«‹çˆ¶å­å…³ç³»
                if (clone.left !== this.NIL) clone.left.parent = clone;
                if (clone.right !== this.NIL) clone.right.right = clone;
                
                return clone;
            }
            
            // æ¸…é™¤æ‰€æœ‰é«˜äº®
            clearHighlights() {
                const clearHighlight = (node) => {
                    if (node === this.NIL) return;
                    node.highlight = false;
                    node.highlightType = 'NONE';
                    clearHighlight(node.left);
                    clearHighlight(node.right);
                };
                clearHighlight(this.root);
            }
            
            // æ¸…é™¤æ‰€æœ‰æ ‡ç­¾
            clearLabels() {
                const clearLabel = (node) => {
                    if (node === this.NIL) return;
                    node.label = '';
                    clearLabel(node.left);
                    clearLabel(node.right);
                };
                clearLabel(this.root);
            }
            
            // è·å–æ ‘çš„é«˜åº¦
            getHeight(node = this.root) {
                if (node === this.NIL) return 0;
                return 1 + Math.max(this.getHeight(node.left), this.getHeight(node.right));
            }
            
            // è·å–èŠ‚ç‚¹æ•°é‡
            getNodeCount(node = this.root) {
                if (node === this.NIL) return 0;
                return 1 + this.getNodeCount(node.left) + this.getNodeCount(node.right);
            }
            
            // æ£€æŸ¥çº¢é»‘æ ‘æ€§è´¨
            checkProperties() {
                const properties = {
                    prop1: true, // æ¯ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²æˆ–é»‘è‰²
                    prop2: this.root.isBlack(), // æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²
                    prop3: true, // æ‰€æœ‰å¶å­èŠ‚ç‚¹(NIL)æ˜¯é»‘è‰²
                    prop4: this.checkRedProperty(this.root), // çº¢è‰²èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²
                    prop5: this.checkBlackHeight(this.root) !== -1 // ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ‰€æœ‰åä»£å¶å­èŠ‚ç‚¹çš„ç®€å•è·¯å¾„ä¸Šï¼Œé»‘è‰²èŠ‚ç‚¹æ•°ç›®ç›¸åŒ
                };
                
                return properties;
            }
            
            // æ£€æŸ¥çº¢è‰²èŠ‚ç‚¹å±æ€§
            checkRedProperty(node) {
                if (node === this.NIL) return true;
                
                if (node.isRed()) {
                    if (node.left.isRed() || node.right.isRed()) {
                        return false;
                    }
                }
                
                return this.checkRedProperty(node.left) && this.checkRedProperty(node.right);
            }
            
            // æ£€æŸ¥é»‘è‰²é«˜åº¦
            checkBlackHeight(node) {
                if (node === this.NIL) return 1;
                
                const leftBlackHeight = this.checkBlackHeight(node.left);
                const rightBlackHeight = this.checkBlackHeight(node.right);
                
                if (leftBlackHeight === -1 || rightBlackHeight === -1 || leftBlackHeight !== rightBlackHeight) {
                    return -1;
                }
                
                return leftBlackHeight + (node.isBlack() ? 1 : 0);
            }
            
            // é‡ç½®æ ‘
            reset() {
                this.root = this.NIL;
                this.history = [];
                this.currentStep = 0;
                this.animationSteps = [];
                this.currentAnimationStep = 0;
                this.isAnimating = false;
            }
            
            // æ‰§è¡Œé¢„è®¾æ¡ˆä¾‹
            executeCase(values) {
                this.reset();
                values.forEach(value => {
                    this.insert(value);
                });
                this.currentAnimationStep = 0;
                return this.animationSteps;
            }
        }

        // æ ‘å¯è§†åŒ–ç±»
        class TreeVisualizer {
            constructor(canvas, tree) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.tree = tree;
                this.nodeRadius = 25;
                this.levelHeight = 80;
                this.animationFrame = null;
                this.currentTreeState = null;
                this.targetTreeState = null;
                this.animationProgress = 0;
                this.animationDuration = 500; // åŠ¨ç”»æŒç»­æ—¶é—´(ms)
                this.isAnimatingState = false;
            }
            
            // ç»˜åˆ¶æ ‘
            drawTree(state = null) {
                const treeToDraw = state || this.tree.root;
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // è®¡ç®—èŠ‚ç‚¹ä½ç½®
                this.calculatePositions(treeToDraw, this.canvas.width / 2, 60, this.canvas.width / 4);
                
                // ç»˜åˆ¶è¿æ¥çº¿
                this.drawConnections(treeToDraw);
                
                // ç»˜åˆ¶èŠ‚ç‚¹
                this.drawNodes(treeToDraw);
            }
            
            // è®¡ç®—èŠ‚ç‚¹ä½ç½®
            calculatePositions(node, x, y, offset) {
                if (node === this.tree.NIL) return;
                
                node.x = x;
                node.y = y;
                
                if (node.left !== this.tree.NIL) {
                    this.calculatePositions(node.left, x - offset, y + this.levelHeight, offset / 2);
                }
                
                if (node.right !== this.tree.NIL) {
                    this.calculatePositions(node.right, x + offset, y + this.levelHeight, offset / 2);
                }
            }
            
            // ç»˜åˆ¶è¿æ¥çº¿
            drawConnections(node) {
                if (node === this.tree.NIL) return;
                
                // ç»˜åˆ¶åˆ°å·¦å­èŠ‚ç‚¹çš„è¿æ¥çº¿
                if (node.left !== this.tree.NIL) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(node.x, node.y + this.nodeRadius);
                    this.ctx.lineTo(node.left.x, node.left.y - this.nodeRadius);
                    this.ctx.strokeStyle = '#333333';
                    this.ctx.lineWidth = 2;
                    this.ctx.stroke();
                    this.drawConnections(node.left);
                }
                
                // ç»˜åˆ¶åˆ°å³å­èŠ‚ç‚¹çš„è¿æ¥çº¿
                if (node.right !== this.tree.NIL) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(node.x, node.y + this.nodeRadius);
                    this.ctx.lineTo(node.right.x, node.right.y - this.nodeRadius);
                    this.ctx.strokeStyle = '#333333';
                    this.ctx.lineWidth = 2;
                    this.ctx.stroke();
                    this.drawConnections(node.right);
                }
            }
            
            // ç»˜åˆ¶èŠ‚ç‚¹
            drawNodes(node) {
                if (node === this.tree.NIL) return;
                
                // ç»˜åˆ¶èŠ‚ç‚¹
                this.ctx.beginPath();
                this.ctx.arc(node.x, node.y, this.nodeRadius, 0, Math.PI * 2);
                
                // è®¾ç½®èŠ‚ç‚¹é¢œè‰²
                if (node.highlight) {
                    if (node.highlightType === 'FOCUS') {
                        this.ctx.fillStyle = '#FFFF99'; // ç„¦ç‚¹èŠ‚ç‚¹
                        this.ctx.strokeStyle = '#FF9900';
                        this.ctx.lineWidth = 3;
                    } else if (node.highlightType === 'CONFLICT') {
                        this.ctx.fillStyle = '#99CCFF'; // å†²çªè·¯å¾„
                        this.ctx.strokeStyle = '#3399FF';
                        this.ctx.lineWidth = 3;
                    }
                } else if (node.color === 'RED') {
                    this.ctx.fillStyle = '#FF9999'; // çº¢è‰²èŠ‚ç‚¹
                    this.ctx.strokeStyle = '#CC3333';
                    this.ctx.lineWidth = 2;
                } else {
                    this.ctx.fillStyle = '#666666'; // é»‘è‰²èŠ‚ç‚¹
                    this.ctx.strokeStyle = '#000000';
                    this.ctx.lineWidth = 2;
                }
                
                this.ctx.fill();
                this.ctx.stroke();
                
                // ç»˜åˆ¶èŠ‚ç‚¹å€¼
                this.ctx.fillStyle = node.color === 'RED' ? '#000000' : '#FFFFFF';
                this.ctx.font = 'bold 16px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                this.ctx.fillText(node.value, node.x, node.y);
                
                // ç»˜åˆ¶èŠ‚ç‚¹æ ‡ç­¾(N, P, G, U)
                if (node.label) {
                    this.ctx.fillStyle = '#E74C3C';
                    this.ctx.font = 'bold 14px Arial';
                    this.ctx.fillText(node.label, node.x, node.y - this.nodeRadius - 10);
                }
                
                // é€’å½’ç»˜åˆ¶å­èŠ‚ç‚¹
                this.drawNodes(node.left);
                this.drawNodes(node.right);
            }
            
            // åŠ¨ç”»è¿‡æ¸¡åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€
            animateToState(targetState) {
                if (this.isAnimatingState) return;
                
                this.currentTreeState = this.cloneTreeState(this.tree.root);
                this.targetTreeState = targetState;
                this.animationProgress = 0;
                this.isAnimatingState = true;
                
                const animate = () => {
                    this.animationProgress += 16 / this.animationDuration; // å‡è®¾60fps
                    
                    if (this.animationProgress >= 1) {
                        this.animationProgress = 1;
                        this.isAnimatingState = false;
                        this.drawTree(this.targetTreeState);
                        return;
                    }
                    
                    // æ’å€¼å½“å‰çŠ¶æ€å’Œç›®æ ‡çŠ¶æ€
                    const interpolatedState = this.interpolateTreeStates(
                        this.currentTreeState, 
                        this.targetTreeState, 
                        this.animationProgress
                    );
                    
                    this.drawTree(interpolatedState);
                    this.animationFrame = requestAnimationFrame(animate);
                };
                
                this.animationFrame = requestAnimationFrame(animate);
            }
            
            // å…‹éš†æ ‘çŠ¶æ€
            cloneTreeState(node) {
                if (node === this.tree.NIL) return this.tree.NIL;
                
                const clone = new RBNode(node.value, node.color);
                clone.x = node.x;
                clone.y = node.y;
                clone.highlight = node.highlight;
                clone.highlightType = node.highlightType;
                clone.label = node.label;
                
                clone.left = this.cloneTreeState(node.left);
                clone.right = this.cloneTreeState(node.right);
                
                return clone;
            }
            
            // æ’å€¼ä¸¤ä¸ªæ ‘çŠ¶æ€
            interpolateTreeStates(state1, state2, progress) {
                if (state1 === this.tree.NIL || state2 === this.tree.NIL) {
                    return progress >= 0.5 ? state2 : state1;
                }
                
                const interpolated = new RBNode(state2.value, state2.color);
                interpolated.x = state1.x + (state2.x - state1.x) * progress;
                interpolated.y =
<!--æ£€æµ‹åˆ°ä»£ç æˆªæ–­ï¼Œè‡ªåŠ¨ç»­å†™ä¸­...-->
state1.y + (state2.y - state1.y) * progress;
                interpolated.highlight = progress >= 0.5 ? state2.highlight : state1.highlight;
                interpolated.highlightType = progress >= 0.5 ? state2.highlightType : state1.highlightType;
                interpolated.label = progress >= 0.5 ? state2.label : state1.label;
                
                interpolated.left = this.interpolateTreeStates(state1.left, state2.left, progress);
                interpolated.right = this.interpolateTreeStates(state1.right, state2.right, progress);
                
                return interpolated;
            }
            
            // åœæ­¢åŠ¨ç”»
            stopAnimation() {
                if (this.animationFrame) {
                    cancelAnimationFrame(this.animationFrame);
                    this.animationFrame = null;
                }
                this.isAnimatingState = false;
            }
        }

        // ä¸»åº”ç”¨ç¨‹åº
        class RedBlackTreeApp {
            constructor() {
                this.tree = new RedBlackTree();
                this.visualizer = new TreeVisualizer(document.getElementById('tree-canvas'), this.tree);
                this.isPlaying = false;
                this.playInterval = null;
                this.currentStepIndex = 0;
                this.animationSteps = [];
                
                this.initEventListeners();
                this.updateUI();
                this.visualizer.drawTree();
            }
            
            initEventListeners() {
                // æ§åˆ¶æŒ‰é’®äº‹ä»¶
                document.getElementById('prev-btn').addEventListener('click', () => this.prevStep());
                document.getElementById('next-btn').addEventListener('click', () => this.nextStep());
                document.getElementById('play-pause-btn').addEventListener('click', () => this.togglePlay());
                document.getElementById('reset-btn').addEventListener('click', () => this.reset());
                document.getElementById('clear-btn').addEventListener('click', () => this.clearTree());
                
                // æ’å…¥æŒ‰é’®äº‹ä»¶
                document.getElementById('insert-btn').addEventListener('click', () => {
                    const value = parseInt(document.getElementById('node-value').value);
                    if (!isNaN(value)) {
                        this.insertValue(value);
                    }
                });
                
                document.getElementById('node-value').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const value = parseInt(document.getElementById('node-value').value);
                        if (!isNaN(value)) {
                            this.insertValue(value);
                        }
                    }
                });
                
                // éšæœºæ’å…¥æŒ‰é’®
                document.getElementById('insert-random-btn').addEventListener('click', () => {
                    const value = Math.floor(Math.random() * 90) + 10; // 10-99ä¹‹é—´çš„éšæœºæ•°
                    document.getElementById('node-value').value = value;
                    this.insertValue(value);
                });
                
                // é¢„è®¾æ¡ˆä¾‹æŒ‰é’®
                document.querySelectorAll('.case-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        // ç§»é™¤æ‰€æœ‰activeç±»
                        document.querySelectorAll('.case-btn').forEach(b => b.classList.remove('active'));
                        // æ·»åŠ activeç±»åˆ°å½“å‰æŒ‰é’®
                        btn.classList.add('active');
                        
                        const caseId = btn.getAttribute('data-case');
                        this.loadPresetCase(caseId);
                    });
                });
            }
            
            // æ’å…¥å€¼
            insertValue(value) {
                this.stopPlay();
                this.tree.insert(value);
                this.animationSteps = this.tree.animationSteps;
                this.currentStepIndex = this.animationSteps.length - 1;
                this.updateUI();
                this.showStep(this.currentStepIndex);
            }
            
            // åŠ è½½é¢„è®¾æ¡ˆä¾‹
            loadPresetCase(caseId) {
                this.stopPlay();
                this.tree.reset();
                
                let values;
                switch(caseId) {
                    case 'case1':
                        values = [11, 2, 14, 1, 7];
                        break;
                    case 'case2':
                        values = [20, 15, 25, 10, 5];
                        break;
                    case 'case3':
                        values = [5, 3, 8, 2, 4, 7, 9];
                        break;
                    case 'case4':
                        values = [50, 30, 70, 20, 40, 60, 80, 10];
                        break;
                    default:
                        values = [11, 2, 14];
                }
                
                this.animationSteps = this.tree.executeCase(values);
                this.currentStepIndex = 0;
                this.updateUI();
                this.showStep(0);
            }
            
            // æ˜¾ç¤ºæŒ‡å®šæ­¥éª¤
            showStep(stepIndex) {
                if (stepIndex < 0 || stepIndex >= this.animationSteps.length) return;
                
                this.currentStepIndex = stepIndex;
                const step = this.animationSteps[stepIndex];
                
                // æ›´æ–°æ­¥éª¤ä¿¡æ¯
                document.getElementById('step-title').textContent = `æ­¥éª¤ ${stepIndex + 1}`;
                document.getElementById('step-description').textContent = step.description;
                document.getElementById('current-step').textContent = stepIndex + 1;
                document.getElementById('total-steps').textContent = this.animationSteps.length;
                
                // æ›´æ–°èŠ‚ç‚¹è®¡æ•°
                document.getElementById('node-count').textContent = this.tree.getNodeCount();
                
                // æ£€æŸ¥çº¢é»‘æ ‘æ€§è´¨
                const properties = this.tree.checkProperties();
                this.updatePropertyUI(properties);
                
                // æ˜¾ç¤ºæ ‘çŠ¶æ€
                this.visualizer.animateToState(step.tree);
            }
            
            // æ›´æ–°çº¢é»‘æ ‘æ€§è´¨UI
            updatePropertyUI(properties) {
                for (let i = 1; i <= 5; i++) {
                    const propElement = document.getElementById(`prop${i}`);
                    const isSatisfied = properties[`prop${i}`];
                    
                    propElement.classList.remove('satisfied', 'violated');
                    propElement.classList.add(isSatisfied ? 'satisfied' : 'violated');
                    
                    const checkElement = propElement.querySelector('.property-check');
                    checkElement.textContent = isSatisfied ? 'âœ“' : 'âœ—';
                }
            }
            
            // ä¸Šä¸€æ­¥
            prevStep() {
                this.stopPlay();
                if (this.currentStepIndex > 0) {
                    this.showStep(this.currentStepIndex - 1);
                }
                this.updateUI();
            }
            
            // ä¸‹ä¸€æ­¥
            nextStep() {
                this.stopPlay();
                if (this.currentStepIndex < this.animationSteps.length - 1) {
                    this.showStep(this.currentStepIndex + 1);
                }
                this.updateUI();
            }
            
            // åˆ‡æ¢æ’­æ”¾/æš‚åœ
            togglePlay() {
                if (this.isPlaying) {
                    this.stopPlay();
                } else {
                    this.startPlay();
                }
                this.updateUI();
            }
            
            // å¼€å§‹æ’­æ”¾
            startPlay() {
                if (this.animationSteps.length === 0) return;
                
                this.isPlaying = true;
                const playIcon = document.getElementById('play-icon');
                const playText = document.getElementById('play-text');
                playIcon.textContent = 'â¸';
                playText.textContent = 'æš‚åœ';
                
                // å¦‚æœå·²ç»åœ¨æœ€åä¸€æ­¥ï¼Œä»å¤´å¼€å§‹
                if (this.currentStepIndex >= this.animationSteps.length - 1) {
                    this.currentStepIndex = -1;
                }
                
                this.playInterval = setInterval(() => {
                    if (this.currentStepIndex < this.animationSteps.length - 1) {
                        this.showStep(this.currentStepIndex + 1);
                        this.updateUI();
                    } else {
                        this.stopPlay();
                    }
                }, 1000); // æ¯ç§’ä¸€æ­¥
            }
            
            // åœæ­¢æ’­æ”¾
            stopPlay() {
                if (this.playInterval) {
                    clearInterval(this.playInterval);
                    this.playInterval = null;
                }
                this.isPlaying = false;
                
                const playIcon = document.getElementById('play-icon');
                const playText = document.getElementById('play-text');
                playIcon.textContent = 'â–¶';
                playText.textContent = 'æ’­æ”¾';
            }
            
            // é‡ç½®
            reset() {
                this.stopPlay();
                this.tree.reset();
                this.animationSteps = [];
                this.currentStepIndex = 0;
                this.updateUI();
                this.visualizer.drawTree();
                
                // é‡ç½®æ­¥éª¤ä¿¡æ¯
                document.getElementById('step-title').textContent = 'åˆå§‹çŠ¶æ€';
                document.getElementById('step-description').textContent = 'çº¢é»‘æ ‘ä¸ºç©ºï¼Œå‡†å¤‡æ’å…¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚ç‚¹å‡»"æ’å…¥èŠ‚ç‚¹"æŒ‰é’®æˆ–é€‰æ‹©ä¸€ä¸ªé¢„è®¾æ¡ˆä¾‹å¼€å§‹ã€‚';
                document.getElementById('current-step').textContent = '0';
                document.getElementById('total-steps').textContent = '0';
                document.getElementById('node-count').textContent = '0';
                
                // é‡ç½®æ€§è´¨æ˜¾ç¤º
                for (let i = 1; i <= 5; i++) {
                    const propElement = document.getElementById(`prop${i}`);
                    propElement.classList.remove('satisfied', 'violated');
                    const checkElement = propElement.querySelector('.property-check');
                    checkElement.textContent = i;
                }
                
                // æ¸…é™¤é¢„è®¾æ¡ˆä¾‹çš„activeçŠ¶æ€
                document.querySelectorAll('.case-btn').forEach(btn => btn.classList.remove('active'));
            }
            
            // æ¸…ç©ºæ ‘
            clearTree() {
                this.reset();
            }
            
            // æ›´æ–°UIçŠ¶æ€
            updateUI() {
                const prevBtn = document.getElementById('prev-btn');
                const nextBtn = document.getElementById('next-btn');
                const playPauseBtn = document.getElementById('play-pause-btn');
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                prevBtn.disabled = this.currentStepIndex <= 0;
                nextBtn.disabled = this.currentStepIndex >= this.animationSteps.length - 1;
                playPauseBtn.disabled = this.animationSteps.length === 0;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            const app = new RedBlackTreeApp();
            
            // ä½¿åº”ç”¨åœ¨å…¨å±€å¯ç”¨ï¼ˆç”¨äºè°ƒè¯•ï¼‰
            window.redBlackTreeApp = app;
            
            // åˆå§‹åŠ è½½ä¸€ä¸ªç®€å•æ¡ˆä¾‹
            document.querySelector('.case-btn[data-case="case1"]').click();
        });
    </script>
</body>
</html>