<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¥ç»è°ƒèŠ‚çš„åŸºæœ¬åå°„å¼§ - äº¤äº’å¼æ•™å­¦åŠ¨ç”»</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #333;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
            max-width: 1000px;
        }
        
        h1 {
            color: #1a237e;
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        .subtitle {
            color: #3949ab;
            font-size: 1.1rem;
            margin-bottom: 15px;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 1000px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 50, 0.1);
            overflow: hidden;
        }
        
        .animation-area {
            position: relative;
            width: 100%;
            height: 500px;
            background-color: #f9fafc;
            border-bottom: 1px solid #e0e0e0;
        }
        
        #reflexCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .control-panel {
            padding: 20px;
            background-color: #f8f9ff;
        }
        
        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .mode-btn {
            padding: 10px 20px;
            background-color: #e8eaf6;
            border: 2px solid #c5cae9;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: #3949ab;
            transition: all 0.3s;
        }
        
        .mode-btn.active {
            background-color: #3949ab;
            color: white;
            border-color: #3949ab;
        }
        
        .mode-btn:hover:not(.active) {
            background-color: #d1d9ff;
        }
        
        .main-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 10px 20px;
            background-color: #3f51b5;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
            min-width: 100px;
        }
        
        .control-btn:hover {
            background-color: #303f9f;
        }
        
        .control-btn:disabled {
            background-color: #9fa8da;
            cursor: not-allowed;
        }
        
        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .speed-label {
            font-weight: 600;
            color: #1a237e;
        }
        
        #speedSlider {
            width: 150px;
        }
        
        .info-panel {
            padding: 15px;
            background-color: white;
            border-top: 1px solid #e0e0e0;
            min-height: 120px;
        }
        
        .info-title {
            color: #1a237e;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .info-content {
            line-height: 1.6;
            color: #444;
        }
        
        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .step-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #c5cae9;
            transition: background-color 0.3s;
        }
        
        .step-dot.active {
            background-color: #3949ab;
        }
        
        .step-dot.completed {
            background-color: #4caf50;
        }
        
        .test-panel {
            padding: 20px;
            background-color: #f1f8e9;
            display: none;
        }
        
        .test-title {
            color: #33691e;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .test-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .test-btn {
            padding: 10px 20px;
            background-color: #7cb342;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .test-btn:hover {
            background-color: #689f38;
        }
        
        .test-area {
            text-align: center;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            border: 1px dashed #c5e1a5;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .feedback {
            margin-top: 10px;
            font-weight: 600;
            min-height: 24px;
        }
        
        .correct {
            color: #2e7d32;
        }
        
        .incorrect {
            color: #c62828;
        }
        
        .component-info {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            max-width: 300px;
            display: none;
            z-index: 10;
            border-left: 4px solid #3949ab;
        }
        
        .component-title {
            color: #1a237e;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        .component-desc {
            color: #555;
            line-height: 1.5;
        }
        
        @media (max-width: 768px) {
            .main-controls {
                flex-direction: column;
            }
            
            .animation-area {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ç¥ç»è°ƒèŠ‚çš„åŸºæœ¬åå°„å¼§</h1>
        <p class="subtitle">å—å®¹ â†’ ä¼ å…¥ â†’ ä¸­æ¢ â†’ ä¼ å‡º â†’ æ•ˆåº”å™¨ | æ¯«ç§’çº§ä¿¡å·ä¼ é€’åŠ¨ç”»</p>
    </div>
    
    <div class="container">
        <div class="animation-area">
            <canvas id="reflexCanvas"></canvas>
            <div id="componentInfo" class="component-info">
                <div class="component-title" id="infoTitle">ç»„ä»¶æ ‡é¢˜</div>
                <div class="component-desc" id="infoDesc">ç»„ä»¶æè¿°ä¿¡æ¯</div>
            </div>
        </div>
        
        <div class="control-panel">
            <div class="mode-selector">
                <div class="mode-btn active" data-mode="guide">å¼•å¯¼æ¨¡å¼</div>
                <div class="mode-btn" data-mode="explore">æ¢ç´¢æ¨¡å¼</div>
                <div class="mode-btn" data-mode="test">æµ‹è¯•æ¨¡å¼</div>
            </div>
            
            <div class="main-controls">
                <button id="playBtn" class="control-btn">æ’­æ”¾</button>
                <button id="pauseBtn" class="control-btn" disabled>æš‚åœ</button>
                <button id="restartBtn" class="control-btn">é‡æ–°å¼€å§‹</button>
                <button id="prevBtn" class="control-btn">ä¸Šä¸€æ­¥</button>
                <button id="nextBtn" class="control-btn">ä¸‹ä¸€æ­¥</button>
                
                <div class="speed-control">
                    <span class="speed-label">é€Ÿåº¦:</span>
                    <input type="range" id="speedSlider" min="1" max="10" value="5">
                    <span id="speedValue">ä¸­é€Ÿ</span>
                </div>
            </div>
            
            <div class="step-indicator">
                <div class="step-dot" data-step="0"></div>
                <div class="step-dot" data-step="1"></div>
                <div class="step-dot" data-step="2"></div>
                <div class="step-dot" data-step="3"></div>
                <div class="step-dot" data-step="4"></div>
            </div>
        </div>
        
        <div class="info-panel">
            <div class="info-title" id="currentStepTitle">åå°„å¼§ç®€ä»‹</div>
            <div class="info-content" id="currentStepDesc">
                åå°„å¼§æ˜¯ç¥ç»è°ƒèŠ‚çš„åŸºæœ¬ç»“æ„å’ŒåŠŸèƒ½å•ä½ï¼ŒåŒ…æ‹¬æ„Ÿå—å™¨ã€ä¼ å…¥ç¥ç»ã€ç¥ç»ä¸­æ¢ã€ä¼ å‡ºç¥ç»å’Œæ•ˆåº”å™¨äº”ä¸ªéƒ¨åˆ†ã€‚ç‚¹å‡»"æ’­æ”¾"æŒ‰é’®å¼€å§‹åŠ¨ç”»æ¼”ç¤ºã€‚
            </div>
        </div>
        
        <div class="test-panel" id="testPanel">
            <div class="test-title">çŸ¥è¯†æµ‹è¯•</div>
            <div class="test-options">
                <button class="test-btn" id="labelTestBtn">ç»“æ„æ ‡æ³¨æŒ‘æˆ˜</button>
                <button class="test-btn" id="orderTestBtn">é¡ºåºæ’åºæŒ‘æˆ˜</button>
                <button class="test-btn" id="resetTestBtn">é‡ç½®æµ‹è¯•</button>
            </div>
            <div class="test-area" id="testArea">
                <p>é€‰æ‹©ä¸€ç§æµ‹è¯•ç±»å‹å¼€å§‹æŒ‘æˆ˜</p>
                <div class="feedback" id="testFeedback"></div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        const canvas = document.getElementById('reflexCanvas');
        const ctx = canvas.getContext('2d');
        const componentInfo = document.getElementById('componentInfo');
        const infoTitle = document.getElementById('infoTitle');
        const infoDesc = document.getElementById('infoDesc');
        const testPanel = document.getElementById('testPanel');
        const testArea = document.getElementById('testArea');
        const testFeedback = document.getElementById('testFeedback');
        
        // åŠ¨ç”»çŠ¶æ€
        let animationState = {
            mode: 'guide', // guide, explore, test
            isPlaying: false,
            currentStep: 0, // 0-4: æ„Ÿå—å™¨,ä¼ å…¥,ä¸­æ¢,ä¼ å‡º,æ•ˆåº”å™¨
            speed: 5, // 1-10
            signalPosition: 0, // 0-100, ä¿¡å·ä½ç½®ç™¾åˆ†æ¯”
            signalMoving: false,
            signalDirection: 1, // 1: æ­£å‘, -1: åå‘
            components: [],
            testActive: false,
            testType: null,
            labelsHidden: false
        };
        
        // åå°„å¼§ç»„ä»¶æ•°æ®
        const reflexComponents = [
            {
                id: 'receptor',
                name: 'æ„Ÿå—å™¨',
                description: 'æ¥å—å†…å¤–ç¯å¢ƒåˆºæ¿€å¹¶è½¬åŒ–ä¸ºç¥ç»å†²åŠ¨çš„ç‰¹æ®Šç»“æ„ã€‚ä¾‹å¦‚çš®è‚¤ä¸­çš„è§¦è§‰å°ä½“ã€è‚Œæ¢­ç­‰ã€‚',
                color: '#FFCCBC', // æµ…è‚‰è‰²
                activeColor: '#FF8A65',
                x: 100,
                y: 250,
                width: 60,
                height: 80
            },
            {
                id: 'afferent',
                name: 'ä¼ å…¥ç¥ç»',
                description: 'å°†æ„Ÿå—å™¨äº§ç”Ÿçš„ç¥ç»å†²åŠ¨ä¼ å‘ç¥ç»ä¸­æ¢çš„ç¥ç»çº¤ç»´ã€‚ç”±æ„Ÿè§‰ç¥ç»å…ƒçš„å¤–å‘¨çªæ„æˆã€‚',
                color: '#E3F2FD', // æµ…è“è‰²
                activeColor: '#64B5F6',
                x: 180,
                y: 200,
                width: 120,
                height: 20
            },
            {
                id: 'center',
                name: 'ç¥ç»ä¸­æ¢',
                description: 'ä½äºè„Šé«“æˆ–è„‘ï¼Œå¯¹ä¼ å…¥ä¿¡æ¯è¿›è¡Œåˆ†æç»¼åˆï¼Œå¹¶å‘å‡ºæŒ‡ä»¤ã€‚åŒ…å«ä¸­é—´ç¥ç»å…ƒå’Œè¿åŠ¨ç¥ç»å…ƒèƒä½“ã€‚',
                color: '#F3E5F5', // æµ…ç´«è‰²
                activeColor: '#BA68C8',
                x: 320,
                y: 150,
                width: 100,
                height: 200
            },
            {
                id: 'efferent',
                name: 'ä¼ å‡ºç¥ç»',
                description: 'å°†ç¥ç»ä¸­æ¢çš„æŒ‡ä»¤ä¼ å‘æ•ˆåº”å™¨çš„ç¥ç»çº¤ç»´ã€‚ç”±è¿åŠ¨ç¥ç»å…ƒçš„è½´çªæ„æˆã€‚',
                color: '#E3F2FD', // æµ…è“è‰²
                activeColor: '#64B5F6',
                x: 440,
                y: 200,
                width: 120,
                height: 20
            },
            {
                id: 'effector',
                name: 'æ•ˆåº”å™¨',
                description: 'æ‰§è¡Œç¥ç»ä¸­æ¢æŒ‡ä»¤çš„å™¨å®˜ï¼Œå¦‚è‚Œè‚‰æˆ–è…ºä½“ã€‚è‚Œè‚‰æ”¶ç¼©æˆ–è…ºä½“åˆ†æ³Œå®Œæˆåå°„æ´»åŠ¨ã€‚',
                color: '#FFEBEE', // æµ…çº¢è‰²
                activeColor: '#EF5350',
                x: 580,
                y: 230,
                width: 80,
                height: 100
            }
        ];
        
        // æ­¥éª¤æè¿°æ•°æ®
        const stepDescriptions = [
            {
                title: 'æ„Ÿå—å™¨å—å®¹',
                description: 'æ„Ÿå—å™¨æ¥å—åˆºæ¿€ï¼ˆå¦‚æ•²å‡»è‚Œè…±ï¼‰ï¼Œå¹¶å°†åˆºæ¿€èƒ½é‡è½¬åŒ–ä¸ºç¥ç»å†²åŠ¨ï¼ˆç”µä¿¡å·ï¼‰ã€‚'
            },
            {
                title: 'ä¼ å…¥ç¥ç»ä¼ å¯¼',
                description: 'ç¥ç»å†²åŠ¨æ²¿ä¼ å…¥ç¥ç»çº¤ç»´å‘ä¸­æ¢ç¥ç»ç³»ç»Ÿï¼ˆè„Šé«“ï¼‰å¿«é€Ÿä¼ å¯¼ï¼Œé€Ÿåº¦å¯è¾¾æ¯ç§’æ•°åç±³ã€‚'
            },
            {
                title: 'ç¥ç»ä¸­æ¢æ•´åˆ',
                description: 'ç¥ç»å†²åŠ¨åˆ°è¾¾è„Šé«“ä¸­æ¢ï¼Œä¸­é—´ç¥ç»å…ƒå¯¹ä¿¡æ¯è¿›è¡Œç®€å•çš„åˆ†ææ•´åˆï¼Œå¹¶æ¿€æ´»è¿åŠ¨ç¥ç»å…ƒã€‚'
            },
            {
                title: 'ä¼ å‡ºç¥ç»ä¼ å¯¼',
                description: 'è¿åŠ¨ç¥ç»å…ƒäº§ç”Ÿçš„ç¥ç»å†²åŠ¨æ²¿ä¼ å‡ºç¥ç»çº¤ç»´ä¼ å‘æ•ˆåº”å™¨ï¼ˆè‚Œè‚‰ï¼‰ã€‚'
            },
            {
                title: 'æ•ˆåº”å™¨ååº”',
                description: 'ç¥ç»å†²åŠ¨åˆ°è¾¾æ•ˆåº”å™¨ï¼ˆè‚Œè‚‰ï¼‰ï¼Œå¼•èµ·è‚Œè‚‰æ”¶ç¼©ï¼Œå®Œæˆåå°„åŠ¨ä½œï¼ˆå¦‚è†è·³ï¼‰ã€‚'
            }
        ];
        
        // åˆå§‹åŒ–Canvas
        function initCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            // è°ƒæ•´ç»„ä»¶ä½ç½®ä»¥é€‚åº”Canvaså¤§å°
            const scaleX = canvas.width / 800;
            const scaleY = canvas.height / 500;
            
            reflexComponents.forEach(comp => {
                comp.x *= scaleX;
                comp.y *= scaleY;
                comp.width *= scaleX;
                comp.height *= scaleY;
            });
            
            draw();
        }
        
        // ç»˜åˆ¶åå°„å¼§
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶èƒŒæ™¯å’Œè„Šé«“è½®å»“
            drawBackground();
            
            // ç»˜åˆ¶è¿æ¥è·¯å¾„
            drawNeuralPath();
            
            // ç»˜åˆ¶å„ä¸ªç»„ä»¶
            reflexComponents.forEach(comp => {
                drawComponent(comp);
            });
            
            // ç»˜åˆ¶ä¿¡å·
            if (animationState.signalMoving || animationState.signalPosition > 0) {
                drawSignal();
            }
            
            // åœ¨æµ‹è¯•æ¨¡å¼ä¸‹éšè—æ ‡ç­¾
            if (!animationState.labelsHidden) {
                drawLabels();
            }
        }
        
        // ç»˜åˆ¶èƒŒæ™¯å’Œè„Šé«“
        function drawBackground() {
            // ç»˜åˆ¶è„Šé«“è½®å»“
            ctx.fillStyle = '#F5F5F5';
            ctx.fillRect(reflexComponents[2].x - 10, reflexComponents[2].y - 10, 
                        reflexComponents[2].width + 20, reflexComponents[2].height + 20);
            
            // è„Šé«“ç°è´¨
            ctx.fillStyle = '#E0E0E0';
            ctx.fillRect(reflexComponents[2].x, reflexComponents[2].y, 
                        reflexComponents[2].width, reflexComponents[2].height);
            
            // ç»˜åˆ¶çš®è‚¤è½®å»“ï¼ˆæ„Ÿå—å™¨å‘¨å›´ï¼‰
            ctx.fillStyle = '#FFF3E0';
            ctx.fillRect(reflexComponents[0].x - 20, reflexComponents[0].y - 10, 
                        reflexComponents[0].width + 40, reflexComponents[0].height + 20);
        }
        
        // ç»˜åˆ¶ç¥ç»è·¯å¾„
        function drawNeuralPath() {
            ctx.beginPath();
            ctx.strokeStyle = '#90CAF9';
            ctx.lineWidth = 3;
            
            // ä»æ„Ÿå—å™¨åˆ°ä¼ å…¥ç¥ç»
            ctx.moveTo(reflexComponents[0].x + reflexComponents[0].width/2, reflexComponents[0].y + reflexComponents[0].height/2);
            ctx.lineTo(reflexComponents[1].x, reflexComponents[1].y + reflexComponents[1].height/2);
            
            // ä¼ å…¥ç¥ç»
            ctx.lineTo(reflexComponents[1].x + reflexComponents[1].width, reflexComponents[1].y + reflexComponents[1].height/2);
            
            // ä¼ å…¥ç¥ç»åˆ°ä¸­æ¢
            ctx.lineTo(reflexComponents[2].x, reflexComponents[2].y + reflexComponents[2].height/2);
            
            // ä¸­æ¢åˆ°ä¼ å‡ºç¥ç»
            ctx.moveTo(reflexComponents[2].x + reflexComponents[2].width, reflexComponents[2].y + reflexComponents[2].height/2);
            ctx.lineTo(reflexComponents[3].x, reflexComponents[3].y + reflexComponents[3].height/2);
            
            // ä¼ å‡ºç¥ç»
            ctx.lineTo(reflexComponents[3].x + reflexComponents[3].width, reflexComponents[3].y + reflexComponents[3].height/2);
            
            // ä¼ å‡ºç¥ç»åˆ°æ•ˆåº”å™¨
            ctx.lineTo(reflexComponents[4].x, reflexComponents[4].y + reflexComponents[4].height/2);
            
            ctx.stroke();
            
            // ç»˜åˆ¶ç®­å¤´
            drawArrow(reflexComponents[1].x + reflexComponents[1].width, reflexComponents[1].y + reflexComponents[1].height/2, 
                     reflexComponents[2].x, reflexComponents[2].y + reflexComponents[2].height/2, '#90CAF9');
            drawArrow(reflexComponents[3].x + reflexComponents[3].width, reflexComponents[3].y + reflexComponents[3].height/2, 
                     reflexComponents[4].x, reflexComponents[4].y + reflexComponents[4].height/2, '#90CAF9');
        }
        
        // ç»˜åˆ¶ç®­å¤´
        function drawArrow(fromX, fromY, toX, toY, color) {
            const headlen = 10;
            const dx = toX - fromX;
            const dy = toY - fromY;
            const angle = Math.atan2(dy, dx);
            
            ctx.save();
            ctx.strokeStyle = color;
            ctx.fillStyle = color;
            
            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            ctx.lineTo(toX, toY);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headlen * Math.cos(angle - Math.PI/6), toY - headlen * Math.sin(angle - Math.PI/6));
            ctx.lineTo(toX - headlen * Math.cos(angle + Math.PI/6), toY - headlen * Math.sin(angle + Math.PI/6));
            ctx.closePath();
            ctx.fill();
            
            ctx.restore();
        }
        
        // ç»˜åˆ¶ç»„ä»¶
        function drawComponent(comp) {
            // åˆ¤æ–­ç»„ä»¶æ˜¯å¦å¤„äºæ¿€æ´»çŠ¶æ€
            const isActive = (
                (animationState.currentStep === 0 && comp.id === 'receptor') ||
                (animationState.currentStep === 1 && comp.id === 'afferent') ||
                (animationState.currentStep === 2 && comp.id === 'center') ||
                (animationState.currentStep === 3 && comp.id === 'efferent') ||
                (animationState.currentStep === 4 && comp.id === 'effector')
            );
            
            const color = isActive ? comp.activeColor : comp.color;
            
            ctx.fillStyle = color;
            
            // æ ¹æ®ä¸åŒç»„ä»¶ç±»å‹ç»˜åˆ¶ä¸åŒå½¢çŠ¶
            if (comp.id === 'receptor') {
                // æ„Ÿå—å™¨ - æ¤­åœ†å½¢
                ctx.beginPath();
                ctx.ellipse(comp.x + comp.width/2, comp.y + comp.height/2, 
                           comp.width/2, comp.height/2, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // å†…éƒ¨ç»†èŠ‚
                ctx.fillStyle = isActive ? '#FF5722' : '#FFAB91';
                ctx.beginPath();
                ctx.ellipse(comp.x + comp.width/2, comp.y + comp.height/2, 
                           comp.width/3, comp.height/3, 0, 0, Math.PI * 2);
                ctx.fill();
                
            } else if (comp.id === 'afferent' || comp.id === 'efferent') {
                // ä¼ å…¥/ä¼ å‡ºç¥ç» - é•¿æ¡å½¢
                ctx.fillRect(comp.x, comp.y, comp.width, comp.height);
                
                // ç¥ç»çº¤ç»´ç»†èŠ‚
                ctx.strokeStyle = isActive ? '#1976D2' : '#90CAF9';
                ctx.lineWidth = 1;
                for (let i = 0; i < 3; i++) {
                    ctx.beginPath();
                    ctx.moveTo(comp.x, comp.y + comp.height/4 * (i+1));
                    ctx.lineTo(comp.x + comp.width, comp.y + comp.height/4 * (i+1));
                    ctx.stroke();
                }
                
            } else if (comp.id === 'center') {
                // ç¥ç»ä¸­æ¢ - çŸ©å½¢
                ctx.fillRect(comp.x, comp.y, comp.width, comp.height);
                
                // ç¥ç»å…ƒèƒä½“
                ctx.fillStyle = isActive ? '#8E24AA' : '#CE93D8';
                for (let i = 0; i < 5; i++) {
                    const neuronX = comp.x + comp.width/6 * (i+1);
                    const neuronY = comp.y + comp.height/2;
                    ctx.beginPath();
                    ctx.arc(neuronX, neuronY, 8, 0, Math.PI * 2);
                    ctx.fill();
                }
                
            } else if (comp.id === 'effector') {
                // æ•ˆåº”å™¨ - è‚Œè‚‰å½¢çŠ¶
                ctx.beginPath();
                ctx.moveTo(comp.x, comp.y + comp.height/2);
                ctx.bezierCurveTo(
                    comp.x + comp.width/3, comp.y,
                    comp.x + 2*comp.width/3, comp.y,
                    comp.x + comp.width, comp.y + comp.height/2
                );
                ctx.bezierCurveTo(
                    comp.x + 2*comp.width/3, comp.y + comp.height,
                    comp.x + comp.width/3, comp.y + comp.height,
                    comp.x, comp.y + comp.height/2
                );
                ctx.closePath();
                ctx.fill();
                
                // è‚Œè‚‰æ¡çº¹
                ctx.strokeStyle = isActive ? '#D32F2F' : '#EF9A9A';
                ctx.lineWidth = 2;
                for (let i = 0; i < 4; i++) {
                    const stripeX = comp.x + comp.width/5 * (i+1);
                    ctx.beginPath();
                    ctx.moveTo(stripeX, comp.y + 10);
                    ctx.lineTo(stripeX, comp.y + comp.height - 10);
                    ctx.stroke();
                }
                
                // å¦‚æœæ•ˆåº”å™¨æ¿€æ´»ï¼Œç»˜åˆ¶æ”¶ç¼©æ•ˆæœ
                if (isActive && animationState.signalPosition > 90) {
                    ctx.fillStyle = 'rgba(239, 83, 80, 0.3)';
                    ctx.beginPath();
                    ctx.ellipse(comp.x + comp.width/2, comp.y + comp.height/2, 
                               comp.width/2 + 5, comp.height/2 + 5, 0, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            // ç»˜åˆ¶ç»„ä»¶è¾¹æ¡†
            ctx.strokeStyle = isActive ? '#1A237E' : '#9FA8DA';
            ctx.lineWidth = isActive ? 3 : 1;
            
            if (comp.id === 'receptor' || comp.id === 'effector') {
                ctx.beginPath();
                ctx.ellipse(comp.x + comp.width/2, comp.y + comp.height/2, 
                           comp.width/2, comp.height/2, 0, 0, Math.PI * 2);
                ctx.stroke();
            } else {
                ctx.strokeRect(comp.x, comp.y, comp.width, comp.height);
            }
        }
        
        // ç»˜åˆ¶ä¿¡å·
        function drawSignal() {
            const pathLength = 700; // è·¯å¾„æ€»é•¿åº¦ï¼ˆè¿‘ä¼¼ï¼‰
            const signalPos = animationState.signalPosition;
            
            // è®¡ç®—ä¿¡å·åœ¨è·¯å¾„ä¸Šçš„ä½ç½®
            let x, y;
            
            if (signalPos < 15) {
                // æ„Ÿå—å™¨åŒºåŸŸ
                const t = signalPos / 15;
                x = reflexComponents[0].x + reflexComponents[0].width/2;
                y = reflexComponents[0].y + reflexComponents[0].height/2;
            } else if (signalPos < 35) {
                // ä¼ å…¥ç¥ç»
                const t = (signalPos - 15) / 20;
                x = reflexComponents[1].x + reflexComponents[1].width * t;
                y = reflexComponents[1].y + reflexComponents[1].height/2;
            } else if (signalPos < 50) {
                // ä¼ å…¥ç¥ç»åˆ°ä¸­æ¢
                const t = (signalPos - 35) / 15;
                x = reflexComponents[1].x + reflexComponents[1].width + (reflexComponents[2].x - (reflexComponents[1].x + reflexComponents[1].width)) * t;
                y = reflexComponents[1].y + reflexComponents[1].height/2 + (reflexComponents[2].y + reflexComponents[2].height/2 - (reflexComponents[1].y + reflexComponents[1].height/2)) * t;
            } else if (signalPos < 65) {
                // ä¸­æ¢å†…éƒ¨
                const t = (signalPos - 50) / 15;
                x = reflexComponents[2].x + reflexComponents[2].width * t;
                y = reflexComponents[2].y + reflexComponents[2].height/2;
            } else if (signalPos < 80) {
                // ä¸­æ¢åˆ°ä¼ å‡ºç¥ç»
                const t = (signalPos - 65) / 15;
                x = reflexComponents[2].x + reflexComponents[2].width + (reflexComponents[3].x - (reflexComponents[2].x + reflexComponents[2].width)) * t;
                y = reflexComponents[2].y + reflexComponents[2].height/2 + (reflexComponents[3].y + reflexComponents[3].height/2 - (reflexComponents[2].y + reflexComponents[2].height/2)) * t;
            } else if (signalPos < 95) {
                // ä¼ å‡ºç¥ç»
                const t = (signalPos - 80) / 15;
                x = reflexComponents[3].x + reflexComponents[3].width * t;
                y = reflexComponents[3].y + reflexComponents[3].height/2;
            } else {
                // ä¼ å‡ºç¥ç»åˆ°æ•ˆåº”å™¨
                const t = (signalPos - 95) / 5;
                x = reflexComponents[3].x + reflexComponents[3].width + (reflexComponents[4].x - (reflexComponents[3].x + reflexComponents[3].width)) * t;
                y = reflexComponents[3].y + reflexComponents[3].height/2 + (reflexComponents[4].y + reflexComponents[4].height/2 - (reflexComponents[3].y + reflexComponents[3].height/2)) * t;
            }
            
            // ç»˜åˆ¶ä¿¡å·ï¼ˆè„‰åŠ¨å…‰ç‚¹ï¼‰
            const pulse = Math.sin(Date.now() / 100) * 0.3 + 0.7;
            const radius = 8 * pulse;
            
            // å…‰ç‚¹ä¸»ä½“
            const gradient = ctx.createRadialGradient(x, y, 0, x, y, radius);
            gradient.addColorStop(0, '#FFFF00');
            gradient.addColorStop(0.7, '#FFEA00');
            gradient.addColorStop(1, 'rgba(255, 234, 0, 0)');
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.fill();
            
            // å…‰æ™•æ•ˆæœ
            ctx.fillStyle = 'rgba(255, 255, 100, 0.2)';
            ctx.beginPath();
            ctx.arc(x, y, radius * 1.5, 0, Math.PI * 2);
            ctx.fill();
        }
        
        // ç»˜åˆ¶æ ‡ç­¾
        function drawLabels() {
            ctx.fillStyle = '#1A237E';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            
            reflexComponents.forEach(comp => {
                const labelY = comp.id === 'receptor' ? comp.y - 10 : 
                              comp.id === 'effector' ? comp.y + comp.height + 25 :
                              comp.y - 10;
                
                ctx.fillText(comp.name, comp.x + comp.width/2, labelY);
            });
            
            // ç»˜åˆ¶æ­¥éª¤æ ‡ç­¾
            ctx.fillStyle = '#3949AB';
            ctx.font = '14px Arial';
            
            const stepLabels = ['å—å®¹', 'ä¼ å…¥', 'ä¸­æ¢', 'ä¼ å‡º', 'æ•ˆåº”'];
            for (let i = 0; i < 5; i++) {
                const x = 100 + i * 150;
                const y = 100;
                
                // æ­¥éª¤åœ†åœˆ
                ctx.fillStyle = animationState.currentStep === i ? '#3949AB' : '#C5CAE9';
                ctx.beginPath();
                ctx.arc(x, y, 20, 0, Math.PI * 2);
                ctx.fill();
                
                // æ­¥éª¤æ•°å­—
                ctx.fillStyle = 'white';
                ctx.font = 'bold 16px Arial';
                ctx.fillText((i+1).toString(), x, y + 5);
                
                // æ­¥éª¤æ–‡å­—
                ctx.fillStyle = '#1A237E';
                ctx.font = '14px Arial';
                ctx.fillText(stepLabels[i], x, y + 40);
            }
        }
        
        // æ›´æ–°åŠ¨ç”»
        function updateAnimation() {
            if (!animationState.isPlaying) return;
            
            // æ ¹æ®é€Ÿåº¦è®¡ç®—ä¿¡å·ç§»åŠ¨å¢é‡
            const speedMap = {1: 0.2, 2: 0.4, 3: 0.6, 4: 0.8, 5: 1.0, 6: 1.5, 7: 2.0, 8: 3.0, 9: 4.0, 10: 5.0};
            const increment = speedMap[animationState.speed] || 1.0;
            
            // æ›´æ–°ä¿¡å·ä½ç½®
            animationState.signalPosition += increment * animationState.signalDirection;
            
            // æ£€æŸ¥æ˜¯å¦åˆ°è¾¾æ­¥éª¤è¾¹ç•Œ
            const stepBoundaries = [15, 35, 50, 65, 80, 100];
            
            if (animationState.signalDirection === 1) {
                // æ­£å‘ç§»åŠ¨
                if (animationState.signalPosition >= stepBoundaries[animationState.currentStep + 1]) {
                    animationState.currentStep++;
                    updateStepInfo();
                    
                    // å¦‚æœåˆ°è¾¾ç»ˆç‚¹ï¼Œæš‚åœåŠ¨ç”»
                    if (animationState.currentStep >= 4) {
                        if (animationState.signalPosition >= 100) {
                            animationState.isPlaying = false;
                            animationState.signalMoving = false;
                            updateControlButtons();
                        }
                    }
                }
                
                // å¦‚æœè¶…è¿‡100%ï¼Œé‡ç½®
                if (animationState.signalPosition > 100) {
                    animationState.signalPosition = 100;
                }
            } else {
                // åå‘ç§»åŠ¨
                if (animationState.signalPosition <= stepBoundaries[animationState.currentStep]) {
                    animationState.currentStep--;
                    updateStepInfo();
                    
                    // å¦‚æœå›åˆ°èµ·ç‚¹ï¼Œæš‚åœåŠ¨ç”»
                    if (animationState.currentStep <= 0 && animationState.signalPosition <= 0) {
                        animationState.isPlaying = false;
                        animationState.signalMoving = false;
                        updateControlButtons();
                    }
                }
                
                // å¦‚æœä½äº0%ï¼Œé‡ç½®
                if (animationState.signalPosition < 0) {
                    animationState.signalPosition = 0;
                }
            }
            
            draw();
            
            // ç»§ç»­åŠ¨ç”»å¾ªç¯
            if (animationState.isPlaying) {
                requestAnimationFrame(updateAnimation);
            }
        }
        
        // æ›´æ–°æ­¥éª¤ä¿¡æ¯
        function updateStepInfo() {
            const stepTitle = document.getElementById('currentStepTitle');
            const stepDesc = document.getElementById('currentStepDesc');
            
            if (animationState.currentStep >= 0 && animationState.currentStep < stepDescriptions.length) {
                stepTitle.textContent = stepDescriptions[animationState.currentStep].title;
                stepDesc.textContent = stepDescriptions[animationState.currentStep].description;
            }
            
            // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
            document.querySelectorAll('.step-dot').forEach((dot, index) => {
                dot.classList.remove('active', 'completed');
                
                if (index === animationState.currentStep) {
                    dot.classList.add('active');
                } else if (index < animationState.currentStep) {
                    dot.classList.add('completed');
                }
            });
        }
        
        // æ›´æ–°æ§åˆ¶æŒ‰é’®çŠ¶æ€
        function updateControlButtons() {
            document.getElementById('playBtn').disabled = animationState.isPlaying;
            document.getElementById('pauseBtn').disabled = !animationState.isPlaying;
            document.getElementById('prevBtn').disabled = animationState.currentStep <= 0;
            document.getElementById('nextBtn').disabled = animationState.currentStep >= 4;
        }
        
        // åˆ‡æ¢åˆ°æŒ‡å®šæ­¥éª¤
        function goToStep(step) {
            if (step < 0 || step > 4) return;
            
            animationState.currentStep = step;
            animationState.signalPosition = step * 20; // æ¯ä¸ªæ­¥éª¤å¤§çº¦20%çš„ä½ç½®
            
            updateStepInfo();
            updateControlButtons();
            draw();
        }
        
        // å¼€å§‹åŠ¨ç”»
        function startAnimation() {
            if (animationState.isPlaying) return;
            
            // å¦‚æœå·²ç»åœ¨ç»ˆç‚¹ï¼Œåˆ™å›åˆ°èµ·ç‚¹
            if (animationState.currentStep >= 4 && animationState.signalPosition >= 100) {
                animationState.currentStep = 0;
                animationState.signalPosition = 0;
                updateStepInfo();
            }
            
            animationState.isPlaying = true;
            animationState.signalMoving = true;
            animationState.signalDirection = 1;
            
            updateControlButtons();
            updateAnimation();
        }
        
        // æš‚åœåŠ¨ç”»
        function pauseAnimation() {
            animationState.isPlaying = false;
            updateControlButtons();
        }
        
        // é‡æ–°å¼€å§‹åŠ¨ç”»
        function restartAnimation() {
            animationState.currentStep = 0;
            animationState.signalPosition = 0;
            animationState.isPlaying = false;
            animationState.signalMoving = false;
            
            updateStepInfo();
            updateControlButtons();
            draw();
        }
        
        // ä¸‹ä¸€æ­¥
        function nextStep() {
            if (animationState.currentStep < 4) {
                goToStep(animationState.currentStep + 1);
            }
        }
        
        // ä¸Šä¸€æ­¥
        function prevStep() {
            if (animationState.currentStep > 0) {
                goToStep(animationState.currentStep - 1);
            }
        }
        
        // åˆ‡æ¢æ¨¡å¼
        function switchMode(mode) {
            animationState.mode = mode;
            
            // æ›´æ–°æ¨¡å¼æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.mode-btn
<!--æ£€æµ‹åˆ°ä»£ç æˆªæ–­ï¼Œè‡ªåŠ¨ç»­å†™ä¸­...-->
).forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.mode === mode) {
                    btn.classList.add('active');
                }
            });
            
            // æ›´æ–°ç•Œé¢æ˜¾ç¤º
            if (mode === 'test') {
                testPanel.style.display = 'block';
                animationState.labelsHidden = false; // æµ‹è¯•æ—¶æ˜¾ç¤ºæ ‡ç­¾
                testFeedback.textContent = '';
                testArea.innerHTML = '<p>é€‰æ‹©ä¸€ç§æµ‹è¯•ç±»å‹å¼€å§‹æŒ‘æˆ˜</p>';
            } else {
                testPanel.style.display = 'none';
                animationState.labelsHidden = false;
            }
            
            // é‡ç½®æµ‹è¯•çŠ¶æ€
            animationState.testActive = false;
            animationState.testType = null;
            
            // å¦‚æœæ˜¯æ¢ç´¢æ¨¡å¼ï¼Œç¡®ä¿åŠ¨ç”»åœæ­¢
            if (mode === 'explore') {
                pauseAnimation();
            }
            
            draw();
        }
        
        // æ˜¾ç¤ºç»„ä»¶ä¿¡æ¯
        function showComponentInfo(component, x, y) {
            if (animationState.mode !== 'explore') return;
            
            infoTitle.textContent = component.name;
            infoDesc.textContent = component.description;
            
            componentInfo.style.left = (x + 15) + 'px';
            componentInfo.style.top = (y + 15) + 'px';
            componentInfo.style.display = 'block';
        }
        
        // éšè—ç»„ä»¶ä¿¡æ¯
        function hideComponentInfo() {
            componentInfo.style.display = 'none';
        }
        
        // æ£€æŸ¥ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨ç»„ä»¶å†…
        function getComponentAt(x, y) {
            for (const comp of reflexComponents) {
                if (x >= comp.x && x <= comp.x + comp.width &&
                    y >= comp.y && y <= comp.y + comp.height) {
                    return comp;
                }
            }
            return null;
        }
        
        // ç»“æ„æ ‡æ³¨æµ‹è¯•
        function startLabelTest() {
            animationState.testActive = true;
            animationState.testType = 'label';
            animationState.labelsHidden = true;
            
            testArea.innerHTML = `
                <p>ç‚¹å‡»åå°„å¼§ä¸­çš„äº”ä¸ªç»„æˆéƒ¨åˆ†ï¼Œç„¶ååœ¨ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©æ­£ç¡®çš„åç§°ï¼š</p>
                <div id="labelTestComponents"></div>
                <div style="margin-top: 15px;">
                    <select id="labelSelect">
                        <option value="">é€‰æ‹©ç»„ä»¶åç§°</option>
                        <option value="receptor">æ„Ÿå—å™¨</option>
                        <option value="afferent">ä¼ å…¥ç¥ç»</option>
                        <option value="center">ç¥ç»ä¸­æ¢</option>
                        <option value="efferent">ä¼ å‡ºç¥ç»</option>
                        <option value="effector">æ•ˆåº”å™¨</option>
                    </select>
                    <button id="submitLabelBtn" style="margin-left: 10px;">æäº¤ç­”æ¡ˆ</button>
                </div>
                <div class="feedback" id="labelFeedback"></div>
            `;
            
            testFeedback.textContent = '';
            testFeedback.className = 'feedback';
            
            // åˆå§‹åŒ–ç»„ä»¶ç‚¹å‡»åŒºåŸŸ
            const componentsDiv = document.getElementById('labelTestComponents');
            componentsDiv.innerHTML = '';
            
            reflexComponents.forEach(comp => {
                const compDiv = document.createElement('div');
                compDiv.className = 'test-component';
                compDiv.dataset.id = comp.id;
                compDiv.style.cssText = `
                    display: inline-block;
                    width: 80px;
                    height: 40px;
                    margin: 5px;
                    background-color: ${comp.color};
                    border: 2px dashed #9FA8DA;
                    border-radius: 4px;
                    cursor: pointer;
                    text-align: center;
                    line-height: 40px;
                    color: transparent;
                    font-size: 12px;
                `;
                compDiv.textContent = 'ç‚¹å‡»é€‰æ‹©';
                compDiv.onclick = function() {
                    document.querySelectorAll('.test-component').forEach(c => {
                        c.style.borderColor = '#9FA8DA';
                    });
                    this.style.borderColor = '#3949AB';
                    this.style.borderStyle = 'solid';
                    document.getElementById('labelSelect').value = this.dataset.id;
                };
                componentsDiv.appendChild(compDiv);
            });
            
            document.getElementById('submitLabelBtn').onclick = checkLabelAnswer;
        }
        
        // æ£€æŸ¥æ ‡æ³¨ç­”æ¡ˆ
        function checkLabelAnswer() {
            const select = document.getElementById('labelSelect');
            const selectedComp = document.querySelector('.test-component[style*="border-color: rgb(57, 73, 171)"]');
            const feedback = document.getElementById('labelFeedback');
            
            if (!select.value || !selectedComp) {
                feedback.textContent = 'è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç»„ä»¶å’Œå¯¹åº”çš„åç§°';
                feedback.className = 'feedback incorrect';
                return;
            }
            
            if (select.value === selectedComp.dataset.id) {
                feedback.textContent = 'âœ“ æ­£ç¡®ï¼';
                feedback.className = 'feedback correct';
                
                // æ ‡è®°ä¸ºå·²æ­£ç¡®
                selectedComp.style.backgroundColor = '#C8E6C9';
                selectedComp.style.color = '#2E7D32';
                selectedComp.textContent = reflexComponents.find(c => c.id === select.value).name;
                selectedComp.onclick = null;
                
                // æ£€æŸ¥æ˜¯å¦å…¨éƒ¨å®Œæˆ
                const remaining = document.querySelectorAll('.test-component:not([style*="background-color: rgb(200, 230, 201)"])').length;
                if (remaining === 0) {
                    testFeedback.textContent = 'ğŸ‰ æ­å–œï¼ä½ å·²æ­£ç¡®æ ‡æ³¨æ‰€æœ‰ç»„ä»¶ï¼';
                    testFeedback.className = 'feedback correct';
                }
            } else {
                feedback.textContent = 'âœ— ä¸æ­£ç¡®ï¼Œè¯·å†è¯•ä¸€æ¬¡';
                feedback.className = 'feedback incorrect';
            }
        }
        
        // é¡ºåºæ’åºæµ‹è¯•
        function startOrderTest() {
            animationState.testActive = true;
            animationState.testType = 'order';
            
            testArea.innerHTML = `
                <p>å°†åå°„å¼§çš„äº”ä¸ªç¯èŠ‚æŒ‰æ­£ç¡®é¡ºåºæ’åˆ—ï¼š</p>
                <div id="orderTestArea" style="
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 10px;
                    margin: 15px 0;
                ">
                    <div id="dropZone" style="
                        width: 100%;
                        min-height: 200px;
                        border: 2px dashed #C5E1A5;
                        border-radius: 8px;
                        padding: 15px;
                        display: flex;
                        flex-direction: column;
                        gap: 8px;
                    ">
                        <p style="color: #7CB342; text-align: center;">å°†ç»„ä»¶æ‹–æ”¾åˆ°è¿™é‡Œæ’åº</p>
                    </div>
                    <div id="sourceComponents" style="
                        display: flex;
                        gap: 10px;
                        flex-wrap: wrap;
                        justify-content: center;
                        margin-top: 10px;
                    "></div>
                </div>
                <button id="checkOrderBtn">æ£€æŸ¥é¡ºåº</button>
                <div class="feedback" id="orderFeedback" style="margin-top: 10px;"></div>
            `;
            
            testFeedback.textContent = '';
            testFeedback.className = 'feedback';
            
            // åˆ›å»ºå¯æ‹–æ‹½çš„ç»„ä»¶
            const sourceDiv = document.getElementById('sourceComponents');
            const dropZone = document.getElementById('dropZone');
            const components = [...reflexComponents];
            
            // æ‰“ä¹±é¡ºåº
            for (let i = components.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [components[i], components[j]] = [components[j], components[i]];
            }
            
            components.forEach(comp => {
                const draggable = document.createElement('div');
                draggable.className = 'draggable-component';
                draggable.dataset.id = comp.id;
                draggable.draggable = true;
                draggable.style.cssText = `
                    padding: 8px 15px;
                    background-color: ${comp.color};
                    border: 2px solid ${comp.activeColor};
                    border-radius: 6px;
                    cursor: move;
                    font-weight: 600;
                    color: #1A237E;
                    user-select: none;
                `;
                draggable.textContent = comp.name;
                
                draggable.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', comp.id);
                    e.dataTransfer.effectAllowed = 'move';
                });
                
                sourceDiv.appendChild(draggable);
            });
            
            // è®¾ç½®æ”¾ç½®åŒºåŸŸ
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                dropZone.style.borderColor = '#7CB342';
                dropZone.style.backgroundColor = '#F1F8E9';
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.style.borderColor = '#C5E1A5';
                dropZone.style.backgroundColor = 'white';
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                const compId = e.dataTransfer.getData('text/plain');
                const comp = reflexComponents.find(c => c.id === compId);
                
                if (comp) {
                    // æ£€æŸ¥æ˜¯å¦å·²ç»å­˜åœ¨
                    const existing = dropZone.querySelector(`[data-id="${compId}"]`);
                    if (!existing) {
                        const droppedComp = document.createElement('div');
                        droppedComp.className = 'dropped-component';
                        droppedComp.dataset.id = compId;
                        droppedComp.style.cssText = `
                            padding: 8px 15px;
                            background-color: ${comp.color};
                            border: 2px solid ${comp.activeColor};
                            border-radius: 6px;
                            margin: 5px 0;
                            font-weight: 600;
                            color: #1A237E;
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                        `;
                        
                        droppedComp.innerHTML = `
                            <span>${comp.name}</span>
                            <button class="remove-btn" style="
                                background: none;
                                border: none;
                                color: #EF5350;
                                cursor: pointer;
                                font-size: 18px;
                            ">Ã—</button>
                        `;
                        
                        droppedComp.querySelector('.remove-btn').onclick = function() {
                            droppedComp.remove();
                            // é‡æ–°æ˜¾ç¤ºåœ¨æºåŒºåŸŸ
                            const sourceComp = sourceDiv.querySelector(`[data-id="${compId}"]`);
                            if (sourceComp) {
                                sourceComp.style.display = 'block';
                            }
                        };
                        
                        dropZone.appendChild(droppedComp);
                        
                        // ä»æºåŒºåŸŸéšè—
                        const sourceComp = sourceDiv.querySelector(`[data-id="${compId}"]`);
                        if (sourceComp) {
                            sourceComp.style.display = 'none';
                        }
                    }
                }
                
                dropZone.style.borderColor = '#C5E1A5';
                dropZone.style.backgroundColor = 'white';
            });
            
            document.getElementById('checkOrderBtn').onclick = checkOrderAnswer;
        }
        
        // æ£€æŸ¥é¡ºåºç­”æ¡ˆ
        function checkOrderAnswer() {
            const droppedComps = document.querySelectorAll('#dropZone .dropped-component');
            const orderFeedback = document.getElementById('orderFeedback');
            
            if (droppedComps.length !== 5) {
                orderFeedback.textContent = 'è¯·å°†å…¨éƒ¨5ä¸ªç»„ä»¶æ‹–æ”¾åˆ°æ’åºåŒºåŸŸ';
                orderFeedback.className = 'feedback incorrect';
                return;
            }
            
            const correctOrder = ['receptor', 'afferent', 'center', 'efferent', 'effector'];
            let isCorrect = true;
            
            droppedComps.forEach((comp, index) => {
                if (comp.dataset.id !== correctOrder[index]) {
                    isCorrect = false;
                }
            });
            
            if (isCorrect) {
                orderFeedback.textContent = 'âœ“ å®Œå…¨æ­£ç¡®ï¼åå°„å¼§é¡ºåºæ­£ç¡®ï¼';
                orderFeedback.className = 'feedback correct';
                testFeedback.textContent = 'ğŸ‰ å¤ªæ£’äº†ï¼ä½ å®Œå…¨æŒæ¡äº†åå°„å¼§çš„ä¼ é€’é¡ºåºï¼';
                testFeedback.className = 'feedback correct';
            } else {
                orderFeedback.textContent = 'âœ— é¡ºåºä¸æ­£ç¡®ï¼Œè¯·å†æ£€æŸ¥ä¸€ä¸‹';
                orderFeedback.className = 'feedback incorrect';
            }
        }
        
        // é‡ç½®æµ‹è¯•
        function resetTest() {
            animationState.testActive = false;
            animationState.testType = null;
            animationState.labelsHidden = false;
            
            testArea.innerHTML = '<p>é€‰æ‹©ä¸€ç§æµ‹è¯•ç±»å‹å¼€å§‹æŒ‘æˆ˜</p>';
            testFeedback.textContent = '';
            testFeedback.className = 'feedback';
            
            draw();
        }
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
        function initEventListeners() {
            // æ¨¡å¼åˆ‡æ¢
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    switchMode(btn.dataset.mode);
                });
            });
            
            // æ§åˆ¶æŒ‰é’®
            document.getElementById('playBtn').addEventListener('click', startAnimation);
            document.getElementById('pauseBtn').addEventListener('click', pauseAnimation);
            document.getElementById('restartBtn').addEventListener('click', restartAnimation);
            document.getElementById('prevBtn').addEventListener('click', prevStep);
            document.getElementById('nextBtn').addEventListener('click', nextStep);
            
            // é€Ÿåº¦æ§åˆ¶
            const speedSlider = document.getElementById('speedSlider');
            const speedValue = document.getElementById('speedValue');
            
            speedSlider.addEventListener('input', () => {
                animationState.speed = parseInt(speedSlider.value);
                const speedLabels = ['ææ…¢', 'å¾ˆæ…¢', 'è¾ƒæ…¢', 'æ…¢', 'ä¸­é€Ÿ', 'è¾ƒå¿«', 'å¿«', 'å¾ˆå¿«', 'æå¿«', 'çœŸå®é€Ÿåº¦'];
                speedValue.textContent = speedLabels[animationState.speed - 1] || 'ä¸­é€Ÿ';
            });
            
            // æµ‹è¯•æŒ‰é’®
            document.getElementById('labelTestBtn').addEventListener('click', startLabelTest);
            document.getElementById('orderTestBtn').addEventListener('click', startOrderTest);
            document.getElementById('resetTestBtn').addEventListener('click', resetTest);
            
            // Canvasç‚¹å‡»äº‹ä»¶
            canvas.addEventListener('click', (e) => {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                if (animationState.mode === 'explore') {
                    const comp = getComponentAt(x, y);
                    if (comp) {
                        showComponentInfo(comp, x, y);
                    } else {
                        hideComponentInfo();
                    }
                } else if (animationState.mode === 'test' && animationState.testActive) {
                    // æµ‹è¯•æ¨¡å¼ä¸‹çš„ç‚¹å‡»å¤„ç†
                    hideComponentInfo();
                }
            });
            
            // ç‚¹å‡»å…¶ä»–åœ°æ–¹éšè—ç»„ä»¶ä¿¡æ¯
            document.addEventListener('click', (e) => {
                if (!canvas.contains(e.target) && !componentInfo.contains(e.target)) {
                    hideComponentInfo();
                }
            });
            
            // çª—å£å¤§å°å˜åŒ–æ—¶è°ƒæ•´Canvas
            window.addEventListener('resize', initCanvas);
        }
        
        // åˆå§‹åŒ–åº”ç”¨
        function initApp() {
            initCanvas();
            initEventListeners();
            updateStepInfo();
            updateControlButtons();
            
            // åˆå§‹ç»˜åˆ¶
            draw();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', initApp);
    </script>
</body>
</html>