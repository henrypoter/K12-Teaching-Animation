<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸºå› å·¥ç¨‹å…¨è¿‡ç¨‹äº¤äº’æ•™å­¦åŠ¨ç”»</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0a192f 0%, #1a365d 100%);
            color: #e6f1ff;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(16, 42, 88, 0.7);
            border-radius: 15px;
            border: 1px solid rgba(64, 156, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 30, 60, 0.3);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #64ffda, #4cc9f0);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 10px rgba(100, 255, 218, 0.2);
        }
        
        .subtitle {
            font-size: 1.1rem;
            color: #a8b2d1;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .control-panel {
            background: rgba(16, 42, 88, 0.8);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(64, 156, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 30, 60, 0.3);
        }
        
        .steps-nav {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .step-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px 15px;
            background: rgba(30, 60, 114, 0.7);
            border: 1px solid rgba(64, 156, 255, 0.3);
            border-radius: 10px;
            color: #ccd6f6;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .step-btn:hover {
            background: rgba(64, 156, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .step-btn.active {
            background: linear-gradient(90deg, #1e7a5e, #2a9d8f);
            color: white;
            border-color: #64ffda;
            box-shadow: 0 0 15px rgba(100, 255, 218, 0.3);
        }
        
        .step-btn.completed {
            background: rgba(42, 157, 143, 0.3);
            border-color: #2a9d8f;
        }
        
        .animation-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }
        
        .control-btn {
            padding: 10px 25px;
            background: rgba(30, 60, 114, 0.9);
            border: 1px solid rgba(64, 156, 255, 0.5);
            border-radius: 8px;
            color: #e6f1ff;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background: rgba(64, 156, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .control-btn.primary {
            background: linear-gradient(90deg, #1e7a5e, #2a9d8f);
            border-color: #64ffda;
        }
        
        .content-area {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .animation-container {
            background: rgba(10, 25, 47, 0.9);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(64, 156, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 30, 60, 0.3);
            min-height: 500px;
            position: relative;
            overflow: hidden;
        }
        
        #animationCanvas {
            width: 100%;
            height: 100%;
            display: block;
            border-radius: 10px;
        }
        
        .info-panel {
            background: rgba(16, 42, 88, 0.8);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(64, 156, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 30, 60, 0.3);
        }
        
        .step-info {
            display: none;
        }
        
        .step-info.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .step-title {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: #64ffda;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .step-icon {
            width: 40px;
            height: 40px;
            background: rgba(100, 255, 218, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .step-description {
            font-size: 1.1rem;
            line-height: 1.7;
            color: #a8b2d1;
            margin-bottom: 20px;
        }
        
        .key-terms {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }
        
        .term {
            padding: 8px 15px;
            background: rgba(30, 60, 114, 0.7);
            border-radius: 20px;
            font-size: 0.9rem;
            color: #ccd6f6;
            border: 1px solid rgba(64, 156, 255, 0.3);
            cursor: help;
            transition: all 0.3s ease;
        }
        
        .term:hover {
            background: rgba(64, 156, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .interaction-hint {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(16, 42, 88, 0.9);
            padding: 10px 20px;
            border-radius: 20px;
            color: #64ffda;
            font-size: 0.9rem;
            border: 1px solid rgba(100, 255, 218, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(100, 255, 218, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(100, 255, 218, 0); }
            100% { box-shadow: 0 0 0 0 rgba(100, 255, 218, 0); }
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(64, 156, 255, 0.2);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #8892b0;
            font-size: 0.9rem;
            border-top: 1px solid rgba(64, 156, 255, 0.2);
        }
        
        @media (max-width: 768px) {
            .steps-nav {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .animation-container {
                min-height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>åŸºå› å·¥ç¨‹å…¨è¿‡ç¨‹äº¤äº’æ•™å­¦åŠ¨ç”»</h1>
            <p class="subtitle">æ¢ç´¢ä»é™åˆ¶é…¶å‰ªåˆ‡åˆ°åŸºå› è¡¨è¾¾çš„å®Œæ•´æµç¨‹ï¼šå‰ªåˆ‡ â†’ è¿æ¥ â†’ é‡ç»„ â†’ è½¬åŒ– â†’ è¡¨è¾¾ã€‚é€šè¿‡äº¤äº’å¼åŠ¨ç”»ç›´è§‚ç†è§£åˆ†å­ç”Ÿç‰©å­¦æ ¸å¿ƒæŠ€æœ¯ã€‚</p>
        </header>
        
        <div class="main-content">
            <div class="control-panel">
                <div class="steps-nav">
                    <button class="step-btn active" data-step="1">1. é™åˆ¶é…¶å‰ªåˆ‡</button>
                    <button class="step-btn" data-step="2">2. è½½ä½“å‡†å¤‡</button>
                    <button class="step-btn" data-step="3">3. é‡ç»„è¿æ¥</button>
                    <button class="step-btn" data-step="4">4. è½¬åŒ–</button>
                    <button class="step-btn" data-step="5">5. è¡¨è¾¾ä¸ç­›é€‰</button>
                </div>
                
                <div class="animation-controls">
                    <button class="control-btn" id="prevBtn">ä¸Šä¸€æ­¥</button>
                    <button class="control-btn primary" id="playBtn">æ’­æ”¾åŠ¨ç”»</button>
                    <button class="control-btn" id="resetBtn">é‡ç½®</button>
                    <button class="control-btn" id="nextBtn">ä¸‹ä¸€æ­¥</button>
                </div>
            </div>
            
            <div class="content-area">
                <div class="animation-container">
                    <canvas id="animationCanvas" width="1100" height="500"></canvas>
                    <div class="interaction-hint" id="hintText">
                        <span>ğŸ’¡</span> ç‚¹å‡»"æ’­æ”¾åŠ¨ç”»"æŒ‰é’®å¼€å§‹å­¦ä¹ 
                    </div>
                </div>
                
                <div class="info-panel">
                    <div class="step-info active" id="step1-info">
                        <h2 class="step-title"><span class="step-icon">âœ‚ï¸</span> æ­¥éª¤1: é™åˆ¶é…¶å‰ªåˆ‡</h2>
                        <p class="step-description">
                            é™åˆ¶æ€§å†…åˆ‡é…¶æ˜¯åŸºå› å·¥ç¨‹çš„"åˆ†å­å‰ªåˆ€"ï¼Œèƒ½è¯†åˆ«DNAåˆ†å­ä¸Šç‰¹å®šçš„æ ¸è‹·é…¸åºåˆ—å¹¶åœ¨ç‰¹å®šä½ç‚¹åˆ‡å‰²DNAã€‚
                            æœ¬æ­¥éª¤å±•ç¤ºé™åˆ¶é…¶EcoRIè¯†åˆ«"GAATTC"åºåˆ—å¹¶åœ¨Gå’ŒAä¹‹é—´åˆ‡å‰²ï¼Œäº§ç”Ÿå…·æœ‰ç²˜æ€§æœ«ç«¯çš„DNAç‰‡æ®µã€‚
                        </p>
                        <div class="key-terms">
                            <div class="term" title="èƒ½è¯†åˆ«ç‰¹å®šDNAåºåˆ—å¹¶åœ¨ç‰¹å®šä½ç‚¹åˆ‡å‰²çš„é…¶">é™åˆ¶æ€§å†…åˆ‡é…¶</div>
                            <div class="term" title="é™åˆ¶é…¶è¯†åˆ«å’Œåˆ‡å‰²çš„ç‰¹å®šDNAåºåˆ—">è¯†åˆ«åºåˆ—</div>
                            <div class="term" title="DNAåˆ‡å‰²åäº§ç”Ÿçš„å•é“¾æœ«ç«¯ï¼Œèƒ½é€šè¿‡ç¢±åŸºäº’è¡¥é…å¯¹è¿æ¥">ç²˜æ€§æœ«ç«¯</div>
                            <div class="term" title="è¢«åˆ‡å‰²å‡ºæ¥çš„ç›®æ ‡DNAç‰‡æ®µ">ç›®çš„åŸºå› </div>
                        </div>
                    </div>
                    
                    <div class="step-info" id="step2-info">
                        <h2 class="step-title"><span class="step-icon">ğŸšš</span> æ­¥éª¤2: è½½ä½“å‡†å¤‡</h2>
                        <p class="step-description">
                            è´¨ç²’æ˜¯åŸºå› å·¥ç¨‹çš„"åˆ†å­è´§è½¦"ï¼Œæ˜¯èƒ½è‡ªæˆ‘å¤åˆ¶çš„å°å‹ç¯çŠ¶DNAåˆ†å­ã€‚
                            ä½¿ç”¨ç›¸åŒçš„é™åˆ¶é…¶åˆ‡å‰²è´¨ç²’DNAï¼Œä½¿å…¶äº§ç”Ÿä¸ç›®çš„åŸºå› åŒ¹é…çš„ç²˜æ€§æœ«ç«¯ï¼Œä¸ºè¿æ¥åšå¥½å‡†å¤‡ã€‚
                        </p>
                        <div class="key-terms">
                            <div class="term" title="ç”¨äºæºå¸¦å¤–æºåŸºå› è¿›å…¥å®¿ä¸»ç»†èƒçš„DNAåˆ†å­">è½½ä½“</div>
                            <div class="term" title="ç»†èŒä¸­å¤©ç„¶å­˜åœ¨çš„å°å‹ç¯çŠ¶DNAåˆ†å­">è´¨ç²’</div>
                            <div class="term" title="è´¨ç²’ä¸Šå«æœ‰å¤šä¸ªé™åˆ¶é…¶åˆ‡ä½ç‚¹çš„åŒºåŸŸ">å¤šå…‹éš†ä½ç‚¹</div>
                            <div class="term" title="ä½¿å®¿ä¸»ç»†èƒå…·æœ‰æŠ—ç”Ÿç´ æŠ—æ€§çš„åŸºå› ">æŠ—æ€§åŸºå› </div>
                        </div>
                    </div>
                    
                    <div class="step-info" id="step3-info">
                        <h2 class="step-title"><span class="step-icon">ğŸ”—</span> æ­¥éª¤3: é‡ç»„è¿æ¥</h2>
                        <p class="step-description">
                            DNAè¿æ¥é…¶æ˜¯"åˆ†å­èƒ¶æ°´"ï¼Œèƒ½å°†DNAç‰‡æ®µå…±ä»·è¿æ¥èµ·æ¥ã€‚
                            ç›®çš„åŸºå› ä¸è´¨ç²’è½½ä½“é€šè¿‡äº’è¡¥çš„ç²˜æ€§æœ«ç«¯ç»“åˆï¼Œåœ¨DNAè¿æ¥é…¶çš„ä½œç”¨ä¸‹å½¢æˆç£·é…¸äºŒé…¯é”®ï¼Œäº§ç”Ÿé‡ç»„DNAåˆ†å­ã€‚
                        </p>
                        <div class="key-terms">
                            <div class="term" title="å‚¬åŒ–DNAç‰‡æ®µè¿æ¥çš„é…¶">DNAè¿æ¥é…¶</div>
                            <div class="term" title="å°†ç›®çš„åŸºå› æ’å…¥è½½ä½“åå½¢æˆçš„DNAåˆ†å­">é‡ç»„DNA</div>
                            <div class="term" title="é‡ç»„åçš„è´¨ç²’åˆ†å­">é‡ç»„è´¨ç²’</div>
                            <div class="term" title="DNAåˆ†å­ä¸­è¿æ¥æ ¸è‹·é…¸çš„åŒ–å­¦é”®">ç£·é…¸äºŒé…¯é”®</div>
                        </div>
                    </div>
                    
                    <div class="step-info" id="step4-info">
                        <h2 class="step-title"><span class="step-icon">ğŸ¦ </span> æ­¥éª¤4: è½¬åŒ–</h2>
                        <p class="step-description">
                            å°†é‡ç»„è´¨ç²’å¯¼å…¥å®¿ä¸»ç»†èƒï¼ˆå¦‚å¤§è‚ æ†èŒï¼‰çš„è¿‡ç¨‹ç§°ä¸ºè½¬åŒ–ã€‚
                            å¸¸ç”¨æ–¹æ³•åŒ…æ‹¬çƒ­æ¿€æ³•å’Œç”µå‡»æ³•ï¼Œä½¿ç»†èƒè†œæš‚æ—¶å‡ºç°å­”æ´ï¼Œå…è®¸è´¨ç²’è¿›å…¥ç»†èƒå†…éƒ¨ã€‚
                        </p>
                        <div class="key-terms">
                            <div class="term" title="å°†å¤–æºDNAå¯¼å…¥å®¿ä¸»ç»†èƒçš„è¿‡ç¨‹">è½¬åŒ–</div>
                            <div class="term" title="æ¥å—å¤–æºDNAçš„ç»†èƒ">å®¿ä¸»ç»†èƒ</div>
                            <div class="term" title="é€šè¿‡æ¸©åº¦å˜åŒ–ä½¿ç»†èƒè†œé€šé€æ€§å¢åŠ çš„æ–¹æ³•">çƒ­æ¿€æ³•</div>
                            <div class="term" title="é€šè¿‡ç”µè„‰å†²ä½¿ç»†èƒè†œå½¢æˆä¸´æ—¶å­”æ´çš„æ–¹æ³•">ç”µå‡»æ³•</div>
                        </div>
                    </div>
                    
                    <div class="step-info" id="step5-info">
                        <h2 class="step-title"><span class="step-icon">ğŸ­</span> æ­¥éª¤5: è¡¨è¾¾ä¸ç­›é€‰</h2>
                        <p class="step-description">
                            æˆåŠŸè½¬åŒ–çš„ç»†èƒåœ¨å«æœ‰æŠ—ç”Ÿç´ çš„åŸ¹å…»åŸºä¸Šç”Ÿé•¿ï¼Œåªæœ‰å«æœ‰æŠ—æ€§åŸºå› çš„ç»†èƒæ‰èƒ½å­˜æ´»ã€‚
                            ç›®çš„åŸºå› åœ¨å®¿ä¸»ç»†èƒå†…è½¬å½•å’Œç¿»è¯‘ï¼Œåˆæˆç›®æ ‡è›‹ç™½è´¨ï¼ˆå¦‚èƒ°å²›ç´ ï¼‰ï¼Œå®ç°åŸºå› çš„è¡¨è¾¾ã€‚
                        </p>
                        <div class="key-terms">
                            <div class="term" title="åŸºå› ä¿¡æ¯è½¬åŒ–ä¸ºè›‹ç™½è´¨çš„è¿‡ç¨‹">åŸºå› è¡¨è¾¾</div>
                            <div class="term" title="ä»DNAåˆæˆRNAçš„è¿‡ç¨‹">è½¬å½•</div>
                            <div class="term" title="ä»RNAåˆæˆè›‹ç™½è´¨çš„è¿‡ç¨‹">ç¿»è¯‘</div>
                            <div class="term" title="ç”¨äºç­›é€‰è½¬åŒ–æˆåŠŸç»†èƒçš„ç‰©è´¨">æŠ—ç”Ÿç´ ç­›é€‰</div>
                        </div>
                    </div>
                    
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #ff6b6b;"></div>
                            <span>é™åˆ¶é…¶ (åˆ†å­å‰ªåˆ€)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #ffa726;"></div>
                            <span>ç›®çš„åŸºå› </span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #4ecdc4;"></div>
                            <span>è´¨ç²’è½½ä½“</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #ffe66d;"></div>
                            <span>DNAè¿æ¥é…¶ (åˆ†å­èƒ¶æ°´)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #95e1d3;"></div>
                            <span>å®¿ä¸»ç»†èƒ</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>åŸºå› å·¥ç¨‹äº¤äº’æ•™å­¦åŠ¨ç”» | è®¾è®¡åŸç†ï¼šé™åˆ¶é…¶å‰ªåˆ‡ â†’ è½½ä½“+ç›®çš„åŸºå›  â†’ é‡ç»„ â†’ è½¬åŒ– â†’ è¡¨è¾¾</p>
            <p>Â© 2023 æ•™è‚²æŠ€æœ¯æ¼”ç¤º | ç”¨äºæ•™å­¦ç›®çš„</p>
        </footer>
    </div>

    <script>
        // å…¨å±€å˜é‡
        const canvas = document.getElementById('animationCanvas');
        const ctx = canvas.getContext('2d');
        const stepButtons = document.querySelectorAll('.step-btn');
        const stepInfos = document.querySelectorAll('.step-info');
        const playBtn = document.getElementById('playBtn');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const resetBtn = document.getElementById('resetBtn');
        const hintText = document.getElementById('hintText');
        
        let currentStep = 1;
        let animationPlaying = false;
        let animationFrameId = null;
        let animationTime = 0;
        
        // åŠ¨ç”»å¯¹è±¡å®šä¹‰
        const animationObjects = {
            // æ­¥éª¤1: é™åˆ¶é…¶å‰ªåˆ‡
            dna: {
                x: 200, y: 250, width: 400, height: 30,
                segments: 8, color: '#4a4a4a',
                cutPosition: 4, // ç¬¬4æ®µè¢«åˆ‡å‰²
                isCut: false,
                stickyEnds: []
            },
            restrictionEnzyme: {
                x: 150, y: 150, width: 40, height: 40,
                color: '#ff6b6b', targetX: 350, targetY: 250,
                isMoving: false, hasCut: false
            },
            targetGene: {
                x: 0, y: 0, width: 100, height: 30,
                color: '#ffa726', isVisible: false,
                isDraggable: false, isDragging: false
            },
            
            // æ­¥éª¤2: è½½ä½“å‡†å¤‡
            plasmid: {
                x: 700, y: 250, radius: 60, color: '#4ecdc4',
                isCut: false, cutAngle: Math.PI/4,
                markerGenes: [
                    {angle: 0, label: "å¯åŠ¨å­", color: "#ff9e80"},
                    {angle: Math.PI, label: "æŠ—æ€§åŸºå› ", color: "#80deea"}
                ]
            },
            
            // æ­¥éª¤3: é‡ç»„è¿æ¥
            ligase: {
                x: 500, y: 100, width: 40, height: 40,
                color: '#ffe66d', isVisible: false,
                isMoving: false
            },
            recombinantPlasmid: {
                x: 700, y: 250, radius: 60, color: '#4ecdc4',
                geneInserted: false, geneColor: '#ffa726',
                isVisible: false
            },
            
            // æ­¥éª¤4: è½¬åŒ–
            hostCell: {
                x: 550, y: 250, radius: 120, color: '#95e1d3',
                membraneWidth: 5, isVisible: false,
                plasmidsInside: []
            },
            
            // æ­¥éª¤5: è¡¨è¾¾ä¸ç­›é€‰
            proteinFactory: {
                x: 550, y: 250, radius: 100, color: '#95e1d3',
                isVisible: false, proteins: []
            },
            antibiotics: {
                x: 300, y: 400, width: 600, height: 50,
                color: 'rgba(255, 107, 107, 0.3)', isVisible: false
            }
        };
        
        // åˆå§‹åŒ–
        function init() {
            // è®¾ç½®Canvaså°ºå¯¸
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // äº‹ä»¶ç›‘å¬å™¨
            stepButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const step = parseInt(btn.dataset.step);
                    goToStep(step);
                });
            });
            
            playBtn.addEventListener('click', toggleAnimation);
            prevBtn.addEventListener('click', () => goToStep(currentStep - 1));
            nextBtn.addEventListener('click', () => goToStep(currentStep + 1));
            resetBtn.addEventListener('click', resetAnimation);
            
            // é¼ æ ‡äº‹ä»¶ç”¨äºæ‹–æ‹½äº¤äº’
            canvas.addEventListener('mousedown', handleMouseDown);
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('mouseup', handleMouseUp);
            
            // å¼€å§‹åŠ¨ç”»å¾ªç¯
            animate();
        }
        
        // è°ƒæ•´Canvaså°ºå¯¸
        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        }
        
        // è½¬åˆ°æŒ‡å®šæ­¥éª¤
        function goToStep(step) {
            if (step < 1 || step > 5) return;
            
            // æ›´æ–°å½“å‰æ­¥éª¤
            currentStep = step;
            
            // æ›´æ–°æ­¥éª¤æŒ‰é’®çŠ¶æ€
            stepButtons.forEach((btn, index) => {
                const btnStep = index + 1;
                btn.classList.remove('active');
                if (btnStep === step) {
                    btn.classList.add('active');
                }
                if (btnStep < step) {
                    btn.classList.add('completed');
                } else {
                    btn.classList.remove('completed');
                }
            });
            
            // æ›´æ–°ä¿¡æ¯é¢æ¿
            stepInfos.forEach(info => {
                info.classList.remove('active');
            });
            document.getElementById(`step${step}-info`).classList.add('active');
            
            // é‡ç½®åŠ¨ç”»çŠ¶æ€
            resetAnimationState();
            animationTime = 0;
            
            // æ›´æ–°æç¤ºæ–‡æœ¬
            updateHintText();
        }
        
        // é‡ç½®åŠ¨ç”»çŠ¶æ€
        function resetAnimationState() {
            // é‡ç½®æ‰€æœ‰å¯¹è±¡çŠ¶æ€
            animationObjects.dna.isCut = false;
            animationObjects.dna.stickyEnds = [];
            animationObjects.restrictionEnzyme.isMoving = false;
            animationObjects.restrictionEnzyme.hasCut = false;
            animationObjects.restrictionEnzyme.x = 150;
            animationObjects.restrictionEnzyme.y = 150;
            
            animationObjects.targetGene.isVisible = false;
            animationObjects.targetGene.isDraggable = false;
            animationObjects.targetGene.x = 0;
            animationObjects.targetGene.y = 0;
            
            animationObjects.plasmid.isCut = false;
            animationObjects.ligase.isVisible = false;
            animationObjects.ligase.isMoving = false;
            animationObjects.recombinantPlasmid.isVisible = false;
            animationObjects.recombinantPlasmid.geneInserted = false;
            
            animationObjects.hostCell.isVisible = false;
            animationObjects.hostCell.plasmidsInside = [];
            
            animationObjects.proteinFactory.isVisible = false;
            animationObjects.proteinFactory.proteins = [];
            animationObjects.antibiotics.isVisible = false;
            
            animationPlaying = false;
            playBtn.textContent = 'æ’­æ”¾åŠ¨ç”»';
            
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            }
        }
        
        // åˆ‡æ¢åŠ¨ç”»æ’­æ”¾çŠ¶æ€
        function toggleAnimation() {
            animationPlaying = !animationPlaying;
            playBtn.textContent = animationPlaying ? 'æš‚åœåŠ¨ç”»' : 'æ’­æ”¾åŠ¨ç”»';
            
            if (animationPlaying) {
                hintText.style.display = 'none';
                startAnimation();
            }
        }
        
        // å¼€å§‹åŠ¨ç”»
        function startAnimation() {
            if (animationFrameId) return;
            
            function animateStep() {
                animationTime += 0.016; // çº¦60fps
                
                // æ ¹æ®å½“å‰æ­¥éª¤æ‰§è¡ŒåŠ¨ç”»
                switch(currentStep) {
                    case 1:
                        animateStep1();
                        break;
                    case 2:
                        animateStep2();
                        break;
                    case 3:
                        animateStep3();
                        break;
                    case 4:
                        animateStep4();
                        break;
                    case 5:
                        animateStep5();
                        break;
                }
                
                // ç»˜åˆ¶å½“å‰å¸§
                draw();
                
                if (animationPlaying) {
                    animationFrameId = requestAnimationFrame(animateStep);
                } else {
                    animationFrameId = null;
                }
            }
            
            animateStep();
        }
        
        // æ­¥éª¤1åŠ¨ç”»ï¼šé™åˆ¶é…¶å‰ªåˆ‡
        function animateStep1() {
            const dna = animationObjects.dna;
            const enzyme = animationObjects.restrictionEnzyme;
            const gene = animationObjects.targetGene;
            
            // ç¬¬ä¸€é˜¶æ®µï¼šé…¶ç§»åŠ¨åˆ°DNA
            if (animationTime < 2 && !enzyme.hasCut) {
                enzyme.isMoving = true;
                const progress = animationTime / 2;
                enzyme.x = 150 + (350 - 150) * progress;
                enzyme.y = 150 + (250 - 150) * progress;
            }
            
            // ç¬¬äºŒé˜¶æ®µï¼šåˆ‡å‰²DNA
            if (animationTime >= 2 && animationTime < 3 && !enzyme.hasCut) {
                dna.isCut = true;
                enzyme.hasCut = true;
                
                // åˆ›å»ºç²˜æ€§æœ«ç«¯
                dna.stickyEnds = [
                    {x: dna.x + dna.width/2 - 20, y: dna.y - 15, sequence: 'AATT'},
                    {x: dna.x + dna.width/2 + 20, y: dna.y - 15, sequence: 'TTAA'}
                ];
                
                // è®¾ç½®ç›®çš„åŸºå› ä½ç½®
                gene.x = dna.x + dna.width/2 - 50;
                gene.y = dna.y;
                gene.isVisible = true;
            }
            
            // ç¬¬ä¸‰é˜¶æ®µï¼šé…¶ç¦»å¼€ï¼ŒåŸºå› å¯æ‹–æ‹½
            if (animationTime >= 3 && animationTime < 4) {
                enzyme.isMoving = true;
                const progress = (animationTime - 3) / 1;
                enzyme.x = 350 + (150 - 350) * progress;
                enzyme.y = 250 + (150 - 250) * progress;
            }
            
            if (animationTime >= 4) {
                enzyme.isMoving = false;
                gene.isDraggable = true;
                
                // è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€æ­¥
                if (animationTime > 6) {
                    goToStep(2);
                    animationTime = 0;
                }
            }
        }
        
        // æ­¥éª¤2åŠ¨ç”»ï¼šè½½ä½“å‡†å¤‡
        function animateStep2() {
            const plasmid = animationObjects.plasmid;
            const enzyme = animationObjects.restrictionEnzyme;
            
            // é‡ç½®é…¶ä½ç½®
            if (animationTime < 0.5) {
                enzyme.x = 550;
                enzyme.y = 150;
                enzyme.hasCut = false;
            }
            
            // é…¶ç§»åŠ¨åˆ°è´¨ç²’
            if (animationTime >= 0.5 && animationTime < 1.5 && !enzyme.hasCut) {
                enzyme.isMoving = true;
                const progress = (animationTime - 0.5) / 1;
                enzyme.x = 550 + (700 - 550) * progress;
                enzyme.y = 150 + (250 - 150) * progress;
            }
            
            // åˆ‡å‰²è´¨ç²’
            if (animationTime >= 1.5 && animationTime < 2.5 && !enzyme.hasCut) {
                plasmid.isCut = true;
                enzyme.hasCut = true;
            }
            
            // é…¶ç¦»å¼€
            if (animationTime >= 2.5 && animationTime < 3.5) {
                enzyme.isMoving = true;
                const progress = (animationTime - 2.5) / 1;
                enzyme.x = 700 + (550 - 700) * progress;
                enzyme.y = 250 + (150 - 250) * progress;
            }
            
            if (animationTime >= 3.5) {
                enzyme.isMoving = false;
                
                // è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€æ­¥
                if (animationTime > 5) {
                    goToStep(3);
                    animationTime = 0;
                }
            }
        }
        
        // æ­¥éª¤3åŠ¨ç”»ï¼šé‡ç»„è¿æ¥
        function animateStep3() {
            const gene = animationObjects.targetGene;
            const plasmid = animationObjects.plasmid;
            const ligase = animationObjects.ligase;
            const recombinant = animationObjects.recombinantPlasmid;
            
            // æ˜¾ç¤ºè¿æ¥é…¶
            if (animationTime < 1) {
                ligase.isVisible = true;
                ligase.x = 500;
                ligase.y = 100;
            }
            
            // å¦‚æœåŸºå› å·²è¿æ¥åˆ°è´¨ç²’
            if (gene.isDragging === false && gene.x > 650 && gene.x < 750 && gene.y > 200 && gene.y < 300) {
                gene.x = plasmid.x;
                gene.y = plasmid.y;
                gene.isDraggable = false;
                gene.isVisible = false;
                
                // è¿æ¥é…¶ç§»åŠ¨åˆ°è¿æ¥ä½ç½®
                if (animationTime >= 1 && animationTime < 2) {
                    ligase.isMoving = true;
                    const progress = (animationTime - 1) / 1;
                    ligase.x = 500 + (700 - 500) * progress;
                    ligase.y = 100 + (250 - 100) * progress;
                }
                
                // æ˜¾ç¤ºé‡ç»„è´¨ç²’
                if (animationTime >= 2) {
                    recombinant.isVisible = true;
                    recombinant.geneInserted = true;
                    plasmid.isCut = false;
                    
                    // è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€æ­¥
                    if (animationTime > 4) {
                        goToStep(4);
                        animationTime = 0;
                    }
                }
            }
        }
        
        // æ­¥éª¤4åŠ¨ç”»ï¼šè½¬åŒ–
        function animateStep4() {
            const hostCell = animationObjects.hostCell;
            const recombinant = animationObjects.recombinantPlasmid;
            
            // æ˜¾ç¤ºå®¿ä¸»ç»†èƒ
            if (animationTime < 1) {
                hostCell.isVisible = true;
            }
            
            // é‡ç»„è´¨ç²’ç§»åŠ¨åˆ°ç»†èƒ
            if (animationTime >= 1 && animationTime < 3) {
                const progress = (animationTime - 1) / 2;
                recombinant.x = 700 + (550 - 700) * progress;
                recombinant.y = 250 + (250 - 250) * progress;
                
                // å½“è´¨ç²’æ¥è¿‘ç»†èƒæ—¶ï¼Œæ·»åŠ åˆ°å†…éƒ¨
                if (progress > 0.8 && hostCell.plasmidsInside.length === 0) {
                    hostCell.plasmidsInside.push({x: 550, y: 250, radius: 20});
                    recombinant.isVisible = false;
                }
            }
            
            // è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€æ­¥
            if (animationTime > 4) {
                goToStep(5);
                animationTime = 0;
            }
        }
        
        // æ­¥éª¤5åŠ¨ç”»ï¼šè¡¨è¾¾ä¸ç­›é€‰
        function animateStep5() {
            const proteinFactory = animationObjects.proteinFactory;
            const antibiotics = animationObjects.antibiotics;
            
            // æ˜¾ç¤ºè›‹ç™½è´¨å·¥å‚å’ŒæŠ—ç”Ÿç´ 
            if (animationTime < 1) {
                proteinFactory.isVisible = true;
                antibiotics.isVisible = true;
            }
            
            // ç”Ÿæˆè›‹ç™½è´¨
            if (animationTime >= 1 && animationTime < 6) {
                // æ¯0.5ç§’ç”Ÿæˆä¸€ä¸ªè›‹ç™½è´¨
                if (Math.floor(animationTime * 2) > proteinFactory.proteins.length) {
                    const angle = Math.random() * Math.PI * 2;
                    const distance = 80 + Math.random() * 40;
                    proteinFactory.proteins.push({
                        x: proteinFactory.x + Math.cos(angle) * distance,
                        y: proteinFactory.y + Math.sin(angle) * distance,
                        size: 5 + Math.random() * 10,
                        color: '#ffa726'
                    });
                }
            }
            
            // é™åˆ¶è›‹ç™½è´¨æ•°é‡
            if (proteinFactory.proteins.length > 20) {
                proteinFactory.proteins.shift();
            }
        }
        
        // ç»˜åˆ¶å‡½æ•°
        function draw() {
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶èƒŒæ™¯
            drawBackground();
            
            // æ ¹æ®å½“å‰æ­¥éª¤ç»˜åˆ¶
            switch(currentStep) {
                case 1:
                    drawStep1();
                    break;
                case 2:
                    drawStep2();
                    break;
                case 3:
                    drawStep3();
                    break;
                case 4:
                    drawStep4();
                    break;
                case 5:
                    drawStep5();
                    break;
            }
        }
        
        // ç»˜åˆ¶èƒŒæ™¯
        function drawBackground() {
            // æ¸å˜èƒŒæ™¯
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#0a192f');
            gradient.addColorStop(1, '#1a365d');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç½‘æ ¼çº¿
            ctx.strokeStyle = 'rgba(100, 255, 218, 0.05)';
            ctx.lineWidth = 1;
            
            for (let x = 0; x < canvas.width; x += 50) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            for (let y = 0; y < canvas.height; y += 50) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // å½“å‰æ­¥éª¤æ ‡é¢˜
            ctx.fillStyle = '#64ffda';
            ctx.font = 'bold 24px "Segoe UI"';
            ctx.textAlign = 'center';
            const stepTitles = ['', 'é™åˆ¶é…¶å‰ªåˆ‡', 'è½½ä½“å‡†å¤‡', 'é‡ç»„è¿æ¥', 'è½¬åŒ–', 'è¡¨è¾¾ä¸ç­›é€‰'];
            ctx.fillText(`æ­¥éª¤ ${currentStep}: ${stepTitles[currentStep]}`, canvas.width/2, 40);
        }
        
        // ç»˜åˆ¶æ­¥éª¤1
        function drawStep1() {
            const dna = animationObjects.dna;
            const enzyme = animationObjects.restrictionEnzyme;
            const gene = animationObjects.targetGene;
            
            // ç»˜åˆ¶DNA
            ctx.fillStyle = dna.color;
            const segmentWidth = dna.width / dna.segments;
            
            for (let i = 0; i < dna.segments; i++) {
                // å¦‚æœDNAè¢«åˆ‡å‰²ä¸”è¿™æ˜¯åˆ‡å‰²ç‚¹ï¼Œè·³è¿‡ç»˜åˆ¶
                if (dna.isCut && i === dna.cutPosition) {
                    continue;
                }
                
                const x = dna.x + i * segmentWidth;
                ctx.fillRect(x, dna.y, segmentWidth - 2, dna.height);
                
                // ç»˜åˆ¶DNAåŒèºæ—‹æ•ˆæœ
                ctx.strokeStyle = '#64ffda';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(x, dna.y);
                ctx.lineTo(x, dna.y + dna.height);
                ctx.stroke();
            }
            
            // ç»˜åˆ¶ç²˜æ€§æœ«ç«¯
            if (dna.stickyEnds.length > 0) {
                ctx.fillStyle = '#ffa726';
                ctx.font = '
<!--æ£€æµ‹åˆ°ä»£ç æˆªæ–­ï¼Œè‡ªåŠ¨ç»­å†™ä¸­...-->
'bold 14px "Segoe UI"';
                ctx.textAlign = 'center';
                
                dna.stickyEnds.forEach(end => {
                    // ç»˜åˆ¶æœ«ç«¯å½¢çŠ¶
                    ctx.beginPath();
                    ctx.moveTo(end.x, end.y);
                    ctx.lineTo(end.x + 20, end.y + 15);
                    ctx.lineTo(end.x + 20, end.y - 15);
                    ctx.closePath();
                    ctx.fill();
                    
                    // ç»˜åˆ¶åºåˆ—æ–‡æœ¬
                    ctx.fillStyle = '#ffffff';
                    ctx.fillText(end.sequence, end.x + 10, end.y + 5);
                    ctx.fillStyle = '#ffa726';
                });
            }
            
            // ç»˜åˆ¶é™åˆ¶é…¶
            ctx.fillStyle = enzyme.color;
            ctx.beginPath();
            ctx.arc(enzyme.x, enzyme.y, enzyme.width/2, 0, Math.PI * 2);
            ctx.fill();
            
            // ç»˜åˆ¶å‰ªåˆ€å›¾æ ‡
            ctx.fillStyle = '#ffffff';
            ctx.font = '20px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('âœ‚ï¸', enzyme.x, enzyme.y);
            
            // ç»˜åˆ¶é…¶æ ‡ç­¾
            ctx.fillStyle = '#ff6b6b';
            ctx.font = 'bold 14px "Segoe UI"';
            ctx.fillText('é™åˆ¶é…¶', enzyme.x, enzyme.y + 30);
            
            // ç»˜åˆ¶ç›®çš„åŸºå› ï¼ˆå¦‚æœå¯è§ï¼‰
            if (gene.isVisible) {
                ctx.fillStyle = gene.color;
                ctx.fillRect(gene.x, gene.y, gene.width, gene.height);
                
                // åŸºå› æ ‡ç­¾
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 14px "Segoe UI"';
                ctx.textAlign = 'center';
                ctx.fillText('ç›®çš„åŸºå› ', gene.x + gene.width/2, gene.y - 10);
                
                // å¦‚æœå¯æ‹–æ‹½ï¼Œæ·»åŠ å‘å…‰æ•ˆæœ
                if (gene.isDraggable) {
                    ctx.shadowColor = gene.color;
                    ctx.shadowBlur = 15;
                    ctx.fillRect(gene.x, gene.y, gene.width, gene.height);
                    ctx.shadowBlur = 0;
                }
            }
            
            // ç»˜åˆ¶è¿æ¥çº¿ï¼ˆå¦‚æœé…¶åœ¨ç§»åŠ¨ï¼‰
            if (enzyme.isMoving && animationTime < 2) {
                ctx.strokeStyle = 'rgba(255, 107, 107, 0.5)';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(150, 150);
                ctx.lineTo(350, 250);
                ctx.stroke();
                ctx.setLineDash([]);
            }
        }
        
        // ç»˜åˆ¶æ­¥éª¤2
        function drawStep2() {
            const plasmid = animationObjects.plasmid;
            const enzyme = animationObjects.restrictionEnzyme;
            
            // ç»˜åˆ¶è´¨ç²’
            ctx.fillStyle = plasmid.color;
            ctx.beginPath();
            ctx.arc(plasmid.x, plasmid.y, plasmid.radius, 0, Math.PI * 2);
            ctx.fill();
            
            // ç»˜åˆ¶è´¨ç²’åˆ‡å£
            if (plasmid.isCut) {
                ctx.strokeStyle = '#ff6b6b';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(plasmid.x, plasmid.y, plasmid.radius, plasmid.cutAngle - 0.2, plasmid.cutAngle + 0.2);
                ctx.stroke();
                
                // ç»˜åˆ¶ç²˜æ€§æœ«ç«¯
                ctx.fillStyle = '#ffa726';
                const end1X = plasmid.x + Math.cos(plasmid.cutAngle) * plasmid.radius;
                const end1Y = plasmid.y + Math.sin(plasmid.cutAngle) * plasmid.radius;
                
                ctx.beginPath();
                ctx.moveTo(end1X, end1Y);
                ctx.lineTo(end1X + 15, end1Y + 10);
                ctx.lineTo(end1X + 15, end1Y - 10);
                ctx.closePath();
                ctx.fill();
                
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 12px "Segoe UI"';
                ctx.textAlign = 'center';
                ctx.fillText('AATT', end1X + 8, end1Y + 3);
            }
            
            // ç»˜åˆ¶è´¨ç²’æ ‡è®°åŸºå› 
            plasmid.markerGenes.forEach(gene => {
                const geneX = plasmid.x + Math.cos(gene.angle) * (plasmid.radius - 10);
                const geneY = plasmid.y + Math.sin(gene.angle) * (plasmid.radius - 10);
                
                ctx.fillStyle = gene.color;
                ctx.beginPath();
                ctx.arc(geneX, geneY, 8, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 10px "Segoe UI"';
                ctx.textAlign = 'center';
                ctx.fillText(gene.label, geneX, geneY + 15);
            });
            
            // ç»˜åˆ¶è´¨ç²’æ ‡ç­¾
            ctx.fillStyle = '#4ecdc4';
            ctx.font = 'bold 16px "Segoe UI"';
            ctx.textAlign = 'center';
            ctx.fillText('è´¨ç²’è½½ä½“', plasmid.x, plasmid.y + plasmid.radius + 25);
            
            // ç»˜åˆ¶é™åˆ¶é…¶
            ctx.fillStyle = enzyme.color;
            ctx.beginPath();
            ctx.arc(enzyme.x, enzyme.y, enzyme.width/2, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = '#ffffff';
            ctx.font = '20px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('âœ‚ï¸', enzyme.x, enzyme.y);
            
            // ç»˜åˆ¶è¿æ¥çº¿
            if (enzyme.isMoving && animationTime > 0.5 && animationTime < 1.5) {
                ctx.strokeStyle = 'rgba(255, 107, 107, 0.5)';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(550, 150);
                ctx.lineTo(700, 250);
                ctx.stroke();
                ctx.setLineDash([]);
            }
        }
        
        // ç»˜åˆ¶æ­¥éª¤3
        function drawStep3() {
            const gene = animationObjects.targetGene;
            const plasmid = animationObjects.plasmid;
            const ligase = animationObjects.ligase;
            const recombinant = animationObjects.recombinantPlasmid;
            
            // ç»˜åˆ¶è´¨ç²’ï¼ˆå¦‚æœæœªé‡ç»„ï¼‰
            if (!recombinant.isVisible) {
                ctx.fillStyle = plasmid.color;
                ctx.beginPath();
                ctx.arc(plasmid.x, plasmid.y, plasmid.radius, 0, Math.PI * 2);
                ctx.fill();
                
                // ç»˜åˆ¶åˆ‡å£
                if (plasmid.isCut) {
                    ctx.strokeStyle = '#ff6b6b';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(plasmid.x, plasmid.y, plasmid.radius, plasmid.cutAngle - 0.2, plasmid.cutAngle + 0.2);
                    ctx.stroke();
                }
                
                // ç»˜åˆ¶è´¨ç²’æ ‡ç­¾
                ctx.fillStyle = '#4ecdc4';
                ctx.font = 'bold 14px "Segoe UI"';
                ctx.textAlign = 'center';
                ctx.fillText('åˆ‡å¼€çš„è´¨ç²’', plasmid.x, plasmid.y + plasmid.radius + 25);
            }
            
            // ç»˜åˆ¶ç›®çš„åŸºå› 
            if (gene.isVisible) {
                ctx.fillStyle = gene.color;
                ctx.fillRect(gene.x, gene.y, gene.width, gene.height);
                
                // åŸºå› æ ‡ç­¾
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 14px "Segoe UI"';
                ctx.textAlign = 'center';
                ctx.fillText('ç›®çš„åŸºå› ', gene.x + gene.width/2, gene.y - 10);
                
                // å¦‚æœå¯æ‹–æ‹½ï¼Œæ·»åŠ å‘å…‰æ•ˆæœ
                if (gene.isDraggable) {
                    ctx.shadowColor = gene.color;
                    ctx.shadowBlur = 15;
                    ctx.fillRect(gene.x, gene.y, gene.width, gene.height);
                    ctx.shadowBlur = 0;
                }
            }
            
            // ç»˜åˆ¶è¿æ¥é…¶
            if (ligase.isVisible) {
                ctx.fillStyle = ligase.color;
                ctx.beginPath();
                ctx.arc(ligase.x, ligase.y, ligase.width/2, 0, Math.PI * 2);
                ctx.fill();
                
                // ç»˜åˆ¶èƒ¶æ°´å›¾æ ‡
                ctx.fillStyle = '#ffffff';
                ctx.font = '20px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('ğŸ”—', ligase.x, ligase.y);
                
                // é…¶æ ‡ç­¾
                ctx.fillStyle = '#ffe66d';
                ctx.font = 'bold 14px "Segoe UI"';
                ctx.fillText('DNAè¿æ¥é…¶', ligase.x, ligase.y + 30);
            }
            
            // ç»˜åˆ¶é‡ç»„è´¨ç²’
            if (recombinant.isVisible) {
                ctx.fillStyle = recombinant.color;
                ctx.beginPath();
                ctx.arc(recombinant.x, recombinant.y, recombinant.radius, 0, Math.PI * 2);
                ctx.fill();
                
                // ç»˜åˆ¶æ’å…¥çš„åŸºå› 
                if (recombinant.geneInserted) {
                    ctx.fillStyle = recombinant.geneColor;
                    const insertWidth = recombinant.radius * 0.6;
                    const insertHeight = 15;
                    ctx.fillRect(
                        recombinant.x - insertWidth/2,
                        recombinant.y - insertHeight/2,
                        insertWidth,
                        insertHeight
                    );
                    
                    // åŸºå› æ ‡ç­¾
                    ctx.fillStyle = '#ffffff';
                    ctx.font = 'bold 12px "Segoe UI"';
                    ctx.textAlign = 'center';
                    ctx.fillText('ç›®çš„åŸºå› ', recombinant.x, recombinant.y - recombinant.radius - 10);
                }
                
                // é‡ç»„è´¨ç²’æ ‡ç­¾
                ctx.fillStyle = '#4ecdc4';
                ctx.font = 'bold 16px "Segoe UI"';
                ctx.textAlign = 'center';
                ctx.fillText('é‡ç»„è´¨ç²’', recombinant.x, recombinant.y + recombinant.radius + 25);
            }
            
            // ç»˜åˆ¶è¿æ¥çº¿
            if (ligase.isMoving && animationTime > 1 && animationTime < 2) {
                ctx.strokeStyle = 'rgba(255, 230, 109, 0.5)';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(500, 100);
                ctx.lineTo(700, 250);
                ctx.stroke();
                ctx.setLineDash([]);
            }
        }
        
        // ç»˜åˆ¶æ­¥éª¤4
        function drawStep4() {
            const hostCell = animationObjects.hostCell;
            const recombinant = animationObjects.recombinantPlasmid;
            
            // ç»˜åˆ¶å®¿ä¸»ç»†èƒ
            if (hostCell.isVisible) {
                // ç»†èƒè†œ
                ctx.strokeStyle = hostCell.color;
                ctx.lineWidth = hostCell.membraneWidth;
                ctx.beginPath();
                ctx.arc(hostCell.x, hostCell.y, hostCell.radius, 0, Math.PI * 2);
                ctx.stroke();
                
                // ç»†èƒè´¨
                ctx.fillStyle = 'rgba(149, 225, 211, 0.2)';
                ctx.beginPath();
                ctx.arc(hostCell.x, hostCell.y, hostCell.radius - hostCell.membraneWidth, 0, Math.PI * 2);
                ctx.fill();
                
                // ç»†èƒæ ‡ç­¾
                ctx.fillStyle = '#95e1d3';
                ctx.font = 'bold 16px "Segoe UI"';
                ctx.textAlign = 'center';
                ctx.fillText('å®¿ä¸»ç»†èƒ', hostCell.x, hostCell.y + hostCell.radius + 30);
            }
            
            // ç»˜åˆ¶é‡ç»„è´¨ç²’
            if (recombinant.isVisible) {
                ctx.fillStyle = recombinant.color;
                ctx.beginPath();
                ctx.arc(recombinant.x, recombinant.y, recombinant.radius, 0, Math.PI * 2);
                ctx.fill();
                
                // ç»˜åˆ¶æ’å…¥çš„åŸºå› 
                ctx.fillStyle = recombinant.geneColor;
                const insertWidth = recombinant.radius * 0.6;
                const insertHeight = 12;
                ctx.fillRect(
                    recombinant.x - insertWidth/2,
                    recombinant.y - insertHeight/2,
                    insertWidth,
                    insertHeight
                );
            }
            
            // ç»˜åˆ¶ç»†èƒå†…çš„è´¨ç²’
            hostCell.plasmidsInside.forEach(plasmid => {
                ctx.fillStyle = '#4ecdc4';
                ctx.beginPath();
                ctx.arc(plasmid.x, plasmid.y, plasmid.radius, 0, Math.PI * 2);
                ctx.fill();
                
                // ç»˜åˆ¶æ’å…¥çš„åŸºå› 
                ctx.fillStyle = '#ffa726';
                const insertWidth = plasmid.radius * 0.8;
                const insertHeight = 8;
                ctx.fillRect(
                    plasmid.x - insertWidth/2,
                    plasmid.y - insertHeight/2,
                    insertWidth,
                    insertHeight
                );
            });
            
            // ç»˜åˆ¶è½¬åŒ–è·¯å¾„
            if (recombinant.isVisible && recombinant.x > 600) {
                ctx.strokeStyle = 'rgba(78, 205, 196, 0.5)';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(700, 250);
                ctx.lineTo(550, 250);
                ctx.stroke();
                ctx.setLineDash([]);
            }
        }
        
        // ç»˜åˆ¶æ­¥éª¤5
        function drawStep5() {
            const proteinFactory = animationObjects.proteinFactory;
            const antibiotics = animationObjects.antibiotics;
            
            // ç»˜åˆ¶è›‹ç™½è´¨å·¥å‚ï¼ˆç»†èƒï¼‰
            if (proteinFactory.isVisible) {
                // ç»†èƒè†œ
                ctx.strokeStyle = proteinFactory.color;
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(proteinFactory.x, proteinFactory.y, proteinFactory.radius, 0, Math.PI * 2);
                ctx.stroke();
                
                // ç»†èƒè´¨
                ctx.fillStyle = 'rgba(149, 225, 211, 0.3)';
                ctx.beginPath();
                ctx.arc(proteinFactory.x, proteinFactory.y, proteinFactory.radius - 3, 0, Math.PI * 2);
                ctx.fill();
                
                // å·¥å‚æ ‡ç­¾
                ctx.fillStyle = '#95e1d3';
                ctx.font = 'bold 16px "Segoe UI"';
                ctx.textAlign = 'center';
                ctx.fillText('è›‹ç™½è´¨å·¥å‚', proteinFactory.x, proteinFactory.y + proteinFactory.radius + 30);
                
                // ç»˜åˆ¶å†…éƒ¨è´¨ç²’
                ctx.fillStyle = '#4ecdc4';
                ctx.beginPath();
                ctx.arc(proteinFactory.x, proteinFactory.y, 20, 0, Math.PI * 2);
                ctx.fill();
                
                // ç»˜åˆ¶åŸºå› 
                ctx.fillStyle = '#ffa726';
                ctx.fillRect(proteinFactory.x - 15, proteinFactory.y - 5, 30, 10);
                
                // ç»˜åˆ¶æ ¸ç³–ä½“
                ctx.fillStyle = '#ff9e80';
                ctx.beginPath();
                ctx.arc(proteinFactory.x + 30, proteinFactory.y - 20, 8, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#ffffff';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('â—', proteinFactory.x + 30, proteinFactory.y - 20);
            }
            
            // ç»˜åˆ¶è›‹ç™½è´¨
            proteinFactory.proteins.forEach(protein => {
                ctx.fillStyle = protein.color;
                ctx.beginPath();
                ctx.arc(protein.x, protein.y, protein.size, 0, Math.PI * 2);
                ctx.fill();
                
                // è›‹ç™½è´¨æ ‡ç­¾
                if (proteinFactory.proteins.length < 10) {
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '10px "Segoe UI"';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('è›‹ç™½', protein.x, protein.y);
                }
            });
            
            // ç»˜åˆ¶æŠ—ç”Ÿç´ åŸ¹å…»åŸº
            if (antibiotics.isVisible) {
                ctx.fillStyle = antibiotics.color;
                ctx.fillRect(antibiotics.x, antibiotics.y, antibiotics.width, antibiotics.height);
                
                // åŸ¹å…»åŸºæ ‡ç­¾
                ctx.fillStyle = '#ff6b6b';
                ctx.font = 'bold 16px "Segoe UI"';
                ctx.textAlign = 'center';
                ctx.fillText('æŠ—ç”Ÿç´ åŸ¹å…»åŸº', antibiotics.x + antibiotics.width/2, antibiotics.y - 10);
                
                // ç»˜åˆ¶å­˜æ´»çš„ç»†èƒ
                ctx.fillStyle = '#95e1d3';
                ctx.beginPath();
                ctx.arc(antibiotics.x + antibiotics.width/2, antibiotics.y + antibiotics.height/2, 25, 0, Math.PI * 2);
                ctx.fill();
                
                // ç»˜åˆ¶ç»†èƒå†…çš„è´¨ç²’
                ctx.fillStyle = '#4ecdc4';
                ctx.beginPath();
                ctx.arc(antibiotics.x + antibiotics.width/2, antibiotics.y + antibiotics.height/2, 8, 0, Math.PI * 2);
                ctx.fill();
                
                // å­˜æ´»æ ‡ç­¾
                ctx.fillStyle = '#2a9d8f';
                ctx.font = 'bold 14px "Segoe UI"';
                ctx.fillText('å­˜æ´»ç»†èƒ', antibiotics.x + antibiotics.width/2, antibiotics.y + antibiotics.height + 25);
            }
            
            // ç»˜åˆ¶è¡¨è¾¾ç®­å¤´
            if (animationTime > 1) {
                ctx.strokeStyle = '#64ffda';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 3]);
                ctx.beginPath();
                ctx.moveTo(proteinFactory.x + 50, proteinFactory.y);
                ctx.lineTo(proteinFactory.x + 150, proteinFactory.y);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // ç®­å¤´å¤´
                ctx.fillStyle = '#64ffda';
                ctx.beginPath();
                ctx.moveTo(proteinFactory.x + 150, proteinFactory.y);
                ctx.lineTo(proteinFactory.x + 140, proteinFactory.y - 5);
                ctx.lineTo(proteinFactory.x + 140, proteinFactory.y + 5);
                ctx.closePath();
                ctx.fill();
                
                // è¡¨è¾¾æ ‡ç­¾
                ctx.fillStyle = '#64ffda';
                ctx.font = 'bold 14px "Segoe UI"';
                ctx.textAlign = 'center';
                ctx.fillText('åŸºå› è¡¨è¾¾ â†’ è›‹ç™½è´¨åˆæˆ', proteinFactory.x + 100, proteinFactory.y - 20);
            }
        }
        
        // é¼ æ ‡äº‹ä»¶å¤„ç†
        let mouseX = 0, mouseY = 0;
        let isDragging = false;
        
        function handleMouseDown(e) {
            const rect = canvas.getBoundingClientRect();
            mouseX = e.clientX - rect.left;
            mouseY = e.clientY - rect.top;
            
            // æ£€æŸ¥æ˜¯å¦ç‚¹å‡»äº†ç›®çš„åŸºå› ï¼ˆæ­¥éª¤3ï¼‰
            if (currentStep === 3 && animationObjects.targetGene.isDraggable) {
                const gene = animationObjects.targetGene;
                if (mouseX > gene.x && mouseX < gene.x + gene.width &&
                    mouseY > gene.y && mouseY < gene.y + gene.height) {
                    isDragging = true;
                    gene.isDragging = true;
                }
            }
        }
        
        function handleMouseMove(e) {
            const rect = canvas.getBoundingClientRect();
            mouseX = e.clientX - rect.left;
            mouseY = e.clientY - rect.top;
            
            // æ‹–æ‹½ç›®çš„åŸºå› 
            if (isDragging && currentStep === 3) {
                const gene = animationObjects.targetGene;
                gene.x = mouseX - gene.width/2;
                gene.y = mouseY - gene.height/2;
            }
        }
        
        function handleMouseUp() {
            if (isDragging && currentStep === 3) {
                const gene = animationObjects.targetGene;
                const plasmid = animationObjects.plasmid;
                
                // æ£€æŸ¥æ˜¯å¦æ‹–æ‹½åˆ°è´¨ç²’é™„è¿‘
                const distance = Math.sqrt(
                    Math.pow(gene.x + gene.width/2 - plasmid.x, 2) +
                    Math.pow(gene.y + gene.height/2 - plasmid.y, 2)
                );
                
                if (distance < plasmid.radius + 20) {
                    // åŸºå› è¿æ¥åˆ°è´¨ç²’
                    gene.isDragging = false;
                    gene.x = plasmid.x - gene.width/2;
                    gene.y = plasmid.y - gene.height/2;
                    
                    // è§¦å‘è¿æ¥åŠ¨ç”»
                    animationObjects.ligase.isVisible = true;
                    animationTime = 1; // è·³åˆ°è¿æ¥åŠ¨ç”»é˜¶æ®µ
                }
            }
            
            isDragging = false;
            if (animationObjects.targetGene) {
                animationObjects.targetGene.isDragging = false;
            }
        }
        
        // æ›´æ–°æç¤ºæ–‡æœ¬
        function updateHintText() {
            const hints = [
                '',
                'ç‚¹å‡»"æ’­æ”¾åŠ¨ç”»"è§‚çœ‹é™åˆ¶é…¶å‰ªåˆ‡DNAçš„è¿‡ç¨‹',
                'è§‚çœ‹è´¨ç²’è½½ä½“è¢«ç›¸åŒé™åˆ¶é…¶å‰ªåˆ‡çš„è¿‡ç¨‹',
                'å°†ç›®çš„åŸºå› æ‹–æ‹½åˆ°è´¨ç²’ä¸Šè¿›è¡Œè¿æ¥',
                'è§‚çœ‹é‡ç»„è´¨ç²’è¿›å…¥å®¿ä¸»ç»†èƒçš„è¿‡ç¨‹',
                'è§‚å¯ŸåŸºå› è¡¨è¾¾å’Œè›‹ç™½è´¨åˆæˆçš„è¿‡ç¨‹'
            ];
            
            if (currentStep >= 1 && currentStep <= 5) {
                hintText.innerHTML = `<span>ğŸ’¡</span> ${hints[currentStep]}`;
                hintText.style.display = 'flex';
            }
        }
        
        // é‡ç½®åŠ¨ç”»
        function resetAnimation() {
            resetAnimationState();
            goToStep(1);
            draw();
        }
        
        // åŠ¨ç”»å¾ªç¯
        function animate() {
            if (animationPlaying) {
                startAnimation();
            } else {
                draw();
            }
            requestAnimationFrame(animate);
        }
        
        // åˆå§‹åŒ–åº”ç”¨
        window.addEventListener('load', init);
    </script>
</body>
</html>