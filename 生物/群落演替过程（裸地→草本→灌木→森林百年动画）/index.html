<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾¤è½æ¼”æ›¿è¿‡ç¨‹ï¼šä»è£¸åœ°åˆ°æ£®æ—</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(to bottom, #e6f7ff 0%, #f0f9eb 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        header {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-left: 6px solid #4CAF50;
        }
        
        h1 {
            color: #2E7D32;
            margin-bottom: 10px;
            font-size: 2.4rem;
        }
        
        .subtitle {
            color: #666;
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .animation-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .canvas-container {
            position: relative;
            width: 100%;
            height: 450px;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #ddd;
            background: linear-gradient(to bottom, #a8d8ff 0%, #87CEEB 30%, #f5f5dc 100%);
        }
        
        #animationCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .stage-indicator {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 12px 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
            border-left: 5px solid #FF9800;
            z-index: 10;
        }
        
        .stage-title {
            font-weight: bold;
            color: #E65100;
            font-size: 1.3rem;
            margin-bottom: 5px;
        }
        
        .stage-desc {
            color: #555;
            font-size: 0.95rem;
            max-width: 300px;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
        }
        
        .time-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #4CAF50;
            color: white;
        }
        
        .btn-primary:hover {
            background: #388E3C;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #FF9800;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #F57C00;
            transform: translateY(-2px);
        }
        
        .btn-outline {
            background: transparent;
            color: #555;
            border: 2px solid #ddd;
        }
        
        .btn-outline:hover {
            border-color: #4CAF50;
            color: #4CAF50;
        }
        
        .time-slider-container {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        #timeSlider {
            flex: 1;
            height: 10px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, #C8E6C9, #4CAF50, #2E7D32);
            border-radius: 5px;
            outline: none;
        }
        
        #timeSlider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #FF9800;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .time-display {
            font-weight: bold;
            color: #2E7D32;
            font-size: 1.2rem;
            min-width: 100px;
            text-align: center;
            background: white;
            padding: 8px 15px;
            border-radius: 8px;
            border: 2px solid #E8F5E9;
        }
        
        .stage-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }
        
        .stage-btn {
            padding: 10px 20px;
            background: #E8F5E9;
            border: 2px solid #C8E6C9;
            border-radius: 8px;
            color: #2E7D32;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .stage-btn:hover, .stage-btn.active {
            background: #4CAF50;
            color: white;
            border-color: #388E3C;
        }
        
        .info-panel {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
        }
        
        .panel {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .panel h2 {
            color: #2E7D32;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #E8F5E9;
            font-size: 1.5rem;
        }
        
        .species-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .species-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 10px;
            border-left: 5px solid #4CAF50;
            transition: all 0.3s ease;
        }
        
        .species-item:hover {
            background: #E8F5E9;
            transform: translateX(5px);
        }
        
        .species-color {
            width: 25px;
            height: 25px;
            border-radius: 50%;
        }
        
        .species-info h3 {
            color: #333;
            margin-bottom: 5px;
        }
        
        .species-info p {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .principles-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .principle-item {
            padding: 15px;
            background: #FFF3E0;
            border-radius: 10px;
            border-left: 5px solid #FF9800;
        }
        
        .principle-item h3 {
            color: #E65100;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .principle-item p {
            color: #666;
            line-height: 1.6;
        }
        
        .view-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #4CAF50;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        .toggle-label {
            font-weight: bold;
            color: #555;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 10px;
            justify-content: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        .legend-text {
            font-size: 0.9rem;
            color: #555;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            margin-top: 20px;
            border-top: 1px solid #eee;
            width: 100%;
        }
        
        @media (max-width: 768px) {
            .info-panel {
                flex-direction: column;
            }
            
            .panel {
                min-width: 100%;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .time-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .canvas-container {
                height: 350px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸŒ± ç¾¤è½æ¼”æ›¿è¿‡ç¨‹ï¼šä»è£¸åœ°åˆ°æ£®æ—</h1>
            <p class="subtitle">æ¢ç´¢ä¸€ä¸ªç”Ÿæ€ç³»ç»Ÿä»è´«ç˜ è£¸åœ°æ¼”å˜ä¸ºèŒ‚å¯†æ£®æ—çš„ç™¾å¹´å†ç¨‹ã€‚è§‚å¯Ÿå…ˆé”‹ç‰©ç§å¦‚ä½•æ”¹é€ ç¯å¢ƒï¼Œä¸ºåç»­ç‰©ç§åˆ›é€ æ¡ä»¶ï¼Œæœ€ç»ˆå½¢æˆç¨³å®šçš„é¡¶æç¾¤è½ã€‚</p>
        </header>
        
        <div class="main-content">
            <section class="animation-section">
                <div class="canvas-container">
                    <canvas id="animationCanvas"></canvas>
                    <div class="stage-indicator">
                        <div class="stage-title" id="stageTitle">è£¸åœ°é˜¶æ®µ (0-5å¹´)</div>
                        <div class="stage-desc" id="stageDesc">å²©çŸ³è£¸éœ²ï¼Œå‡ ä¹æ²¡æœ‰ç”Ÿå‘½è¿¹è±¡ã€‚åœ°è¡£å’Œè‹”è—“å¼€å§‹é™„ç€åœ¨å²©çŸ³è¡¨é¢ã€‚</div>
                    </div>
                </div>
                
                <div class="controls">
                    <div class="time-controls">
                        <button class="btn btn-primary" id="playBtn">
                            <span>â–¶ï¸ æ’­æ”¾</span>
                        </button>
                        <button class="btn btn-outline" id="pauseBtn">
                            <span>â¸ï¸ æš‚åœ</span>
                        </button>
                        <button class="btn btn-outline" id="resetBtn">
                            <span>ğŸ”„ é‡ç½®</span>
                        </button>
                        
                        <div class="time-slider-container">
                            <input type="range" id="timeSlider" min="0" max="150" value="0">
                            <div class="time-display" id="timeDisplay">0 å¹´</div>
                        </div>
                        
                        <button class="btn btn-secondary" id="viewToggleBtn">
                            <span>ğŸ“Š åˆ‡æ¢åŸç†è§†å›¾</span>
                        </button>
                    </div>
                    
                    <div class="stage-buttons">
                        <button class="stage-btn active" data-stage="0">è£¸åœ°é˜¶æ®µ</button>
                        <button class="stage-btn" data-stage="1">è‰æœ¬é˜¶æ®µ</button>
                        <button class="stage-btn" data-stage="2">çŒæœ¨é˜¶æ®µ</button>
                        <button class="stage-btn" data-stage="3">æ£®æ—é˜¶æ®µ</button>
                    </div>
                </div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #A1887F;"></div>
                        <div class="legend-text">è£¸åœ°/å²©çŸ³</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #81C784;"></div>
                        <div class="legend-text">åœ°è¡£/è‹”è—“</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #4CAF50;"></div>
                        <div class="legend-text">è‰æœ¬æ¤ç‰©</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #388E3C;"></div>
                        <div class="legend-text">çŒæœ¨</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #1B5E20;"></div>
                        <div class="legend-text">ä¹”æœ¨</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #8D6E63;"></div>
                        <div class="legend-text">åœŸå£¤</div>
                    </div>
                </div>
            </section>
            
            <div class="info-panel">
                <div class="panel">
                    <h2>ğŸ“‹ æ¼”æ›¿é˜¶æ®µä¸å…³é”®ç‰©ç§</h2>
                    <div class="species-list" id="speciesList">
                        <!-- ç‰©ç§ä¿¡æ¯å°†é€šè¿‡JSåŠ¨æ€æ›´æ–° -->
                    </div>
                </div>
                
                <div class="panel">
                    <h2>ğŸ”¬ ç”Ÿæ€å­¦åŸç†</h2>
                    <div class="principles-list">
                        <div class="principle-item">
                            <h3>ğŸŒ± å…ˆé”‹ç‰©ç§ä½œç”¨</h3>
                            <p>åœ°è¡£å’Œè‹”è—“ä½œä¸ºå…ˆé”‹ç‰©ç§ï¼Œèƒ½å¤Ÿåˆ†æ³Œæœ‰æœºé…¸è…èš€å²©çŸ³è¡¨é¢ï¼Œä¿ƒè¿›åœŸå£¤å½¢æˆï¼Œä¸ºåç»­æ¤ç‰©ç”Ÿé•¿åˆ›é€ æ¡ä»¶ã€‚</p>
                        </div>
                        <div class="principle-item">
                            <h3>ğŸ”„ ç¯å¢ƒæ”¹é€ </h3>
                            <p>æ¯ä¸ªé˜¶æ®µçš„ä¼˜åŠ¿ç‰©ç§éƒ½ä¼šæ”¹å˜ç¯å¢ƒæ¡ä»¶ï¼ˆå¦‚å¢åŠ åœŸå£¤æœ‰æœºè´¨ã€æ”¹å˜å…‰ç…§æ¡ä»¶ï¼‰ï¼Œä»è€Œä¸ºä¸‹ä¸€é˜¶æ®µç‰©ç§çš„å…¥ä¾µåˆ›é€ æ¡ä»¶ã€‚</p>
                        </div>
                        <div class="principle-item">
                            <h3>ğŸŒ³ ç«äº‰ä¸æ›¿ä»£</h3>
                            <p>éšç€ç¯å¢ƒæ¡ä»¶å˜åŒ–ï¼Œé€‚åº”æ–°ç¯å¢ƒçš„ç‰©ç§åœ¨ç«äº‰ä¸­å–å¾—ä¼˜åŠ¿ï¼Œé€æ¸æ›¿ä»£åŸæœ‰ç‰©ç§ï¼Œæ¨åŠ¨ç¾¤è½å‘æ›´å¤æ‚ç»“æ„å‘å±•ã€‚</p>
                        </div>
                        <div class="principle-item">
                            <h3>ğŸï¸ é¡¶æç¾¤è½</h3>
                            <p>ç»è¿‡é•¿æœŸæ¼”æ›¿ï¼Œç¾¤è½ä¸å½“åœ°æ°”å€™ã€åœŸå£¤æ¡ä»¶è¾¾åˆ°å¹³è¡¡ï¼Œå½¢æˆç›¸å¯¹ç¨³å®šçš„é¡¶æç¾¤è½ï¼ˆå¦‚æ£®æ—ï¼‰ï¼Œç‰©ç§ç»„æˆå’Œç»“æ„ä¸å†å‘ç”Ÿæ˜æ˜¾å˜åŒ–ã€‚</p>
                        </div>
                    </div>
                    
                    <div class="view-toggle">
                        <span class="toggle-label">æ˜¾ç¤ºåŸç†è§†å›¾</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="principleViewToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Â© 2023 ç”Ÿæ€å­¦æ•™å­¦åŠ¨ç”» | ç¾¤è½æ¼”æ›¿è¿‡ç¨‹æ¨¡æ‹Ÿ | è®¾è®¡ï¼šç†ŠçŒ«è€å¸ˆ</p>
            <p>æœ¬åŠ¨ç”»å±•ç¤ºäº†åŸç”Ÿæ¼”æ›¿çš„å…¸å‹è¿‡ç¨‹ï¼Œæ—¶é—´å°ºåº¦ä¸º150å¹´ï¼Œå®é™…æ¼”æ›¿é€Ÿåº¦å—æ°”å€™ã€åœ°å½¢ç­‰å¤šç§å› ç´ å½±å“ã€‚</p>
        </footer>
    </div>

    <script>
        // è·å–Canvaså’Œä¸Šä¸‹æ–‡
        const canvas = document.getElementById('animationCanvas');
        const ctx = canvas.getContext('2d');
        
        // è®¾ç½®Canvaså°ºå¯¸
        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }
        
        // åˆå§‹è°ƒæ•´å°ºå¯¸
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // åŠ¨ç”»çŠ¶æ€å˜é‡
        let currentTime = 0; // å½“å‰æ—¶é—´ï¼ˆå¹´ï¼‰
        let maxTime = 150;   // æœ€å¤§æ—¶é—´ï¼ˆå¹´ï¼‰
        let isPlaying = false;
        let animationId = null;
        let showPrincipleView = false;
        
        // æ¼”æ›¿é˜¶æ®µå®šä¹‰
        const stages = [
            { name: "è£¸åœ°é˜¶æ®µ", years: "0-5å¹´", desc: "å²©çŸ³è£¸éœ²ï¼Œå‡ ä¹æ²¡æœ‰ç”Ÿå‘½è¿¹è±¡ã€‚åœ°è¡£å’Œè‹”è—“å¼€å§‹é™„ç€åœ¨å²©çŸ³è¡¨é¢ã€‚" },
            { name: "è‰æœ¬é˜¶æ®µ", years: "5-20å¹´", desc: "è‰æœ¬æ¤ç‰©æˆä¸ºä¼˜åŠ¿ç§ï¼Œå½¢æˆè‰åœ°ã€‚åœŸå£¤é€æ¸å¢åšï¼Œæœ‰æœºè´¨å¢åŠ ã€‚" },
            { name: "çŒæœ¨é˜¶æ®µ", years: "20-50å¹´", desc: "çŒæœ¨å¼€å§‹ç”Ÿé•¿å¹¶é€æ¸å æ®ä¼˜åŠ¿ï¼Œé®æŒ¡è‰æœ¬æ¤ç‰©å…‰çº¿ã€‚" },
            { name: "æ£®æ—é˜¶æ®µ", years: "50-150å¹´", desc: "ä¹”æœ¨æˆä¸ºä¼˜åŠ¿ç§ï¼Œå½¢æˆæ£®æ—ç¾¤è½ã€‚æ—ä¸‹å…‰ç…§å‡å°‘ï¼Œç‰©ç§ç»„æˆè¶‹äºç¨³å®šã€‚" }
        ];
        
        // ç‰©ç§ä¿¡æ¯
        const speciesByStage = {
            0: [
                { name: "åœ°è¡£", color: "#81C784", role: "å…ˆé”‹ç‰©ç§ï¼Œåˆ†æ³Œæœ‰æœºé…¸è…èš€å²©çŸ³ï¼Œå¯åŠ¨åœŸå£¤å½¢æˆè¿‡ç¨‹" },
                { name: "è‹”è—“", color: "#66BB6A", role: "ä¿æŒæ°´åˆ†ï¼ŒåŠ é€Ÿå²©çŸ³é£åŒ–ï¼Œç§¯ç´¯æœ‰æœºç‰©è´¨" }
            ],
            1: [
                { name: "ä¸€å¹´ç”Ÿè‰æœ¬", color: "#4CAF50", role: "å¿«é€Ÿç”Ÿé•¿ï¼Œè¿›ä¸€æ­¥æ”¹è‰¯åœŸå£¤ï¼Œå¢åŠ æœ‰æœºè´¨" },
                { name: "å¤šå¹´ç”Ÿè‰æœ¬", color: "#388E3C", role: "æ ¹ç³»å‘è¾¾ï¼Œç¨³å®šåœŸå£¤ï¼Œä¸ºçŒæœ¨ç”Ÿé•¿åˆ›é€ æ¡ä»¶" },
                { name: "å°å‹åŠ¨ç‰©", color: "#FF9800", role: "æ˜†è™«ç­‰å¼€å§‹å‡ºç°ï¼Œä¿ƒè¿›ä¼ ç²‰å’Œç‰©è´¨å¾ªç¯" }
            ],
            2: [
                { name: "çŒæœ¨", color: "#2E7D32", role: "æˆä¸ºä¼˜åŠ¿ç§ï¼Œé®æŒ¡é˜³å…‰ï¼Œæ”¹å˜å¾®æ°”å€™" },
                { name: "å°å‹é¸Ÿç±»", color: "#2196F3", role: "ä¼ æ’­ç§å­ï¼Œæ§åˆ¶æ˜†è™«æ•°é‡" },
                { name: "åœŸå£¤ç”Ÿç‰©", color: "#795548", role: "èš¯èš“ç­‰å¢å¤šï¼Œæ”¹å–„åœŸå£¤ç»“æ„" }
            ],
            3: [
                { name: "é˜³ç”Ÿä¹”æœ¨", color: "#1B5E20", role: "å¿«é€Ÿç”Ÿé•¿ï¼Œå½¢æˆæ£®æ—å† å±‚" },
                { name: "é˜´ç”Ÿä¹”æœ¨", color: "#004D40", role: "é€‚åº”æ—ä¸‹å¼±å…‰ç¯å¢ƒï¼Œå½¢æˆç¬¬äºŒå±‚" },
                { name: "æ—ä¸‹æ¤ç‰©", color: "#558B2F", role: "é€‚åº”ä½å…‰ç…§ç¯å¢ƒï¼Œå½¢æˆæ£®æ—åº•å±‚" },
                { name: "æ£®æ—åŠ¨ç‰©", color: "#5D4037", role: "é¸Ÿç±»ã€å“ºä¹³ç±»ç­‰å¢å¤šï¼Œå½¢æˆå¤æ‚é£Ÿç‰©ç½‘" }
            ]
        };
        
        // DOMå…ƒç´ 
        const timeSlider = document.getElementById('timeSlider');
        const timeDisplay = document.getElementById('timeDisplay');
        const stageTitle = document.getElementById('stageTitle');
        const stageDesc = document.getElementById('stageDesc');
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const viewToggleBtn = document.getElementById('viewToggleBtn');
        const principleViewToggle = document.getElementById('principleViewToggle');
        const stageButtons = document.querySelectorAll('.stage-btn');
        const speciesList = document.getElementById('speciesList');
        
        // åˆå§‹åŒ–ç‰©ç§åˆ—è¡¨
        updateSpeciesList(0);
        
        // æ›´æ–°ç‰©ç§åˆ—è¡¨æ˜¾ç¤º
        function updateSpeciesList(stageIndex) {
            speciesList.innerHTML = '';
            const species = speciesByStage[stageIndex];
            
            species.forEach(species => {
                const speciesItem = document.createElement('div');
                speciesItem.className = 'species-item';
                speciesItem.innerHTML = `
                    <div class="species-color" style="background-color: ${species.color};"></div>
                    <div class="species-info">
                        <h3>${species.name}</h3>
                        <p>${species.role}</p>
                    </div>
                `;
                speciesList.appendChild(speciesItem);
            });
        }
        
        // æ›´æ–°é˜¶æ®µæŒ‡ç¤ºå™¨
        function updateStageIndicator(time) {
            let stageIndex;
            if (time < 5) stageIndex = 0;
            else if (time < 20) stageIndex = 1;
            else if (time < 50) stageIndex = 2;
            else stageIndex = 3;
            
            stageTitle.textContent = `${stages[stageIndex].name} (${stages[stageIndex].years})`;
            stageDesc.textContent = stages[stageIndex].desc;
            
            // æ›´æ–°é˜¶æ®µæŒ‰é’®çŠ¶æ€
            stageButtons.forEach((btn, index) => {
                if (index === stageIndex) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // æ›´æ–°ç‰©ç§åˆ—è¡¨
            updateSpeciesList(stageIndex);
            
            return stageIndex;
        }
        
        // ç»˜åˆ¶åŠ¨ç”»
        function drawAnimation() {
            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶å¤©ç©º
            const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height * 0.4);
            const timeOfDay = (currentTime / maxTime) * 0.5 + 0.3; // æ¨¡æ‹Ÿæ—¶é—´å˜åŒ–
            skyGradient.addColorStop(0, `rgba(135, 206, 235, ${0.7 + timeOfDay * 0.3})`);
            skyGradient.addColorStop(1, `rgba(176, 224, 230, ${0.5 + timeOfDay * 0.3})`);
            ctx.fillStyle = skyGradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height * 0.4);
            
            // ç»˜åˆ¶åœ°é¢èƒŒæ™¯
            const groundHeight = canvas.height * 0.6;
            const groundY = canvas.height * 0.4;
            
            // æ ¹æ®æ—¶é—´è®¡ç®—åœŸå£¤åšåº¦å’Œé¢œè‰²
            const soilThickness = Math.min(0.1 + (currentTime / maxTime) * 0.4, 0.5);
            const rockHeight = groundHeight * (1 - soilThickness);
            
            // ç»˜åˆ¶å²©çŸ³å±‚
            ctx.fillStyle = '#A1887F';
            ctx.fillRect(0, groundY, canvas.width, rockHeight);
            
            // ç»˜åˆ¶å²©çŸ³çº¹ç†
            ctx.fillStyle = '#8D6E63';
            for (let i = 0; i < 20; i++) {
                const x = Math.random() * canvas.width;
                const y = groundY + Math.random() * rockHeight;
                const size = 5 + Math.random() * 15;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // ç»˜åˆ¶åœŸå£¤å±‚
            const soilY = groundY + rockHeight;
            const soilGradient = ctx.createLinearGradient(0, soilY, 0, canvas.height);
            const soilDarkness = 0.3 + (currentTime / maxTime) * 0.5; // éšæ—¶é—´å˜æ·±
            soilGradient.addColorStop(0, `rgba(139, 69, 19, ${soilDarkness})`);
            soilGradient.addColorStop(1, `rgba(101, 67, 33, ${soilDarkness})`);
            ctx.fillStyle = soilGradient;
            ctx.fillRect(0, soilY, canvas.width, groundHeight * soilThickness);
            
            // æ ¹æ®å½“å‰é˜¶æ®µç»˜åˆ¶æ¤è¢«
            const stageIndex = updateStageIndicator(currentTime);
            
            // ç»˜åˆ¶æ¤è¢«
            drawVegetation(stageIndex, currentTime);
            
            // å¦‚æœå¼€å¯åŸç†è§†å›¾ï¼Œç»˜åˆ¶åŸç†å›¾è¡¨
            if (showPrincipleView) {
                drawPrincipleView();
            }
            
            // æ›´æ–°æ—¶é—´æ˜¾ç¤º
            timeDisplay.textContent = `${Math.round(currentTime)} å¹´`;
            timeSlider.value = currentTime;
        }
        
        // ç»˜åˆ¶æ¤è¢«
        function drawVegetation(stageIndex, time) {
            const groundY = canvas.height * 0.4;
            const groundHeight = canvas.height * 0.6;
            
            // è£¸åœ°é˜¶æ®µï¼šåœ°è¡£å’Œè‹”è—“
            if (stageIndex === 0) {
                const lichenDensity = Math.min(time / 5, 1);
                for (let i = 0; i < 30 * lichenDensity; i++) {
                    const x = Math.random() * canvas.width;
                    const y = groundY + Math.random() * 30;
                    const size = 3 + Math.random() * 5;
                    
                    ctx.fillStyle = i % 2 === 0 ? '#81C784' : '#66BB6A';
                    ctx.beginPath();
                    ctx.ellipse(x, y, size, size/2, 0, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            // è‰æœ¬é˜¶æ®µ
            if (stageIndex >= 1) {
                const grassDensity = stageIndex === 1 ? Math.min((time - 5) / 15, 1) : 1;
                
                // ç»˜åˆ¶è‰åœ°
                for (let i = 0; i < 200 * grassDensity; i++) {
                    const x = Math.random() * canvas.width;
                    const baseY = groundY + groundHeight * 0.7;
                    const height = 10 + Math.random() * 30;
                    const width = 2 + Math.random() * 3;
                    
                    // è‰å¶
                    ctx.fillStyle = `rgba(76, 175, 80, ${0.3 + Math.random() * 0.5})`;
                    ctx.fillRect(x, baseY - height, width, height);
                    
                    // è‰å°–
                    if (Math.random() > 0.7) {
                        ctx.fillStyle = '#FFD54F';
                        ctx.beginPath();
                        ctx.arc(x + width/2, baseY - height - 2, 3, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
                
                // ä¸€äº›é‡èŠ±
                if (time > 10) {
                    for (let i = 0; i < 15 * grassDensity; i++) {
                        const x = Math.random() * canvas.width;
                        const baseY = groundY + groundHeight * 0.7;
                        const stemHeight = 20 + Math.random() * 20;
                        
                        // èŠ±èŒ
                        ctx.fillStyle = '#388E3C';
                        ctx.fillRect(x, baseY - stemHeight, 2, stemHeight);
                        
                        // èŠ±æœµ
                        ctx.fillStyle = ['#E91E63', '#9C27B0', '#FF9800', '#FFEB3B'][Math.floor(Math.random() * 4)];
                        ctx.beginPath();
                        ctx.arc(x + 1, baseY - stemHeight - 5, 6, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
            }
            
            // çŒæœ¨é˜¶æ®µ
            if (stageIndex >= 2) {
                const bushDensity = stageIndex === 2 ? Math.min((time - 20) / 30, 1) : 1;
                
                for (let i = 0; i < 15 * bushDensity; i++) {
                    const x = 50 + (i % 5) * (canvas.width - 100) / 5;
                    const baseY = groundY + groundHeight * 0.6;
                    const bushHeight = 40 + Math.random() * 40;
                    const bushWidth = 30 + Math.random() * 40;
                    
                    // çŒæœ¨ä¸›
                    ctx.fillStyle = '#2E7D32';
                    ctx.beginPath();
                    ctx.ellipse(x, baseY - bushHeight/2, bushWidth/2, bushHeight/2, 0, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // çŒæœ¨èŠ±æœµ
                    if (time > 30 && Math.random() > 0.5) {
                        ctx.fillStyle = '#FF5252';
                        for (let j = 0; j < 5; j++) {
                            const flowerX = x - bushWidth/3 + Math.random() * bushWidth/1.5;
                            const flowerY = baseY - bushHeight/2 - bushHeight/4 + Math.random() * bushHeight/2;
                            ctx.beginPath();
                            ctx.arc(flowerX, flowerY, 4, 0, Math.PI * 2);
                            ctx.fill();
                        }
                    }
                }
            }
            
            // æ£®æ—é˜¶æ®µ
            if (stageIndex === 3) {
                const treeDensity = Math.min((time - 50) / 100, 1);
                
                // ç»˜åˆ¶æ ‘æœ¨
                for (let i = 0; i < 8 * treeDensity; i++) {
                    const x = 30 + i * (canvas.width - 60) / 8;
                    const baseY = groundY + groundHeight * 0.5;
                    const treeHeight = 80 + Math.random() * 70;
                    const trunkWidth = 10 + Math.random() * 8;
                    
                    // æ ‘å¹²
                    ctx.fillStyle = '#5D4037';
                    ctx.fillRect(x - trunkWidth/2, baseY - treeHeight, trunkWidth, treeHeight);
                    
                    // æ ‘å† 
                    const canopyLayers = 3;
                    for (let j = 0; j < canopyLayers; j++) {
                        const layerY = baseY - treeHeight + 20 + j * 25;
                        const layerWidth = 40 - j * 10;
                        const layerHeight = 30 - j * 8;
                        
                        ctx.fillStyle = `rgba(27, 94, 32, ${0.7 - j * 0.2})`;
                        ctx.beginPath();
                        ctx.ellipse(x, layerY, layerWidth, layerHeight, 0, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    
                    // æ—ä¸‹æ¤ç‰©
                    if (i % 2 === 0) {
                        ctx.fillStyle = '#558B2F';
                        ctx.beginPath();
                        ctx.ellipse(x, baseY - 20, 15, 10, 0, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
                
                // ç»˜åˆ¶ä¸€äº›é£é¸Ÿï¼ˆæ£®æ—é˜¶æ®µï¼‰
                if (time > 80) {
                    for (let i = 0; i < 3; i++) {
                        const birdX = 50 + Math.random() * (canvas.width - 100);
                        const birdY = 50 + Math.random() * 100;
                        
                        ctx.fillStyle = '#5D4037';
                        ctx.beginPath();
                        ctx.arc(birdX, birdY, 3, 0, Math.PI * 2);
                        ctx.fill();
                        
                        // ç¿…è†€
                        ctx.beginPath();
                        ctx.moveTo(birdX, birdY);
                        ctx.lineTo(birdX - 8, birdY - 5);
                        ctx.moveTo(birdX, birdY);
                        ctx.lineTo(birdX + 8, birdY - 5);
                        ctx.strokeStyle = '#5D4037';
                        ctx.lineWidth = 2;
                        ctx.stroke();
                    }
                }
            }
        }
        
        // ç»˜åˆ¶åŸç†è§†å›¾
        function drawPrincipleView() {
            const graphWidth = canvas.width * 0.3;
            const graphHeight = canvas.height * 0.25;
            const graphX = canvas.width - graphWidth - 20;
            const graphY = 20;
            
            // ç»˜åˆ¶åŸç†è§†å›¾èƒŒæ™¯
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.fillRect(graphX, graphY, graphWidth, graphHeight);
            ctx.strokeStyle = '#4CAF50';
            ctx.lineWidth = 2;
            ctx.strokeRect(graphX, graphY, graphWidth, graphHeight);
            
            // ç»˜åˆ¶æ ‡é¢˜
            ctx.fillStyle = '#2E7D32';
            ctx.font = 'bold 16px Arial';
            ctx.fillText('ç”Ÿæ€å› å­å˜åŒ–', graphX + 10, graphY + 25);
            
            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(graphX + 40, graphY + graphHeight - 30);
            ctx.lineTo(graphX + graphWidth - 10, graphY + graphHeight - 30);
            ctx.moveTo(graphX + 40, graphY + 40);
            ctx.lineTo(graphX + 40, graphY + graphHeight - 30);
            ctx.stroke();
            
            // åæ ‡è½´æ ‡ç­¾
            ctx.fillStyle = '#666';
            ctx.font = '12px Arial';
            ctx.fillText('æ—¶é—´ (å¹´)', graphX + graphWidth/2 - 20, graphY + graphHeight - 10);
            ctx.save();
            ctx.translate(graphX + 20, graphY + graphHeight/2);
            ctx.rotate(-Math.PI/2);
            ctx.fillText('ç›¸å¯¹å€¼', 0, 0);
            ctx.restore();
            
            // ç»˜åˆ¶ä¸‰æ¡æ›²çº¿ï¼šåœŸå£¤åšåº¦ã€æ¤è¢«è¦†ç›–åº¦ã€ç‰©ç§å¤šæ ·æ€§
            const metrics = [
                { name: 'åœŸå£¤åšåº¦', color: '#8D6E63', values: [] },
                { name: 'æ¤è¢«è¦†ç›–', color: '#4CAF50', values: [] },
                { name: 'ç‰©ç§å¤šæ ·æ€§', color: '#2196F3', values: [] }
            ];
            
            // è®¡ç®—æŒ‡æ ‡å€¼
            for (let t = 0; t <= maxTime; t += 5) {
                // åœŸå£¤åšåº¦ï¼šéšæ—¶é—´çº¿æ€§å¢åŠ 
                metrics[0].values.push(Math.min(t / maxTime * 1.2, 1));
                
                // æ¤è¢«è¦†ç›–ï¼šSå‹æ›²çº¿å¢é•¿
                let vegetation;
                if (t < 5) vegetation = t / 5 * 0.1;
                else if (t < 20) vegetation = 0.1 + (t - 5) / 15 * 0.4;
                else
<!--æ£€æµ‹åˆ°ä»£ç æˆªæ–­ï¼Œè‡ªåŠ¨ç»­å†™ä¸­...-->
else if (t < 50) vegetation = 0.5 + (t - 20) / 30 * 0.3;
                else vegetation = 0.8 + (t - 50) / 100 * 0.2;
                metrics[1].values.push(vegetation);
                
                // ç‰©ç§å¤šæ ·æ€§ï¼šé˜¶æ¢¯å¼å¢é•¿
                let diversity;
                if (t < 5) diversity = 0.1;
                else if (t < 20) diversity = 0.3;
                else if (t < 50) diversity = 0.6;
                else diversity = 0.9;
                metrics[2].values.push(diversity);
            }
            
            // ç»˜åˆ¶æ›²çº¿
            const dataPoints = metrics[0].values.length;
            const xStep = (graphWidth - 50) / (dataPoints - 1);
            
            metrics.forEach((metric, index) => {
                ctx.strokeStyle = metric.color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                for (let i = 0; i < dataPoints; i++) {
                    const x = graphX + 40 + i * xStep;
                    const y = graphY + graphHeight - 30 - metric.values[i] * (graphHeight - 60);
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                
                ctx.stroke();
                
                // ç»˜åˆ¶å½“å‰æ—¶é—´ç‚¹
                const currentIndex = Math.min(Math.floor(currentTime / 5), dataPoints - 1);
                const currentX = graphX + 40 + currentIndex * xStep;
                const currentY = graphY + graphHeight - 30 - metric.values[currentIndex] * (graphHeight - 60);
                
                ctx.fillStyle = metric.color;
                ctx.beginPath();
                ctx.arc(currentX, currentY, 4, 0, Math.PI * 2);
                ctx.fill();
                
                // ç»˜åˆ¶å›¾ä¾‹
                const legendY = graphY + 60 + index * 20;
                ctx.fillStyle = metric.color;
                ctx.fillRect(graphX + graphWidth - 80, legendY - 8, 15, 3);
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.fillText(metric.name, graphX + graphWidth - 60, legendY);
            });
            
            // ç»˜åˆ¶å½“å‰æ—¶é—´çº¿
            const currentX = graphX + 40 + (currentTime / maxTime) * (graphWidth - 50);
            ctx.strokeStyle = '#FF9800';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 3]);
            ctx.beginPath();
            ctx.moveTo(currentX, graphY + 40);
            ctx.lineTo(currentX, graphY + graphHeight - 30);
            ctx.stroke();
            ctx.setLineDash([]);
        }
        
        // åŠ¨ç”»å¾ªç¯
        function animate() {
            if (isPlaying) {
                currentTime += 0.1; // æ§åˆ¶æ’­æ”¾é€Ÿåº¦
                if (currentTime > maxTime) {
                    currentTime = maxTime;
                    isPlaying = false;
                    playBtn.innerHTML = '<span>â–¶ï¸ æ’­æ”¾</span>';
                }
                drawAnimation();
            }
            animationId = requestAnimationFrame(animate);
        }
        
        // å¼€å§‹åŠ¨ç”»å¾ªç¯
        animate();
        
        // äº‹ä»¶ç›‘å¬å™¨
        playBtn.addEventListener('click', () => {
            isPlaying = true;
            playBtn.innerHTML = '<span>â¸ï¸ æ’­æ”¾ä¸­</span>';
            if (currentTime >= maxTime) {
                currentTime = 0;
            }
        });
        
        pauseBtn.addEventListener('click', () => {
            isPlaying = false;
            playBtn.innerHTML = '<span>â–¶ï¸ æ’­æ”¾</span>';
        });
        
        resetBtn.addEventListener('click', () => {
            currentTime = 0;
            isPlaying = false;
            playBtn.innerHTML = '<span>â–¶ï¸ æ’­æ”¾</span>';
            drawAnimation();
        });
        
        timeSlider.addEventListener('input', () => {
            currentTime = parseFloat(timeSlider.value);
            isPlaying = false;
            playBtn.innerHTML = '<span>â–¶ï¸ æ’­æ”¾</span>';
            drawAnimation();
        });
        
        viewToggleBtn.addEventListener('click', () => {
            showPrincipleView = !showPrincipleView;
            principleViewToggle.checked = showPrincipleView;
            viewToggleBtn.innerHTML = showPrincipleView ? 
                '<span>ğŸŒ¿ åˆ‡æ¢æ™¯è§‚è§†å›¾</span>' : 
                '<span>ğŸ“Š åˆ‡æ¢åŸç†è§†å›¾</span>';
            drawAnimation();
        });
        
        principleViewToggle.addEventListener('change', () => {
            showPrincipleView = principleViewToggle.checked;
            viewToggleBtn.innerHTML = showPrincipleView ? 
                '<span>ğŸŒ¿ åˆ‡æ¢æ™¯è§‚è§†å›¾</span>' : 
                '<span>ğŸ“Š åˆ‡æ¢åŸç†è§†å›¾</span>';
            drawAnimation();
        });
        
        // é˜¶æ®µæŒ‰é’®äº‹ä»¶
        stageButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const stageIndex = parseInt(btn.dataset.stage);
                let targetTime;
                
                switch(stageIndex) {
                    case 0: targetTime = 0; break;
                    case 1: targetTime = 10; break;
                    case 2: targetTime = 35; break;
                    case 3: targetTime = 100; break;
                }
                
                currentTime = targetTime;
                isPlaying = false;
                playBtn.innerHTML = '<span>â–¶ï¸ æ’­æ”¾</span>';
                drawAnimation();
            });
        });
        
        // åˆå§‹ç»˜åˆ¶
        drawAnimation();
        
        // æ·»åŠ ç‚¹å‡»æ¤ç‰©æ˜¾ç¤ºä¿¡æ¯çš„åŠŸèƒ½
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // æ ¹æ®ç‚¹å‡»ä½ç½®æ˜¾ç¤ºä¸åŒä¿¡æ¯
            const stageIndex = updateStageIndicator(currentTime);
            const species = speciesByStage[stageIndex];
            
            // ç®€å•åˆ¤æ–­ç‚¹å‡»åŒºåŸŸ
            if (y > canvas.height * 0.4) {
                // éšæœºé€‰æ‹©ä¸€ä¸ªç‰©ç§æ˜¾ç¤ºä¿¡æ¯ï¼ˆå®é™…åº”ç”¨ä¸­å¯ä»¥æ ¹æ®ç²¾ç¡®ä½ç½®åˆ¤æ–­ï¼‰
                const randomSpecies = species[Math.floor(Math.random() * species.length)];
                
                // æ˜¾ç¤ºä¸´æ—¶ä¿¡æ¯
                const infoX = Math.min(x, canvas.width - 200);
                const infoY = Math.min(y, canvas.height - 100);
                
                ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
                ctx.fillRect(infoX, infoY, 180, 70);
                ctx.strokeStyle = randomSpecies.color;
                ctx.lineWidth = 2;
                ctx.strokeRect(infoX, infoY, 180, 70);
                
                ctx.fillStyle = '#333';
                ctx.font = 'bold 14px Arial';
                ctx.fillText(randomSpecies.name, infoX + 10, infoY + 25);
                
                ctx.fillStyle = '#666';
                ctx.font = '12px Arial';
                const lines = wrapText(ctx, randomSpecies.role, infoX + 10, infoY + 45, 160, 16);
                
                // 3ç§’åæ¸…é™¤
                setTimeout(() => {
                    drawAnimation();
                }, 3000);
            }
        });
        
        // æ–‡æœ¬æ¢è¡Œå‡½æ•°
        function wrapText(context, text, x, y, maxWidth, lineHeight) {
            const words = text.split(' ');
            let line = '';
            let lines = [];
            
            for (let i = 0; i < words.length; i++) {
                const testLine = line + words[i] + ' ';
                const metrics = context.measureText(testLine);
                const testWidth = metrics.width;
                
                if (testWidth > maxWidth && i > 0) {
                    lines.push(line);
                    line = words[i] + ' ';
                } else {
                    line = testLine;
                }
            }
            lines.push(line);
            
            for (let i = 0; i < lines.length; i++) {
                context.fillText(lines[i], x, y + (i * lineHeight));
            }
            
            return lines;
        }
        
        // æ·»åŠ é”®ç›˜æ§åˆ¶
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case ' ':
                    // ç©ºæ ¼é”®åˆ‡æ¢æ’­æ”¾/æš‚åœ
                    isPlaying = !isPlaying;
                    playBtn.innerHTML = isPlaying ? '<span>â¸ï¸ æ’­æ”¾ä¸­</span>' : '<span>â–¶ï¸ æ’­æ”¾</span>';
                    e.preventDefault();
                    break;
                case 'ArrowRight':
                    currentTime = Math.min(currentTime + 5, maxTime);
                    drawAnimation();
                    e.preventDefault();
                    break;
                case 'ArrowLeft':
                    currentTime = Math.max(currentTime - 5, 0);
                    drawAnimation();
                    e.preventDefault();
                    break;
                case 'v':
                case 'V':
                    showPrincipleView = !showPrincipleView;
                    principleViewToggle.checked = showPrincipleView;
                    viewToggleBtn.innerHTML = showPrincipleView ? 
                        '<span>ğŸŒ¿ åˆ‡æ¢æ™¯è§‚è§†å›¾</span>' : 
                        '<span>ğŸ“Š åˆ‡æ¢åŸç†è§†å›¾</span>';
                    drawAnimation();
                    e.preventDefault();
                    break;
            }
        });
        
        // æ·»åŠ è§¦æ‘¸è®¾å¤‡æ”¯æŒ
        let touchStartX = 0;
        canvas.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            e.preventDefault();
        });
        
        canvas.addEventListener('touchmove', (e) => {
            const touchX = e.touches[0].clientX;
            const deltaX = touchX - touchStartX;
            
            if (Math.abs(deltaX) > 20) {
                currentTime += deltaX * 0.5;
                currentTime = Math.max(0, Math.min(currentTime, maxTime));
                touchStartX = touchX;
                drawAnimation();
            }
            
            e.preventDefault();
        });
    </script>
</body>
</html>