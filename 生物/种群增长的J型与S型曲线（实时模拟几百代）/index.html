<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§ç¾¤å¢é•¿æ¨¡å‹ï¼šJå‹ä¸Så‹æ›²çº¿æ¨¡æ‹Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 1400px;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        header {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        h1 {
            color: #1a5f7a;
            margin-bottom: 10px;
            font-size: 2.4rem;
        }

        .subtitle {
            color: #666;
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
        }

        .simulation-section {
            flex: 1;
            min-width: 500px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .panel-title {
            color: #1a5f7a;
            font-size: 1.4rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e4edf5;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-title svg {
            width: 24px;
            height: 24px;
        }

        .canvas-container {
            position: relative;
            width: 100%;
            height: 400px;
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #d1e3f0;
        }

        #simulationCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .k-line {
            position: absolute;
            left: 0;
            right: 0;
            height: 2px;
            background: repeating-linear-gradient(
                90deg,
                #ff4757,
                #ff4757 10px,
                transparent 10px,
                transparent 20px
            );
            pointer-events: none;
            z-index: 10;
        }

        .k-label {
            position: absolute;
            background: #ff4757;
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: bold;
            pointer-events: none;
            z-index: 11;
        }

        .controls-section {
            flex: 1;
            min-width: 400px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            gap: 15px;
        }

        .control-label {
            min-width: 180px;
            font-weight: 600;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-label svg {
            width: 20px;
            height: 20px;
        }

        .slider-container {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        input[type="range"] {
            flex: 1;
            height: 8px;
            -webkit-appearance: none;
            background: linear-gradient(90deg, #e4edf5, #1a5f7a);
            border-radius: 4px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #1a5f7a;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .value-display {
            min-width: 60px;
            text-align: center;
            padding: 6px 12px;
            background: #f8fafc;
            border-radius: 6px;
            border: 1px solid #d1e3f0;
            font-weight: 600;
            color: #1a5f7a;
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        button svg {
            width: 20px;
            height: 20px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #1a5f7a, #2a8bb8);
            color: white;
            flex: 2;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(26, 95, 122, 0.3);
        }

        .btn-secondary {
            background: #f8fafc;
            color: #2c3e50;
            border: 2px solid #d1e3f0;
            flex: 1;
        }

        .btn-secondary:hover {
            background: #e4edf5;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffa502, #ff7f00);
            color: white;
            flex: 1;
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 127, 0, 0.3);
        }

        .model-selector {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .model-btn {
            flex: 1;
            padding: 12px;
            background: #f8fafc;
            border: 2px solid #d1e3f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-align: center;
        }

        .model-btn.active {
            border-color: #1a5f7a;
            background: #e4edf5;
            color: #1a5f7a;
        }

        .j-model.active {
            border-color: #ffa502;
            background: #fff9e6;
            color: #cc8400;
        }

        .s-model.active {
            border-color: #1a5f7a;
            background: #e6f7ff;
            color: #0066cc;
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-top: 10px;
        }

        .preset-btn {
            padding: 10px;
            background: #f8fafc;
            border: 2px solid #e4edf5;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            text-align: center;
        }

        .preset-btn:hover {
            background: #e4edf5;
            transform: translateY(-2px);
        }

        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .stat-item {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #1a5f7a;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1a5f7a;
            font-family: 'Courier New', monospace;
        }

        .j-stat {
            border-left-color: #ffa502;
        }

        .j-stat .stat-value {
            color: #cc8400;
        }

        .s-stat {
            border-left-color: #1a5f7a;
        }

        .s-stat .stat-value {
            color: #0066cc;
        }

        .legend {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .legend-j {
            background: #ffa502;
        }

        .legend-s {
            background: #1a5f7a;
        }

        .legend-k {
            background: repeating-linear-gradient(
                90deg,
                #ff4757,
                #ff4757 5px,
                transparent 5px,
                transparent 10px
            );
            width: 30px;
        }

        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #e4edf5;
            width: 100%;
        }

        @media (max-width: 1100px) {
            .main-content {
                flex-direction: column;
            }
            
            .simulation-section, .controls-section {
                min-width: 100%;
            }
        }

        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            .panel {
                padding: 15px;
            }
            
            .control-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .slider-container {
                width: 100%;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ç§ç¾¤å¢é•¿æ¨¡å‹ï¼šJå‹ä¸Så‹æ›²çº¿æ¨¡æ‹Ÿ</h1>
            <p class="subtitle">é€šè¿‡å®æ—¶æ¨¡æ‹Ÿæ•°ç™¾ä»£ç§ç¾¤å¢é•¿ï¼Œç›´è§‚ç†è§£Jå‹ï¼ˆæŒ‡æ•°å¢é•¿ï¼‰ä¸Så‹ï¼ˆé€»è¾‘æ–¯è’‚å¢é•¿ï¼‰æ›²çº¿çš„å·®å¼‚åŠå…¶ç”Ÿæ€å­¦æ„ä¹‰ã€‚è°ƒæ•´å‚æ•°è§‚å¯Ÿç¯å¢ƒå®¹çº³é‡ã€å¢é•¿ç‡ç­‰å…³é”®å› ç´ å¦‚ä½•å½±å“ç§ç¾¤åŠ¨æ€ã€‚</p>
        </header>

        <div class="main-content">
            <section class="simulation-section">
                <div class="panel">
                    <h2 class="panel-title">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 3v18h18V3H3zm16 16H5V5h14v14z"/>
                            <path d="M7 7h10v10H7z"/>
                        </svg>
                        ç§ç¾¤æ¨¡æ‹Ÿè§†å›¾
                    </h2>
                    <div class="canvas-container">
                        <canvas id="simulationCanvas"></canvas>
                        <div class="k-line" id="kLine"></div>
                        <div class="k-label" id="kLabel">K = 500</div>
                    </div>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color legend-j"></div>
                            <span>Jå‹å¢é•¿ï¼ˆæŒ‡æ•°å¢é•¿ï¼‰</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color legend-s"></div>
                            <span>Så‹å¢é•¿ï¼ˆé€»è¾‘æ–¯è’‚å¢é•¿ï¼‰</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color legend-k"></div>
                            <span>ç¯å¢ƒå®¹çº³é‡ï¼ˆKå€¼ï¼‰</span>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <h2 class="panel-title">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"/>
                        </svg>
                        å¢é•¿æ›²çº¿å›¾
                    </h2>
                    <div class="canvas-container">
                        <canvas id="graphCanvas"></canvas>
                    </div>
                </div>
            </section>

            <section class="controls-section">
                <div class="panel">
                    <h2 class="panel-title">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
                        </svg>
                        æ¨¡æ‹Ÿæ§åˆ¶
                    </h2>
                    
                    <div class="control-group">
                        <div class="control-row">
                            <label class="control-label">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/>
                                    <path d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                                </svg>
                                æ¨¡æ‹Ÿé€Ÿåº¦
                            </label>
                            <div class="slider-container">
                                <input type="range" id="speedSlider" min="1" max="10" value="5">
                                <span class="value-display" id="speedValue">5x</span>
                            </div>
                        </div>

                        <div class="control-row">
                            <label class="control-label">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M16 1H8C6.34 1 5 2.34 5 4v16c0 1.66 1.34 3 3 3h8c1.66 0 3-1.34 3-3V4c0-1.66-1.34-3-3-3zm-2 20h-4v-1h4v1zm3.25-3H6.75V4h10.5v14z"/>
                                </svg>
                                æ˜¾ç¤ºä¸ªä½“æ•°
                            </label>
                            <div class="slider-container">
                                <input type="range" id="displaySlider" min="10" max="500" value="200">
                                <span class="value-display" id="displayValue">200</span>
                            </div>
                        </div>
                    </div>

                    <div class="button-group">
                        <button id="startBtn" class="btn-primary">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                            å¼€å§‹æ¨¡æ‹Ÿ
                        </button>
                        <button id="resetBtn" class="btn-secondary">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                            </svg>
                            é‡ç½®
                        </button>
                        <button id="stepBtn" class="btn-secondary">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M5.88 4.12L13.76 12l-7.88 7.88L8 22l10-10L8 2z"/>
                            </svg>
                            å•æ­¥å‰è¿›
                        </button>
                    </div>
                </div>

                <div class="panel">
                    <h2 class="panel-title">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/>
                        </svg>
                        æ¨¡å‹å‚æ•°
                    </h2>
                    
                    <div class="model-selector">
                        <div class="model-btn j-model active" data-model="j">ä»…Jå‹</div>
                        <div class="model-btn s-model" data-model="s">ä»…Så‹</div>
                        <div class="model-btn" data-model="both">å¯¹æ¯”æ¨¡å¼</div>
                    </div>

                    <div class="control-group">
                        <div class="control-row">
                            <label class="control-label">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4V7zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
                                </svg>
                                åˆå§‹ç§ç¾¤ (Nâ‚€)
                            </label>
                            <div class="slider-container">
                                <input type="range" id="n0Slider" min="1" max="100" value="10">
                                <span class="value-display" id="n0Value">10</span>
                            </div>
                        </div>

                        <div class="control-row">
                            <label class="control-label">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
                                </svg>
                                å†…ç¦€å¢é•¿ç‡ (r)
                            </label>
                            <div class="slider-container">
                                <input type="range" id="rSlider" min="0.1" max="1.0" step="0.05" value="0.3">
                                <span class="value-display" id="rValue">0.30</span>
                            </div>
                        </div>

                        <div class="control-row">
                            <label class="control-label">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/>
                                    <path d="M7 12h10v2H7z"/>
                                </svg>
                                ç¯å¢ƒå®¹çº³é‡ (K)
                            </label>
                            <div class="slider-container">
                                <input type="range" id="kSlider" min="100" max="2000" value="500">
                                <span class="value-display" id="kValue">500</span>
                            </div>
                        </div>
                    </div>

                    <div class="control-group">
                        <h3 style="color: #1a5f7a; margin-bottom: 15px;">é¢„è®¾åœºæ™¯</h3>
                        <div class="preset-buttons">
                            <button class="preset-btn" data-preset="bacteria">ğŸ¦  ç»†èŒåŸ¹å…»</button>
                            <button class="preset-btn" data-preset="invasive">ğŸŒ¿ å…¥ä¾µç‰©ç§</button>
                            <button class="preset-btn" data-preset="endangered">ğŸ¼ æ¿’å±ç‰©ç§</button>
                            <button class="preset-btn" data-preset="pest">ğŸ› å†œä¸šå®³è™«</button>
                            <button class="preset-btn" data-preset="custom">âš™ï¸ è‡ªå®šä¹‰</button>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <h2 class="panel-title">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                        </svg>
                        å®æ—¶æ•°æ®
                    </h2>
                    
                    <div class="stats-panel">
                        <div class="stat-item j-stat">
                            <div class="stat-label">Jå‹ç§ç¾¤æ•°é‡</div>
                            <div class="stat-value" id="jPopulation">10</div>
                        </div>
                        <div class="stat-item s-stat">
                            <div class="stat-label">Så‹ç§ç¾¤æ•°é‡</div>
                            <div class="stat-value" id="sPopulation">10</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">å½“å‰ä»£æ•°</div>
                            <div class="stat-value" id="generation">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Så‹å¢é•¿ç‡</div>
                            <div class="stat-value" id="growthRate">100%</div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <footer>
            <p>ç§ç¾¤å¢é•¿æ¨¡å‹æ•™å­¦åŠ¨ç”» | è®¾è®¡ï¼šæ•™è‚²æŠ€æœ¯ä¸“å®¶ | ä½¿ç”¨HTML5 Canvaså®ç°</p>
            <p>Jå‹æ›²çº¿ï¼šNâ‚œ = Nâ‚€ Ã— eÊ³áµ— | Så‹æ›²çº¿ï¼šdN/dt = rN(1 - N/K)</p>
        </footer>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let simulationRunning = false;
        let animationId = null;
        let generation = 0;
        let simulationSpeed = 5;
        let maxDisplayIndividuals = 200;

        // ç§ç¾¤å‚æ•°
        let params = {
            n0: 10,
            r: 0.3,
            k: 500,
            model: 'both' // 'j', 's', 'both'
        };

        // ç§ç¾¤çŠ¶æ€
        let populations = {
            j: { n: 10, history: [], individuals: [] },
            s: { n: 10, history: [], individuals: [] }
        };

        // Canvas ä¸Šä¸‹æ–‡
        const simCanvas = document.getElementById('simulationCanvas');
        const graphCanvas = document.getElementById('graphCanvas');
        const simCtx = simCanvas.getContext('2d');
        const graphCtx = graphCanvas.getContext('2d');

        // åˆå§‹åŒ–Canvaså¤§å°
        function initCanvas() {
            const container = simCanvas.parentElement;
            simCanvas.width = container.clientWidth;
            simCanvas.height = container.clientHeight;
            
            const graphContainer = graphCanvas.parentElement;
            graphCanvas.width = graphContainer.clientWidth;
            graphCanvas.height = graphContainer.clientHeight;
            
            updateKLine();
            drawGraph();
        }

        // æ›´æ–°Kå€¼çº¿ä½ç½®
        function updateKLine() {
            const kLine = document.getElementById('kLine');
            const kLabel = document.getElementById('kLabel');
            const container = simCanvas.parentElement;
            
            // Kå€¼åœ¨Canvasä¸­çš„ä½ç½®ï¼ˆä»é¡¶éƒ¨è®¡ç®—ï¼‰
            const kPosition = (1 - params.k / 2000) * container.clientHeight;
            
            kLine.style.top = `${kPosition}px`;
            kLabel.style.top = `${kPosition - 30}px`;
            kLabel.style.left = '10px';
            kLabel.textContent = `K = ${params.k}`;
        }

        // ç»˜åˆ¶æ¨¡æ‹Ÿè§†å›¾
        function drawSimulation() {
            const width = simCanvas.width;
            const height = simCanvas.height;
            
            // æ¸…ç©ºç”»å¸ƒ
            simCtx.clearRect(0, 0, width, height);
            
            // ç»˜åˆ¶èƒŒæ™¯ç½‘æ ¼
            simCtx.strokeStyle = '#e4edf5';
            simCtx.lineWidth = 1;
            const gridSize = 40;
            
            for (let x = 0; x < width; x += gridSize) {
                simCtx.beginPath();
                simCtx.moveTo(x, 0);
                simCtx.lineTo(x, height);
                simCtx.stroke();
            }
            
            for (let y = 0; y < height; y += gridSize) {
                simCtx.beginPath();
                simCtx.moveTo(0, y);
                simCtx.lineTo(width, y);
                simCtx.stroke();
            }
            
            // ç»˜åˆ¶Jå‹ç§ç¾¤ä¸ªä½“
            if (params.model === 'j' || params.model === 'both') {
                const jCount = Math.min(populations.j.individuals.length, maxDisplayIndividuals);
                const scale = maxDisplayIndividuals > jCount ? 1 : maxDisplayIndividuals / populations.j.individuals.length;
                
                for (let i = 0; i < jCount; i++) {
                    const individual = populations.j.individuals[i];
                    const displayIndex = Math.floor(i * scale);
                    
                    simCtx.fillStyle = 'rgba(255, 165, 2, 0.7)';
                    simCtx.beginPath();
                    simCtx.arc(
                        (individual.x * width) + Math.sin(generation * 0.1 + i) * 2,
                        height - (individual.y * height) + Math.cos(generation * 0.1 + i) * 2,
                        4, 0, Math.PI * 2
                    );
                    simCtx.fill();
                    
                    // æ·»åŠ è„‰åŠ¨æ•ˆæœ
                    if (simulationRunning) {
                        simCtx.beginPath();
                        simCtx.arc(
                            (individual.x * width) + Math.sin(generation * 0.1 + i) * 2,
                            height - (individual.y * height) + Math.cos(generation * 0.1 + i) * 2,
                            6 + Math.sin(Date.now() * 0.002 + i) * 2,
                            0, Math.PI * 2
                        );
                        simCtx.strokeStyle = 'rgba(255, 165, 2, 0.3)';
                        simCtx.stroke();
                    }
                }
            }
            
            // ç»˜åˆ¶Så‹ç§ç¾¤ä¸ªä½“
            if (params.model === 's' || params.model === 'both') {
                const sCount = Math.min(populations.s.individuals.length, maxDisplayIndividuals);
                const scale = maxDisplayIndividuals > sCount ? 1 : maxDisplayIndividuals / populations.s.individuals.length;
                
                for (let i = 0; i < sCount; i++) {
                    const individual = populations.s.individuals[i];
                    const displayIndex = Math.floor(i * scale);
                    
                    simCtx.fillStyle = 'rgba(26, 95, 122, 0.7)';
                    simCtx.beginPath();
                    simCtx.arc(
                        (individual.x * width) + Math.cos(generation * 0.1 + i) * 2,
                        height - (individual.y * height) + Math.sin(generation * 0.1 + i) * 2,
                        4, 0, Math.PI * 2
                    );
                    simCtx.fill();
                    
                    // æ·»åŠ è„‰åŠ¨æ•ˆæœ
                    if (simulationRunning) {
                        simCtx.beginPath();
                        simCtx.arc(
                            (individual.x * width) + Math.cos(generation * 0.1 + i) * 2,
                            height - (individual.y * height) + Math.sin(generation * 0.1 + i) * 2,
                            6 + Math.cos(Date.now() * 0.002 + i) * 2,
                            0, Math.PI * 2
                        );
                        simCtx.strokeStyle = 'rgba(26, 95, 122, 0.3)';
                        simCtx.stroke();
                    }
                }
            }
            
            // ç»˜åˆ¶Kå€¼çº¿
            const kPosition = (1 - params.k / 2000) * height;
            simCtx.strokeStyle = '#ff4757';
            simCtx.setLineDash([10, 5]);
            simCtx.lineWidth = 2;
            simCtx.beginPath();
            simCtx.moveTo(0, kPosition);
            simCtx.lineTo(width, kPosition);
            simCtx.stroke();
            simCtx.setLineDash([]);
            
            // ç»˜åˆ¶Kå€¼æ ‡ç­¾
            simCtx.fillStyle = '#ff4757';
            simCtx.font = 'bold 14px Arial';
            simCtx.fillText(`K = ${params.k}`, 10, kPosition - 10);
        }

        // ç»˜åˆ¶æ›²çº¿å›¾
        function drawGraph() {
            const width = graphCanvas.width;
            const
<!--æ£€æµ‹åˆ°ä»£ç æˆªæ–­ï¼Œè‡ªåŠ¨ç»­å†™ä¸­...-->
height = graphCanvas.height;
            
            // æ¸…ç©ºç”»å¸ƒ
            graphCtx.clearRect(0, 0, width, height);
            
            // ç»˜åˆ¶èƒŒæ™¯
            graphCtx.fillStyle = '#ffffff';
            graphCtx.fillRect(0, 0, width, height);
            
            // ç»˜åˆ¶åæ ‡è½´
            graphCtx.strokeStyle = '#666';
            graphCtx.lineWidth = 2;
            
            // Yè½´
            graphCtx.beginPath();
            graphCtx.moveTo(60, 20);
            graphCtx.lineTo(60, height - 40);
            graphCtx.stroke();
            
            // Xè½´
            graphCtx.beginPath();
            graphCtx.moveTo(60, height - 40);
            graphCtx.lineTo(width - 20, height - 40);
            graphCtx.stroke();
            
            // åæ ‡è½´æ ‡ç­¾
            graphCtx.fillStyle = '#666';
            graphCtx.font = '14px Arial';
            graphCtx.textAlign = 'center';
            graphCtx.fillText('ç§ç¾¤æ•°é‡ (N)', 30, height / 2);
            graphCtx.save();
            graphCtx.translate(30, height / 2);
            graphCtx.rotate(-Math.PI / 2);
            graphCtx.fillText('ç§ç¾¤æ•°é‡ (N)', 0, 0);
            graphCtx.restore();
            
            graphCtx.textAlign = 'center';
            graphCtx.fillText('æ—¶é—´ (ä»£)', width / 2, height - 10);
            
            // Yè½´åˆ»åº¦
            const maxPopulation = Math.max(2000, params.k * 1.2);
            for (let i = 0; i <= 5; i++) {
                const value = (i * maxPopulation) / 5;
                const y = height - 40 - (value / maxPopulation) * (height - 60);
                
                graphCtx.beginPath();
                graphCtx.moveTo(55, y);
                graphCtx.lineTo(60, y);
                graphCtx.stroke();
                
                graphCtx.textAlign = 'right';
                graphCtx.fillText(Math.round(value).toString(), 50, y + 4);
            }
            
            // Xè½´åˆ»åº¦
            const maxGenerations = 200;
            for (let i = 0; i <= 4; i++) {
                const value = i * 50;
                const x = 60 + (value / maxGenerations) * (width - 80);
                
                graphCtx.beginPath();
                graphCtx.moveTo(x, height - 40);
                graphCtx.lineTo(x, height - 35);
                graphCtx.stroke();
                
                graphCtx.textAlign = 'center';
                graphCtx.fillText(value.toString(), x, height - 25);
            }
            
            // ç»˜åˆ¶Kå€¼æ°´å¹³çº¿
            graphCtx.strokeStyle = '#ff4757';
            graphCtx.setLineDash([5, 5]);
            graphCtx.lineWidth = 1;
            const kY = height - 40 - (params.k / maxPopulation) * (height - 60);
            graphCtx.beginPath();
            graphCtx.moveTo(60, kY);
            graphCtx.lineTo(width - 20, kY);
            graphCtx.stroke();
            
            graphCtx.textAlign = 'left';
            graphCtx.fillStyle = '#ff4757';
            graphCtx.fillText(`K = ${params.k}`, width - 100, kY - 5);
            graphCtx.setLineDash([]);
            
            // ç»˜åˆ¶Jå‹æ›²çº¿
            if ((params.model === 'j' || params.model === 'both') && populations.j.history.length > 1) {
                graphCtx.strokeStyle = '#ffa502';
                graphCtx.lineWidth = 3;
                graphCtx.beginPath();
                
                for (let i = 0; i < populations.j.history.length; i++) {
                    const x = 60 + (i / maxGenerations) * (width - 80);
                    const y = height - 40 - (populations.j.history[i] / maxPopulation) * (height - 60);
                    
                    if (i === 0) {
                        graphCtx.moveTo(x, y);
                    } else {
                        graphCtx.lineTo(x, y);
                    }
                }
                graphCtx.stroke();
                
                // ç»˜åˆ¶å½“å‰ç‚¹
                if (populations.j.history.length > 0) {
                    const lastX = 60 + ((populations.j.history.length - 1) / maxGenerations) * (width - 80);
                    const lastY = height - 40 - (populations.j.history[populations.j.history.length - 1] / maxPopulation) * (height - 60);
                    
                    graphCtx.fillStyle = '#ffa502';
                    graphCtx.beginPath();
                    graphCtx.arc(lastX, lastY, 6, 0, Math.PI * 2);
                    graphCtx.fill();
                }
            }
            
            // ç»˜åˆ¶Så‹æ›²çº¿
            if ((params.model === 's' || params.model === 'both') && populations.s.history.length > 1) {
                graphCtx.strokeStyle = '#1a5f7a';
                graphCtx.lineWidth = 3;
                graphCtx.beginPath();
                
                for (let i = 0; i < populations.s.history.length; i++) {
                    const x = 60 + (i / maxGenerations) * (width - 80);
                    const y = height - 40 - (populations.s.history[i] / maxPopulation) * (height - 60);
                    
                    if (i === 0) {
                        graphCtx.moveTo(x, y);
                    } else {
                        graphCtx.lineTo(x, y);
                    }
                }
                graphCtx.stroke();
                
                // ç»˜åˆ¶å½“å‰ç‚¹
                if (populations.s.history.length > 0) {
                    const lastX = 60 + ((populations.s.history.length - 1) / maxGenerations) * (width - 80);
                    const lastY = height - 40 - (populations.s.history[populations.s.history.length - 1] / maxPopulation) * (height - 60);
                    
                    graphCtx.fillStyle = '#1a5f7a';
                    graphCtx.beginPath();
                    graphCtx.arc(lastX, lastY, 6, 0, Math.PI * 2);
                    graphCtx.fill();
                    
                    // æ ‡è®°æ‹ç‚¹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                    if (populations.s.history.length > 10) {
                        const maxGrowthIndex = findMaxGrowthIndex(populations.s.history);
                        if (maxGrowthIndex > 0) {
                            const inflectionX = 60 + (maxGrowthIndex / maxGenerations) * (width - 80);
                            const inflectionY = height - 40 - (populations.s.history[maxGrowthIndex] / maxPopulation) * (height - 60);
                            
                            graphCtx.fillStyle = '#ff4757';
                            graphCtx.beginPath();
                            graphCtx.arc(inflectionX, inflectionY, 8, 0, Math.PI * 2);
                            graphCtx.fill();
                            graphCtx.fillStyle = '#ffffff';
                            graphCtx.font = 'bold 12px Arial';
                            graphCtx.textAlign = 'center';
                            graphCtx.fillText('æ‹ç‚¹', inflectionX, inflectionY - 15);
                        }
                    }
                }
            }
            
            // å›¾ä¾‹
            graphCtx.font = '14px Arial';
            if (params.model === 'both') {
                graphCtx.fillStyle = '#ffa502';
                graphCtx.fillText('Jå‹æ›²çº¿', width - 100, 30);
                graphCtx.fillStyle = '#1a5f7a';
                graphCtx.fillText('Så‹æ›²çº¿', width - 100, 50);
            } else if (params.model === 'j') {
                graphCtx.fillStyle = '#ffa502';
                graphCtx.fillText('Jå‹æ›²çº¿', width - 100, 30);
            } else if (params.model === 's') {
                graphCtx.fillStyle = '#1a5f7a';
                graphCtx.fillText('Så‹æ›²çº¿', width - 100, 30);
            }
        }
        
        // æ‰¾åˆ°Så‹æ›²çº¿çš„æœ€å¤§å¢é•¿ç‚¹ï¼ˆæ‹ç‚¹ï¼‰
        function findMaxGrowthIndex(history) {
            let maxGrowth = 0;
            let maxIndex = 0;
            
            for (let i = 1; i < history.length; i++) {
                const growth = history[i] - history[i-1];
                if (growth > maxGrowth) {
                    maxGrowth = growth;
                    maxIndex = i;
                }
            }
            
            return maxIndex;
        }
        
        // è®¡ç®—ä¸‹ä¸€ä»£ç§ç¾¤
        function calculateNextGeneration() {
            // Jå‹å¢é•¿ï¼šN_t = N_0 * e^(r*t)
            populations.j.n = params.n0 * Math.exp(params.r * generation);
            
            // Så‹å¢é•¿ï¼šdN/dt = rN(1-N/K) çš„ç¦»æ•£è¿‘ä¼¼
            const currentS = populations.s.n;
            const growth = params.r * currentS * (1 - currentS / params.k);
            populations.s.n = Math.max(0, currentS + growth);
            
            // æ›´æ–°å†å²è®°å½•
            populations.j.history.push(populations.j.n);
            populations.s.history.push(populations.s.n);
            
            // é™åˆ¶å†å²è®°å½•é•¿åº¦
            if (populations.j.history.length > 200) {
                populations.j.history.shift();
                populations.s.history.shift();
            }
            
            // æ›´æ–°ä¸ªä½“ä½ç½®
            updateIndividuals();
            
            // æ›´æ–°æ˜¾ç¤ºæ•°æ®
            updateDisplay();
            
            generation++;
        }
        
        // æ›´æ–°ä¸ªä½“ä½ç½®
        function updateIndividuals() {
            // ä¸ºJå‹ç§ç¾¤åˆ›å»ºä¸ªä½“
            const targetJCount = Math.min(Math.floor(populations.j.n), 1000);
            while (populations.j.individuals.length < targetJCount) {
                populations.j.individuals.push({
                    x: Math.random(),
                    y: Math.random() * (params.k / 2000) // Jå‹ä¸å—Ké™åˆ¶
                });
            }
            while (populations.j.individuals.length > targetJCount) {
                populations.j.individuals.pop();
            }
            
            // ä¸ºSå‹ç§ç¾¤åˆ›å»ºä¸ªä½“
            const targetSCount = Math.min(Math.floor(populations.s.n), 1000);
            while (populations.s.individuals.length < targetSCount) {
                populations.s.individuals.push({
                    x: Math.random(),
                    y: Math.random() * (populations.s.n / params.k) * (params.k / 2000)
                });
            }
            while (populations.s.individuals.length > targetSCount) {
                populations.s.individuals.pop();
            }
            
            // æ›´æ–°ä¸ªä½“ä½ç½®ï¼ˆæ¨¡æ‹Ÿè½»å¾®ç§»åŠ¨ï¼‰
            populations.j.individuals.forEach(ind => {
                ind.x = (ind.x + Math.random() * 0.02 - 0.01) % 1;
                ind.y = Math.min(1, Math.max(0, ind.y + Math.random() * 0.02 - 0.01));
            });
            
            populations.s.individuals.forEach(ind => {
                ind.x = (ind.x + Math.random() * 0.02 - 0.01) % 1;
                ind.y = Math.min(populations.s.n / params.k, Math.max(0, ind.y + Math.random() * 0.02 - 0.01));
            });
        }
        
        // æ›´æ–°æ˜¾ç¤ºæ•°æ®
        function updateDisplay() {
            document.getElementById('jPopulation').textContent = Math.round(populations.j.n);
            document.getElementById('sPopulation').textContent = Math.round(populations.s.n);
            document.getElementById('generation').textContent = generation;
            
            // è®¡ç®—Så‹å¢é•¿ç‡
            if (populations.s.history.length > 1) {
                const current = populations.s.history[populations.s.history.length - 1];
                const previous = populations.s.history[populations.s.history.length - 2];
                const rate = previous > 0 ? ((current - previous) / previous * 100).toFixed(1) : '100.0';
                document.getElementById('growthRate').textContent = `${rate}%`;
            }
        }
        
        // é‡ç½®æ¨¡æ‹Ÿ
        function resetSimulation() {
            generation = 0;
            populations = {
                j: { n: params.n0, history: [params.n0], individuals: [] },
                s: { n: params.n0, history: [params.n0], individuals: [] }
            };
            
            updateIndividuals();
            updateDisplay();
            drawSimulation();
            drawGraph();
        }
        
        // å•æ­¥å‰è¿›
        function stepSimulation() {
            calculateNextGeneration();
            drawSimulation();
            drawGraph();
        }
        
        // å¼€å§‹/åœæ­¢æ¨¡æ‹Ÿ
        function toggleSimulation() {
            simulationRunning = !simulationRunning;
            const startBtn = document.getElementById('startBtn');
            
            if (simulationRunning) {
                startBtn.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                    </svg>
                    æš‚åœæ¨¡æ‹Ÿ
                `;
                startBtn.classList.add('btn-warning');
                startBtn.classList.remove('btn-primary');
                
                // å¼€å§‹åŠ¨ç”»å¾ªç¯
                function animate() {
                    if (!simulationRunning) return;
                    
                    for (let i = 0; i < simulationSpeed; i++) {
                        calculateNextGeneration();
                    }
                    
                    drawSimulation();
                    drawGraph();
                    
                    animationId = requestAnimationFrame(animate);
                }
                
                animate();
            } else {
                startBtn.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                    å¼€å§‹æ¨¡æ‹Ÿ
                `;
                startBtn.classList.remove('btn-warning');
                startBtn.classList.add('btn-primary');
                
                if (animationId) {
                    cancelAnimationFrame(animationId);
                }
            }
        }
        
        // è®¾ç½®é¢„è®¾åœºæ™¯
        function setPreset(presetName) {
            switch(presetName) {
                case 'bacteria':
                    params.n0 = 5;
                    params.r = 0.8;
                    params.k = 800;
                    params.model = 'both';
                    break;
                case 'invasive':
                    params.n0 = 2;
                    params.r = 0.4;
                    params.k = 1500;
                    params.model = 'both';
                    break;
                case 'endangered':
                    params.n0 = 50;
                    params.r = 0.1;
                    params.k = 200;
                    params.model = 's';
                    break;
                case 'pest':
                    params.n0 = 10;
                    params.r = 0.6;
                    params.k = 300;
                    params.model = 's';
                    break;
                case 'custom':
                    // ä¿æŒå½“å‰è®¾ç½®
                    return;
            }
            
            // æ›´æ–°æ»‘å—å’Œæ˜¾ç¤º
            document.getElementById('n0Slider').value = params.n0;
            document.getElementById('n0Value').textContent = params.n0;
            document.getElementById('rSlider').value = params.r;
            document.getElementById('rValue').textContent = params.r.toFixed(2);
            document.getElementById('kSlider').value = params.k;
            document.getElementById('kValue').textContent = params.k;
            
            // æ›´æ–°æ¨¡å‹é€‰æ‹©
            document.querySelectorAll('.model-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.model === params.model) {
                    btn.classList.add('active');
                }
            });
            
            updateKLine();
            resetSimulation();
        }
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
        function initEventListeners() {
            // æ¨¡æ‹Ÿæ§åˆ¶æŒ‰é’®
            document.getElementById('startBtn').addEventListener('click', toggleSimulation);
            document.getElementById('resetBtn').addEventListener('click', resetSimulation);
            document.getElementById('stepBtn').addEventListener('click', stepSimulation);
            
            // æ»‘å—æ§åˆ¶
            document.getElementById('speedSlider').addEventListener('input', function() {
                simulationSpeed = parseInt(this.value);
                document.getElementById('speedValue').textContent = this.value + 'x';
            });
            
            document.getElementById('displaySlider').addEventListener('input', function() {
                maxDisplayIndividuals = parseInt(this.value);
                document.getElementById('displayValue').textContent = this.value;
                drawSimulation();
            });
            
            document.getElementById('n0Slider').addEventListener('input', function() {
                params.n0 = parseInt(this.value);
                document.getElementById('n0Value').textContent = this.value;
                resetSimulation();
            });
            
            document.getElementById('rSlider').addEventListener('input', function() {
                params.r = parseFloat(this.value);
                document.getElementById('rValue').textContent = params.r.toFixed(2);
                resetSimulation();
            });
            
            document.getElementById('kSlider').addEventListener('input', function() {
                params.k = parseInt(this.value);
                document.getElementById('kValue').textContent = this.value;
                updateKLine();
                resetSimulation();
            });
            
            // æ¨¡å‹é€‰æ‹©
            document.querySelectorAll('.model-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.model-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    params.model = this.dataset.model;
                    resetSimulation();
                });
            });
            
            // é¢„è®¾åœºæ™¯
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    setPreset(this.dataset.preset);
                });
            });
            
            // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°åˆå§‹åŒ–Canvas
            window.addEventListener('resize', initCanvas);
        }
        
        // åˆå§‹åŒ–åº”ç”¨
        function initApp() {
            initCanvas();
            initEventListeners();
            resetSimulation();
            
            // åˆå§‹ç»˜åˆ¶
            drawSimulation();
            drawGraph();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>