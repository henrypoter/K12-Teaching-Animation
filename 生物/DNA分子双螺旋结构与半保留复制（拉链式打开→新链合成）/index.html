<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNAåŒèºæ—‹ç»“æ„ä¸åŠä¿ç•™å¤åˆ¶æ•™å­¦åŠ¨ç”»</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0a1929 0%, #1a3a5f 100%);
            color: #e0f7ff;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            max-width: 900px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #4fc3f7, #29b6f6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            max-width: 1200px;
            width: 100%;
        }
        
        .animation-area {
            flex: 1;
            min-width: 700px;
            background: rgba(10, 25, 47, 0.8);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(41, 182, 246, 0.2);
        }
        
        .controls-panel {
            width: 300px;
            background: rgba(15, 30, 55, 0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(79, 195, 247, 0.2);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .panel-section {
            background: rgba(25, 45, 75, 0.6);
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid #29b6f6;
        }
        
        h2 {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: #4fc3f7;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        h2 i {
            font-style: normal;
            font-size: 1.2rem;
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        button {
            background: linear-gradient(135deg, #1565c0, #0d47a1);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 120px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        
        button:hover {
            background: linear-gradient(135deg, #1976d2, #1565c0);
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button.primary {
            background: linear-gradient(135deg, #29b6f6, #0288d1);
        }
        
        button.secondary {
            background: linear-gradient(135deg, #7e57c2, #5e35b1);
        }
        
        .slider-container {
            margin: 15px 0;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(79, 195, 247, 0.2);
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #29b6f6;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(41, 182, 246, 0.8);
        }
        
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #29b6f6;
        }
        
        .legend {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .color-box {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }
        
        .info-box {
            background: rgba(25, 45, 75, 0.8);
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
            border-top: 2px solid #29b6f6;
            font-size: 0.95rem;
            line-height: 1.5;
            min-height: 100px;
        }
        
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #90caf9;
        }
        
        .step {
            text-align: center;
            flex: 1;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        .step.active {
            background: rgba(41, 182, 246, 0.2);
            color: #4fc3f7;
            font-weight: bold;
        }
        
        canvas {
            display: block;
            border-radius: 10px;
            background: rgba(5, 15, 30, 0.9);
        }
        
        .footer {
            margin-top: 20px;
            text-align: center;
            font-size: 0.9rem;
            opacity: 0.7;
            max-width: 900px;
        }
        
        @media (max-width: 1100px) {
            .container {
                flex-direction: column;
                align-items: center;
            }
            
            .animation-area, .controls-panel {
                width: 100%;
                min-width: unset;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>DNAåŒèºæ—‹ç»“æ„ä¸åŠä¿ç•™å¤åˆ¶</h1>
        <p class="subtitle">äº¤äº’å¼æ•™å­¦åŠ¨ç”» - æ¢ç´¢ç”Ÿå‘½é—ä¼ å¯†ç çš„å¤åˆ¶æœºåˆ¶</p>
    </div>
    
    <div class="container">
        <div class="animation-area">
            <canvas id="dnaCanvas" width="700" height="500"></canvas>
        </div>
        
        <div class="controls-panel">
            <div class="panel-section">
                <h2><i>âš™ï¸</i> åŠ¨ç”»æ§åˆ¶</h2>
                <div class="button-group">
                    <button id="playBtn" class="primary">â–¶ï¸ æ’­æ”¾</button>
                    <button id="pauseBtn">â¸ï¸ æš‚åœ</button>
                    <button id="resetBtn">ğŸ”„ é‡ç½®</button>
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>è¿›åº¦æ§åˆ¶</span>
                        <span id="progressText">0%</span>
                    </div>
                    <input type="range" id="progressSlider" min="0" max="100" value="0">
                </div>
                
                <div class="button-group">
                    <button id="prevStepBtn">â—€ï¸ ä¸Šä¸€æ­¥</button>
                    <button id="nextStepBtn">â–¶ï¸ ä¸‹ä¸€æ­¥</button>
                </div>
                
                <div class="step-indicator">
                    <div class="step active" data-step="0">ç»“æ„</div>
                    <div class="step" data-step="1">è§£æ—‹</div>
                    <div class="step" data-step="2">å¼•ç‰©</div>
                    <div class="step" data-step="3">åˆæˆ</div>
                    <div class="step" data-step="4">è¿æ¥</div>
                    <div class="step" data-step="5">å®Œæˆ</div>
                </div>
            </div>
            
            <div class="panel-section">
                <h2><i>ğŸ‘ï¸</i> è§†è§’ä¸æ˜¾ç¤º</h2>
                <div class="button-group">
                    <button id="viewStructure" class="secondary">ğŸ”­ ç»“æ„è§†è§’</button>
                    <button id="viewReplication">ğŸ”¬ å¤åˆ¶å‰è§†è§’</button>
                </div>
                
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="highlightParent" checked>
                        <label for="highlightParent">é«˜äº®æ¯é“¾ï¼ˆåŠä¿ç•™éªŒè¯ï¼‰</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="showEnzymes" checked>
                        <label for="showEnzymes">æ˜¾ç¤ºé…¶ä¸åˆ†å­</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="showLabels" checked>
                        <label for="showLabels">æ˜¾ç¤ºæ ‡ç­¾</label>
                    </div>
                </div>
            </div>
            
            <div class="panel-section">
                <h2><i>ğŸ¨</i> å›¾ä¾‹</h2>
                <div class="legend">
                    <div class="legend-item">
                        <div class="color-box" style="background-color: #cccccc;"></div>
                        <span>DNAéª¨æ¶</span>
                    </div>
                    <div class="legend-item">
                        <div class="color-box" style="background-color: #ff5252;"></div>
                        <span>è…ºå˜Œå‘¤ (A)</span>
                    </div>
                    <div class="legend-item">
                        <div class="color-box" style="background-color: #ffeb3b;"></div>
                        <span>èƒ¸è…ºå˜§å•¶ (T)</span>
                    </div>
                    <div class="legend-item">
                        <div class="color-box" style="background-color: #448aff;"></div>
                        <span>é¸Ÿå˜Œå‘¤ (G)</span>
                    </div>
                    <div class="legend-item">
                        <div class="color-box" style="background-color: #69f0ae;"></div>
                        <span>èƒå˜§å•¶ (C)</span>
                    </div>
                    <div class="legend-item">
                        <div class="color-box" style="background-color: #ff9800;"></div>
                        <span>è§£æ—‹é…¶</span>
                    </div>
                    <div class="legend-item">
                        <div class="color-box" style="background-color: #b388ff;"></div>
                        <span>DNAèšåˆé…¶</span>
                    </div>
                    <div class="legend-item">
                        <div class="color-box" style="background-color: #8d6e63;"></div>
                        <span>RNAå¼•ç‰©</span>
                    </div>
                </div>
            </div>
            
            <div class="panel-section">
                <h2><i>â„¹ï¸</i> å½“å‰æ­¥éª¤è¯´æ˜</h2>
                <div class="info-box" id="infoText">
                    è§‚å¯Ÿå®Œæ•´çš„DNAåŒèºæ—‹ç»“æ„ã€‚æ³¨æ„ä¸¤æ¡åå‘å¹³è¡Œçš„é“¾ï¼Œä»¥åŠA-Tã€G-Cç¢±åŸºå¯¹çš„äº’è¡¥é…å¯¹ã€‚
                </div>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>æ•™å­¦åŠ¨ç”»è®¾è®¡ï¼šDNAåŠä¿ç•™å¤åˆ¶è¿‡ç¨‹ | äº¤äº’å¼ç”Ÿç‰©å­¦æ•™å­¦å·¥å…· | ä½¿ç”¨HTML5 Canvaså®ç°</p>
    </div>

    <script>
        // è·å–Canvaså’Œä¸Šä¸‹æ–‡
        const canvas = document.getElementById('dnaCanvas');
        const ctx = canvas.getContext('2d');
        
        // åŠ¨ç”»çŠ¶æ€
        let animationState = {
            currentStep: 0, // 0:ç»“æ„, 1:è§£æ—‹, 2:å¼•ç‰©, 3:åˆæˆ, 4:è¿æ¥, 5:å®Œæˆ
            progress: 0, // å½“å‰æ­¥éª¤å†…çš„è¿›åº¦ 0-100
            isPlaying: false,
            viewMode: 'structure', // 'structure' æˆ– 'replication'
            highlightParent: true,
            showEnzymes: true,
            showLabels: true
        };
        
        // DNAæ•°æ®
        const dnaData = {
            basePairs: 20, // ç¢±åŸºå¯¹æ•°é‡
            helixRadius: 100, // èºæ—‹åŠå¾„
            baseSpacing: 15, // ç¢±åŸºå¯¹é—´è·
            twistAngle: Math.PI / 10, // æ¯å¯¹ç¢±åŸºçš„æ—‹è½¬è§’åº¦
            replicationStart: 10, // å¤åˆ¶èµ·å§‹ä½ç½®ï¼ˆç¢±åŸºå¯¹ç´¢å¼•ï¼‰
            replicationProgress: 0, // å¤åˆ¶è¿›åº¦ 0-1
            newStrandProgress: 0 // æ–°é“¾åˆæˆè¿›åº¦ 0-1
        };
        
        // é¢œè‰²å®šä¹‰
        const colors = {
            backbone: '#cccccc',
            adenine: '#ff5252',
            thymine: '#ffeb3b',
            guanine: '#448aff',
            cytosine: '#69f0ae',
            newAdenine: '#ff8a80',
            newThymine: '#fff59d',
            newGuanine: '#82b1ff',
            newCytosine: '#b9f6ca',
            helicase: '#ff9800',
            polymerase: '#b388ff',
            primer: '#8d6e63',
            background: '#050f1e'
        };
        
        // é…¶å’Œåˆ†å­ä½ç½®
        const enzymes = {
            helicase: { x: 0, y: 0, active: false },
            polymeraseLeading: { x: 0, y: 0, active: false },
            polymeraseLagging: { x: 0, y: 0, active: false },
            primers: [],
            nucleotides: []
        };
        
        // æ­¥éª¤ä¿¡æ¯
        const stepInfo = [
            "è§‚å¯Ÿå®Œæ•´çš„DNAåŒèºæ—‹ç»“æ„ã€‚æ³¨æ„ä¸¤æ¡åå‘å¹³è¡Œçš„é“¾ï¼Œä»¥åŠA-Tã€G-Cç¢±åŸºå¯¹çš„äº’è¡¥é…å¯¹ã€‚",
            "è§£æ—‹é…¶ç»“åˆåˆ°DNAä¸Šï¼Œåƒæ‹‰é“¾ä¸€æ ·æ‰“å¼€åŒèºæ—‹ç»“æ„ï¼Œå½¢æˆå¤åˆ¶å‰ã€‚æ°¢é”®æ–­è£‚ï¼Œä¸¤æ¡é“¾åˆ†ç¦»ã€‚",
            "RNAå¼•ç‰©ç»“åˆåˆ°æ¯æ¡æ¨¡æ¿é“¾çš„èµ·å§‹ä½ç½®ï¼Œä¸ºDNAèšåˆé…¶æä¾›èµ·å§‹ç‚¹ã€‚å¼•ç‰©ç”±å¼•ç‰©é…¶åˆæˆã€‚",
            "DNAèšåˆé…¶ä»¥æ¯æ¡æ¯é“¾ä¸ºæ¨¡æ¿ï¼ŒæŒ‰ç…§ç¢±åŸºäº’è¡¥é…å¯¹åŸåˆ™ï¼ˆA-T, G-Cï¼‰æ·»åŠ æ–°çš„æ ¸è‹·é…¸ï¼Œåˆæˆæ–°é“¾ã€‚é¢†å¤´é“¾è¿ç»­åˆæˆï¼Œæ»åé“¾ä¸è¿ç»­åˆæˆï¼ˆå†ˆå´ç‰‡æ®µï¼‰ã€‚",
            "DNAè¿æ¥é…¶å°†æ»åé“¾ä¸Šçš„å†ˆå´ç‰‡æ®µè¿æ¥èµ·æ¥ï¼Œå½¢æˆå®Œæ•´çš„æ–°é“¾ã€‚åŒæ—¶RNAå¼•ç‰©è¢«å»é™¤å¹¶æ›¿æ¢ä¸ºDNAã€‚",
            "å¤åˆ¶å®Œæˆï¼ç”Ÿæˆä¸¤ä¸ªå®Œå…¨ç›¸åŒçš„DNAåˆ†å­ï¼Œæ¯ä¸ªåˆ†å­åŒ…å«ä¸€æ¡æ¯é“¾å’Œä¸€æ¡æ–°é“¾ï¼Œè¿™å°±æ˜¯åŠä¿ç•™å¤åˆ¶ã€‚"
        ];
        
        // åˆå§‹åŒ–
        function init() {
            updateStepIndicator();
            updateInfoText();
            generateRandomBases();
            generateNucleotides();
            draw();
            
            // è®¾ç½®åŠ¨ç”»å¾ªç¯
            requestAnimationFrame(animate);
        }
        
        // ç”Ÿæˆéšæœºç¢±åŸºåºåˆ—
        function generateRandomBases() {
            dnaData.bases = [];
            for (let i = 0; i < dnaData.basePairs; i++) {
                // éšæœºé€‰æ‹©ç¢±åŸºå¯¹
                const pairType = Math.floor(Math.random() * 2); // 0: A-T, 1: G-C
                dnaData.bases.push({
                    type: pairType,
                    opened: false,
                    newBase1: null, // ç¬¬ä¸€æ¡æ–°é“¾ä¸Šçš„ç¢±åŸº
                    newBase2: null  // ç¬¬äºŒæ¡æ–°é“¾ä¸Šçš„ç¢±åŸº
                });
            }
        }
        
        // ç”Ÿæˆæ¸¸ç¦»æ ¸è‹·é…¸
        function generateNucleotides() {
            enzymes.nucleotides = [];
            const nucleotideCount = 30;
            
            for (let i = 0; i < nucleotideCount; i++) {
                const type = Math.floor(Math.random() * 4); // 0:A, 1:T, 2:G, 3:C
                let color;
                switch(type) {
                    case 0: color = colors.adenine; break;
                    case 1: color = colors.thymine; break;
                    case 2: color = colors.guanine; break;
                    case 3: color = colors.cytosine; break;
                }
                
                enzymes.nucleotides.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    type: type,
                    color: color,
                    targetX: 0,
                    targetY: 0,
                    moving: false,
                    used: false
                });
            }
        }
        
        // ç»˜åˆ¶DNA
        function draw() {
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶èƒŒæ™¯
            ctx.fillStyle = colors.background;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // æ ¹æ®è§†è§’æ¨¡å¼è°ƒæ•´ç»˜åˆ¶
            if (animationState.viewMode === 'structure') {
                drawDNAStructure();
            } else {
                drawReplicationFork();
            }
            
            // ç»˜åˆ¶é…¶å’Œåˆ†å­
            if (animationState.showEnzymes) {
                drawEnzymesAndMolecules();
            }
            
            // ç»˜åˆ¶æ ‡ç­¾
            if (animationState.showLabels) {
                drawLabels();
            }
        }
        
        // ç»˜åˆ¶DNAç»“æ„
        function drawDNAStructure() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            // è®¡ç®—å½“å‰å¤åˆ¶è¿›åº¦å¯¹åº”çš„ç¢±åŸºå¯¹
            const replicationIndex = dnaData.replicationStart + 
                Math.floor(dnaData.replicationProgress * (dnaData.basePairs - dnaData.replicationStart));
            
            // ç»˜åˆ¶æ¯æ¡é“¾çš„éª¨æ¶
            for (let chain = 0; chain < 2; chain++) {
                ctx.beginPath();
                ctx.strokeStyle = colors.backbone;
                ctx.lineWidth = 3;
                
                for (let i = 0; i < dnaData.basePairs; i++) {
                    const angle = i * dnaData.twistAngle;
                    const radius = dnaData.helixRadius;
                    const x = centerX + (chain === 0 ? radius : -radius) * Math.cos(angle);
                    const y = centerY + i * dnaData.baseSpacing - (dnaData.basePairs * dnaData.baseSpacing) / 2;
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                    
                    // ç»˜åˆ¶ç¢±åŸº
                    if (i < dnaData.bases.length) {
                        const base = dnaData.bases[i];
                        
                        // è®¡ç®—é…å¯¹ç¢±åŸºçš„ä½ç½®
                        const pairAngle = angle + (chain === 0 ? Math.PI : 0);
                        const pairX = centerX + (chain === 0 ? -radius : radius) * Math.cos(pairAngle);
                        const pairY = y;
                        
                        // ç»˜åˆ¶ç¢±åŸºå¯¹è¿æ¥çº¿
                        if (!base.opened || i > replicationIndex) {
                            ctx.save();
                            ctx.beginPath();
                            ctx.moveTo(x, y);
                            ctx.lineTo(pairX, pairY);
                            
                            // æ ¹æ®ç¢±åŸºç±»å‹è®¾ç½®é¢œè‰²
                            let baseColor;
                            if (base.type === 0) { // A-T
                                baseColor = chain === 0 ? colors.adenine : colors.thymine;
                            } else { // G-C
                                baseColor = chain === 0 ? colors.guanine : colors.cytosine;
                            }
                            
                            // å¦‚æœæ˜¯æ–°åˆæˆçš„ç¢±åŸºï¼Œä½¿ç”¨è¾ƒæµ…çš„é¢œè‰²
                            if (base.newBase1 !== null || base.newBase2 !== null) {
                                if (chain === 0 && base.newBase1 !== null) {
                                    baseColor = base.newBase1 === 0 ? colors.newAdenine : colors.newGuanine;
                                } else if (chain === 1 && base.newBase2 !== null) {
                                    baseColor = base.newBase2 === 1 ? colors.newThymine : colors.newCytosine;
                                }
                            }
                            
                            // å¦‚æœé«˜äº®æ¯é“¾ï¼Œæ–°é“¾å˜æ·¡
                            if (animationState.highlightParent && 
                                (base.newBase1 !== null || base.newBase2 !== null)) {
                                ctx.globalAlpha = 0.4;
                            }
                            
                            ctx.strokeStyle = baseColor;
                            ctx.lineWidth = 2;
                            ctx.stroke();
                            ctx.restore();
                        }
                        
                        // åœ¨ç¢±åŸºä½ç½®ç»˜åˆ¶å°åœ†ç‚¹
                        ctx.save();
                        ctx.beginPath();
                        ctx.arc(x, y, 4, 0, Math.PI * 2);
                        
                        let dotColor;
                        if (base.type === 0) { // A-T
                            dotColor = chain === 0 ? colors.adenine : colors.thymine;
                        } else { // G-C
                            dotColor = chain === 0 ? colors.guanine : colors.cytosine;
                        }
                        
                        // å¦‚æœæ˜¯æ–°åˆæˆçš„ç¢±åŸºï¼Œä½¿ç”¨è¾ƒæµ…çš„é¢œè‰²
                        if (base.newBase1 !== null || base.newBase2 !== null) {
                            if (chain === 0 && base.newBase1 !== null) {
                                dotColor = base.newBase1 === 0 ? colors.newAdenine : colors.newGuanine;
                            } else if (chain === 1 && base.newBase2 !== null) {
                                dotColor = base.newBase2 === 1 ? colors.newThymine : colors.newCytosine;
                            }
                        }
                        
                        // å¦‚æœé«˜äº®æ¯é“¾ï¼Œæ–°é“¾å˜æ·¡
                        if (animationState.highlightParent && 
                            (base.newBase1 !== null || base.newBase2 !== null)) {
                            ctx.globalAlpha = 0.4;
                        }
                        
                        ctx.fillStyle = dotColor;
                        ctx.fill();
                        ctx.restore();
                    }
                }
                
                ctx.stroke();
            }
            
            // ç»˜åˆ¶è§£æ—‹é…¶
            if (animationState.currentStep >= 1 && animationState.currentStep <= 3) {
                const enzymeY = centerY + replicationIndex * dnaData.baseSpacing - 
                    (dnaData.basePairs * dnaData.baseSpacing) / 2;
                const enzymeX = centerX;
                
                enzymes.helicase.x = enzymeX;
                enzymes.helicase.y = enzymeY;
                enzymes.helicase.active = true;
            }
            
            // ç»˜åˆ¶èšåˆé…¶
            if (animationState.currentStep >= 3 && animationState.currentStep <= 4) {
                const leadingY = centerY + (replicationIndex - 2) * dnaData.baseSpacing - 
                    (dnaData.basePairs * dnaData.baseSpacing) / 2;
                const laggingY = centerY + (replicationIndex - 8) * dnaData.baseSpacing - 
                    (dnaData.basePairs * dnaData.baseSpacing) / 2;
                
                enzymes.polymeraseLeading.x = centerX - 120;
                enzymes.polymeraseLeading.y = leadingY;
                enzymes.polymeraseLeading.active = true;
                
                enzymes.polymeraseLagging.x = centerX + 120;
                enzymes.polymeraseLagging.y = laggingY;
                enzymes.polymeraseLagging.active = true;
            }
        }
        
        // ç»˜åˆ¶å¤åˆ¶å‰
        function drawReplicationFork() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            // è®¡ç®—å¤åˆ¶å‰ä½ç½®
            const forkIndex = dnaData.replicationStart + 
                Math.floor(dnaData.replicationProgress * (dnaData.basePairs - dnaData.replicationStart));
            const forkY = centerY;
            
            // ç»˜åˆ¶æ¯é“¾
            ctx.strokeStyle = colors.backbone;
            ctx.lineWidth = 3;
            
            // å·¦ä¾§æ¯é“¾ï¼ˆ3'â†’5'æ–¹å‘ï¼‰
            ctx.beginPath();
            ctx.moveTo(centerX - 200, forkY - 100);
            ctx.lineTo(centerX - 50, forkY);
            ctx.stroke();
            
            // å³ä¾§æ¯é“¾ï¼ˆ5'â†’3'æ–¹å‘ï¼‰
            ctx.beginPath();
            ctx.moveTo(centerX + 200, forkY - 100);
            ctx.lineTo(centerX + 50, forkY);
            ctx.stroke();
            
            // ç»˜åˆ¶æ‰“å¼€çš„ç¢±åŸºå¯¹
            const visiblePairs = 8;
            for (let i = 0; i < visiblePairs; i++) {
                const y = forkY - i * 15;
                const opened = i < forkIndex - dnaData.replicationStart;
                
                // å·¦ä¾§ç¢±åŸº
                const leftX = centerX - 50 - i * 5;
                ctx.beginPath();
                ctx.arc(leftX, y, 4, 0, Math.PI * 2);
                
                // æ ¹æ®ä½ç½®ç¡®å®šç¢±åŸºç±»å‹
                const baseIndex = forkIndex - i;
                let baseColor = colors.adenine;
                if (baseIndex < dnaData.bases.length && baseIndex >= 0) {
                    const base = dnaData.bases[baseIndex];
                    baseColor = base.type === 0 ? colors.adenine : colors.guanine;
                }
                
                ctx.fillStyle = baseColor;
                ctx.fill();
                
                // å³ä¾§ç¢±åŸº
                const rightX = centerX + 50 + i * 5;
                ctx.beginPath();
                ctx.arc(rightX, y, 4, 0, Math.PI * 2);
                
                let pairColor = colors.thymine;
                if (baseIndex < dnaData.bases.length && baseIndex >= 0) {
                    const base = dnaData.bases[baseIndex];
                    pairColor = base.type === 0 ? colors.thymine : colors.cytosine;
                }
                
                ctx.fillStyle = pairColor;
                ctx.fill();
                
                // å¦‚æœæœªæ‰“å¼€ï¼Œç»˜åˆ¶è¿æ¥çº¿
                if (!opened) {
                    ctx.beginPath();
                    ctx.moveTo(leftX, y);
                    ctx.lineTo(rightX, y);
                    ctx.strokeStyle = baseColor;
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            }
            
            // ç»˜åˆ¶æ–°é“¾
            if (animationState.currentStep >= 3) {
                const newStrandLength = Math.floor(dnaData.newStrandProgress * visiblePairs);
                
                // é¢†å¤´é“¾ï¼ˆè¿ç»­åˆæˆï¼‰
                ctx.strokeStyle = colors.backbone;
                ctx.lineWidth = 3;
                ctx.setLineDash([]);
                ctx.beginPath();
                ctx.moveTo(centerX - 50, forkY);
                
                for (let i = 0; i < newStrandLength; i++) {
                    const y = forkY - i * 15;
                    const x = centerX - 70 - i * 5;
                    ctx.lineTo(x, y);
                    
                    // ç»˜åˆ¶æ–°ç¢±åŸº
                    ctx.beginPath();
                    ctx.arc(x, y, 4, 0, Math.PI * 2);
                    
                    // æ ¹æ®æ¯é“¾ç¢±åŸºç¡®å®šæ–°ç¢±åŸº
                    const baseIndex = forkIndex - i;
                    let newBaseColor = colors.newThymine;
                    if (baseIndex < dnaData.bases.length && baseIndex >= 0) {
                        const base = dnaData.bases[baseIndex];
                        newBaseColor = base.type === 0 ? colors.newThymine : colors.newCytosine;
                    }
                    
                    // å¦‚æœé«˜äº®æ¯é“¾ï¼Œæ–°é“¾å˜æ·¡
                    if (animationState.highlightParent) {
                        ctx.globalAlpha = 0.4;
                    }
                    
                    ctx.fillStyle = newBaseColor;
                    ctx.fill();
                    ctx.globalAlpha = 1.0;
                }
                ctx.stroke();
                
                // æ»åé“¾ï¼ˆå†ˆå´ç‰‡æ®µï¼‰
                if (newStrandLength >= 3) {
                    const fragmentLength = Math.min(3, newStrandLength - 2);
                    
                    ctx.setLineDash([5, 3]);
                    ctx.beginPath();
                    const startY = forkY - 2 * 15;
                    ctx.moveTo(centerX + 70, startY);
                    
                    for (let i = 0; i < fragmentLength; i++) {
                        const y = startY - i * 15;
                        const x = centerX + 90 + i * 5;
                        ctx.lineTo(x, y);
                        
                        // ç»˜åˆ¶æ–°ç¢±åŸº
                        ctx.beginPath();
                        ctx.arc(x, y, 4, 0, Math.PI * 2);
                        
                        // æ ¹æ®æ¯é“¾ç¢±åŸºç¡®å®šæ–°ç¢±åŸº
                        const baseIndex = forkIndex - 2 - i;
                        let newBaseColor = colors.newAdenine;
                        if (baseIndex < dnaData.bases.length && baseIndex >= 0) {
                            const base = dnaData.bases[baseIndex];
                            newBaseColor = base.type === 0 ? colors.newAdenine : colors.newGuanine;
                        }
                        
                        // å¦‚æœé«˜äº®æ¯é“¾ï¼Œæ–°é“¾å˜æ·¡
                        if (animationState.highlightParent) {
                            ctx.globalAlpha = 0.4;
                        }
                        
                        ctx.fillStyle = newBaseColor;
                        ctx.fill();
                        ctx.globalAlpha = 1.0;
                    }
                    ctx.stroke();
                    ctx.setLineDash([]);
                }
            }
            
            // è®¾ç½®é…¶ä½ç½®
            enzymes.helicase.x = centerX;
            enzymes.helicase.y = forkY;
            enzymes.helicase.active = animationState.currentStep >= 1 && animationState.currentStep <= 3;
            
            enzymes.polymeraseLeading.x = centerX - 100;
            enzymes.polymeraseLeading.y = forkY - 30;
            enzymes.polymeraseLeading.active = animationState.currentStep >= 3 && animationState.currentStep <= 4;
            
            enzymes.polymeraseLagging.x = centerX + 100;
            enzymes.polymeraseLagging.y = forkY - 60;
            enzymes.polymeraseLagging.active = animationState.currentStep >= 3 && animationState.currentStep <= 4;
        }
        
        // ç»˜åˆ¶é…¶å’Œåˆ†å­
        function drawEnzymesAndMolecules() {
            // ç»˜åˆ¶è§£æ—‹é…¶
            if (enzymes.helicase.active) {
                ctx.save();
                ctx.translate(enzymes.helicase.x, enzymes.helicase.y);
                
                // ç»˜åˆ¶é…¶ä¸»ä½“
                ctx.fillStyle = colors.helicase;
                ctx.beginPath();
                ctx.arc(0, 0, 15, 0, Math.PI * 2);
                ctx.fill();
                
                // ç»˜åˆ¶é…¶å›¾æ ‡
                ctx.fillStyle = 'white';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('H', 0, 0);
                
                ctx.restore();
                
                // ç»˜åˆ¶æ ‡ç­¾
                if (animationState.showLabels) {
                    ctx.fillStyle = 'white';
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('è§£æ—‹é…¶', enzymes.helicase.x, enzymes.helicase.y + 25);
                }
            }
            
            // ç»˜åˆ¶DNAèšåˆé…¶ï¼ˆé¢†å¤´é“¾ï¼‰
            if (enzymes.polymeraseLeading.active) {
                ctx.save();
                ctx.translate(enzymes.polymeraseLeading.x, enzymes.polymeraseLeading.y);
                
                // ç»˜åˆ¶é…¶ä¸»ä½“
                ctx.fillStyle = colors.polymerase;
                ctx.beginPath();
                ctx.arc(0, 0, 15, 0, Math.PI * 2);
                ctx.fill();
                
                // ç»˜åˆ¶é…¶å›¾æ ‡
                ctx.fillStyle = 'white';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('P', 0, 0);
                
                ctx.restore();
                
                // ç»˜åˆ¶æ ‡ç­¾
                if (animationState.showLabels) {
                    ctx.fillStyle = 'white';
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('èšåˆé…¶', enzymes.polymeraseLeading.x, enzymes.polymeraseLeading.y + 25);
                }
            }
            
            // ç»˜åˆ¶DNAèšåˆé…¶ï¼ˆæ»åé“¾ï¼‰
            if (enzymes.polymeraseLagging.active) {
                ctx.save();
                ctx.translate(enzymes.polymeraseLagging.x, enzymes.polymeraseLagging.y);
                
                // ç»˜åˆ¶é…¶ä¸»ä½“
                ctx.fillStyle = colors.polymerase;
                ctx.beginPath();
                ctx.arc(0, 0, 15, 0, Math.PI * 2);
                ctx.fill();
                
                // ç»˜åˆ¶é…¶å›¾æ ‡
                ctx.fillStyle = 'white';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('P', 0, 0);
                
                ctx.restore();
                
                // ç»˜åˆ¶æ ‡ç­¾
                if (animationState.showLabels) {
                    ctx.fillStyle = 'white';
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('èšåˆé…¶', enzymes.polymeraseLagging.x, enzymes.polymeraseLagging.y + 25);
                }
            }
            
            // ç»˜åˆ¶æ¸¸ç¦»æ ¸è‹·é…¸
            if (animationState.currentStep >= 3 && animationState.currentStep <= 4) {
                enzymes.nucleotides.forEach((nucleotide, index) => {
                    if (!nucleotide.used) {
                        // è®©ä¸€äº›æ ¸è‹·é…¸ç§»åŠ¨å‘èšåˆé…¶
                        if (index < 5 && Math.random() < 0.05) {
                            nucleotide.moving = true;
                            nucleotide.targetX = enzymes.polymeraseLeading.x;
                            nucleotide.targetY = enzymes.polymeraseLeading.y;
                        } else if (index >= 5 && index < 10 && Math.random() < 0.05) {
                            nucleotide.moving = true;
                            nucleotide.targetX = enzymes.polymeraseLagging.x;
                            nucleotide.targetY = enzymes.polymeraseLagging.y;
                        }
                        
                        // æ›´æ–°ä½ç½®
                        if (nucleotide.moving) {
                            const dx = nucleotide.targetX - nucleotide.x;
                            const dy = nucleotide.targetY - nucleotide.y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            if (distance < 5) {
                                nucleotide.used = true;
                            } else {
                                nucleotide.x += dx * 0.05;
                                nucleotide.y += dy * 0.05;
                            }
                        }
                        
                        // ç»˜åˆ¶æ ¸è‹·é…¸
                        ctx.save();
                        ctx.fillStyle = nucleotide.color;
                        ctx.beginPath();
                        ctx.arc(nucleotide.x, nucleotide.y, 6, 0, Math.PI * 2);
                        ctx.fill();
                        
                        // ç»˜åˆ¶æ ¸è‹·é…¸ç±»å‹
                        ctx.fillStyle = 'white';
                        ctx.font = '10px Arial';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        
                        let baseLetter = 'A';
                        switch(nucleotide.type) {
                            case 0: baseLetter =
<!--æ£€æµ‹åˆ°ä»£ç æˆªæ–­ï¼Œè‡ªåŠ¨ç»­å†™ä¸­...-->
'A'; break;
                            case 1: baseLetter = 'T'; break;
                            case 2: baseLetter = 'G'; break;
                            case 3: baseLetter = 'C'; break;
                        }
                        
                        ctx.fillText(baseLetter, nucleotide.x, nucleotide.y);
                        ctx.restore();
                    }
                });
            }
        }
        
        // ç»˜åˆ¶æ ‡ç­¾
        function drawLabels() {
            if (animationState.viewMode === 'structure') {
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                
                // ç»˜åˆ¶æ–¹å‘æ ‡ç­¾
                ctx.fillStyle = '#90caf9';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                
                // 5' å’Œ 3' æ ‡ç­¾
                const topY = centerY - (dnaData.basePairs * dnaData.baseSpacing) / 2;
                const bottomY = centerY + (dnaData.basePairs * dnaData.baseSpacing) / 2;
                
                ctx.fillText("5'", centerX - dnaData.helixRadius - 20, topY);
                ctx.fillText("3'", centerX - dnaData.helixRadius - 20, bottomY);
                ctx.fillText("3'", centerX + dnaData.helixRadius + 20, topY);
                ctx.fillText("5'", centerX + dnaData.helixRadius + 20, bottomY);
                
                // ç»˜åˆ¶å¤§æ²Ÿå°æ²Ÿæ ‡ç­¾
                ctx.fillStyle = '#80deea';
                ctx.font = '12px Arial';
                ctx.fillText('å¤§æ²Ÿ', centerX, centerY - 60);
                ctx.fillText('å°æ²Ÿ', centerX, centerY + 40);
            } else {
                // å¤åˆ¶å‰è§†è§’çš„æ ‡ç­¾
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                
                ctx.fillStyle = '#90caf9';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                
                // æ¯é“¾æ–¹å‘
                ctx.fillText("3'", centerX - 220, centerY - 100);
                ctx.fillText("5'", centerX - 30, centerY + 10);
                ctx.fillText("5'", centerX + 220, centerY - 100);
                ctx.fillText("3'", centerX + 30, centerY + 10);
                
                // æ–°é“¾æ–¹å‘
                if (animationState.currentStep >= 3) {
                    ctx.fillText("5'", centerX - 30, centerY + 10);
                    ctx.fillText("3'", centerX - 90, centerY - 100);
                    ctx.fillText("5'", centerX + 110, centerY - 40);
                    ctx.fillText("3'", centerX + 130, centerY - 90);
                }
                
                // å¤åˆ¶å‰æ ‡ç­¾
                ctx.fillStyle = '#ffcc80';
                ctx.fillText('å¤åˆ¶å‰', centerX, centerY + 5);
            }
        }
        
        // åŠ¨ç”»å¾ªç¯
        function animate() {
            if (animationState.isPlaying) {
                // æ›´æ–°è¿›åº¦
                animationState.progress += 0.5;
                
                if (animationState.progress >= 100) {
                    animationState.progress = 0;
                    
                    // è¿›å…¥ä¸‹ä¸€æ­¥
                    if (animationState.currentStep < 5) {
                        animationState.currentStep++;
                        updateStepIndicator();
                        updateInfoText();
                        
                        // æ›´æ–°DNAæ•°æ®
                        updateDNAData();
                    } else {
                        // å¦‚æœå·²ç»æ˜¯æœ€åä¸€æ­¥ï¼Œåœæ­¢æ’­æ”¾
                        animationState.isPlaying = false;
                        document.getElementById('playBtn').textContent = 'â–¶ï¸ æ’­æ”¾';
                    }
                }
                
                // æ›´æ–°DNAæ•°æ®
                updateDNAData();
                
                // æ›´æ–°è¿›åº¦æ˜¾ç¤º
                updateProgressDisplay();
            }
            
            // é‡ç»˜ç”»å¸ƒ
            draw();
            
            // ç»§ç»­åŠ¨ç”»å¾ªç¯
            requestAnimationFrame(animate);
        }
        
        // æ›´æ–°DNAæ•°æ®
        function updateDNAData() {
            // æ ¹æ®å½“å‰æ­¥éª¤å’Œè¿›åº¦æ›´æ–°DNAçŠ¶æ€
            switch(animationState.currentStep) {
                case 0: // ç»“æ„å±•ç¤º
                    dnaData.replicationProgress = 0;
                    dnaData.newStrandProgress = 0;
                    // é‡ç½®æ‰€æœ‰ç¢±åŸºä¸ºæœªæ‰“å¼€
                    dnaData.bases.forEach(base => {
                        base.opened = false;
                        base.newBase1 = null;
                        base.newBase2 = null;
                    });
                    break;
                    
                case 1: // è§£æ—‹
                    dnaData.replicationProgress = animationState.progress / 100;
                    // æ‰“å¼€ç¢±åŸºå¯¹
                    const openIndex = dnaData.replicationStart + 
                        Math.floor(dnaData.replicationProgress * (dnaData.basePairs - dnaData.replicationStart));
                    
                    for (let i = 0; i < dnaData.bases.length; i++) {
                        dnaData.bases[i].opened = i < openIndex;
                    }
                    break;
                    
                case 2: // å¼•ç‰©
                    dnaData.replicationProgress = 0.3;
                    // ä¿æŒç¢±åŸºå¯¹æ‰“å¼€çŠ¶æ€
                    const primerIndex = dnaData.replicationStart + 3;
                    for (let i = 0; i < dnaData.bases.length; i++) {
                        dnaData.bases[i].opened = i < primerIndex;
                    }
                    break;
                    
                case 3: // åˆæˆ
                    dnaData.replicationProgress = 0.3 + (animationState.progress / 100) * 0.4;
                    dnaData.newStrandProgress = animationState.progress / 100;
                    
                    // æ‰“å¼€æ›´å¤šç¢±åŸºå¯¹
                    const synthesisIndex = dnaData.replicationStart + 
                        Math.floor(dnaData.replicationProgress * (dnaData.basePairs - dnaData.replicationStart));
                    
                    for (let i = 0; i < dnaData.bases.length; i++) {
                        dnaData.bases[i].opened = i < synthesisIndex;
                        
                        // æ·»åŠ æ–°åˆæˆçš„ç¢±åŸº
                        if (i < synthesisIndex - 2) {
                            // ç¬¬ä¸€æ¡æ–°é“¾ï¼ˆå¯¹åº”å³ä¾§æ¯é“¾ï¼‰
                            if (dnaData.bases[i].newBase1 === null) {
                                dnaData.bases[i].newBase1 = dnaData.bases[i].type === 0 ? 1 : 3; // Aâ†’T, Gâ†’C
                            }
                            
                            // ç¬¬äºŒæ¡æ–°é“¾ï¼ˆå¯¹åº”å·¦ä¾§æ¯é“¾ï¼‰
                            if (i < synthesisIndex - 5 && dnaData.bases[i].newBase2 === null) {
                                dnaData.bases[i].newBase2 = dnaData.bases[i].type === 0 ? 0 : 2; // Tâ†’A, Câ†’G
                            }
                        }
                    }
                    break;
                    
                case 4: // è¿æ¥
                    dnaData.replicationProgress = 0.7 + (animationState.progress / 100) * 0.2;
                    dnaData.newStrandProgress = 1.0;
                    
                    // æ‰€æœ‰ç¢±åŸºå¯¹éƒ½æ‰“å¼€
                    const connectIndex = dnaData.replicationStart + 
                        Math.floor(dnaData.replicationProgress * (dnaData.basePairs - dnaData.replicationStart));
                    
                    for (let i = 0; i < dnaData.bases.length; i++) {
                        dnaData.bases[i].opened = i < connectIndex;
                        
                        // ç¡®ä¿æ‰€æœ‰ç¢±åŸºéƒ½æœ‰æ–°é“¾
                        if (i < connectIndex - 2) {
                            dnaData.bases[i].newBase1 = dnaData.bases[i].type === 0 ? 1 : 3;
                            dnaData.bases[i].newBase2 = dnaData.bases[i].type === 0 ? 0 : 2;
                        }
                    }
                    break;
                    
                case 5: // å®Œæˆ
                    dnaData.replicationProgress = 1.0;
                    dnaData.newStrandProgress = 1.0;
                    
                    // æ‰€æœ‰ç¢±åŸºå¯¹éƒ½æ‰“å¼€ä¸”éƒ½æœ‰æ–°é“¾
                    for (let i = 0; i < dnaData.bases.length; i++) {
                        dnaData.bases[i].opened = i >= dnaData.replicationStart;
                        
                        if (i >= dnaData.replicationStart) {
                            dnaData.bases[i].newBase1 = dnaData.bases[i].type === 0 ? 1 : 3;
                            dnaData.bases[i].newBase2 = dnaData.bases[i].type === 0 ? 0 : 2;
                        }
                    }
                    break;
            }
        }
        
        // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
        function updateStepIndicator() {
            document.querySelectorAll('.step').forEach((step, index) => {
                if (index === animationState.currentStep) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });
        }
        
        // æ›´æ–°ä¿¡æ¯æ–‡æœ¬
        function updateInfoText() {
            document.getElementById('infoText').textContent = stepInfo[animationState.currentStep];
        }
        
        // æ›´æ–°è¿›åº¦æ˜¾ç¤º
        function updateProgressDisplay() {
            const totalProgress = animationState.currentStep * 100 + animationState.progress;
            const maxProgress = 5 * 100;
            const percent = Math.floor((totalProgress / maxProgress) * 100);
            
            document.getElementById('progressText').textContent = `${percent}%`;
            document.getElementById('progressSlider').value = percent;
        }
        
        // äº‹ä»¶ç›‘å¬å™¨
        document.getElementById('playBtn').addEventListener('click', function() {
            animationState.isPlaying = !animationState.isPlaying;
            this.textContent = animationState.isPlaying ? 'â¸ï¸ æš‚åœ' : 'â–¶ï¸ æ’­æ”¾';
        });
        
        document.getElementById('pauseBtn').addEventListener('click', function() {
            animationState.isPlaying = false;
            document.getElementById('playBtn').textContent = 'â–¶ï¸ æ’­æ”¾';
        });
        
        document.getElementById('resetBtn').addEventListener('click', function() {
            animationState.isPlaying = false;
            animationState.currentStep = 0;
            animationState.progress = 0;
            animationState.viewMode = 'structure';
            
            document.getElementById('playBtn').textContent = 'â–¶ï¸ æ’­æ”¾';
            updateStepIndicator();
            updateInfoText();
            updateDNAData();
            updateProgressDisplay();
            generateNucleotides();
        });
        
        document.getElementById('prevStepBtn').addEventListener('click', function() {
            if (animationState.currentStep > 0) {
                animationState.currentStep--;
                animationState.progress = 0;
                updateStepIndicator();
                updateInfoText();
                updateDNAData();
                updateProgressDisplay();
            }
        });
        
        document.getElementById('nextStepBtn').addEventListener('click', function() {
            if (animationState.currentStep < 5) {
                animationState.currentStep++;
                animationState.progress = 0;
                updateStepIndicator();
                updateInfoText();
                updateDNAData();
                updateProgressDisplay();
            }
        });
        
        document.getElementById('viewStructure').addEventListener('click', function() {
            animationState.viewMode = 'structure';
            this.classList.add('secondary');
            document.getElementById('viewReplication').classList.remove('secondary');
        });
        
        document.getElementById('viewReplication').addEventListener('click', function() {
            animationState.viewMode = 'replication';
            this.classList.add('secondary');
            document.getElementById('viewStructure').classList.remove('secondary');
        });
        
        document.getElementById('highlightParent').addEventListener('change', function() {
            animationState.highlightParent = this.checked;
        });
        
        document.getElementById('showEnzymes').addEventListener('change', function() {
            animationState.showEnzymes = this.checked;
        });
        
        document.getElementById('showLabels').addEventListener('change', function() {
            animationState.showLabels = this.checked;
        });
        
        document.getElementById('progressSlider').addEventListener('input', function() {
            const percent = parseInt(this.value);
            const step = Math.floor(percent / 16.67); // å°†0-100æ˜ å°„åˆ°0-5æ­¥
            const stepProgress = (percent % 16.67) / 16.67 * 100;
            
            animationState.currentStep = Math.min(step, 5);
            animationState.progress = stepProgress;
            animationState.isPlaying = false;
            
            document.getElementById('playBtn').textContent = 'â–¶ï¸ æ’­æ”¾';
            updateStepIndicator();
            updateInfoText();
            updateDNAData();
            updateProgressDisplay();
        });
        
        // æ­¥éª¤æŒ‡ç¤ºå™¨ç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('.step').forEach(step => {
            step.addEventListener('click', function() {
                const stepIndex = parseInt(this.getAttribute('data-step'));
                animationState.currentStep = stepIndex;
                animationState.progress = 0;
                animationState.isPlaying = false;
                
                document.getElementById('playBtn').textContent = 'â–¶ï¸ æ’­æ”¾';
                updateStepIndicator();
                updateInfoText();
                updateDNAData();
                updateProgressDisplay();
            });
        });
        
        // åˆå§‹åŒ–
        window.addEventListener('load', init);
    </script>
</body>
</html>