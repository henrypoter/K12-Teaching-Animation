<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èƒšèƒå¹²ç»†èƒåˆ†åŒ–ä¸å™¨å®˜å½¢æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .animation-panel {
            flex: 3;
            min-width: 300px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            position: relative;
        }
        
        #animationCanvas {
            display: block;
            width: 100%;
            height: 500px;
            background: #f8fafc;
        }
        
        .controls-panel {
            flex: 1;
            min-width: 250px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            padding: 25px;
        }
        
        .stage-navigation {
            margin-bottom: 30px;
        }
        
        h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.5rem;
            border-bottom: 2px solid #4A90E2;
            padding-bottom: 8px;
        }
        
        .stage-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .stage-btn {
            padding: 14px 18px;
            border: none;
            border-radius: 10px;
            background: #f1f5f9;
            color: #475569;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            position: relative;
            padding-left: 50px;
        }
        
        .stage-btn:hover {
            background: #e2e8f0;
            transform: translateY(-2px);
        }
        
        .stage-btn.active {
            background: #4A90E2;
            color: white;
            box-shadow: 0 4px 10px rgba(74, 144, 226, 0.3);
        }
        
        .stage-btn::before {
            content: '';
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #94a3b8;
        }
        
        .stage-btn.active::before {
            background: white;
        }
        
        .stage-btn:nth-child(1)::before { background: #6366f1; }
        .stage-btn:nth-child(2)::before { background: #4A90E2; }
        .stage-btn:nth-child(3)::before { background: #D0021B; }
        .stage-btn:nth-child(4)::before { background: #F5A623; }
        .stage-btn:nth-child(5)::before { background: #7ED321; }
        
        .animation-controls {
            margin-bottom: 30px;
        }
        
        .control-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .ctrl-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: #4A90E2;
            color: white;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .ctrl-btn:hover {
            background: #3a7bc8;
            transform: translateY(-2px);
        }
        
        .ctrl-btn.reset {
            background: #94a3b8;
        }
        
        .ctrl-btn.reset:hover {
            background: #7c8a9c;
        }
        
        .legend {
            margin-bottom: 25px;
        }
        
        .legend-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .color-box {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        .ectoderm-color { background: #4A90E2; }
        .mesoderm-color { background: #D0021B; }
        .endoderm-color { background: #F5A623; }
        
        .interactive-section {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .organ-drag-game {
            margin-top: 20px;
        }
        
        .target-zones {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            gap: 15px;
        }
        
        .target-zone {
            flex: 1;
            min-height: 120px;
            border: 3px dashed #cbd5e1;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            transition: all 0.3s ease;
        }
        
        .target-zone.highlight {
            border-color: #4A90E2;
            background: rgba(74, 144, 226, 0.05);
        }
        
        .zone-label {
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .organ-pool {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 10px;
        }
        
        .organ-item {
            width: 80px;
            height: 80px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: grab;
            transition: all 0.3s ease;
            background: white;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            padding: 10px;
        }
        
        .organ-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }
        
        .organ-icon {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .organ-name {
            font-size: 0.8rem;
            text-align: center;
            font-weight: 500;
        }
        
        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: 500;
            display: none;
        }
        
        .feedback.correct {
            background: rgba(126, 211, 33, 0.1);
            color: #2d5a27;
            border: 1px solid #7ED321;
            display: block;
        }
        
        .feedback.incorrect {
            background: rgba(208, 2, 27, 0.1);
            color: #8a1a1a;
            border: 1px solid #D0021B;
            display: block;
        }
        
        .info-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #4A90E2;
            max-width: 600px;
        }
        
        .info-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }
        
        .info-description {
            color: #475569;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #64748b;
            font-size: 0.9rem;
            border-top: 1px solid #e2e8f0;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .target-zones {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>èƒšèƒå¹²ç»†èƒåˆ†åŒ–ä¸å™¨å®˜å½¢æˆ</h1>
            <p class="subtitle">æ¢ç´¢ä»å…¨èƒ½å¹²ç»†èƒåˆ°ä¸‰èƒšå±‚ï¼Œå†åˆ°äººä½“å™¨å®˜çš„å¥‡å¦™å‘è‚²è¿‡ç¨‹</p>
        </header>
        
        <div class="main-content">
            <div class="animation-panel">
                <canvas id="animationCanvas"></canvas>
                <div class="info-panel">
                    <div class="info-title" id="infoTitle">èƒšèƒå¹²ç»†èƒåˆ†åŒ–</div>
                    <div class="info-description" id="infoDescription">ç‚¹å‡»å·¦ä¾§é˜¶æ®µæŒ‰é’®æˆ–ä½¿ç”¨ä¸‹æ–¹æ§åˆ¶æŒ‰é’®å¼€å§‹æ¢ç´¢èƒšèƒå‘è‚²è¿‡ç¨‹</div>
                </div>
            </div>
            
            <div class="controls-panel">
                <div class="stage-navigation">
                    <h2>å‘è‚²é˜¶æ®µ</h2>
                    <div class="stage-buttons">
                        <button class="stage-btn active" data-stage="0">1. å¹²ç»†èƒä¸åˆ†åŒ–</button>
                        <button class="stage-btn" data-stage="1">2. å›Šèƒšå½¢æˆ</button>
                        <button class="stage-btn" data-stage="2">3. åŸè‚ èƒšå½¢æˆ</button>
                        <button class="stage-btn" data-stage="3">4. ä¸‰èƒšå±‚å»ºç«‹</button>
                        <button class="stage-btn" data-stage="4">5. å™¨å®˜åˆ†åŒ–</button>
                    </div>
                </div>
                
                <div class="animation-controls">
                    <h2>åŠ¨ç”»æ§åˆ¶</h2>
                    <div class="control-buttons">
                        <button class="ctrl-btn" id="playBtn">æ’­æ”¾</button>
                        <button class="ctrl-btn" id="pauseBtn">æš‚åœ</button>
                        <button class="ctrl-btn reset" id="resetBtn">é‡ç½®</button>
                    </div>
                </div>
                
                <div class="legend">
                    <h2>ä¸‰èƒšå±‚å›¾ä¾‹</h2>
                    <div class="legend-items">
                        <div class="legend-item">
                            <div class="color-box ectoderm-color"></div>
                            <span>å¤–èƒšå±‚ - ç¥ç»ç³»ç»Ÿã€è¡¨çš®ç­‰</span>
                        </div>
                        <div class="legend-item">
                            <div class="color-box mesoderm-color"></div>
                            <span>ä¸­èƒšå±‚ - è‚Œè‚‰ã€éª¨éª¼ã€å¿ƒè„ç­‰</span>
                        </div>
                        <div class="legend-item">
                            <div class="color-box endoderm-color"></div>
                            <span>å†…èƒšå±‚ - æ¶ˆåŒ–ç³»ç»Ÿã€å‘¼å¸ç³»ç»Ÿç­‰</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="interactive-section">
            <h2>çŸ¥è¯†æ¢ç´¢ï¼šå™¨å®˜ä¸èƒšå±‚åŒ¹é…</h2>
            <p>å°†ä¸‹é¢çš„å™¨å®˜æ‹–æ‹½åˆ°å…¶èµ·æºçš„èƒšå±‚åŒºåŸŸä¸­</p>
            
            <div class="organ-drag-game">
                <div class="target-zones">
                    <div class="target-zone" id="ectodermZone" data-layer="ectoderm">
                        <div class="zone-label">å¤–èƒšå±‚</div>
                        <div class="zone-desc">ç¥ç»ç³»ç»Ÿã€è¡¨çš®ç­‰</div>
                    </div>
                    <div class="target-zone" id="mesodermZone" data-layer="mesoderm">
                        <div class="zone-label">ä¸­èƒšå±‚</div>
                        <div class="zone-desc">è‚Œè‚‰ã€éª¨éª¼ã€å¿ƒè„ç­‰</div>
                    </div>
                    <div class="target-zone" id="endodermZone" data-layer="endoderm">
                        <div class="zone-label">å†…èƒšå±‚</div>
                        <div class="zone-desc">æ¶ˆåŒ–ç³»ç»Ÿã€å‘¼å¸ç³»ç»Ÿç­‰</div>
                    </div>
                </div>
                
                <div class="organ-pool" id="organPool">
                    <!-- å™¨å®˜å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="feedback" id="feedback"></div>
            </div>
        </div>
        
        <footer>
            <p>æ•™å­¦åŠ¨ç”»è®¾è®¡ | èƒšèƒå‘è‚²è¿‡ç¨‹å¯è§†åŒ– | é€‚ç”¨äºé«˜ä¸­åŠå¤§å­¦ç”Ÿç‰©å­¦å­¦ä¹ </p>
        </footer>
    </div>

    <script>
        // è·å–Canvaså’Œä¸Šä¸‹æ–‡
        const canvas = document.getElementById('animationCanvas');
        const ctx = canvas.getContext('2d');
        
        // è®¾ç½®Canvaså°ºå¯¸
        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        }
        
        // åˆå§‹è°ƒæ•´å°ºå¯¸
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // åŠ¨ç”»çŠ¶æ€
        let currentStage = 0;
        let animationProgress = 0;
        let isPlaying = false;
        let lastTime = 0;
        const stageDurations = [4000, 5000, 6000, 5000, 6000]; // æ¯ä¸ªé˜¶æ®µçš„æŒç»­æ—¶é—´(ms)
        
        // é˜¶æ®µä¿¡æ¯
        const stageInfo = [
            {
                title: "å¹²ç»†èƒä¸åˆ†åŒ–",
                description: "èƒšèƒå¹²ç»†èƒå…·æœ‰å…¨èƒ½æ€§ï¼Œèƒ½å¤Ÿè‡ªæˆ‘æ›´æ–°å¹¶åˆ†åŒ–ä¸ºå„ç§ç»†èƒç±»å‹ã€‚å›¾ä¸­å±•ç¤ºäº†å¹²ç»†èƒåˆ†è£‚å’Œæ—©æœŸåˆ†åŒ–çš„è¿‡ç¨‹ã€‚"
            },
            {
                title: "å›Šèƒšå½¢æˆ",
                description: "å—ç²¾åµç»è¿‡å¤šæ¬¡åˆ†è£‚å½¢æˆå›Šèƒšï¼ŒåŒ…å«å†…ç»†èƒå›¢å’Œæ»‹å…»å±‚ã€‚å†…ç»†èƒå›¢å°†å‘è‚²ä¸ºèƒšèƒæœ¬ä½“ã€‚"
            },
            {
                title: "åŸè‚ èƒšå½¢æˆ",
                description: "é€šè¿‡ç»†èƒè¿ç§»å’Œé‡æ’ï¼Œå½¢æˆå…·æœ‰ä¸‰ä¸ªèƒšå±‚ï¼ˆå¤–ã€ä¸­ã€å†…èƒšå±‚ï¼‰çš„åŸè‚ èƒšã€‚è¿™æ˜¯å™¨å®˜å½¢æˆçš„åŸºç¡€ã€‚"
            },
            {
                title: "ä¸‰èƒšå±‚å»ºç«‹",
                description: "ä¸‰ä¸ªèƒšå±‚å·²æ¸…æ™°å»ºç«‹ï¼šå¤–èƒšå±‚ï¼ˆè“è‰²ï¼‰ã€ä¸­èƒšå±‚ï¼ˆçº¢è‰²ï¼‰ã€å†…èƒšå±‚ï¼ˆé»„è‰²ï¼‰ã€‚å„èƒšå±‚å°†åˆ†åŒ–ä¸ºç‰¹å®šå™¨å®˜ç³»ç»Ÿã€‚"
            },
            {
                title: "å™¨å®˜åˆ†åŒ–",
                description: "å„èƒšå±‚å¼€å§‹åˆ†åŒ–ä¸ºå™¨å®˜åŸåŸºï¼šå¤–èƒšå±‚å½¢æˆç¥ç»ç®¡å’Œè¡¨çš®ï¼›ä¸­èƒšå±‚å½¢æˆä½“èŠ‚ã€å¿ƒè„ç­‰ï¼›å†…èƒšå±‚å½¢æˆåŸå§‹æ¶ˆåŒ–ç®¡ç­‰ã€‚"
            }
        ];
        
        // æ›´æ–°ä¿¡æ¯é¢æ¿
        function updateInfoPanel() {
            document.getElementById('infoTitle').textContent = stageInfo[currentStage].title;
            document.getElementById('infoDescription').textContent = stageInfo[currentStage].description;
        }
        
        // ç»˜åˆ¶å‡½æ•°
        function draw() {
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // æ ¹æ®å½“å‰é˜¶æ®µå’Œè¿›åº¦ç»˜åˆ¶
            switch(currentStage) {
                case 0: drawStage0(); break;
                case 1: drawStage1(); break;
                case 2: drawStage2(); break;
                case 3: drawStage3(); break;
                case 4: drawStage4(); break;
            }
        }
        
        // é˜¶æ®µ0: å¹²ç»†èƒä¸åˆ†åŒ–
        function drawStage0() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 80;
            
            // ç»˜åˆ¶èƒŒæ™¯åœ†å½¢
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius + 10, 0, Math.PI * 2);
            ctx.fillStyle = '#f1f5f9';
            ctx.fill();
            
            // æ ¹æ®è¿›åº¦ç»˜åˆ¶å¹²ç»†èƒåˆ†è£‚è¿‡ç¨‹
            const progress = animationProgress / stageDurations[0];
            
            if (progress < 0.5) {
                // å•ä¸ªå¹²ç»†èƒ
                const scale = 0.8 + 0.2 * Math.sin(progress * Math.PI * 4);
                drawStemCell(centerX, centerY, radius * scale, '#6366f1');
                
                // ç»˜åˆ¶"å…¨èƒ½æ€§"æ–‡å­—
                ctx.font = 'bold 18px Arial';
                ctx.fillStyle = '#6366f1';
                ctx.textAlign = 'center';
                ctx.fillText('å…¨èƒ½å¹²ç»†èƒ', centerX, centerY - radius - 30);
            } else {
                // åˆ†è£‚ä¸ºä¸¤ä¸ªç»†èƒ
                const offset = (progress - 0.5) * 100;
                const cellRadius = radius * 0.7;
                
                // ç¬¬ä¸€ä¸ªç»†èƒ
                drawStemCell(centerX - offset, centerY, cellRadius, '#4A90E2');
                
                // ç¬¬äºŒä¸ªç»†èƒï¼ˆé¢œè‰²å¼€å§‹åˆ†åŒ–ï¼‰
                const colorMix = (progress - 0.5) * 2;
                const r = Math.floor(74 + (208 - 74) * colorMix);
                const g = Math.floor(144 + (2 - 144) * colorMix);
                const b = Math.floor(226 + (27 - 226) * colorMix);
                const color = `rgb(${r}, ${g}, ${b})`;
                
                drawStemCell(centerX + offset, centerY, cellRadius, color);
                
                // ç»˜åˆ¶ç®­å¤´å’Œ"åˆ†åŒ–"æ–‡å­—
                ctx.font = 'bold 16px Arial';
                ctx.fillStyle = '#475569';
                ctx.textAlign = 'center';
                ctx.fillText('åˆ†åŒ–å¼€å§‹', centerX, centerY - radius - 30);
            }
        }
        
        // ç»˜åˆ¶å¹²ç»†èƒ
        function drawStemCell(x, y, radius, color) {
            // ç»†èƒä¸»ä½“
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.fillStyle = color;
            ctx.fill();
            
            // ç»†èƒæ ¸
            ctx.beginPath();
            ctx.arc(x, y, radius * 0.4, 0, Math.PI * 2);
            ctx.fillStyle = '#ffffff';
            ctx.fill();
            
            // ç»†èƒæ ¸ç»†èŠ‚
            ctx.beginPath();
            ctx.arc(x, y, radius * 0.2, 0, Math.PI * 2);
            ctx.fillStyle = color;
            ctx.fill();
            
            // ç»†èƒè†œ
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 2;
            ctx.stroke();
        }
        
        // é˜¶æ®µ1: å›Šèƒšå½¢æˆ
        function drawStage1() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const progress = animationProgress / stageDurations[1];
            
            // ç»˜åˆ¶å›Šèƒš
            const blastRadius = 120;
            
            // å¤–å±‚ï¼ˆæ»‹å…»å±‚ï¼‰
            ctx.beginPath();
            ctx.arc(centerX, centerY, blastRadius, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(100, 150, 200, 0.3)';
            ctx.fill();
            ctx.strokeStyle = '#4A90E2';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // å†…ç»†èƒå›¢ï¼ˆæ ¹æ®è¿›åº¦æ˜¾ç¤ºï¼‰
            const innerCellRadius = 40;
            const innerY = centerY - blastRadius * 0.3;
            
            if (progress > 0.3) {
                const innerProgress = Math.min(1, (progress - 0.3) / 0.7);
                
                // ç»˜åˆ¶å†…ç»†èƒå›¢
                ctx.beginPath();
                ctx.arc(centerX, innerY, innerCellRadius * innerProgress, 0, Math.PI * 2);
                ctx.fillStyle = '#4A90E2';
                ctx.fill();
                
                // ç»˜åˆ¶å†…ç»†èƒå›¢ä¸­çš„ç»†èƒ
                const cellCount = 3;
                for (let i = 0; i < cellCount; i++) {
                    const angle = (i / cellCount) * Math.PI * 2;
                    const cellX = centerX + Math.cos(angle) * innerCellRadius * 0.5 * innerProgress;
                    const cellY = innerY + Math.sin(angle) * innerCellRadius * 0.5 * innerProgress;
                    
                    ctx.beginPath();
                    ctx.arc(cellX, cellY, 12 * innerProgress, 0, Math.PI * 2);
                    ctx.fillStyle = '#ffffff';
                    ctx.fill();
                }
                
                // æ ‡æ³¨
                if (progress > 0.5) {
                    ctx.font = '14px Arial';
                    ctx.fillStyle = '#475569';
                    ctx.textAlign = 'center';
                    ctx.fillText('å†…ç»†èƒå›¢', centerX, innerY - innerCellRadius - 15);
                    ctx.fillText('æ»‹å…»å±‚', centerX, centerY + blastRadius + 20);
                }
            }
        }
        
        // é˜¶æ®µ2: åŸè‚ èƒšå½¢æˆ
        function drawStage2() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const progress = animationProgress / stageDurations[2];
            
            // ç»˜åˆ¶åŸè‚ èƒšå½¢æˆè¿‡ç¨‹
            const embryoRadius = 130;
            
            // æ ¹æ®è¿›åº¦ç»˜åˆ¶ç»†èƒè¿ç§»å’Œèƒšå±‚å½¢æˆ
            if (progress < 0.5) {
                // æ—©æœŸåŸè‚ èƒš - ç»†èƒå¼€å§‹è¿ç§»
                const migrationProgress = progress * 2;
                
                // ç»˜åˆ¶å¤–å±‚ç»†èƒ
                ctx.beginPath();
                ctx.arc(centerX, centerY, embryoRadius, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(74, 144, 226, 0.2)';
                ctx.fill();
                ctx.strokeStyle = '#4A90E2';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // ç»˜åˆ¶è¿ç§»çš„ç»†èƒï¼ˆå‘å†…å‡¹é™·ï¼‰
                const invaginationDepth = migrationProgress * 50;
                ctx.beginPath();
                ctx.arc(centerX, centerY + invaginationDepth, embryoRadius * 0.7, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(245, 166, 35, 0.3)';
                ctx.fill();
                
                // ç»˜åˆ¶è¿ç§»ç®­å¤´
                if (migrationProgress > 0.2) {
                    drawArrow(centerX, centerY + embryoRadius * 0.8, centerX, centerY + embryoRadius * 0.8 + 40, '#D0021B');
                    ctx.font = '14px Arial';
                    ctx.fillStyle = '#475569';
                    ctx.textAlign = 'center';
                    ctx.fillText('ç»†èƒè¿ç§»', centerX, centerY + embryoRadius * 0.8 + 60);
                }
            } else {
                // åæœŸåŸè‚ èƒš - ä¸‰èƒšå±‚å½¢æˆ
                const layerProgress = (progress - 0.5) * 2;
                
                // ç»˜åˆ¶å¤–èƒšå±‚ï¼ˆè“è‰²ï¼‰
                ctx.beginPath();
                ctx.arc(centerX, centerY, embryoRadius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(74, 144, 226, ${0.2 + 0.3 * layerProgress})`;
                ctx.fill();
                
                // ç»˜åˆ¶ä¸­èƒšå±‚ï¼ˆçº¢è‰²ï¼‰
                ctx.beginPath();
                ctx.arc(centerX, centerY, embryoRadius * 0.7, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(208, 2, 27, ${0.2 + 0.3 * layerProgress})`;
                ctx.fill();
                
                // ç»˜åˆ¶å†…èƒšå±‚ï¼ˆé»„è‰²ï¼‰
                ctx.beginPath();
                ctx.arc(centerX, centerY, embryoRadius * 0.4, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(245, 166, 35, ${0.2 + 0.3 * layerProgress})`;
                ctx.fill();
                
                // ç»˜åˆ¶æ ‡æ³¨
                if (layerProgress > 0.5) {
                    ctx.font = '14px Arial';
                    ctx.fillStyle = '#475569';
                    ctx.textAlign = 'center';
                    ctx.fillText('å¤–èƒšå±‚', centerX, centerY - embryoRadius - 15);
                    ctx.fillText('ä¸­èƒšå±‚', centerX + embryoRadius * 0.7, centerY);
                    ctx.fillText('å†…èƒšå±‚', centerX, centerY + embryoRadius * 0.4 + 20);
                }
            }
        }
        
        // é˜¶æ®µ3: ä¸‰èƒšå±‚å»ºç«‹
        function drawStage3() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const progress = animationProgress / stageDurations[3];
            
            // ç»˜åˆ¶æ¸…æ™°çš„ä¸‰èƒšå±‚ç»“æ„
            const layerRadius = 140;
            
            // å¤–èƒšå±‚ï¼ˆè“è‰²ï¼‰
            ctx.beginPath();
            ctx.arc(centerX, centerY, layerRadius, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(74, 144, 226, 0.4)';
            ctx.fill();
            ctx.strokeStyle = '#4A90E2';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // ä¸­èƒšå±‚ï¼ˆçº¢è‰²ï¼‰
            ctx.beginPath();
            ctx.arc(centerX, centerY, layerRadius * 0.65, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(208, 2, 27, 0.4)';
            ctx.fill();
            ctx.strokeStyle = '#D0021B';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // å†…èƒšå±‚ï¼ˆé»„è‰²ï¼‰
            ctx.beginPath();
            ctx.arc(centerX, centerY, layerRadius * 0.3, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(245, 166, 35, 0.4)';
            ctx.fill();
            ctx.strokeStyle = '#F5A623';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // ç»˜åˆ¶èƒšå±‚åç§°
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            
            ctx.fillStyle = '#4A90E2';
            ctx.fillText('å¤–èƒšå±‚', centerX, centerY - layerRadius - 20);
            
            ctx.fillStyle = '#D0021B';
            ctx.fillText('ä¸­èƒšå±‚', centerX + layerRadius * 0.65 + 30, centerY);
            
            ctx.fillStyle = '#F5A623';
            ctx.fillText('å†…èƒšå±‚', centerX, centerY + layerRadius * 0.3 + 30);
            
            // ç»˜åˆ¶è¡ç”Ÿå™¨å®˜å›¾æ ‡ï¼ˆæ ¹æ®è¿›åº¦æ˜¾ç¤ºï¼‰
            if (progress > 0.5) {
                const iconProgress = (progress - 0.5) * 2;
                
                // å¤–èƒšå±‚è¡ç”Ÿå›¾æ ‡ï¼ˆå¤§è„‘ï¼‰
                drawOrganIcon(centerX, centerY - layerRadius * 0.8, 'ğŸ§ ', 'å¤§è„‘', '#4A90E2', iconProgress);
                
                // ä¸­èƒšå±‚è¡ç”Ÿå›¾æ ‡ï¼ˆå¿ƒè„ï¼‰
                drawOrganIcon(centerX + layerRadius * 0.5, centerY, 'â¤ï¸', 'å¿ƒè„', '#D0021B', iconProgress);
                
                // å†…èƒšå±‚è¡ç”Ÿå›¾æ ‡ï¼ˆè‚è„ï¼‰
                drawOrganIcon(centerX, centerY + layerRadius * 0.5, 'ğŸ«', 'è‚º', '#F5A623', iconProgress);
            }
        }
        
        // é˜¶æ®µ4: å™¨å®˜åˆ†åŒ–
        function drawStage4() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const progress = animationProgress / stageDurations[4];
            
            // ç»˜åˆ¶èƒšèƒè½®å»“
            const embryoWidth = 180;
            const embryoHeight = 250;
            
            // èƒšèƒä¸»ä½“
            ctx.beginPath();
            ctx.ellipse(centerX, centerY, embryoWidth/2, embryoHeight/2, 0, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(240, 240, 240, 0.8)';
            ctx.fill();
            ctx.strokeStyle = '#94a3b8';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // æ ¹æ®è¿›åº¦ç»˜åˆ¶å™¨å®˜åŸåŸº
            const organProgress = Math.min(1, progress * 1.5);
            
            // å¤–èƒšå±‚å™¨å®˜ï¼šç¥ç»ç®¡ï¼ˆå¤§è„‘å’Œè„Šé«“ï¼‰
            if (organProgress > 0.1) {
                const neuralProgress = Math.min(1, (organProgress - 0.1) / 0.9);
                
                // ç»˜åˆ¶ç¥ç»ç®¡
                ctx.beginPath();
                ctx.moveTo(centerX, centerY - embryoHeight * 0.4);
                ctx.bezierCurveTo(
                    centerX + embryoWidth * 0.2 * neuralProgress, 
                    centerY - embryoHeight * 0.2, 
                    centerX + embryoWidth * 0.15 * neuralProgress, 
                    centerY + embryoHeight * 0.2, 
                    centerX, 
                    centerY + embryoHeight * 0.3
                );
                ctx.bezierCurveTo(
                    centerX - embryoWidth * 0.15 * neuralProgress, 
                    centerY + embryoHeight * 0.2, 
                    centerX - embryoWidth * 0.2 * neuralProgress, 
                    centerY - embryoHeight * 0.2, 
                    centerX, 
                    centerY - embryoHeight * 0.4
                );
                ctx.closePath();
                ctx.fillStyle = `rgba(74, 144, 226, ${0.3 + 0.4 * neuralProgress})`;
                ctx.fill();
                
                // æ ‡æ³¨
                if (neuralProgress > 0.7) {
                    ctx.font = '14px Arial';
                    ctx.fillStyle = '#4A90E2';
                    ctx.textAlign = 'center';
                    ctx.fillText('ç¥ç»ç®¡', centerX, centerY - embryoHeight * 0.45);
                }
            }
            
            // ä¸­èƒšå±‚å™¨å®˜ï¼šä½“èŠ‚å’Œå¿ƒè„
            if (organProgress > 0.3) {
                const mesodermProgress = Math.min(1, (organProgress - 0.3) / 0.7);
                
                // ç»˜åˆ¶ä½“èŠ‚ï¼ˆæ²¿ä¸­çº¿ä¸¤ä¾§ï¼‰
                const somiteCount = 8;
                for (let i = 0; i < somiteCount; i++) {
                    const yPos = centerY - embryoHeight * 0.2 + i * 25;
                    const size = 12 * mesodermProgress;
                    
                    // å·¦ä¾§ä½“èŠ‚
                    ctx.beginPath();
                    ctx.arc(centerX - embryoWidth * 0.25, yPos, size, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(208, 2, 27, ${0.4 + 0.3 * mesodermProgress})`;
                    ctx.fill();
                    
                    // å³ä¾§ä½“èŠ‚
                    ctx.beginPath();
                    ctx.arc(centerX + embryoWidth * 0.25, yPos, size, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(208, 2, 27, ${0.4 + 0.3 * mesodermProgress})`;
                    ctx.fill();
                }
                
                // ç»˜åˆ¶å¿ƒè„åŸåŸº
                if (mesodermProgress > 0.5) {
                    const heartSize = 20 * mesodermProgress;
                    ctx.beginPath();
                    ctx.arc(centerX, centerY - embryoHeight * 0.1, heartSize, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(208, 2, 27, ${0.6 * mesodermProgress})`;
                    ctx.fill();
                    
                    // æ ‡æ³¨
                    if (mesodermProgress > 0.7) {
                        ctx.font = '14px Arial';
                        ctx.fillStyle = '#D0021B';
                        ctx.textAlign = 'center';
                        ctx.fillText('å¿ƒè„åŸåŸº', centerX, centerY - embryoHeight * 0.1 - heartSize - 10);
                        ctx.fillText('ä½“èŠ‚', centerX - embryoWidth * 0.25 - 25, centerY - embryoHeight * 0.2);
                    }
                }
            }
            
            // å†…èƒšå±‚å™¨å®˜ï¼šåŸå§‹æ¶ˆåŒ–ç®¡
            if (organProgress > 0.5) {
                const endodermProgress = Math.min(1, (organProgress - 0.5) / 0.5);
                
                // ç»˜åˆ¶åŸå§‹æ¶ˆåŒ–ç®¡
                ctx.beginPath();
                ctx.moveTo(centerX, centerY - embryoHeight * 0.1);
                ctx.bezierCurveTo(
                    centerX + embryoWidth * 0.1 * endodermProgress, 
                    centerY, 
                    centerX + embryoWidth * 0.08 * endodermProgress, 
                    centerY + embryoHeight * 0.2, 
                    centerX, 
                    centerY + embryoHeight * 0.25
                );
                ctx.bezierCurveTo(
                    centerX - embryoWidth * 0.08 * endodermProgress, 
                    centerY + embryoHeight * 0.2, 
                    centerX - embryoWidth * 0.1 * endodermProgress, 
                    centerY, 
                    centerX, 
                    centerY - embryoHeight * 0.1
                );
                ctx.closePath();
                ctx.fillStyle = `rgba(245, 166, 35, ${0.3 + 0.4 * endodermProgress})`;
                ctx.fill();
                
                // æ ‡æ³¨
                if (endodermProgress > 0.7) {
                    ctx.font = '14px Arial';
                    ctx.fillStyle = '#F5A623';
                    ctx.textAlign = 'center';
                    ctx.fillText('åŸå§‹æ¶ˆåŒ–ç®¡', centerX, centerY + embryoHeight * 0.3);
                }
            }
        }
        
        // ç»˜åˆ¶ç®­å¤´
        function drawArrow(fromX, fromY, toX, toY, color) {
            const headlen = 10;
            const dx = toX - fromX;
            const dy = toY - fromY;
            const angle = Math.atan2(dy, dx);
            
            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            ctx.lineTo(toX, toY);
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.stroke();
            
            ctx.beginPath();
            ctx.move
<!--æ£€æµ‹åˆ°ä»£ç æˆªæ–­ï¼Œè‡ªåŠ¨ç»­å†™ä¸­...-->
to(toX, toY);
            ctx.lineTo(toX - headlen * Math.cos(angle - Math.PI / 6), toY - headlen * Math.sin(angle - Math.PI / 6));
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headlen * Math.cos(angle + Math.PI / 6), toY - headlen * Math.sin(angle + Math.PI / 6));
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.stroke();
        }
        
        // ç»˜åˆ¶å™¨å®˜å›¾æ ‡
        function drawOrganIcon(x, y, emoji, name, color, progress) {
            const alpha = Math.min(1, progress * 2);
            
            // ç»˜åˆ¶èƒŒæ™¯åœ†
            ctx.beginPath();
            ctx.arc(x, y, 30, 0, Math.PI * 2);
            ctx.fillStyle = `rgba(255, 255, 255, ${0.8 * alpha})`;
            ctx.fill();
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // ç»˜åˆ¶emoji
            ctx.font = `24px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(emoji, x, y - 5);
            
            // ç»˜åˆ¶åç§°
            ctx.font = `12px Arial`;
            ctx.fillStyle = color;
            ctx.fillText(name, x, y + 20);
        }
        
        // åŠ¨ç”»å¾ªç¯
        function animate(timestamp) {
            if (!lastTime) lastTime = timestamp;
            const deltaTime = timestamp - lastTime;
            lastTime = timestamp;
            
            if (isPlaying) {
                animationProgress += deltaTime;
                
                // å¦‚æœå½“å‰é˜¶æ®µå®Œæˆï¼Œè‡ªåŠ¨è¿›å…¥ä¸‹ä¸€é˜¶æ®µ
                if (animationProgress >= stageDurations[currentStage]) {
                    if (currentStage < stageDurations.length - 1) {
                        currentStage++;
                        animationProgress = 0;
                        updateStageButtons();
                        updateInfoPanel();
                    } else {
                        // æœ€åä¸€ä¸ªé˜¶æ®µå®Œæˆååœæ­¢
                        isPlaying = false;
                        document.getElementById('playBtn').textContent = 'é‡æ–°æ’­æ”¾';
                    }
                }
                
                draw();
            }
            
            requestAnimationFrame(animate);
        }
        
        // å¼€å§‹åŠ¨ç”»å¾ªç¯
        requestAnimationFrame(animate);
        
        // é˜¶æ®µæŒ‰é’®äº‹ä»¶
        document.querySelectorAll('.stage-btn').forEach(button => {
            button.addEventListener('click', function() {
                const stage = parseInt(this.getAttribute('data-stage'));
                currentStage = stage;
                animationProgress = 0;
                updateStageButtons();
                updateInfoPanel();
                draw();
            });
        });
        
        // æ›´æ–°é˜¶æ®µæŒ‰é’®çŠ¶æ€
        function updateStageButtons() {
            document.querySelectorAll('.stage-btn').forEach((button, index) => {
                if (index === currentStage) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });
        }
        
        // æ§åˆ¶æŒ‰é’®äº‹ä»¶
        document.getElementById('playBtn').addEventListener('click', function() {
            isPlaying = true;
            if (this.textContent === 'é‡æ–°æ’­æ”¾') {
                currentStage = 0;
                animationProgress = 0;
                this.textContent = 'æ’­æ”¾';
                updateStageButtons();
                updateInfoPanel();
            }
        });
        
        document.getElementById('pauseBtn').addEventListener('click', function() {
            isPlaying = false;
        });
        
        document.getElementById('resetBtn').addEventListener('click', function() {
            currentStage = 0;
            animationProgress = 0;
            isPlaying = false;
            updateStageButtons();
            updateInfoPanel();
            draw();
            document.getElementById('playBtn').textContent = 'æ’­æ”¾';
        });
        
        // åˆå§‹åŒ–ä¿¡æ¯é¢æ¿
        updateInfoPanel();
        
        // äº¤äº’æ¸¸æˆï¼šå™¨å®˜ä¸èƒšå±‚åŒ¹é…
        const organs = [
            { id: 1, name: 'å¤§è„‘', emoji: 'ğŸ§ ', correctLayer: 'ectoderm' },
            { id: 2, name: 'è„Šé«“', emoji: 'ğŸ¦´', correctLayer: 'ectoderm' },
            { id: 3, name: 'è¡¨çš®', emoji: 'ğŸ‘ï¸', correctLayer: 'ectoderm' },
            { id: 4, name: 'å¿ƒè„', emoji: 'â¤ï¸', correctLayer: 'mesoderm' },
            { id: 5, name: 'è‚Œè‚‰', emoji: 'ğŸ’ª', correctLayer: 'mesoderm' },
            { id: 6, name: 'éª¨éª¼', emoji: 'ğŸ¦´', correctLayer: 'mesoderm' },
            { id: 7, name: 'è‚è„', emoji: 'ğŸ«€', correctLayer: 'endoderm' },
            { id: 8, name: 'è‚º', emoji: 'ğŸ«', correctLayer: 'endoderm' },
            { id: 9, name: 'èƒ°è…º', emoji: 'ğŸ¥•', correctLayer: 'endoderm' }
        ];
        
        const organPool = document.getElementById('organPool');
        const feedback = document.getElementById('feedback');
        let draggedOrgan = null;
        
        // ç”Ÿæˆå™¨å®˜å…ƒç´ 
        organs.forEach(organ => {
            const organElement = document.createElement('div');
            organElement.className = 'organ-item';
            organElement.setAttribute('data-id', organ.id);
            organElement.setAttribute('data-layer', organ.correctLayer);
            organElement.setAttribute('draggable', 'true');
            
            organElement.innerHTML = `
                <div class="organ-icon">${organ.emoji}</div>
                <div class="organ-name">${organ.name}</div>
            `;
            
            organElement.addEventListener('dragstart', handleDragStart);
            organElement.addEventListener('dragend', handleDragEnd);
            
            organPool.appendChild(organElement);
        });
        
        // ç›®æ ‡åŒºåŸŸäº‹ä»¶
        const targetZones = document.querySelectorAll('.target-zone');
        targetZones.forEach(zone => {
            zone.addEventListener('dragover', handleDragOver);
            zone.addEventListener('dragenter', handleDragEnter);
            zone.addEventListener('dragleave', handleDragLeave);
            zone.addEventListener('drop', handleDrop);
        });
        
        // æ‹–æ‹½äº‹ä»¶å¤„ç†å‡½æ•°
        function handleDragStart(e) {
            draggedOrgan = this;
            this.style.opacity = '0.5';
            e.dataTransfer.setData('text/plain', this.getAttribute('data-id'));
        }
        
        function handleDragEnd() {
            this.style.opacity = '1';
            draggedOrgan = null;
            targetZones.forEach(zone => zone.classList.remove('highlight'));
        }
        
        function handleDragOver(e) {
            e.preventDefault();
        }
        
        function handleDragEnter(e) {
            e.preventDefault();
            this.classList.add('highlight');
        }
        
        function handleDragLeave() {
            this.classList.remove('highlight');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('highlight');
            
            const organId = e.dataTransfer.getData('text/plain');
            const organElement = document.querySelector(`.organ-item[data-id="${organId}"]`);
            const correctLayer = organElement.getAttribute('data-layer');
            const targetLayer = this.getAttribute('data-layer');
            
            // æ£€æŸ¥æ˜¯å¦æ­£ç¡®
            if (correctLayer === targetLayer) {
                feedback.textContent = `æ­£ç¡®ï¼${organElement.querySelector('.organ-name').textContent}ç¡®å®èµ·æºäº${getLayerName(targetLayer)}`;
                feedback.className = 'feedback correct';
                
                // å°†å™¨å®˜ç§»åŠ¨åˆ°ç›®æ ‡åŒºåŸŸ
                const clone = organElement.cloneNode(true);
                clone.style.cursor = 'default';
                clone.style.opacity = '0.7';
                clone.draggable = false;
                this.appendChild(clone);
                
                // ä»å™¨å®˜æ± ä¸­ç§»é™¤
                organElement.style.display = 'none';
                
                // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å™¨å®˜éƒ½å·²æ­£ç¡®æ”¾ç½®
                checkGameCompletion();
            } else {
                feedback.textContent = `ä¸æ­£ç¡®ã€‚${organElement.querySelector('.organ-name').textContent}èµ·æºäº${getLayerName(correctLayer)}ï¼Œè€Œä¸æ˜¯${getLayerName(targetLayer)}`;
                feedback.className = 'feedback incorrect';
            }
            
            // 3ç§’åéšè—åé¦ˆ
            setTimeout(() => {
                feedback.className = 'feedback';
            }, 3000);
        }
        
        function getLayerName(layerKey) {
            switch(layerKey) {
                case 'ectoderm': return 'å¤–èƒšå±‚';
                case 'mesoderm': return 'ä¸­èƒšå±‚';
                case 'endoderm': return 'å†…èƒšå±‚';
                default: return '';
            }
        }
        
        function checkGameCompletion() {
            const remainingOrgans = document.querySelectorAll('.organ-item:not([style*="display: none"])');
            if (remainingOrgans.length === 0) {
                feedback.textContent = 'æ­å–œï¼æ‰€æœ‰å™¨å®˜éƒ½å·²æ­£ç¡®å½’ç±»ï¼ä½ å·²æŒæ¡ä¸‰èƒšå±‚ä¸å™¨å®˜èµ·æºçš„å…³ç³»ã€‚';
                feedback.className = 'feedback correct';
            }
        }
        
        // åˆå§‹åŒ–ç»˜åˆ¶
        draw();
    </script>
</body>
</html>