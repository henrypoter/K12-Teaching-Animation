<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæ€ç³»ç»Ÿç¢³å¾ªç¯ä¸å…¨çƒç¢³å¤±è¡¡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0a1929 0%, #1a2b3c 100%);
            color: #e0f2fe;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(16, 42, 67, 0.7);
            border-radius: 15px;
            border: 1px solid rgba(64, 156, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #4ade80, #22d3ee);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 30px;
        }

        .animation-section {
            flex: 3;
            min-width: 300px;
            background: rgba(16, 42, 67, 0.7);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(64, 156, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .controls-section {
            flex: 1;
            min-width: 300px;
            background: rgba(16, 42, 67, 0.7);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(64, 156, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        #animationCanvas {
            width: 100%;
            height: 600px;
            background: rgba(10, 25, 41, 0.5);
            border-radius: 10px;
            display: block;
            cursor: pointer;
        }

        .control-group {
            margin-bottom: 25px;
        }

        h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #7dd3fc;
            border-bottom: 2px solid rgba(125, 211, 252, 0.3);
            padding-bottom: 8px;
        }

        h3 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #a5f3fc;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            padding: 12px 20px;
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 120px;
        }

        button:hover {
            background: linear-gradient(135deg, #1e3a8a, #2563eb);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button.active {
            background: linear-gradient(135deg, #059669, #10b981);
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.5);
        }

        .slider-container {
            margin: 20px 0;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .slider-label span:last-child {
            color: #7dd3fc;
            font-weight: 600;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .toggle-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .toggle-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: rgba(30, 58, 138, 0.3);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .toggle-item:hover {
            background: rgba(30, 58, 138, 0.5);
        }

        .toggle-item label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            flex: 1;
        }

        .toggle-icon {
            width: 24px;
            height: 24px;
            border-radius: 4px;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #475569;
            border-radius: 34px;
            transition: .4s;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            border-radius: 50%;
            transition: .4s;
        }

        input:checked + .toggle-slider {
            background-color: #10b981;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .info-panel {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #3b82f6;
        }

        .info-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #7dd3fc;
        }

        .info-content {
            line-height: 1.6;
            opacity: 0.9;
        }

        .data-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .data-item {
            background: rgba(30, 58, 138, 0.3);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .data-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .data-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #7dd3fc;
        }

        .data-unit {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .challenge-section {
            background: rgba(16, 42, 67, 0.7);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid rgba(64, 156, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .challenge-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .challenge-slider {
            background: rgba(30, 41, 59, 0.8);
            padding: 15px;
            border-radius: 10px;
        }

        .challenge-result {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(16, 185, 129, 0.2));
            border-radius: 10px;
            margin-top: 20px;
        }

        .result-value {
            font-size: 2rem;
            font-weight: 700;
            margin: 10px 0;
            color: #10b981;
        }

        .warning {
            color: #f87171;
        }

        .success {
            color: #4ade80;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            opacity: 0.7;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            #animationCanvas {
                height: 400px;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸŒ ç”Ÿæ€ç³»ç»Ÿç¢³å¾ªç¯ä¸å…¨çƒç¢³å¤±è¡¡</h1>
            <p class="subtitle">æ¢ç´¢è‡ªç„¶ç¢³å¾ªç¯çš„åŠ¨æ€å¹³è¡¡ï¼Œè§‚å¯Ÿäººç±»æ´»åŠ¨å¦‚ä½•å¹²æ‰°è¿™ä¸€ç³»ç»Ÿï¼Œå¹¶ç†è§£å…¨çƒç¢³å¤±è¡¡å¯¹æ°”å€™çš„å½±å“ã€‚</p>
        </header>

        <div class="main-content">
            <section class="animation-section">
                <h2>ç¢³å¾ªç¯åŠ¨æ€æ¨¡æ‹Ÿ</h2>
                <canvas id="animationCanvas"></canvas>
                
                <div class="data-display">
                    <div class="data-item">
                        <div class="data-label">å¤§æ°” COâ‚‚ æµ“åº¦</div>
                        <div class="data-value" id="co2Value">415</div>
                        <div class="data-unit">ppm</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">å…¨çƒå¹³å‡æ¸©åº¦</div>
                        <div class="data-value" id="tempValue">1.2</div>
                        <div class="data-unit">Â°C (ç›¸å¯¹äºå·¥ä¸šé©å‘½å‰)</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">å¹´ç¢³æ’æ”¾é‡</div>
                        <div class="data-value" id="emissionValue">36.8</div>
                        <div class="data-unit">Gt COâ‚‚/å¹´</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">ç¢³å¾ªç¯çŠ¶æ€</div>
                        <div class="data-value" id="balanceStatus">å¤±è¡¡</div>
                        <div class="data-unit" id="balanceDetail">(è‡ªç„¶å¸æ”¶ < äººç±»æ’æ”¾)</div>
                    </div>
                </div>
            </section>

            <section class="controls-section">
                <h2>æ¨¡æ‹Ÿæ§åˆ¶</h2>
                
                <div class="control-group">
                    <h3>åœºæ™¯æ¨¡å¼</h3>
                    <div class="button-group">
                        <button id="btnNatural" class="active">ä»…è‡ªç„¶å¾ªç¯</button>
                        <button id="btnPreIndustrial">å·¥ä¸šé©å‘½å‰</button>
                        <button id="btnModern">ç°ä»£é«˜æ’æ”¾</button>
                        <button id="btnFuture">æœªæ¥æƒ…æ™¯</button>
                    </div>
                </div>

                <div class="control-group">
                    <h3>æ—¶é—´æ§åˆ¶</h3>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>æ¨¡æ‹Ÿé€Ÿåº¦</span>
                            <span id="speedValue">1.0x</span>
                        </div>
                        <input type="range" id="speedSlider" min="0.1" max="3" step="0.1" value="1">
                    </div>
                    <div class="button-group">
                        <button id="btnPlay">â¸ï¸ æš‚åœ</button>
                        <button id="btnReset">ğŸ”„ é‡ç½®</button>
                        <button id="btnFastForward">â© å¿«è¿›100å¹´</button>
                    </div>
                </div>

                <div class="control-group">
                    <h3>æ˜¾ç¤ºé€‰é¡¹</h3>
                    <div class="toggle-group">
                        <div class="toggle-item">
                            <label>
                                <div class="toggle-icon" style="background: #22d3ee;"></div>
                                <span>è‡ªç„¶ç¢³æµ</span>
                            </label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="toggleNatural" checked>
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                        <div class="toggle-item">
                            <label>
                                <div class="toggle-icon" style="background: #f97316;"></div>
                                <span>äººç±»æ’æ”¾</span>
                            </label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="toggleHuman" checked>
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                        <div class="toggle-item">
                            <label>
                                <div class="toggle-icon" style="background: #ef4444;"></div>
                                <span>æ¸©å®¤æ•ˆåº”</span>
                            </label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="toggleGreenhouse">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                        <div class="toggle-item">
                            <label>
                                <div class="toggle-icon" style="background: #8b5cf6;"></div>
                                <span>æ•°æ®æ ‡ç­¾</span>
                            </label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="toggleLabels" checked>
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-panel">
                    <div class="info-title">ğŸ’¡ ç‚¹å‡»äº¤äº’æç¤º</div>
                    <div class="info-content">
                        ç‚¹å‡»ç”»å¸ƒä¸­çš„ä¸åŒå…ƒç´ æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼š
                        <ul style="margin-top: 10px; padding-left: 20px;">
                            <li>ğŸŒ³ æ£®æ— - å…‰åˆä½œç”¨ä¸å‘¼å¸ä½œç”¨</li>
                            <li>ğŸŒŠ æµ·æ´‹ - ç¢³æº¶è§£ä¸ç”Ÿç‰©æ³µ</li>
                            <li>ğŸ­ å·¥å‚ - åŒ–çŸ³ç‡ƒæ–™æ’æ”¾</li>
                            <li>ğŸš— æ±½è½¦ - äº¤é€šæ’æ”¾</li>
                        </ul>
                    </div>
                </div>
            </section>
        </div>

        <section class="challenge-section">
            <h2>ğŸŒ± å‡æ’æŒ‘æˆ˜ï¼šå°†2100å¹´å‡æ¸©æ§åˆ¶åœ¨2Â°Cä»¥å†…</h2>
            <p style="margin-bottom: 20px; opacity: 0.9;">è°ƒæ•´ä»¥ä¸‹å‚æ•°ï¼Œè§‚å¯Ÿå¯¹å¤§æ°”COâ‚‚æµ“åº¦å’Œå…¨çƒæ¸©åº¦çš„å½±å“ï¼š</p>
            
            <div class="challenge-controls">
                <div class="challenge-slider">
                    <div class="slider-label">
                        <span>èƒ½æºç»“æ„</span>
                        <span id="energyValue">50%</span>
                    </div>
                    <input type="range" id="energySlider" min="0" max="100" value="50">
                    <div style="font-size: 0.9rem; opacity: 0.8; margin-top: 5px;">
                        å¯å†ç”Ÿèƒ½æºæ¯”ä¾‹
                    </div>
                </div>
                
                <div class="challenge-slider">
                    <div class="slider-label">
                        <span>æ£®æ—è¦†ç›–ç‡</span>
                        <span id="forestValue">30%</span>
                    </div>
                    <input type="range" id="forestSlider" min="10" max="50" value="30">
                    <div style="font-size: 0.9rem; opacity: 0.8; margin-top: 5px;">
                        å…¨çƒæ£®æ—è¦†ç›–ç‡
                    </div>
                </div>
                
                <div class="challenge-slider">
                    <div class="slider-label">
                        <span>å·¥ä¸šæ•ˆç‡</span>
                        <span id="efficiencyValue">60%</span>
                    </div>
                    <input type="range" id="efficiencySlider" min="20" max="90" value="60">
                    <div style="font-size: 0.9rem; opacity: 0.8; margin-top: 5px;">
                        èƒ½æºåˆ©ç”¨æ•ˆç‡
                    </div>
                </div>
            </div>

            <div class="challenge-result">
                <h3>2100å¹´é¢„æµ‹ç»“æœ</h3>
                <div class="data-item" style="display: inline-block; margin: 10px;">
                    <div class="data-label">å¤§æ°” COâ‚‚ æµ“åº¦</div>
                    <div class="data-value" id="futureCO2">520</div>
                    <div class="data-unit">ppm</div>
                </div>
                <div class="data-item" style="display: inline-block; margin: 10px;">
                    <div class="data-label">å…¨çƒå‡æ¸©</div>
                    <div class="data-value" id="futureTemp">2.8</div>
                    <div class="data-unit">Â°C</div>
                </div>
                
                <div id="challengeMessage" class="result-value warning">
                    âŒ è¶…å‡º2Â°Cç›®æ ‡
                </div>
                
                <p style="margin-top: 15px; font-size: 0.9rem; opacity: 0.8;">
                    ç›®æ ‡ï¼šå°†å¯å†ç”Ÿèƒ½æºæ¯”ä¾‹æé«˜åˆ°70%ä»¥ä¸Šï¼Œæ£®æ—è¦†ç›–ç‡æé«˜åˆ°40%ä»¥ä¸Šï¼Œå·¥ä¸šæ•ˆç‡æé«˜åˆ°80%ä»¥ä¸Š
                </p>
            </div>
        </section>

        <footer>
            <p>æ•™å­¦åŠ¨ç”»è®¾è®¡ | ç”Ÿæ€ç³»ç»Ÿç¢³å¾ªç¯ä¸å…¨çƒç¢³å¤±è¡¡ | æ•°æ®åŸºäºIPCCæŠ¥å‘Šä¸ç§‘å­¦ç ”ç©¶</p>
            <p>äº¤äº’å¼æ•™è‚²å·¥å…· - é€šè¿‡å¯è§†åŒ–ç†è§£å¤æ‚çš„ç”Ÿæ€ç³»ç»Ÿè¿‡ç¨‹</p>
        </footer>
    </div>

    <script>
        // åˆå§‹åŒ–Canvas
        const canvas = document.getElementById('animationCanvas');
        const ctx = canvas.getContext('2d');
        
        // è®¾ç½®Canvaså°ºå¯¸
        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }
        
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // æ¨¡æ‹ŸçŠ¶æ€
        let simulationState = {
            mode: 'natural', // natural, preIndustrial, modern, future
            isPlaying: true,
            speed: 1.0,
            time: 0,
            
            // æ˜¾ç¤ºé€‰é¡¹
            showNatural: true,
            showHuman: true,
            showGreenhouse: false,
            showLabels: true,
            
            // ç¢³å‚¨åº“æ•°æ® (å•ä½: GtC)
            reservoirs: {
                atmosphere: { value: 850, capacity: 1000, color: '#7dd3fc', x: 0.5, y: 0.2, radius: 60 },
                ocean: { value: 38000, capacity: 40000, color: '#22d3ee', x: 0.8, y: 0.6, radius: 90 },
                biosphere: { value: 560, capacity: 600, color: '#4ade80', x: 0.3, y: 0.5, radius: 50 },
                soil: { value: 2300, capacity: 2500, color: '#a16207', x: 0.2, y: 0.7, radius: 55 }
            },
            
            // ç¢³æµåŠ¨
            flows: {
                photosynthesis: { from: 'atmosphere', to: 'biosphere', rate: 123, color: '#10b981', active: true },
                respiration: { from: 'biosphere', to: 'atmosphere', rate: 118, color: '#86efac', active: true },
                decomposition: { from: 'biosphere', to: 'soil', rate: 60, color: '#d9f99d', active: true },
                soilRespiration: { from: 'soil', to: 'atmosphere', rate: 58, color: '#fef08a', active: true },
                oceanUptake: { from: 'atmosphere', to: 'ocean', rate: 92, color: '#38bdf8', active: true },
                oceanRelease: { from: 'ocean', to: 'atmosphere', rate: 90, color: '#0ea5e9', active: true }
            },
            
            // äººç±»æ´»åŠ¨
            humanActivities: {
                fossilFuels: { rate: 9.5, color: '#f97316', x: 0.7, y: 0.3, icon: 'ğŸ­' },
                deforestation: { rate: 1.5, color: '#ef4444', x: 0.4, y: 0.8, icon: 'ğŸª“' },
                transportation: { rate: 8.0, color: '#f59e0b', x: 0.6, y: 0.4, icon: 'ğŸš—' }
            },
            
            // æ¸©å®¤æ•ˆåº”
            greenhouseEffect: {
                intensity: 0.3,
                temperatureRise: 1.2
            },
            
            // ç‚¹å‡»äº¤äº’ä¿¡æ¯
            activeInfo: null
        };
        
        // ç²’å­ç³»ç»Ÿ
        class Particle {
            constructor(x, y, color, vx, vy, life = 100) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.vx = vx;
                this.vy = vy;
                this.life = life;
                this.maxLife = life;
                this.size = Math.random() * 3 + 2;
            }
            
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.life--;
                this.vx *= 0.99;
                this.vy *= 0.99;
            }
            
            draw(ctx) {
                const alpha = this.life / this.maxLife;
                ctx.save();
                ctx.globalAlpha = alpha;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
            
            isAlive() {
                return this.life > 0;
            }
        }
        
        let particles = [];
        
        // ç»˜åˆ¶å‡½æ•°
        function draw() {
            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶èƒŒæ™¯
            drawBackground();
            
            // ç»˜åˆ¶ç¢³å‚¨åº“
            drawReservoirs();
            
            // ç»˜åˆ¶ç¢³æµåŠ¨
            if (simulationState.showNatural) {
                drawFlows();
            }
            
            // ç»˜åˆ¶äººç±»æ´»åŠ¨
            if (simulationState.showHuman) {
                drawHumanActivities();
            }
            
            // ç»˜åˆ¶æ¸©å®¤æ•ˆåº”
            if (simulationState.showGreenhouse) {
                drawGreenhouseEffect();
            }
            
            // ç»˜åˆ¶æ•°æ®æ ‡ç­¾
            if (simulationState.showLabels) {
                drawLabels();
            }
            
            // ç»˜åˆ¶ç²’å­
            drawParticles();
            
            // ç»˜åˆ¶ç‚¹å‡»ä¿¡æ¯
            if (simulationState.activeInfo) {
                drawInfoPanel();
            }
        }
        
        function drawBackground() {
            // æ¸å˜èƒŒæ™¯
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#0a1929');
            gradient.addColorStop(1, '#1a2b3c');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç½‘æ ¼çº¿
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
            ctx.lineWidth = 1;
            
            const gridSize = 50;
            for (let x = 0; x < canvas.width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            for (let y = 0; y < canvas.height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
        }
        
        function drawReservoirs() {
            for (const [key, reservoir] of Object.entries(simulationState.reservoirs)) {
                const x = reservoir.x * canvas.width;
                const y = reservoir.y * canvas.height;
                const radius = reservoir.radius;
                
                // ç»˜åˆ¶å‚¨åº“
                ctx.save();
                
                // å‘å…‰æ•ˆæœ
                ctx.shadowColor = reservoir.color;
                ctx.shadowBlur = 15;
                
                // å¡«å……
                const gradient = ctx.createRadialGradient(x, y, 0, x, y, radius);
                gradient.addColorStop(0, reservoir.color + 'cc');
                gradient.addColorStop(1, reservoir.color + '33');
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.fill();
                
                // è¾¹æ¡†
                ctx.strokeStyle = reservoir.color;
                ctx.lineWidth = 2;
                ctx.stroke();
                
                ctx.restore();
                
                // ç»˜åˆ¶æ ‡ç­¾
                if (simulationState.showLabels) {
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '14px Arial';
                    ctx.textAlign = 'center';
                    
                    let label = '';
                    switch(key) {
                        case 'atmosphere': label = 'å¤§æ°”åœˆ'; break;
                        case 'ocean': label = 'æµ·æ´‹'; break;
                        case 'biosphere': label = 'ç”Ÿç‰©åœˆ'; break;
                        case 'soil': label = 'åœŸå£¤'; break;
                    }
                    
                    ctx.fillText(label, x, y + radius + 20);
                    ctx.fillText(`${Math.round(reservoir.value)} GtC`, x, y + radius + 40);
                }
            }
        }
        
        function drawFlows() {
            for (const [key, flow] of Object.entries(simulationState.flows)) {
                if (!flow.active) continue;
                
                const from = simulationState.reservoirs[flow.from];
                const to = simulationState.reservoirs[flow.to];
                
                const fromX = from.x * canvas.width;
                const fromY = from.y * canvas.height;
                const toX = to.x * canvas.width;
                const toY = to.y * canvas.height;
                
                // è®¡ç®—ç®­å¤´æ–¹å‘
                const dx = toX - fromX;
                const dy = toY - fromY;
                const distance = Math.sqrt(dx * dx + dy * dy);
                const angle = Math.atan2(dy, dx);
                
                // è°ƒæ•´èµ·ç‚¹å’Œç»ˆç‚¹åˆ°åœ†è¾¹ç¼˜
                const startX = fromX + Math.cos(angle) * from.radius;
                const startY = fromY + Math.sin(angle) * from.radius;
                const endX = toX - Math.cos(angle) * to.radius;
                const endY = toY - Math.sin(angle) * to.radius;
                
                // ç»˜åˆ¶æµåŠ¨çº¿
                ctx.save();
                ctx.strokeStyle = flow.color;
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
                
                // è™šçº¿æ•ˆæœ
                ctx.setLineDash([5, 5]);
                
                ctx.beginPath();
                ctx.moveTo(startX, startY);
                ctx.lineTo(endX, endY);
                ctx.stroke();
                
                ctx.restore();
                
                // ç»˜åˆ¶ç®­å¤´
                const arrowSize = 8;
                const arrowX = endX - Math.cos(angle) * arrowSize;
                const arrowY = endY - Math.sin(angle) * arrowSize;
                
                ctx.save();
                ctx.fillStyle = flow.color;
                ctx.translate(arrowX, arrowY);
                ctx.rotate(angle);
                
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(-arrowSize * 1.5, -arrowSize);
                ctx.lineTo(-arrowSize * 1.5, arrowSize);
                ctx.closePath();
                ctx.fill();
                
                ctx.restore();
                
                // ç”Ÿæˆç²’å­
                if (simulationState.isPlaying) {
                    const progress = (simulationState.time % 100) / 100;
                    const particleX = startX + (endX - startX) * progress;
                    const particleY = startY + (endY - startY) * progress;
                    
                    if (Math.random() < 0.3) {
                        particles.push(new Particle(
                            particleX,
                            particleY,
                            flow.color,
                            Math.cos(angle) * 2,
                            Math.sin(angle) * 2,
                            50
                        ));
                    }
                }
            }
        }
        
        function drawHumanActivities() {
            for (const [key, activity] of Object.entries(simulationState.humanActivities)) {
                const x = activity.x * canvas.width;
                const y = activity.y * canvas.height;
                
                // ç»˜åˆ¶å›¾æ ‡
                ctx.save();
                ctx.font = '30px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(activity.icon, x, y);
                ctx.restore();
                
                // ç»˜åˆ¶æ’æ”¾æµ
                const toX = simulationState.reservoirs.atmosphere.x * canvas.width;
                const toY = simulationState.reservoirs.atmosphere.y * canvas.height;
                
                const dx = toX - x;
                const dy = toY - y;
                const angle = Math.atan2(dy, dx);
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                // è°ƒæ•´ç»ˆç‚¹åˆ°å¤§æ°”åœˆè¾¹ç¼˜
                const endX = toX - Math.cos(angle) * simulationState.reservoirs.atmosphere.radius;
                const endY = toY - Math.sin(angle) * simulationState.reservoirs.atmosphere.radius;
                
                // ç»˜åˆ¶æ’æ”¾çº¿
                ctx.save();
                ctx.strokeStyle = activity.color;
                ctx.lineWidth = 3;
                ctx.lineCap = 'round';
                
                // é—ªçƒæ•ˆæœ
                const alpha = 0.5 + 0.5 * Math.sin(simulationState.time * 0.1);
                ctx.globalAlpha = alpha;
                
                ctx.beginPath();
                ctx.moveTo(x, y);
                ctx.lineTo(endX, endY);
                ctx.stroke();
                
                ctx.restore();
                
                // ç”Ÿæˆæ’æ”¾ç²’å­
                if (simulationState.isPlaying) {
                    const progress = (simulationState.time % 50) / 50;
                    const particleX = x + (endX - x) * progress;
                    const particleY = y + (endY - y) * progress;
                    
                    if (Math.random() < 0.5) {
                        particles.push(new Particle(
                            particleX,
                            particleY,
                            activity.color,
                            Math.cos(angle) * 3,
                            Math.sin(angle) * 3,
                            70
                        ));
                    }
                }
                
                // ç»˜åˆ¶æ ‡ç­¾
                if (simulationState.showLabels) {
                    ctx.fillStyle = activity.color;
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    
                    let label = '';
                    switch(key) {
                        case 'fossilFuels': label = 'åŒ–çŸ³ç‡ƒæ–™'; break;
                        case 'deforestation': label = 'æ£®æ—ç ä¼'; break;
                        case 'transportation': label = 'äº¤é€šè¿è¾“'; break;
                    }
                    
                    ctx.fillText(`${label} ${activity.rate} GtC/å¹´`, x, y + 25);
                }
            }
        }
        
        function drawGreenhouseEffect() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const maxRadius = Math.min(canvas.width, canvas.height) * 0.4;
            
            // ç»˜åˆ¶çƒ­åŠ›å›¾
            const gradient = ctx.createRadialGradient(
                centerX, centerY, maxRadius * 0.3,
                centerX, centerY, maxRadius
            );
            
            gradient.addColorStop(0, '#ef444400');
            gradient.addColorStop(0.5, '#f9731640');
            gradient.addColorStop(1, '#ef444420');
            
            ctx.save();
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(centerX, centerY, maxRadius, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
            
            // ç»˜åˆ¶æ¸©åº¦è®¡
            const thermometerX = canvas.width - 100;
            const thermometerY = 100;
            const thermometerHeight = 200;
            const thermometerWidth = 30;
            
            // æ¸©åº¦è®¡èƒŒæ™¯
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.fillRect(thermometerX, thermometerY, thermometerWidth, thermometerHeight);
            
            // æ¸©åº¦å¡«å……
            const tempHeight = (simulationState.greenhouseEffect.temperatureRise / 5) * thermometerHeight;
            const tempGradient = ctx.createLinearGradient(
                thermometerX, thermometerY + thermometerHeight - tempHeight,
                thermometerX + thermometerWidth, thermometerY + thermometerHeight
            );
            
            tempGradient.addColorStop(0, '#10b981');
            tempGradient.addColorStop(0.5, '#f59e0b');
            tempGradient.addColorStop(1, '#ef4444');
            
            ctx.fillStyle = tempGradient;
            ctx.fillRect(
                thermometerX,
                thermometerY + thermometerHeight - tempHeight,
                thermometerWidth,
                tempHeight
            );
            
            // æ¸©åº¦è®¡è¾¹æ¡†
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.lineWidth = 2;
            ctx.strokeRect(thermometerX, thermometerY, thermometerWidth, thermometerHeight);
            
            // æ ‡ç­¾
            ctx.fillStyle = '#ffffff';
            ctx.font = '12px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('å…¨çƒå‡æ¸©', thermometerX + thermometerWidth + 10, thermometerY + 20);
            ctx.fillText(`${simulationState.greenhouseEffect.temperatureRise.toFixed(1)}Â°C`, 
                        thermometerX + thermometerWidth + 10, thermometerY + 40);
        }
        
        function drawLabels() {
            // ç»˜åˆ¶æ ‡é¢˜
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ç”Ÿæ€ç³»ç»Ÿç¢³å¾ªç¯æ¨¡æ‹Ÿ', canvas.width / 2, 30);
            
            // ç»˜åˆ¶æ¨¡å¼æŒ‡ç¤ºå™¨
            let modeText =
<!--æ£€æµ‹åˆ°ä»£ç æˆªæ–­ï¼Œè‡ªåŠ¨ç»­å†™ä¸­...-->
let modeText = '';
            switch(simulationState.mode) {
                case 'natural': modeText = 'æ¨¡å¼ï¼šä»…è‡ªç„¶å¾ªç¯'; break;
                case 'preIndustrial': modeText = 'æ¨¡å¼ï¼šå·¥ä¸šé©å‘½å‰'; break;
                case 'modern': modeText = 'æ¨¡å¼ï¼šç°ä»£é«˜æ’æ”¾'; break;
                case 'future': modeText = 'æ¨¡å¼ï¼šæœªæ¥æƒ…æ™¯'; break;
            }
            
            ctx.font = '14px Arial';
            ctx.fillStyle = simulationState.isPlaying ? '#4ade80' : '#f59e0b';
            ctx.fillText(`${modeText} | ${simulationState.isPlaying ? 'æ’­æ”¾ä¸­' : 'å·²æš‚åœ'}`, canvas.width / 2, 55);
        }
        
        function drawParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                const particle = particles[i];
                particle.update();
                particle.draw(ctx);
                
                if (!particle.isAlive()) {
                    particles.splice(i, 1);
                }
            }
        }
        
        function drawInfoPanel() {
            const info = simulationState.activeInfo;
            const panelWidth = 300;
            const panelHeight = 200;
            const x = Math.min(canvas.width - panelWidth - 20, info.x + 20);
            const y = Math.min(canvas.height - panelHeight - 20, info.y + 20);
            
            // ç»˜åˆ¶é¢æ¿èƒŒæ™¯
            ctx.save();
            ctx.fillStyle = 'rgba(30, 41, 59, 0.95)';
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 2;
            ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
            ctx.shadowBlur = 10;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 5;
            
            ctx.beginPath();
            ctx.roundRect(x, y, panelWidth, panelHeight, 10);
            ctx.fill();
            ctx.stroke();
            ctx.restore();
            
            // ç»˜åˆ¶æ ‡é¢˜
            ctx.fillStyle = '#7dd3fc';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(info.title, x + 15, y + 30);
            
            // ç»˜åˆ¶å†…å®¹
            ctx.fillStyle = '#e0f2fe';
            ctx.font = '14px Arial';
            const lines = info.content.split('\n');
            lines.forEach((line, i) => {
                ctx.fillText(line, x + 15, y + 60 + i * 25);
            });
            
            // ç»˜åˆ¶å…³é—­æŒ‰é’®
            ctx.fillStyle = '#ef4444';
            ctx.font = 'bold 20px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Ã—', x + panelWidth - 20, y + 20);
        }
        
        // æ¨¡æ‹Ÿæ›´æ–°å‡½æ•°
        function updateSimulation() {
            if (!simulationState.isPlaying) return;
            
            simulationState.time += simulationState.speed;
            
            // æ ¹æ®æ¨¡å¼æ›´æ–°æ•°æ®
            switch(simulationState.mode) {
                case 'natural':
                    // è‡ªç„¶å¹³è¡¡çŠ¶æ€
                    simulationState.humanActivities.fossilFuels.rate = 0;
                    simulationState.humanActivities.deforestation.rate = 0;
                    simulationState.humanActivities.transportation.rate = 0;
                    simulationState.greenhouseEffect.temperatureRise = 0;
                    break;
                    
                case 'preIndustrial':
                    // å·¥ä¸šé©å‘½å‰
                    simulationState.humanActivities.fossilFuels.rate = 0.1;
                    simulationState.humanActivities.deforestation.rate = 0.3;
                    simulationState.humanActivities.transportation.rate = 0;
                    simulationState.greenhouseEffect.temperatureRise = 0;
                    break;
                    
                case 'modern':
                    // ç°ä»£é«˜æ’æ”¾
                    simulationState.humanActivities.fossilFuels.rate = 9.5;
                    simulationState.humanActivities.deforestation.rate = 1.5;
                    simulationState.humanActivities.transportation.rate = 8.0;
                    simulationState.greenhouseEffect.temperatureRise = 1.2;
                    break;
                    
                case 'future':
                    // æœªæ¥æƒ…æ™¯
                    simulationState.humanActivities.fossilFuels.rate = 12.0;
                    simulationState.humanActivities.deforestation.rate = 2.0;
                    simulationState.humanActivities.transportation.rate = 10.0;
                    simulationState.greenhouseEffect.temperatureRise = 2.8;
                    break;
            }
            
            // æ›´æ–°ç¢³å‚¨åº“
            updateReservoirs();
            
            // æ›´æ–°UIæ˜¾ç¤º
            updateUIDisplay();
            
            // æ›´æ–°æŒ‘æˆ˜æ¨¡æ‹Ÿ
            updateChallenge();
        }
        
        function updateReservoirs() {
            // è®¡ç®—å‡€è‡ªç„¶æµåŠ¨
            let netNaturalFlow = 0;
            for (const flow of Object.values(simulationState.flows)) {
                if (flow.active) {
                    const from = simulationState.reservoirs[flow.from];
                    const to = simulationState.reservoirs[flow.to];
                    
                    // ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç¢³
                    if (from.value >= flow.rate * 0.01) {
                        from.value -= flow.rate * 0.01;
                        to.value += flow.rate * 0.01;
                    }
                }
            }
            
            // è®¡ç®—äººç±»æ’æ”¾
            let totalHumanEmission = 0;
            for (const activity of Object.values(simulationState.humanActivities)) {
                totalHumanEmission += activity.rate;
                simulationState.reservoirs.atmosphere.value += activity.rate * 0.01;
            }
            
            // æ›´æ–°å¤§æ°”COâ‚‚æµ“åº¦æ˜¾ç¤º
            const co2Value = document.getElementById('co2Value');
            const baseCO2 = 280; // å·¥ä¸šé©å‘½å‰æµ“åº¦
            const humanContribution = totalHumanEmission * 0.47; // ç®€åŒ–è½¬æ¢å› å­
            const currentCO2 = Math.round(baseCO2 + humanContribution);
            co2Value.textContent = currentCO2;
            
            // æ›´æ–°æ¸©åº¦
            const tempValue = document.getElementById('tempValue');
            const tempRise = simulationState.greenhouseEffect.temperatureRise;
            tempValue.textContent = tempRise.toFixed(1);
            tempValue.className = 'data-value ' + 
                (tempRise < 1 ? 'success' : tempRise < 2 ? '' : 'warning');
            
            // æ›´æ–°æ’æ”¾é‡
            const emissionValue = document.getElementById('emissionValue');
            emissionValue.textContent = (totalHumanEmission * 3.67).toFixed(1); // è½¬æ¢ä¸ºGt CO2
            
            // æ›´æ–°å¹³è¡¡çŠ¶æ€
            const balanceStatus = document.getElementById('balanceStatus');
            const balanceDetail = document.getElementById('balanceDetail');
            
            const naturalAbsorption = simulationState.flows.oceanUptake.rate + 
                                     simulationState.flows.photosynthesis.rate;
            
            if (totalHumanEmission > naturalAbsorption * 0.8) {
                balanceStatus.textContent = 'ä¸¥é‡å¤±è¡¡';
                balanceStatus.className = 'data-value warning';
                balanceDetail.textContent = `(è‡ªç„¶å¸æ”¶ ${naturalAbsorption.toFixed(1)} < äººç±»æ’æ”¾ ${totalHumanEmission.toFixed(1)} GtC/å¹´)`;
            } else if (totalHumanEmission > 0) {
                balanceStatus.textContent = 'è½»åº¦å¤±è¡¡';
                balanceStatus.className = 'data-value';
                balanceDetail.textContent = `(è‡ªç„¶å¸æ”¶ ${naturalAbsorption.toFixed(1)} â‰ˆ äººç±»æ’æ”¾ ${totalHumanEmission.toFixed(1)} GtC/å¹´)`;
            } else {
                balanceStatus.textContent = 'å¹³è¡¡';
                balanceStatus.className = 'data-value success';
                balanceDetail.textContent = '(è‡ªç„¶å¾ªç¯åŠ¨æ€å¹³è¡¡)';
            }
        }
        
        function updateUIDisplay() {
            // æ›´æ–°é€Ÿåº¦æ˜¾ç¤º
            document.getElementById('speedValue').textContent = simulationState.speed.toFixed(1) + 'x';
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('btnPlay').textContent = simulationState.isPlaying ? 'â¸ï¸ æš‚åœ' : 'â–¶ï¸ æ’­æ”¾';
            
            // æ›´æ–°æ¨¡å¼æŒ‰é’®
            const modeButtons = ['btnNatural', 'btnPreIndustrial', 'btnModern', 'btnFuture'];
            modeButtons.forEach(btnId => {
                document.getElementById(btnId).classList.remove('active');
            });
            document.getElementById('btn' + simulationState.mode.charAt(0).toUpperCase() + simulationState.mode.slice(1)).classList.add('active');
        }
        
        function updateChallenge() {
            // è·å–æ»‘å—å€¼
            const energyValue = parseInt(document.getElementById('energySlider').value);
            const forestValue = parseInt(document.getElementById('forestSlider').value);
            const efficiencyValue = parseInt(document.getElementById('efficiencySlider').value);
            
            // æ›´æ–°æ˜¾ç¤ºå€¼
            document.getElementById('energyValue').textContent = energyValue + '%';
            document.getElementById('forestValue').textContent = forestValue + '%';
            document.getElementById('efficiencyValue').textContent = efficiencyValue + '%';
            
            // è®¡ç®—æœªæ¥CO2æµ“åº¦
            const baseCO2 = 415; // å½“å‰æµ“åº¦
            const energyFactor = (100 - energyValue) / 100;
            const forestFactor = (40 - forestValue) / 40;
            const efficiencyFactor = (100 - efficiencyValue) / 100;
            
            const futureCO2 = Math.round(baseCO2 + 
                energyFactor * 150 + 
                forestFactor * 80 + 
                efficiencyFactor * 70);
            
            // è®¡ç®—æœªæ¥æ¸©åº¦
            const baseTemp = 1.2;
            const tempRise = baseTemp + 
                (futureCO2 - 415) / 100 * 0.6;
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('futureCO2').textContent = futureCO2;
            document.getElementById('futureTemp').textContent = tempRise.toFixed(1);
            
            // æ›´æ–°æŒ‘æˆ˜ç»“æœ
            const challengeMessage = document.getElementById('challengeMessage');
            if (tempRise <= 2.0) {
                challengeMessage.textContent = 'âœ… è¾¾æˆ2Â°Cç›®æ ‡';
                challengeMessage.className = 'result-value success';
            } else if (tempRise <= 2.5) {
                challengeMessage.textContent = 'âš ï¸ æ¥è¿‘ç›®æ ‡';
                challengeMessage.className = 'result-value';
            } else {
                challengeMessage.textContent = 'âŒ è¶…å‡º2Â°Cç›®æ ‡';
                challengeMessage.className = 'result-value warning';
            }
        }
        
        // äº‹ä»¶å¤„ç†
        function setupEventListeners() {
            // ç”»å¸ƒç‚¹å‡»äº‹ä»¶
            canvas.addEventListener('click', (e) => {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                // æ£€æŸ¥æ˜¯å¦ç‚¹å‡»å…³é—­æŒ‰é’®
                if (simulationState.activeInfo) {
                    const panelWidth = 300;
                    const panelHeight = 200;
                    const infoX = Math.min(canvas.width - panelWidth - 20, simulationState.activeInfo.x + 20);
                    const infoY = Math.min(canvas.height - panelHeight - 20, simulationState.activeInfo.y + 20);
                    
                    if (x >= infoX + panelWidth - 30 && x <= infoX + panelWidth - 10 &&
                        y >= infoY && y <= infoY + 30) {
                        simulationState.activeInfo = null;
                        return;
                    }
                }
                
                // æ£€æŸ¥ç‚¹å‡»äº†å“ªä¸ªå…ƒç´ 
                let clickedElement = null;
                
                // æ£€æŸ¥ç¢³å‚¨åº“
                for (const [key, reservoir] of Object.entries(simulationState.reservoirs)) {
                    const resX = reservoir.x * canvas.width;
                    const resY = reservoir.y * canvas.height;
                    const distance = Math.sqrt((x - resX) ** 2 + (y - resY) ** 2);
                    
                    if (distance <= reservoir.radius) {
                        let title = '';
                        let content = '';
                        
                        switch(key) {
                            case 'atmosphere':
                                title = 'ğŸŒ¤ï¸ å¤§æ°”åœˆ';
                                content = 'ç¢³å‚¨é‡ï¼šçº¦850 GtC\nä¸»è¦è¿‡ç¨‹ï¼š\n- å…‰åˆä½œç”¨å¸æ”¶COâ‚‚\n- å‘¼å¸ä½œç”¨é‡Šæ”¾COâ‚‚\n- æµ·æ´‹æ°”ä½“äº¤æ¢\näººç±»å½±å“ï¼šåŒ–çŸ³ç‡ƒæ–™æ’æ”¾å¢åŠ å¤§æ°”COâ‚‚æµ“åº¦';
                                break;
                            case 'ocean':
                                title = 'ğŸŒŠ æµ·æ´‹';
                                content = 'ç¢³å‚¨é‡ï¼šçº¦38,000 GtC\nä¸»è¦è¿‡ç¨‹ï¼š\n- ç‰©ç†æº¶è§£æ³µ\n- ç”Ÿç‰©æ³µï¼ˆæµ®æ¸¸ç”Ÿç‰©ï¼‰\n- ç¢³é…¸ç›æ³µ\nå¸æ”¶èƒ½åŠ›ï¼šå¹´å¸æ”¶çº¦92 GtC';
                                break;
                            case 'biosphere':
                                title = 'ğŸŒ³ ç”Ÿç‰©åœˆ';
                                content = 'ç¢³å‚¨é‡ï¼šçº¦560 GtC\nä¸»è¦è¿‡ç¨‹ï¼š\n- å…‰åˆä½œç”¨å›ºå®šCOâ‚‚\n- å‘¼å¸ä½œç”¨é‡Šæ”¾COâ‚‚\n- é£Ÿç‰©é“¾ä¼ é€’\näººç±»å½±å“ï¼šæ£®æ—ç ä¼å‡å°‘ç¢³æ±‡';
                                break;
                            case 'soil':
                                title = 'ğŸŸ¤ åœŸå£¤';
                                content = 'ç¢³å‚¨é‡ï¼šçº¦2,300 GtC\nä¸»è¦è¿‡ç¨‹ï¼š\n- æœ‰æœºç‰©åˆ†è§£\n- å¾®ç”Ÿç‰©å‘¼å¸\n- ç¢³çŸ¿åŒ–\nå‚¨å­˜æ—¶é—´ï¼šæ•°ç™¾å¹´è‡³æ•°åƒå¹´';
                                break;
                        }
                        
                        clickedElement = { title, content, x, y };
                        break;
                    }
                }
                
                // æ£€æŸ¥äººç±»æ´»åŠ¨
                if (!clickedElement) {
                    for (const [key, activity] of Object.entries(simulationState.humanActivities)) {
                        const actX = activity.x * canvas.width;
                        const actY = activity.y * canvas.height;
                        const distance = Math.sqrt((x - actX) ** 2 + (y - actY) ** 2);
                        
                        if (distance <= 30) {
                            let title = '';
                            let content = '';
                            
                            switch(key) {
                                case 'fossilFuels':
                                    title = 'ğŸ­ åŒ–çŸ³ç‡ƒæ–™ç‡ƒçƒ§';
                                    content = `å¹´æ’æ”¾é‡ï¼š${activity.rate} GtC/å¹´\næ¥æºï¼š\n- ç…¤ç‚­å‘ç”µ\n- çŸ³æ²¹åŒ–å·¥\n- å¤©ç„¶æ°”\nå½±å“ï¼šå·¥ä¸šé©å‘½ä»¥æ¥ä¸»è¦æ’æ”¾æº`;
                                    break;
                                case 'deforestation':
                                    title = 'ğŸª“ åœŸåœ°åˆ©ç”¨å˜åŒ–';
                                    content = `å¹´æ’æ”¾é‡ï¼š${activity.rate} GtC/å¹´\nåŸå› ï¼š\n- æ£®æ—ç ä¼\n- å†œä¸šæ‰©å¼ \n- åŸå¸‚å‘å±•\nå½±å“ï¼šå‡å°‘ç¢³æ±‡ï¼Œé‡Šæ”¾åœŸå£¤ç¢³`;
                                    break;
                                case 'transportation':
                                    title = 'ğŸš— äº¤é€šè¿è¾“';
                                    content = `å¹´æ’æ”¾é‡ï¼š${activity.rate} GtC/å¹´\næ¥æºï¼š\n- æ±½è½¦å°¾æ°”\n- èˆªç©ºç‡ƒæ²¹\n- èˆ¹èˆ¶ç‡ƒæ–™\nè¶‹åŠ¿ï¼šéšç»æµå‘å±•æŒç»­å¢é•¿`;
                                    break;
                            }
                            
                            clickedElement = { title, content, x, y };
                            break;
                        }
                    }
                }
                
                simulationState.activeInfo = clickedElement;
            });
            
            // æ§åˆ¶æŒ‰é’®äº‹ä»¶
            document.getElementById('btnPlay').addEventListener('click', () => {
                simulationState.isPlaying = !simulationState.isPlaying;
                updateUIDisplay();
            });
            
            document.getElementById('btnReset').addEventListener('click', () => {
                simulationState.time = 0;
                simulationState.mode = 'natural';
                simulationState.isPlaying = true;
                
                // é‡ç½®ç¢³å‚¨åº“
                simulationState.reservoirs.atmosphere.value = 850;
                simulationState.reservoirs.ocean.value = 38000;
                simulationState.reservoirs.biosphere.value = 560;
                simulationState.reservoirs.soil.value = 2300;
                
                updateUIDisplay();
            });
            
            document.getElementById('btnFastForward').addEventListener('click', () => {
                simulationState.time += 10000; // å¿«è¿›100å¹´
                simulationState.mode = 'future';
                updateUIDisplay();
            });
            
            // æ¨¡å¼æŒ‰é’®äº‹ä»¶
            document.getElementById('btnNatural').addEventListener('click', () => {
                simulationState.mode = 'natural';
                updateUIDisplay();
            });
            
            document.getElementById('btnPreIndustrial').addEventListener('click', () => {
                simulationState.mode = 'preIndustrial';
                updateUIDisplay();
            });
            
            document.getElementById('btnModern').addEventListener('click', () => {
                simulationState.mode = 'modern';
                updateUIDisplay();
            });
            
            document.getElementById('btnFuture').addEventListener('click', () => {
                simulationState.mode = 'future';
                updateUIDisplay();
            });
            
            // é€Ÿåº¦æ»‘å—
            document.getElementById('speedSlider').addEventListener('input', (e) => {
                simulationState.speed = parseFloat(e.target.value);
                updateUIDisplay();
            });
            
            // æ˜¾ç¤ºé€‰é¡¹åˆ‡æ¢
            document.getElementById('toggleNatural').addEventListener('change', (e) => {
                simulationState.showNatural = e.target.checked;
            });
            
            document.getElementById('toggleHuman').addEventListener('change', (e) => {
                simulationState.showHuman = e.target.checked;
            });
            
            document.getElementById('toggleGreenhouse').addEventListener('change', (e) => {
                simulationState.showGreenhouse = e.target.checked;
            });
            
            document.getElementById('toggleLabels').addEventListener('change', (e) => {
                simulationState.showLabels = e.target.checked;
            });
            
            // æŒ‘æˆ˜æ»‘å—
            document.getElementById('energySlider').addEventListener('input', updateChallenge);
            document.getElementById('forestSlider').addEventListener('input', updateChallenge);
            document.getElementById('efficiencySlider').addEventListener('input', updateChallenge);
        }
        
        // åŠ¨ç”»å¾ªç¯
        function animate() {
            updateSimulation();
            draw();
            requestAnimationFrame(animate);
        }
        
        // åˆå§‹åŒ–
        function init() {
            setupEventListeners();
            updateChallenge(); // åˆå§‹åŒ–æŒ‘æˆ˜æ¨¡æ‹Ÿ
            animate();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', init);
        
        // æ·»åŠ roundRectæ”¯æŒ
        if (!CanvasRenderingContext2D.prototype.roundRect) {
            CanvasRenderingContext2D.prototype.roundRect = function(x, y, width, height, radius) {
                if (width < 2 * radius) radius = width / 2;
                if (height < 2 * radius) radius = height / 2;
                this.beginPath();
                this.moveTo(x + radius, y);
                this.arcTo(x + width, y, x + width, y + height, radius);
                this.arcTo(x + width, y + height, x, y + height, radius);
                this.arcTo(x, y + height, x, y, radius);
                this.arcTo(x, y, x + width, y, radius);
                this.closePath();
                return this;
            };
        }
    </script>
</body>
</html>