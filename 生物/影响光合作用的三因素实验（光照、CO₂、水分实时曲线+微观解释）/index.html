<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…‰åˆä½œç”¨ä¸‰å› ç´ å®éªŒ | äº¤äº’å¼æ•™å­¦åŠ¨ç”»</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        body {
            background-color: #E8F5E9;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        header {
            text-align: center;
            padding: 20px;
            background-color: #2E8B57;
            color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(46, 139, 87, 0.2);
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .control-panel {
            flex: 1;
            min-width: 300px;
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .experiment-area {
            flex: 2;
            min-width: 500px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .plant-container {
            flex: 1;
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
            min-height: 350px;
        }

        .graph-container {
            flex: 1;
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            min-height: 350px;
        }

        .factor-control {
            margin-bottom: 30px;
        }

        .factor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .factor-title {
            font-weight: 600;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .light-color { background-color: #1E88E5; }
        .co2-color { background-color: #43A047; }
        .water-color { background-color: #FF9800; }

        .lock-btn {
            padding: 6px 15px;
            border: none;
            border-radius: 20px;
            background-color: #546E7A;
            color: white;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .lock-btn:hover {
            opacity: 0.9;
        }

        .lock-btn.locked {
            background-color: #2E8B57;
        }

        .slider-container {
            margin-top: 15px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .slider-value {
            font-weight: 600;
        }

        .slider {
            width: 100%;
            height: 10px;
            -webkit-appearance: none;
            appearance: none;
            background: #E0E0E0;
            border-radius: 5px;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .light-slider::-webkit-slider-thumb { background-color: #1E88E5; }
        .co2-slider::-webkit-slider-thumb { background-color: #43A047; }
        .water-slider::-webkit-slider-thumb { background-color: #FF9800; }

        .control-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s;
            flex: 1;
        }

        .btn-primary {
            background-color: #2E8B57;
            color: white;
        }

        .btn-primary:hover {
            background-color: #26734a;
        }

        .btn-secondary {
            background-color: #FF5252;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #ff3838;
        }

        .mode-selector {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        .mode-btn {
            padding: 10px 20px;
            border: 2px solid #2E8B57;
            background-color: white;
            color: #2E8B57;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            flex: 1;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background-color: #2E8B57;
            color: white;
        }

        .canvas-container {
            position: relative;
            width: 100%;
            height: 300px;
        }

        #plantCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        #graphCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .micro-explanation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #2E8B57;
            font-size: 0.95rem;
            max-height: 120px;
            overflow-y: auto;
        }

        .explanation-title {
            font-weight: 600;
            color: #2E8B57;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hint {
            background-color: rgba(30, 136, 229, 0.1);
            border-left: 4px solid #1E88E5;
            padding: 12px;
            border-radius: 4px;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        @media (max-width: 1100px) {
            .main-content {
                flex-direction: column;
            }
            
            .control-panel, .experiment-area {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>å…‰åˆä½œç”¨ä¸‰å› ç´ å®éªŒ</h1>
            <p class="subtitle">å…‰ç…§ã€COâ‚‚ã€æ°´åˆ†å¯¹å…‰åˆä½œç”¨é€Ÿç‡çš„å½±å“ | å®æ—¶æ›²çº¿ä¸å¾®è§‚è§£é‡Š</p>
        </header>

        <div class="main-content">
            <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
            <div class="control-panel">
                <div class="factor-control">
                    <div class="factor-header">
                        <div class="factor-title">
                            <div class="color-indicator light-color"></div>
                            å…‰ç…§å¼ºåº¦
                        </div>
                        <button id="lightLock" class="lock-btn locked">å·²é”å®š</button>
                    </div>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>å¼±å…‰</span>
                            <span class="slider-value" id="lightValue">50%</span>
                            <span>å¼ºå…‰</span>
                        </div>
                        <input type="range" min="0" max="100" value="50" class="slider light-slider" id="lightSlider">
                    </div>
                    <div class="hint" id="lightHint">
                        è°ƒæ•´å…‰ç…§å¼ºåº¦ï¼Œè§‚å¯Ÿå…‰ååº”é€Ÿç‡å˜åŒ–ã€‚å…‰ååº”ä¸ºæš—ååº”æä¾›ATPå’ŒNADPHã€‚
                    </div>
                </div>

                <div class="factor-control">
                    <div class="factor-header">
                        <div class="factor-title">
                            <div class="color-indicator co2-color"></div>
                            COâ‚‚æµ“åº¦
                        </div>
                        <button id="co2Lock" class="lock-btn">æœªé”å®š</button>
                    </div>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>ä½æµ“åº¦</span>
                            <span class="slider-value" id="co2Value">50%</span>
                            <span>é«˜æµ“åº¦</span>
                        </div>
                        <input type="range" min="0" max="100" value="50" class="slider co2-slider" id="co2Slider">
                    </div>
                    <div class="hint" id="co2Hint">
                        COâ‚‚æ˜¯æš—ååº”çš„åŸæ–™ã€‚è°ƒæ•´æµ“åº¦ï¼Œè§‚å¯Ÿå…¶å¯¹å¡å°”æ–‡å¾ªç¯çš„å½±å“ã€‚
                    </div>
                </div>

                <div class="factor-control">
                    <div class="factor-header">
                        <div class="factor-title">
                            <div class="color-indicator water-color"></div>
                            åœŸå£¤æ°´åˆ†
                        </div>
                        <button id="waterLock" class="lock-btn">æœªé”å®š</button>
                    </div>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>å¹²ç‡¥</span>
                            <span class="slider-value" id="waterValue">50%</span>
                            <span>æ¹¿æ¶¦</span>
                        </div>
                        <input type="range" min="0" max="100" value="50" class="slider water-slider" id="waterSlider">
                    </div>
                    <div class="hint" id="waterHint">
                        æ°´åˆ†å½±å“æ°”å­”å¼€é—­ï¼Œä»è€Œå½±å“COâ‚‚å¸æ”¶ã€‚æ°´åˆ†ä¸è¶³ä¼šå¯¼è‡´æ°”å­”å…³é—­ã€‚
                    </div>
                </div>

                <div class="mode-selector">
                    <button id="singleMode" class="mode-btn active">å•å› ç´ å®éªŒæ¨¡å¼</button>
                    <button id="multiMode" class="mode-btn">ç»¼åˆæ¢ç´¢æ¨¡å¼</button>
                </div>

                <div class="control-buttons">
                    <button id="resetBtn" class="btn btn-secondary">é‡ç½®å®éªŒ</button>
                    <button id="demoBtn" class="btn btn-primary">æ˜¾ç¤ºå…¸å‹æ›²çº¿</button>
                </div>
            </div>

            <!-- å³ä¾§å®éªŒåŒºåŸŸ -->
            <div class="experiment-area">
                <!-- æ¤ç‰©å®éªŒå®¹å™¨ -->
                <div class="plant-container">
                    <div class="canvas-container">
                        <canvas id="plantCanvas"></canvas>
                        <div class="micro-explanation">
                            <div class="explanation-title">
                                <span>ğŸ”¬ å¾®è§‚è¿‡ç¨‹è§£é‡Š</span>
                            </div>
                            <div id="explanationText">
                                ç­‰å¾…å®éªŒå¼€å§‹... è¯·è°ƒæ•´ä¸Šæ–¹å› ç´ æ»‘å—ï¼Œè§‚å¯Ÿå…‰åˆä½œç”¨çš„å¾®è§‚è¿‡ç¨‹å˜åŒ–ã€‚
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å®æ—¶æ›²çº¿å›¾ -->
                <div class="graph-container">
                    <div class="canvas-container">
                        <canvas id="graphCanvas"></canvas>
                    </div>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="color-indicator light-color"></div>
                            <span>å…‰ç…§å¼ºåº¦æ›²çº¿</span>
                        </div>
                        <div class="legend-item">
                            <div class="color-indicator co2-color"></div>
                            <span>COâ‚‚æµ“åº¦æ›²çº¿</span>
                        </div>
                        <div class="legend-item">
                            <div class="color-indicator water-color"></div>
                            <span>æ°´åˆ†å«é‡æ›²çº¿</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentMode = 'single'; // 'single' æˆ– 'multi'
        let activeFactor = 'light'; // å½“å‰æ´»è·ƒå› ç´ 
        let dataPoints = {
            light: [],
            co2: [],
            water: []
        };
        let experimentHistory = [];
        let animationId = null;

        // è·å–DOMå…ƒç´ 
        const plantCanvas = document.getElementById('plantCanvas');
        const graphCanvas = document.getElementById('graphCanvas');
        const plantCtx = plantCanvas.getContext('2d');
        const graphCtx = graphCanvas.getContext('2d');
        
        // æ§åˆ¶å…ƒç´ 
        const lightSlider = document.getElementById('lightSlider');
        const co2Slider = document.getElementById('co2Slider');
        const waterSlider = document.getElementById('waterSlider');
        
        const lightValue = document.getElementById('lightValue');
        const co2Value = document.getElementById('co2Value');
        const waterValue = document.getElementById('waterValue');
        
        const lightLock = document.getElementById('lightLock');
        const co2Lock = document.getElementById('co2Lock');
        const waterLock = document.getElementById('waterLock');
        
        const lightHint = document.getElementById('lightHint');
        const co2Hint = document.getElementById('co2Hint');
        const waterHint = document.getElementById('waterHint');
        
        const explanationText = document.getElementById('explanationText');
        
        const resetBtn = document.getElementById('resetBtn');
        const demoBtn = document.getElementById('demoBtn');
        const singleModeBtn = document.getElementById('singleMode');
        const multiModeBtn = document.getElementById('multiMode');

        // åˆå§‹åŒ–ç”»å¸ƒå¤§å°
        function initCanvasSize() {
            const plantContainer = document.querySelector('.plant-container .canvas-container');
            const graphContainer = document.querySelector('.graph-container .canvas-container');
            
            plantCanvas.width = plantContainer.clientWidth;
            plantCanvas.height = plantContainer.clientHeight;
            
            graphCanvas.width = graphContainer.clientWidth;
            graphCanvas.height = graphContainer.clientHeight;
        }

        // è®¡ç®—å…‰åˆä½œç”¨é€Ÿç‡
        function calculatePhotosynthesisRate(light, co2, water) {
            // æ¨¡æ‹Ÿä¸‰å› ç´ å¯¹å…‰åˆä½œç”¨é€Ÿç‡çš„å½±å“
            // å…‰ç…§ï¼šSå‹æ›²çº¿ï¼Œé¥±å’Œç‚¹çº¦åœ¨70%
            let lightEffect = 1 - Math.exp(-light / 30);
            if (light > 70) lightEffect = 1 - Math.exp(-70 / 30) + (light - 70) * 0.002;
            
            // COâ‚‚ï¼šSå‹æ›²çº¿ï¼Œé¥±å’Œç‚¹çº¦åœ¨60%
            let co2Effect = 1 - Math.exp(-co2 / 25);
            if (co2 > 60) co2Effect = 1 - Math.exp(-60 / 25) + (co2 - 60) * 0.001;
            
            // æ°´åˆ†ï¼šæŠ›ç‰©çº¿å‹ï¼Œæœ€ä¼˜ç‚¹åœ¨70%
            let waterEffect;
            if (water <= 70) {
                waterEffect = water / 70;
            } else {
                waterEffect = 1 - (water - 70) / 30;
            }
            if (waterEffect < 0) waterEffect = 0;
            
            // é™åˆ¶å› å­ï¼šå–æœ€å°å€¼ï¼Œæ¨¡æ‹Ÿé™åˆ¶å› å­å®šå¾‹
            let rate = Math.min(lightEffect, co2Effect, waterEffect) * 100;
            
            // åœ¨ç»¼åˆæ¨¡å¼ä¸‹ï¼Œè€ƒè™‘å› ç´ çš„ååŒä½œç”¨
            if (currentMode === 'multi') {
                rate = (lightEffect * co2Effect * waterEffect * 120);
            }
            
            return Math.min(rate, 100);
        }

        // è·å–å½“å‰å› ç´ å€¼
        function getCurrentValues() {
            return {
                light: parseInt(lightSlider.value),
                co2: parseInt(co2Slider.value),
                water: parseInt(waterSlider.value)
            };
        }

        // ç»˜åˆ¶æ¤ç‰©å®éªŒåœºæ™¯
        function drawPlantScene(light, co2, water, rate) {
            const ctx = plantCtx;
            const width = plantCanvas.width;
            const height = plantCanvas.height;
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, width, height);
            
            // ç»˜åˆ¶èƒŒæ™¯
            ctx.fillStyle = '#E8F5E9';
            ctx.fillRect(0, 0, width, height);
            
            // ç»˜åˆ¶å®éªŒå®¹å™¨
            ctx.fillStyle = '#B3E5FC';
            ctx.fillRect(width * 0.1, height * 0.1, width * 0.8, height * 0.7);
            ctx.strokeStyle = '#1E88E5';
            ctx.lineWidth = 3;
            ctx.strokeRect(width * 0.1, height * 0.1, width * 0.8, height * 0.7);
            
            // ç»˜åˆ¶åœŸå£¤
            ctx.fillStyle = '#8D6E63';
            ctx.fillRect(width * 0.1, height * 0.7, width * 0.8, height * 0.2);
            
            // ç»˜åˆ¶æ°´ä½ï¼ˆæ ¹æ®æ°´åˆ†ï¼‰
            const waterLevel = height * 0.7 - (water / 100) * height * 0.1;
            ctx.fillStyle = 'rgba(30, 136, 229, 0.3)';
            ctx.fillRect(width * 0.1, waterLevel, width * 0.8, height * 0.7 - waterLevel);
            
            // ç»˜åˆ¶æ¤ç‰©èŒ
            ctx.beginPath();
            ctx.moveTo(width * 0.5, height * 0.7);
            ctx.lineTo(width * 0.5, height * 0.4);
            ctx.strokeStyle = '#388E3C';
            ctx.lineWidth = 8;
            ctx.stroke();
            
            // ç»˜åˆ¶å¶ç‰‡ï¼ˆæ ¹æ®å…‰åˆé€Ÿç‡æ”¹å˜å¤§å°å’Œé¢œè‰²ï¼‰
            const leafColor = rate > 50 ? '#4CAF50' : '#8BC34A';
            ctx.fillStyle = leafColor;
            
            // å·¦å¶ç‰‡
            ctx.beginPath();
            ctx.ellipse(width * 0.4, height * 0.45, 40 + rate * 0.3, 20 + rate * 0.2, -Math.PI/6, 0, Math.PI * 2);
            ctx.fill();
            
            // å³å¶ç‰‡
            ctx.beginPath();
            ctx.ellipse(width * 0.6, height * 0.45, 40 + rate * 0.3, 20 + rate * 0.2, Math.PI/6, 0, Math.PI * 2);
            ctx.fill();
            
            // ç»˜åˆ¶æ°”æ³¡ï¼ˆæ ¹æ®å…‰åˆé€Ÿç‡ï¼‰
            const bubbleCount = Math.floor(rate / 10);
            const now = Date.now();
            
            for (let i = 0; i < bubbleCount; i++) {
                const x = width * 0.5 + Math.sin(now/1000 + i) * 30;
                const y = height * 0.4 - (now/50 + i * 50) % (height * 0.5);
                const size = 3 + Math.sin(now/500 + i) * 2;
                
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(33, 150, 243, 0.7)';
                ctx.fill();
                
                // æ°”æ³¡é«˜å…‰
                ctx.beginPath();
                ctx.arc(x - size/3, y - size/3, size/3, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.fill();
            }
            
            // ç»˜åˆ¶å…‰ç…§æ•ˆæœ
            if (light > 0) {
                const gradient = ctx.createRadialGradient(
                    width * 0.8, height * 0.2, 10,
                    width * 0.8, height * 0.2, 100 + light
                );
                gradient.addColorStop(0, 'rgba(255, 255, 200, 0.8)');
                gradient.addColorStop(1, 'rgba(255, 255, 200, 0)');
                
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, width, height);
            }
            
            // ç»˜åˆ¶å¾®è§‚è§£é‡Šå›¾æ ‡
            drawMicroExplanation(ctx, width, height, light, co2, water, rate);
        }

        // ç»˜åˆ¶å¾®è§‚è§£é‡Š
        function drawMicroExplanation(ctx, width, height, light, co2, water, rate) {
            const centerX = width * 0.8;
            const centerY = height * 0.25;
            const size = 80;
            
            // ç»˜åˆ¶å¶ç»¿ä½“å®¹å™¨
            ctx.fillStyle = 'rgba(76, 175, 80, 0.1)';
            ctx.fillRect(centerX - size/2, centerY - size/2, size, size);
            ctx.strokeStyle = '#4CAF50';
            ctx.lineWidth = 2;
            ctx.strokeRect(centerX - size/2, centerY - size/2, size, size);
            
            // ç»˜åˆ¶å…‰ååº”ï¼ˆå·¦ä¾§ï¼‰
            const lightReactionX = centerX - size/3;
            
            // å…‰å­
            for (let i = 0; i < Math.floor(light/20); i++) {
                const angle = (Date.now()/500 + i) % (Math.PI * 2);
                const x = lightReactionX + Math.cos(angle) * 15;
                const y = centerY + Math.sin(angle) * 15;
                
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, Math.PI * 2);
                ctx.fillStyle = '#FFC107';
                ctx.fill();
            }
            
            // æ°´åˆ†å­åˆ†è§£
            ctx.font = '12px Arial';
            ctx.fillStyle = '#2196F3';
            ctx.fillText('Hâ‚‚O', lightReactionX - 10, centerY + 30);
            
            if (light > 30) {
                ctx.fillText('â†’', lightReactionX, centerY + 30);
                ctx.fillStyle = '#4CAF50';
                ctx.fillText('Oâ‚‚', lightReactionX + 10, centerY + 30);
            }
            
            // ç»˜åˆ¶ATP/NADPHï¼ˆå°ç”µæ± ï¼‰
            if (light > 20) {
                ctx.fillStyle = '#FF9800';
                ctx.fillRect(lightReactionX - 8, centerY - 20, 16, 10);
                ctx.fillStyle = '#795548';
                ctx.fillRect(lightReactionX - 3, centerY - 25, 6, 5);
            }
            
            // ç»˜åˆ¶æš—ååº”ï¼ˆå³ä¾§ï¼‰
            const darkReactionX = centerX + size/3;
            
            // COâ‚‚åˆ†å­
            ctx.fillStyle = '#43A047';
            for (let i = 0; i < Math.floor(co2/25); i++) {
                const x = darkReactionX + Math.sin(Date.now()/800 + i) * 10;
                const y = centerY - 15 + i * 8;
                
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = 'white';
                ctx.font = '10px Arial';
                ctx.fillText('COâ‚‚', x - 8, y + 3);
                ctx.fillStyle = '#43A047';
            }
            
            // ç»˜åˆ¶ç³–åˆ†å­ï¼ˆå¦‚æœæ¡ä»¶åˆé€‚ï¼‰
            if (co2 > 30 && light > 30 && water > 30) {
                ctx.fillStyle = '#8BC34A';
                ctx.beginPath();
                ctx.arc(darkReactionX, centerY + 20, 6, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = 'white';
                ctx.font = '10px Arial';
                ctx.fillText('Câ‚†Hâ‚â‚‚Oâ‚†', darkReactionX - 15, centerY + 25);
            }
            
            // ç»˜åˆ¶æ°´åˆ†å½±å“æŒ‡ç¤ºå™¨
            if (water < 30) {
                ctx.fillStyle = '#FF5252';
                ctx.font = 'bold 14px Arial';
                ctx.fillText('æ°”å­”å…³é—­', centerX - 25, centerY - 40);
            }
        }

        // ç»˜åˆ¶å®æ—¶æ›²çº¿å›¾
        function drawGraph() {
            const ctx = graphCtx;
            const width = graphCanvas.width;
            const height = graphCanvas.height;
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, width, height);
            
            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = '#546E7A';
            ctx.lineWidth = 2;
            
            // Yè½´
            ctx.beginPath();
            ctx.moveTo(50, 30);
            ctx.lineTo(50, height - 50);
            ctx.stroke();
            
            // Xè½´
            ctx.beginPath();
            ctx.moveTo(50, height - 50);
            ctx.lineTo(width - 30, height - 50);
            ctx.stroke();
            
            // åæ ‡è½´æ ‡ç­¾
            ctx.fillStyle = '#546E7A';
            ctx.font = '14px Arial';
            ctx.fillText('å…‰åˆä½œç”¨é€Ÿç‡ (%)', 10, 20);
            ctx.fillText('å› ç´ å¼ºåº¦ (%)', width - 80, height - 20);
            
            // Yè½´åˆ»åº¦
            for (let i = 0; i <= 100; i += 20) {
                const y = height - 50 - (i / 100) * (height - 100);
                ctx.beginPath();
                ctx.moveTo(45, y);
                ctx.lineTo(50, y);
                ctx.stroke();
                
                ctx.fillText(i.toString(), 30, y + 4);
            }
            
            // Xè½´åˆ»åº¦
            for (let i = 0; i <= 100; i += 20) {
                const x = 50 + (i / 100) * (width - 100);
                ctx.beginPath();
                ctx.moveTo(x, height - 50);
                ctx.lineTo(x, height - 45);
                ctx.stroke();
                
                ctx.fillText(i.toString(), x - 5, height - 30);
            }
            
            // ç»˜åˆ¶æ•°æ®ç‚¹
            drawDataPoints(ctx, width, height, 'light', '#1E88E5');
            drawDataPoints(ctx, width, height, 'co2', '#43A047');
            drawDataPoints(ctx, width, height, 'water', '#FF9800');
            
            // ç»˜åˆ¶å½“å‰ç‚¹
            const values = getCurrentValues();
            const rate = calculatePhotosynthesisRate(values.light, values.co2, values.water);
            
            let currentX;
            if (currentMode === 'single') {
                switch(activeFactor) {
                    case 'light':
                        currentX = 50 + (values.light / 100) * (width - 100);
                        break;
                    case 'co2':
                        currentX = 50 + (values.co2 / 100) * (width - 100);
                        break;
                    case 'water':
                        currentX = 50 + (values.water / 100) * (width - 100);
                        break;
                }
            } else {
                currentX = 50 + (values.light / 100) * (width - 100);
            }
            
            const currentY = height - 50 - (rate / 100) * (height - 100);
            
            // ç»˜åˆ¶å½“å‰ç‚¹
            ctx.beginPath();
            ctx.arc(currentX, currentY, 8, 0, Math.PI * 2);
            ctx.fillStyle = '#FF5252';
            ctx.fill();
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        // ç»˜åˆ¶æ•°æ®ç‚¹
        function drawDataPoints(ctx, width, height, factor, color) {
            const points = dataPoints[factor];
            if (points.length === 0) return;
            
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.setLineDash([]);
            
            // ç»˜åˆ¶è¿çº¿
            ctx.beginPath();
            for (let i = 0; i < points.length; i++) {
                const x = 50 + (points[i].x / 100) * (width - 100);
                const y = height - 50 - (points[i].y / 100) * (height - 100);
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // ç»˜åˆ¶æ•°æ®ç‚¹
            ctx.fillStyle = color;
            for (let i = 0; i < points.length; i++) {
                const x = 50 + (points[i].x / 100) * (width - 100);
                const y = height - 50 - (points[i].y / 100) * (height - 100);
                
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // æ›´æ–°è§£é‡Šæ–‡æœ¬
        function updateExplanation(light, co2, water, rate) {
            let explanation = '';
            
            if (currentMode === 'single') {
                switch(activeFactor) {
                    case 'light':
                        if (light < 30) {
                            explanation = `ğŸ’¡ å…‰ç…§è¾ƒå¼±ï¼šå…‰ååº”é€Ÿç‡ä½ï¼Œäº§ç”Ÿçš„ATPå’ŒNADPHä¸è¶³ï¼Œé™åˆ¶äº†æ•´ä¸ªå…‰åˆä½œç”¨è¿‡ç¨‹ã€‚`;
                        } else if (light < 70) {
                            explanation = `ğŸ’¡ å…‰ç…§é€‚ä¸­ï¼šå…‰ååº”æ­£å¸¸è¿›è¡Œï¼Œä¸ºæš—ååº”æä¾›å……è¶³çš„ATPå’ŒNADPHã€‚å…‰åˆé€Ÿç‡éšå…‰ç…§å¢å¼ºè€Œæé«˜ã€‚`;
                        } else {
                            explanation = `ğŸ’¡ å…‰ç…§è¿‡å¼ºï¼šå·²è¾¾åˆ°å…‰é¥±å’Œç‚¹ã€‚ç»§ç»­å¢åŠ å…‰ç…§ï¼Œå…‰åˆé€Ÿç‡ä¸å†æé«˜ï¼Œå¯èƒ½å¼•èµ·å…‰æŠ‘åˆ¶ã€‚`;
                        }
                        break;
                        
                    case 'co2':
                        if (co2 < 20) {
                            explanation = `ğŸŒ¿ COâ‚‚æµ“åº¦ä½ï¼šæš—ååº”åŸæ–™ä¸è¶³ï¼Œå¡å°”æ–‡å¾ªç¯å—é™ã€‚å³ä½¿å…‰ååº”æ­£å¸¸ï¼Œå…‰åˆé€Ÿç‡ä¹Ÿå¾ˆä½ã€‚`;
                        } else if (co2 < 60) {
                            explanation = `ğŸŒ¿ COâ‚‚æµ“åº¦é€‚ä¸­ï¼šæš—ååº”æ­£å¸¸è¿›è¡Œï¼ŒCOâ‚‚è¢«å›ºå®šä¸ºæœ‰æœºç‰©ã€‚å…‰åˆé€Ÿç‡éšCOâ‚‚æµ“åº¦å¢åŠ è€Œæé«˜ã€‚`;
                        } else {
                            explanation = `ğŸŒ¿ COâ‚‚æµ“åº¦é«˜ï¼šå·²è¾¾åˆ°COâ‚‚é¥±å’Œç‚¹ã€‚ç»§ç»­å¢åŠ COâ‚‚ï¼Œå…‰åˆé€Ÿç‡æé«˜ä¸æ˜æ˜¾ã€‚`;
                        }
                        break;
                        
                    case 'water':
                        if (water < 30) {
                            explanation = `ğŸ’§ æ°´åˆ†ä¸è¶³ï¼šæ¤ç‰©æ°”å­”å…³é—­ä»¥å‡å°‘æ°´åˆ†è’¸å‘ï¼Œä½†åŒæ—¶é™åˆ¶äº†COâ‚‚çš„å¸æ”¶ã€‚å…‰åˆé€Ÿç‡æ˜¾è‘—ä¸‹é™ã€‚`;
                        } else if (water < 70) {
                            explanation = `ğŸ’§ æ°´åˆ†é€‚ä¸­ï¼šæ°”å­”æ­£å¸¸å¼€æ”¾ï¼ŒCOâ‚‚å¸æ”¶è‰¯å¥½ã€‚æ°´åˆ†å‚ä¸å…‰ååº”ï¼Œæä¾›ç”µå­å’ŒHâºã€‚`;
                        } else {
                            explanation = `ğŸ’§ æ°´åˆ†è¿‡å¤šï¼šåœŸå£¤ç¼ºæ°§å½±å“æ ¹ç³»å‘¼å¸ï¼Œé—´æ¥é™åˆ¶å…‰åˆä½œç”¨ã€‚`;
                        }
                        break;
                }
            } else {
                // ç»¼åˆæ¨¡å¼è§£é‡Š
                const limitingFactor = getLimitingFactor(light, co2, water, rate);
                explanation = `ğŸ”¬ ç»¼åˆæ¨¡å¼ï¼šå½“å‰å…‰åˆé€Ÿç‡ ${rate.toFixed(1)}%ã€‚`;
                
                if (limitingFactor) {
                    explanation += ` ä¸»è¦é™åˆ¶å› å­ï¼š${limitingFactor}ã€‚`;
                }
                
                if (rate > 70) {
                    explanation += ` ä¸‰å› ç´ é…åˆè‰¯å¥½ï¼Œå…‰åˆä½œç”¨é«˜æ•ˆè¿›è¡Œã€‚`;
                }
            }
            
            explanationText.textContent = explanation;
        }

        // è·å–ä¸»è¦é™åˆ¶å› å­
        function getLimitingFactor(light, co2, water, rate) {
            const lightEffect = 1 - Math.exp(-light / 30);
            const co2Effect = 1 - Math.exp(-co2 / 25);
            const waterEffect = water <= 70 ? water / 70 : 1 - (water - 70) / 30;
            
            const minEffect = Math.min(lightEffect, co2Effect, waterEffect);
            
            if (minEffect === lightEffect && lightEffect < 0.7) return 'å…‰ç…§å¼ºåº¦';
            if (minEffect === co2Effect && co2Effect < 0.7) return 'COâ‚‚æµ“åº¦';
            if (minEffect === waterEffect && waterEffect < 0.7) return 'åœŸå£¤æ°´åˆ†';
            
            return null;
        }

        // æ·»åŠ æ•°æ®ç‚¹
        function addDataPoint(factor, x, y) {
            dataPoints[factor].push({x, y});
            
            // ä¿æŒæœ€å¤š20ä¸ªæ•°æ®ç‚¹
            if (dataPoints[factor].length > 20) {
                dataPoints[factor].shift();
            }
        }

        // æ›´æ–°æ»‘å—å€¼æ˜¾ç¤º
        function updateSliderValues() {
            lightValue.textContent = `${lightSlider.value}%`;
            co2Value.textContent = `${co2Slider.value}%`;
            waterValue.textContent = `${waterSlider.value}%`;
        }

        // é‡ç½®å®éªŒ
        function resetExperiment() {
            dataPoints = {
                light: [],
                co2: [],
                water: []
            };
            
            lightSlider.value = 50;
            co2Slider.value = 50;
            waterSlider.value = 50;
            
            updateSliderValues();
            updateDisplay();
            
            explanationText.textContent = 'å®éªŒå·²é‡ç½®ã€‚è¯·è°ƒæ•´å› ç´ æ»‘å—å¼€å§‹æ–°çš„å®éªŒã€‚';
        }

        // æ˜¾ç¤ºå…¸å‹æ›²çº¿
        function showDemoCurves() {
            resetExperiment();
            
            // ç”Ÿæˆå…¸å‹æ•°æ®ç‚¹
            for (let i = 0; i <= 100; i += 5) {
                // å…‰ç…§æ›²çº¿ï¼šSå‹ï¼Œé¥±å’Œç‚¹åœ¨70
                const lightRate = Math.min(100, (1 - Math.exp(-i/30)) * 120);
                dataPoints.light.push({x: i, y: lightRate});
                
                // COâ‚‚æ›²çº¿ï¼šSå‹ï¼Œé¥±å’Œç‚¹åœ¨60
                const co2Rate = Math.min(100, (1 - Math.exp(-i/25)) * 110);
                dataPoints.co2.push({x: i, y: co2Rate});
                
                // æ°´åˆ†æ›²çº¿ï¼šæŠ›ç‰©çº¿ï¼Œå³°å€¼åœ¨70
                let waterRate;
                if (i <= 70) {
                    waterRate = (i / 70) * 100;
                } else {
                    waterRate = (1 - (i - 70) / 30) * 100;
                }
                dataPoints.water.push({x: i, y: waterRate});
            }
            
            updateDisplay();
            explanationText.textContent = 'å·²æ˜¾ç¤ºå…¸å‹æ›²çº¿ã€‚å…‰ç…§å’ŒCOâ‚‚å‘ˆSå‹æ›²çº¿ï¼ˆæœ‰é¥±å’Œç‚¹ï¼‰ï¼Œæ°´åˆ†å‘ˆæŠ›ç‰©çº¿å‹ï¼ˆæœ‰æœ€é€‚ç‚¹ï¼‰ã€‚';
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            const values = getCurrentValues();
            const rate = calculatePhotosynthesisRate(values.light, values.co2, values.water);
            
            drawPlantScene(values.light, values.co2, values.water, rate);
            drawGraph();
            updateExplanation(values.light, values.co2, values.water, rate);
            
            // åœ¨å•å› ç´ æ¨¡å¼ä¸‹ï¼Œè®°å½•æ•°æ®ç‚¹
            if (currentMode === 'single') {
                let xValue;
                switch(activeFactor) {
                    case 'light':

<!--æ£€æµ‹åˆ°ä»£ç æˆªæ–­ï¼Œè‡ªåŠ¨ç»­å†™ä¸­...-->
xValue = values.light;
                        break;
                    case 'co2':
                        xValue = values.co2;
                        break;
                    case 'water':
                        xValue = values.water;
                        break;
                }
                
                // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸è¿‘çš„æ•°æ®ç‚¹
                const existingPoint = dataPoints[activeFactor].find(p => Math.abs(p.x - xValue) < 2);
                if (!existingPoint) {
                    addDataPoint(activeFactor, xValue, rate);
                }
            }
        }

        // é”å®š/è§£é”å› ç´ 
        function toggleLock(factor) {
            const lockBtns = {
                light: lightLock,
                co2: co2Lock,
                water: waterLock
            };
            
            const sliders = {
                light: lightSlider,
                co2: co2Slider,
                water: waterSlider
            };
            
            const hints = {
                light: lightHint,
                co2: co2Hint,
                water: waterHint
            };
            
            // å¦‚æœå½“å‰æ¨¡å¼æ˜¯å•å› ç´ ï¼Œå¤„ç†é”å®šé€»è¾‘
            if (currentMode === 'single') {
                // å¦‚æœç‚¹å‡»çš„æ˜¯å·²é”å®šçš„æŒ‰é’®ï¼Œåˆ™è§£é”å®ƒ
                if (lockBtns[factor].classList.contains('locked')) {
                    // è§£é”å½“å‰å› ç´ 
                    lockBtns[factor].classList.remove('locked');
                    lockBtns[factor].textContent = 'æœªé”å®š';
                    sliders[factor].disabled = false;
                    hints[factor].style.opacity = '0.6';
                    
                    // æ‰¾åˆ°ä¸‹ä¸€ä¸ªæœªé”å®šçš„å› ç´ å¹¶é”å®šå®ƒ
                    const factors = ['light', 'co2', 'water'];
                    for (const f of factors) {
                        if (f !== factor && !lockBtns[f].classList.contains('locked')) {
                            lockBtns[f].classList.add('locked');
                            lockBtns[f].textContent = 'å·²é”å®š';
                            sliders[f].disabled = true;
                            hints[f].style.opacity = '0.3';
                            activeFactor = f;
                            break;
                        }
                    }
                }
            }
            
            updateDisplay();
        }

        // åˆ‡æ¢æ¨¡å¼
        function switchMode(mode) {
            currentMode = mode;
            
            if (mode === 'single') {
                singleModeBtn.classList.add('active');
                multiModeBtn.classList.remove('active');
                
                // åˆå§‹åŒ–é”å®šçŠ¶æ€ï¼šé”å®šco2å’Œwaterï¼Œæ¿€æ´»light
                lightLock.classList.add('locked');
                lightLock.textContent = 'å·²é”å®š';
                lightSlider.disabled = false;
                lightHint.style.opacity = '1';
                
                co2Lock.classList.remove('locked');
                co2Lock.textContent = 'æœªé”å®š';
                co2Slider.disabled = true;
                co2Hint.style.opacity = '0.3';
                
                waterLock.classList.remove('locked');
                waterLock.textContent = 'æœªé”å®š';
                waterSlider.disabled = true;
                waterHint.style.opacity = '0.3';
                
                activeFactor = 'light';
                
                explanationText.textContent = 'å•å› ç´ å®éªŒæ¨¡å¼å·²æ¿€æ´»ã€‚å½“å‰ç ”ç©¶å› ç´ ï¼šå…‰ç…§å¼ºåº¦ã€‚è°ƒæ•´å…‰ç…§æ»‘å—ï¼Œè§‚å¯Ÿæ›²çº¿å˜åŒ–ã€‚';
            } else {
                singleModeBtn.classList.remove('active');
                multiModeBtn.classList.add('active');
                
                // è§£é”æ‰€æœ‰å› ç´ 
                lightLock.classList.remove('locked');
                lightLock.textContent = 'æœªé”å®š';
                lightSlider.disabled = false;
                lightHint.style.opacity = '1';
                
                co2Lock.classList.remove('locked');
                co2Lock.textContent = 'æœªé”å®š';
                co2Slider.disabled = false;
                co2Hint.style.opacity = '1';
                
                waterLock.classList.remove('locked');
                waterLock.textContent = 'æœªé”å®š';
                waterSlider.disabled = false;
                waterHint.style.opacity = '1';
                
                explanationText.textContent = 'ç»¼åˆæ¢ç´¢æ¨¡å¼å·²æ¿€æ´»ã€‚å¯åŒæ—¶è°ƒæ•´æ‰€æœ‰å› ç´ ï¼Œè§‚å¯Ÿé™åˆ¶å› å­æ•ˆåº”ã€‚';
            }
            
            // æ¸…ç©ºæ•°æ®ç‚¹
            dataPoints = {
                light: [],
                co2: [],
                water: []
            };
            
            updateDisplay();
        }

        // åŠ¨ç”»å¾ªç¯
        function animate() {
            updateDisplay();
            animationId = requestAnimationFrame(animate);
        }

        // åˆå§‹åŒ–
        function init() {
            // è®¾ç½®åˆå§‹ç”»å¸ƒå¤§å°
            initCanvasSize();
            
            // åˆå§‹æ˜¾ç¤º
            updateSliderValues();
            switchMode('single');
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            lightSlider.addEventListener('input', () => {
                updateSliderValues();
                updateDisplay();
            });
            
            co2Slider.addEventListener('input', () => {
                updateSliderValues();
                updateDisplay();
            });
            
            waterSlider.addEventListener('input', () => {
                updateSliderValues();
                updateDisplay();
            });
            
            lightLock.addEventListener('click', () => toggleLock('light'));
            co2Lock.addEventListener('click', () => toggleLock('co2'));
            waterLock.addEventListener('click', () => toggleLock('water'));
            
            resetBtn.addEventListener('click', resetExperiment);
            demoBtn.addEventListener('click', showDemoCurves);
            
            singleModeBtn.addEventListener('click', () => switchMode('single'));
            multiModeBtn.addEventListener('click', () => switchMode('multi'));
            
            // çª—å£å¤§å°æ”¹å˜æ—¶è°ƒæ•´ç”»å¸ƒ
            window.addEventListener('resize', () => {
                initCanvasSize();
                updateDisplay();
            });
            
            // å¼€å§‹åŠ¨ç”»å¾ªç¯
            animate();
            
            // åˆå§‹æç¤º
            explanationText.textContent = 'æ¬¢è¿ä½¿ç”¨å…‰åˆä½œç”¨ä¸‰å› ç´ å®éªŒæ¨¡æ‹Ÿï¼åœ¨å•å› ç´ æ¨¡å¼ä¸‹ï¼Œæ¯æ¬¡åªç ”ç©¶ä¸€ä¸ªå› ç´ å¯¹å…‰åˆä½œç”¨çš„å½±å“ã€‚';
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', init);
    </script>
</body>
</html>